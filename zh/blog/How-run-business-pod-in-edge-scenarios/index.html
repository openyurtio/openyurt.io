<!doctype html>
<html lang="zh" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/zh/blog/rss.xml" title="OpenYurt RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh/blog/atom.xml" title="OpenYurt Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="OpenYurt" href="/zh/opensearch.xml"><title data-react-helmet="true">OpenYurtï¼šåœ¨è¾¹ç¼˜åœºæ™¯æ— ç¼è¿è¡Œä½¿ç”¨InClusterConfigçš„ä¸šåŠ¡Pod | OpenYurt</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://openyurt.io/zh/blog/How-run-business-pod-in-edge-scenarios"><meta data-react-helmet="true" name="docsearch:language" content="zh"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="OpenYurtï¼šåœ¨è¾¹ç¼˜åœºæ™¯æ— ç¼è¿è¡Œä½¿ç”¨InClusterConfigçš„ä¸šåŠ¡Pod | OpenYurt"><meta data-react-helmet="true" name="description" content="1.èƒŒæ™¯ä»‹ç»"><meta data-react-helmet="true" property="og:description" content="1.èƒŒæ™¯ä»‹ç»"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2021-10-15T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://github.com/rambohe-ch"><meta data-react-helmet="true" property="article:tag" content="openyurt"><link data-react-helmet="true" rel="shortcut icon" href="/zh/img/openyurt.ico"><link data-react-helmet="true" rel="canonical" href="https://openyurt.io/zh/blog/How-run-business-pod-in-edge-scenarios"><link data-react-helmet="true" rel="alternate" href="https://openyurt.io/blog/How-run-business-pod-in-edge-scenarios" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://openyurt.io/zh/blog/How-run-business-pod-in-edge-scenarios" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://openyurt.io/blog/How-run-business-pod-in-edge-scenarios" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/zh/assets/css/styles.f0d5cd5f.css">
<link rel="preload" href="/zh/assets/js/runtime~main.c70e262d.js" as="script">
<link rel="preload" href="/zh/assets/js/main.dffb8149.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><div class="announcementBar_axC9" role="banner"><div class="announcementBarPlaceholder_xYHE"></div><div class="announcementBarContent_6uhP">â­ï¸ If you like OpenYurt, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/openyurtio/openyurt">GitHub</a>! â­ï¸</div><button type="button" class="clean-btn close announcementBarClose_A3A1" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><div class="navbar__logo"><img src="/zh/img/openyurt.ico" alt="OpenYurt" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/zh/img/openyurt.ico" alt="OpenYurt" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">OpenYurt</b></a><a class="navbar__item navbar__link" href="/zh/docs/">æ–‡æ¡£</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh/blog">åšå®¢</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/zh/docs/">v0.6.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh/docs/next/">Next</a></li><li><a class="dropdown__link" href="/zh/docs/">v0.6.0</a></li><li><a class="dropdown__link" href="/zh/docs/v0.5.0/">v0.5.0</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_EbrZ"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>ç®€ä½“ä¸­æ–‡</span></span></a><ul class="dropdown__menu"><li><a href="/blog/How-run-business-pod-in-edge-scenarios" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li><li><a href="/zh/blog/How-run-business-pod-in-edge-scenarios" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">ç®€ä½“ä¸­æ–‡</a></li></ul></div><a href="https://github.com/openyurtio/openyurt" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ğŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ğŸŒ</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_NKBi"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_q+wC thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_9G5K margin-bottom--md">All posts</div><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zh/blog/How-to-use-yurtctl-convert-revert">Kubernetesä¸OpenYurtæ— ç¼è½¬æ¢ï¼ˆå‘½ä»¤å¼ï¼‰</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zh/blog/How-to-use-service-topology">OpenYurtè¾¹ç¼˜æµé‡é—­ç¯èƒ½åŠ›è§£æ</a></li><li class="sidebarItem_cjdF"><a aria-current="page" class="sidebarItemLink_zyXk sidebarItemLinkActive_wcJs" href="/zh/blog/How-run-business-pod-in-edge-scenarios">OpenYurtï¼šåœ¨è¾¹ç¼˜åœºæ™¯æ— ç¼è¿è¡Œä½¿ç”¨InClusterConfigçš„ä¸šåŠ¡Pod</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zh/blog/Edge-gateway-caching-capabilities">è¾¹ç¼˜ç½‘å…³ç¼“å­˜èƒ½åŠ›çš„ä¼˜é›…å®ç°</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zh/blog/Play-with-OpenYurt-on-Raspberry-Pi">åœ¨æ ‘è“æ´¾ä¸Šç©è½¬ OpenYurt</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zh/blog/Build-side-efficient-collaborative-network">å¦‚ä½•æ„å»ºKubernetesåŸç”Ÿäº‘è¾¹é«˜æ•ˆååŒç½‘ç»œ</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zh/blog/Expansion-capability-of-Yurthub">ä»è¾¹ç¼˜è‡ªæ²»çœ‹YurtHubçš„æ‰©å±•èƒ½åŠ›</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zh/blog/YurtHub-design-detail">æ·±åº¦è§£è¯»OpenYurtï¼šè¾¹ç¼˜è‡ªæ²»èƒ½åŠ›è®¾è®¡è§£æ</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zh/blog/Use-of-yurtctl">OpenYurtï½œä¸€é”®è®©åŸç”Ÿk8sé›†ç¾¤å…·å¤‡è¾¹ç¼˜è®¡ç®—èƒ½åŠ›</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zh/blog/Introduce-of-OpenYurt">è¾¹ç¼˜è®¡ç®—äº‘åŸç”Ÿé¡¹ç›® OpenYurt</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_d4p0" itemprop="headline">OpenYurtï¼šåœ¨è¾¹ç¼˜åœºæ™¯æ— ç¼è¿è¡Œä½¿ç”¨InClusterConfigçš„ä¸šåŠ¡Pod</h1><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2021-10-15T00:00:00.000Z" itemprop="datePublished">2021å¹´10æœˆ15æ—¥</time> Â· <!-- -->é˜…è¯»éœ€è¦ 1 åˆ†é’Ÿ</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://github.com/rambohe-ch" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://github.com/rambohe-ch.png" alt="rambohe"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/rambohe-ch" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">rambohe</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of OpenYurt</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h3 class="anchor anchorWithStickyNavbar_y2LR" id="1èƒŒæ™¯ä»‹ç»">1.èƒŒæ™¯ä»‹ç»<a aria-hidden="true" class="hash-link" href="#1èƒŒæ™¯ä»‹ç»" title="Direct link to heading">â€‹</a></h3><p>OpenYurtæ˜¯ä¸šç•Œé¦–ä¸ªéä¾µå…¥çš„è¾¹ç¼˜è®¡ç®—äº‘åŸç”Ÿå¼€æºé¡¹ç›®ï¼Œé€šè¿‡è¾¹ç¼˜è‡ªæ²»ï¼Œäº‘è¾¹ååŒï¼Œè¾¹ç¼˜å•å…ƒåŒ–ï¼Œè¾¹ç¼˜æµé‡é—­ç¯ç­‰èƒ½åŠ›ä¸ºç”¨æˆ·æä¾›äº‘è¾¹ä¸€ä½“åŒ–çš„ä½¿ç”¨ä½“éªŒã€‚ä¸å°‘ç”¨æˆ·åœ¨ä½¿ç”¨OpenYurtçš„æ—¶å€™ï¼Œç»å¸¸éœ€è¦æŠŠå­˜é‡çš„ä½¿ç”¨InClusterConfigè®¿é—®kube-apiserverçš„Podé€šè¿‡OpenYurtè¿ç§»åˆ°è¾¹ç¼˜ç¯å¢ƒä¸­ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/zh/assets/images/InCluster1-1ef22d79567f77ccd6a6d7eeb72185ac.png"></p><p>åœ¨OpenYurté›†ç¾¤ä¸­ï¼Œæä¾›äº†ä½¿ç”¨InClusterConfigçš„ä¸šåŠ¡Podé›¶ä¿®æ”¹å°±å¯ä»¥è¿è¡Œåœ¨è¾¹ç¼˜ç¯å¢ƒçš„èƒ½åŠ›ã€‚</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="2é¢ä¸´æŒ‘æˆ˜">2.é¢ä¸´æŒ‘æˆ˜<a aria-hidden="true" class="hash-link" href="#2é¢ä¸´æŒ‘æˆ˜" title="Direct link to heading">â€‹</a></h3><p>ä½¿ç”¨InClusterConfigçš„ä¸šåŠ¡Podåœ¨è¾¹ç¼˜ç¯å¢ƒä¸­è¿è¡Œï¼Œéœ€è¦è§£å†³å¦‚ä¸‹é—®é¢˜ï¼š</p><ul><li><p>é—®é¢˜ä¸€ï¼šPodé€šè¿‡InClusterConfigåœ°å€è®¿é—®kube-apiserverï¼ŒèŠ‚ç‚¹ä¸Šé»˜è®¤ç½‘ç»œè§„åˆ™ï¼ˆiptables/ipvsï¼‰å°†ä¼šæŠŠè¯·æ±‚è½¬å‘åˆ°kube-apiserverçš„PodIPï¼ŒåŒæ—¶äº‘ç«¯ä¸è¾¹ç¼˜ä½äºä¸åŒç½‘ç»œå¹³é¢ï¼Œè¾¹ç¼˜æ˜¯æ— æ³•è®¿é—®åˆ°äº‘ç«¯çš„PodIPã€‚æ‰€ä»¥è¾¹ç¼˜ä¸šåŠ¡Podæ— æ³•é€šè¿‡InClusterConfigè®¿é—®åˆ°kube-apiserverã€‚</p><p><img alt="Incluster2" src="/zh/assets/images/Incluster2-7f6a69f9c29152322fbc57bf978eca6e.png"></p></li><li><p>é—®é¢˜äºŒï¼šåœ¨è§£å†³é—®é¢˜ä¸€åï¼Œå¦‚æœäº‘è¾¹ç½‘ç»œæ–­å¼€æ—¶ä¸šåŠ¡Podå®¹å™¨å‡ºç°é‡å¯ç­‰çŠ¶å†µï¼Œè¾¹ç¼˜Podå°†æ— æ³•ä»kube-apiserverè·å–åˆ°ä¸šåŠ¡é…ç½®ï¼Œè¿™ä¼šå½±å“åˆ°ä¸šåŠ¡Podçš„é‡å¯è¿è¡Œã€‚</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="3è§£å†³æ–¹æ¡ˆ">3.è§£å†³æ–¹æ¡ˆ<a aria-hidden="true" class="hash-link" href="#3è§£å†³æ–¹æ¡ˆ" title="Direct link to heading">â€‹</a></h3><p>ä»ä¸Šè¿°é—®é¢˜å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬éœ€è¦æ— æ„ŸçŸ¥çš„è°ƒæ•´è¾¹ç¼˜podçš„è®¿é—®åœ°å€ï¼ŒåŒæ—¶éœ€è¦åœ¨è¾¹ç¼˜ç¯å¢ƒä¸­ç¼“å­˜ä¸šåŠ¡é…ç½®ï¼Œä¿è¯äº‘è¾¹æ–­ç½‘æ—¶ä¹Ÿå¯ä»¥åˆ©ç”¨è¾¹ç¼˜ç¼“å­˜ä¸šåŠ¡é…ç½®ï¼Œä¿è¯äº‘è¾¹æ–­ç½‘æ—¶ä¹Ÿå¯ä»¥åˆ©ç”¨è¾¹ç¼˜ç¼“å­˜æ¥è·å–ä¸šåŠ¡Podçš„é…ç½®ä¿¡æ¯ã€‚å…·ä½“è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼›</p><h5 class="anchor anchorWithStickyNavbar_y2LR" id="31è¾¹ç¼˜podè®¿é—®çš„äº‘ç«¯endpointä¼˜åŒ–">3.1è¾¹ç¼˜Podè®¿é—®çš„äº‘ç«¯endpointä¼˜åŒ–<a aria-hidden="true" class="hash-link" href="#31è¾¹ç¼˜podè®¿é—®çš„äº‘ç«¯endpointä¼˜åŒ–" title="Direct link to heading">â€‹</a></h5><ul><li><p>Podé€šè¿‡InClusterConfigè®¿é—®kube-apiserverï¼Œæºç å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">InClusterConfig</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token plain">Config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    tokenFile  </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;/var/run/secrets/kubernetes.io/serviceaccount/token&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    rootCAFile </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;/var/run/secrets/kubernetes.io/serviceaccount/ca.crt&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// é€šè¿‡Kuberentes serviceå¯¹åº”çš„ç¯å¢ƒå˜é‡æ¥è·å–è®¿é—®åœ°å€</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">host</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> port </span><span class="token operator">:=</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Getenv</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;KUBERNETES_SERVICE_HOST&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Getenv</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;KUBERNETES_SERVICE_PORT&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">len</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">host</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token operator">||</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">len</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">port</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token boolean">nil</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> ErrNotInCluster</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// skip some code...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token plain">Config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Host</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;https://&quot;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> net</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">JoinHostPort</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">host</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> port</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    TLSClientConfig</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> tlsClientConfig</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    BearerToken</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">     </span><span class="token function" style="color:rgb(80, 250, 123)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">token</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    BearerTokenFile</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> tokenFile</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token boolean">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li></ul><ul><li><p>å› æ­¤æƒ³æ— æ„ŸçŸ¥è°ƒæ•´è¾¹ç¼˜Podè®¿é—®çš„äº‘ç«¯endpointï¼Œåªéœ€è¦æ— ä¾µå…¥ä¿®æ”¹Podçš„KUBERNETES_SERVICE_HOSTå’ŒKUBERNETE_SERVICE_PORTä¸¤ä¸ªç¯å¢ƒå˜é‡æˆ–è€…ä¿®æ”¹kubernetes serviceåœ°å€ã€‚è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p><ul><li><p>è§£å†³æ–¹æ¡ˆä¸€ï¼šå¢åŠ ä¸€ä¸ªadmission controlleråœ¨è¾¹ç¼˜Podåˆ›å»ºæ—¶æŠŠkube-apiserverçš„å…¬ç½‘åœ°å€è‡ªåŠ¨æ³¨å…¥åˆ°Podçš„ç¯å¢ƒå˜é‡KUBERNETES_SERVICE_HOSTå’ŒKUBERNETE_SERVICE_PORT</p></li><li><p>è§£å†³æ–¹æ¡ˆäºŒï¼šè¾¹ç¼˜æ•°æ®è¿‡æ»¤æ¡†æ¶ä¸­å¢åŠ ä¸€ä¸ªfillter yurthubçš„è¾¹ç¼˜æ•°æ®è¿‡æ»¤æ¡†æ¶ç±»ä¼¼äºadmission controller ,ä¸“é—¨ç”¨äºè¾¹ç¼˜åœºæ™¯ä¸‹åœ¨è¾¹ç¼˜åº”ç”¨æ— æ„ŸçŸ¥çš„çŠ¶æ€ä¸‹ï¼Œæ— ä¾µå…¥çš„ä¿®æ”¹æˆ–è€…è¿‡æ»¤äº‘ç«¯è¿”å›çš„æ•°æ®ã€‚ç›®å‰æ”¯æŒçš„è¿‡æ»¤å™¨æœ‰ï¼šMasterserviceï¼Œservicetopologyï¼Œdiscardcloudserviceç­‰</p></li><li><p>è§£å†³æ–¹æ¡ˆå¯¹æ¯”ï¼š</p><table><thead><tr><th align="center"></th><th align="center">è§£å†³æ–¹æ¡ˆä¸€</th><th align="center">è§£å†³æ–¹æ¡ˆäºŒ</th></tr></thead><tbody><tr><td align="center">å®ç°æ–¹æ¡ˆ</td><td align="center">å¢åŠ ä¸€ä¸ªadmission controller</td><td align="center">è¾¹ç¼˜æ•°æ®è¿‡æ»¤æ¡†æ¶ä¸­å¢åŠ ä¸€ä¸ªfilter</td></tr><tr><td align="center">å¤æ‚åº¦</td><td align="center">é«˜ï¼ˆéœ€è¦åŒºåˆ«Podè¿è¡Œåœ¨è¾¹ç¼˜è¿˜æ˜¯äº‘ç«¯ï¼‰</td><td align="center">ä½</td></tr><tr><td align="center">æ˜¾ç¤ºä¿®æ”¹æ•°æ®</td><td align="center">Podä¸­å¢åŠ ç¯å¢ƒå˜é‡é…ç½®</td><td align="center">æ— </td></tr></tbody></table></li></ul></li></ul><p>ç»¼åˆå®ç°å¤æ‚åº¦ï¼Œéä¾µå…¥ç­‰è®¾è®¡ç†å¿µï¼Œåœ¨OpenYurtä¸­æˆ‘ä»¬é€‰æ‹©äº†è§£å†³æ–¹æ¡ˆäºŒã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/zh/assets/images/InCluster3-4342c22777070b2df9e39d158a929ac3.png"></p><h5 class="anchor anchorWithStickyNavbar_y2LR" id="32ä¸šåŠ¡podçš„è¾¹ç¼˜è‡ªæ²»">3.2ä¸šåŠ¡Podçš„è¾¹ç¼˜è‡ªæ²»<a aria-hidden="true" class="hash-link" href="#32ä¸šåŠ¡podçš„è¾¹ç¼˜è‡ªæ²»" title="Direct link to heading">â€‹</a></h5><p>åœ¨äº‘è¾¹ç½‘ç»œæ–­å¼€çŠ¶æ€ä¸‹ï¼Œä¸šåŠ¡Podé‡å¯æ—¶ï¼Œå°†æ— æ³•ä»äº‘ç«¯kube-apiserverè·å–åˆ°ä¸šåŠ¡é…ç½®ä¿¡æ¯ï¼Œå› æ­¤éœ€è¦åœ¨è¾¹ç¼˜æœ¬åœ°ç¼“å­˜Podçš„ä¸šåŠ¡æ•°æ®ã€‚</p><p><img src="/zh/assets/images/InCluster4-4a67ce6edd8af63676837754c51f97f3.png"></p><p>è¯´æ˜1ï¼šä¸šåŠ¡Podé€šè¿‡yurthubè®¿é—®kube-apiserverï¼Œä¹Ÿæ„å‘³ç€<!-- -->[3.1 è¾¹ç¼˜Podè®¿é—®çš„äº‘ç«¯endpointä¼˜åŒ–]<!-- -->ç« èŠ‚ä¸­æåˆ°çš„KUBERNETES_SERVICE_HOSTå’ŒKUBERNETE_SERVICE_PORTç¯å¢ƒå˜é‡è¢«ä¿®æ”¹ä¸ºyurthub https endpoint(169.254.2.1:10268)ã€‚</p><p>è¯´æ˜2ï¼šå¦‚æœä¸šåŠ¡Podçš„å¤§é‡list/watchæ“ä½œå¯¼è‡´å¤§é‡æœ¬åœ°cacheï¼Œå¯èƒ½ä¼šé€ æˆæœ¬åœ°ç£ç›˜å‹åŠ›ï¼Œå› æ­¤yurthubå¯¹ä¸šåŠ¡Podçš„ç¼“å­˜èƒ½åŠ›é»˜è®¤æ˜¯å…³é—­çš„ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡yurt-hub-cfg configmapçš„cache_agentså­—æ®µä¸­å¢åŠ User-Agentä¿¡æ¯æ¥æ‰“å¼€å¯¹åº”Podçš„æ•°æ®ç¼“å­˜ã€‚ä¾‹å¦‚ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">apiVersion</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kind</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> ConfigMap</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">metadata</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> yurt</span><span class="token operator">-</span><span class="token plain">hub</span><span class="token operator">-</span><span class="token plain">cfg</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  namespace</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> kube</span><span class="token operator">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  # ç¼“å­˜è¾¹ç¼˜ingress</span><span class="token operator">-</span><span class="token plain">controller podè®¿é—®kube</span><span class="token operator">-</span><span class="token plain">apiserverçš„æ•°æ®</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  cache_agents</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;ingress-controller&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="4æ€»ç»“">4.æ€»ç»“<a aria-hidden="true" class="hash-link" href="#4æ€»ç»“" title="Direct link to heading">â€‹</a></h3><ul><li><p>å¦‚æœå­˜é‡Podæ— éœ€è®¿é—®kube-apiserveræˆ–è€…InClusterConfigè®¿é—®kube-apiserverï¼Œè¿™äº›ç±»å‹Podå¯ä»¥é›¶ä¿®æ”¹è¿è¡Œåˆ°OpenYurté›†ç¾¤çš„è¾¹ç¼˜ç¯å¢ƒä¸Šã€‚é€šè¿‡å…¶ä»–æ–¹å¼è®¿é—®kube-apiserverçš„ä¸šåŠ¡Podç›®å‰æ— æ³•ä¿è¯é›¶ä¿®æ”¹è¿è¡Œåˆ°è¾¹ç¼˜ç¯å¢ƒã€‚</p></li><li><p>è¾¹ç¼˜ä¸šåŠ¡Podæ˜¯å¦æ­£å¸¸è®¿é—®kube-apiserverï¼Œé¦–å…ˆå¯ä»¥æŸ¥çœ‹ä¸šåŠ¡podçš„ç¯å¢ƒå˜é‡æ˜¯å¦æ­£å¸¸ï¼š</p><p>KUBERNETES_SERVICE_HOST=127.0.0.1æˆ–è€…169.254.2.1ï¼ŒKUBERNETES_SERVICE_PORT=10268ã€‚ç„¶åå¯ä»¥æŸ¥çœ‹yurthubç»„ä»¶çš„æ—¥å¿—æ˜¯å¦æœ‰ä¸šåŠ¡Podç›¸å…³çš„è¯·æ±‚æ—¥å¿—ã€‚å½“ç„¶ä¹Ÿå¯ä»¥æŸ¥è¯¢ä¸šåŠ¡Podçš„æ—¥å¿—æ˜¯å¦æ­£å¸¸ã€‚æœ€åå¯ä»¥ç¡®è®¤/etc/kubernetes/cacheç›®å½•æ˜¯å¦æœ‰ç›¸å…³ç»„ä»¶çš„ç¼“å­˜æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰å¯ä»¥å†ç¡®è®¤kube-system/yurt-hub-cfg configmapæ˜¯å¦å·²ç»é…ç½®ã€‚</p></li><li><p>ä½¿ç”¨InClusterConfigçš„Podé›¶ä¿®æ”¹è¿è¡Œåˆ°è¾¹ç¼˜ç¯å¢ƒçš„èƒ½åŠ›ï¼Œæ•´ä½“å®ç°ç”±yurthubç»„ä»¶æ‰¿è½½ï¼Œæ²¡æœ‰ç»™OpenYurtæ¶æ„å¢åŠ é¢å¤–çš„è´Ÿæ‹…ï¼ŒåŒæ—¶ç”¨æˆ·åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å¯¹è¯¥èƒ½åŠ›ä¹ŸåŸºæœ¬æ— æ„ŸçŸ¥ï¼Œå¯¹åŸç”Ÿä¸šåŠ¡Podæ— ä¾µå…¥ã€‚</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥ï¼š<a aria-hidden="true" class="hash-link" href="#å‚è€ƒé“¾æ¥" title="Direct link to heading">â€‹</a></h3><p>1.<a href="https://kubernetes.io/docs/tasks/access-application-cluster/access-cluster/#accessing-the-api-from-a-pod" target="_blank" rel="noopener noreferrer">Accessing the API from a Pod</a></p><p>2.<a href="https://github.com/openyurtio/openyurt/blob/master/docs/proposals/20210720-data-filtering-framework.md" target="_blank" rel="noopener noreferrer">data filtering framework on the edge</a></p><p>3.<a href="https://mp.weixin.qq.com/s/4BLfvMJJA623ZwRSgUE69A" target="_blank" rel="noopener noreferrer">æ·±åº¦è§£è¯»OpenYurtï¼šè¾¹ç¼˜è‡ªæ²»èƒ½åŠ›è®¾è®¡è§£æ</a></p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_xD8n"><div class="col"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/zh/blog/tags/openyurt">openyurt</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/openyurtio/openyurt.io/tree/master/blog/blog/2021-10-15-How-run-business-pod-in-edge-scenarios.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>ç¼–è¾‘æœ¬é¡µ</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/zh/blog/How-to-use-service-topology"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Â« <!-- -->OpenYurtè¾¹ç¼˜æµé‡é—­ç¯èƒ½åŠ›è§£æ</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/zh/blog/Edge-gateway-caching-capabilities"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">è¾¹ç¼˜ç½‘å…³ç¼“å­˜èƒ½åŠ›çš„ä¼˜é›…å®ç°<!-- --> Â»</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1èƒŒæ™¯ä»‹ç»" class="table-of-contents__link toc-highlight">1.èƒŒæ™¯ä»‹ç»</a></li><li><a href="#2é¢ä¸´æŒ‘æˆ˜" class="table-of-contents__link toc-highlight">2.é¢ä¸´æŒ‘æˆ˜</a></li><li><a href="#3è§£å†³æ–¹æ¡ˆ" class="table-of-contents__link toc-highlight">3.è§£å†³æ–¹æ¡ˆ</a></li><li><a href="#4æ€»ç»“" class="table-of-contents__link toc-highlight">4.æ€»ç»“</a></li><li><a href="#å‚è€ƒé“¾æ¥" class="table-of-contents__link toc-highlight">å‚è€ƒé“¾æ¥ï¼š</a></li></ul></div></div></div></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">æ–‡æ¡£</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/zh/docs/installation/summary">å¿«é€Ÿå¼€å§‹</a></li></ul></div><div class="col footer__col"><div class="footer__title">ç¤¾åŒº</div><ul class="footer__items"><li class="footer__item"><a href="https://join.slack.com/t/openyurt/shared_invite/zt-rc5ecz4h-sEWU1vYx5gzc3_zx3En0jg" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>CNCF Slack ( #openyurt channel )<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a class="footer__link-item" href="/zh/blog/">é’‰é’‰ (31993519)</a></li><li class="footer__item"><a href="https://shimo.im/docs/rGK3cXYWYkPrvWp8" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Bi-week Meeting (APAC, Chinese)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">æ›´å¤š</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/openyurtio/openyurt" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/openyurtio/community/blob/main/community-membership.md" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Community Membership<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
        <br>
        <strong>Copyright Â© 2022 The OpenYurt Authors. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage/"> Trademark Usage</a> page.</strong></div></div></div></footer></div>
<script src="/zh/assets/js/runtime~main.c70e262d.js"></script>
<script src="/zh/assets/js/main.dffb8149.js"></script>
</body>
</html>