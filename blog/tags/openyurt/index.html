<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="OpenYurt RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="OpenYurt Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="OpenYurt" href="/opensearch.xml"><title data-react-helmet="true">5 posts tagged with &quot;openyurt&quot; | OpenYurt</title><meta data-react-helmet="true" property="og:title" content="5 posts tagged with &quot;openyurt&quot; | OpenYurt"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://openyurt.io/blog/tags/openyurt"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-react-helmet="true" rel="shortcut icon" href="/img/openyurt.ico"><link data-react-helmet="true" rel="canonical" href="https://openyurt.io/blog/tags/openyurt"><link data-react-helmet="true" rel="alternate" href="https://openyurt.io/blog/tags/openyurt" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://openyurt.io/zh/blog/tags/openyurt" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://openyurt.io/blog/tags/openyurt" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.4691cb76.css">
<link rel="preload" href="/assets/js/runtime~main.34caa5e1.js" as="script">
<link rel="preload" href="/assets/js/main.c87394d4.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><div class="announcementBar_axC9" role="banner"><div class="announcementBarPlaceholder_xYHE"></div><div class="announcementBarContent_6uhP">â­ï¸ If you like OpenYurt, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/openyurtio/openyurt">GitHub</a>! â­ï¸</div><button type="button" class="clean-btn close announcementBarClose_A3A1" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/openyurt.ico" alt="OpenYurt" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/openyurt.ico" alt="OpenYurt" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">OpenYurt</b></a><a class="navbar__item navbar__link" href="/docs/">Documentation</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/docs/">v0.5.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/">Next</a></li><li><a class="dropdown__link" href="/docs/">v0.5.0</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_EbrZ"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/blog/tags/openyurt" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">English</a></li><li><a href="/zh/blog/tags/openyurt" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">ç®€ä½“ä¸­æ–‡</a></li></ul></div><a href="https://github.com/openyurtio/openyurt" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ğŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ğŸŒ</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_NKBi"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-tags-post-list-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_q+wC thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_9G5K margin-bottom--md">All posts</div><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/How-to-use-yurtctl-convert-revert">Seamless conversion between Kubernetes and OpenYurt</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/How-to-use-service-topology">Use service topology to realize topology-aware traffic routing</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/How-run-business-pod-in-edge-scenarios">How Openyurt runs the business pod in edge scenarios</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/Edge-gateway-caching-capabilities">Elegant realization of edge gateway caching capabilities</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/Play-with-OpenYurt-on-Raspberry-Pi">Getting Started with OpenYurt:play with OpenYurt on Raspberry Pi</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/Build-side-efficient-collaborative-network">How to build Kubernetes Native Cloud side efficient collaborative network</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/Expansion-capability-of-Yurthub">Viewing Expansion Ability of YurtHub from Edge Autonomy</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/YurtHub-design-detail">YurtHub Design Detail:edge autonomy of OpenYurt</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/Use-of-yurtctl">Yurtctl:make the native k8s cluster achieve edge computing capabilities</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/Introduce-of-OpenYurt">OpenYurt:edge computing cloud native project</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>5 posts tagged with &quot;openyurt&quot;</h1><a href="/blog/tags">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_d4p0" itemprop="headline"><a itemprop="url" href="/blog/How-to-use-yurtctl-convert-revert">Seamless conversion between Kubernetes and OpenYurt</a></h2><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2021-12-03T00:00:00.000Z" itemprop="datePublished">December 3, 2021</time> Â· <!-- -->9 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://github.com/adamzhoul" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://github.com/adamzhoul.png" alt="adamzhoul"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/adamzhoul" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">adamzhoul</span></a></div><small class="avatar__subtitle" itemprop="description">Member of OpenYurt</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>æ‰“å¼€openYurtçš„README.mdï¼Œåœ¨ç®€å•ä»‹ç»ä¹‹åå°±æ˜¯Getting started:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain"> yurtctl convert --provider [minikube|kubeadm|kind] // To convert an existing Kubernetes cluster to an OpenYurt cluster</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> yurtctl revert // To uninstall and revert back to the original cluster settings</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ç®€å•ä¸€è¡Œå‘½ä»¤å°±å¯ä½“éªŒOpenYurtäº†ï¼Œæ„Ÿè§‰éå¸¸æ–¹ä¾¿ã€‚</p><p>ç¨ç­‰ï¼ä¸ºä»€ä¹ˆæ˜¯ convert/revert è€Œä¸æ˜¯ install/uninstall ?</p><p>è¿™ä¸ªå‘½ä»¤å¯¹é›†ç¾¤åšäº†ä»€ä¹ˆï¼Ÿ</p><p>çœ‹æ¥ï¼Œåœ¨æ‰§è¡Œå®ƒä¹‹å‰æœ‰å¿…è¦ææ¸…æ¥šå®ƒåˆ°åº•åšäº†ä»€ä¹ˆã€‚</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="yurtctl-convert-åˆ°åº•åšäº†äº›ä»€ä¹ˆ">yurtctl convert åˆ°åº•åšäº†äº›ä»€ä¹ˆï¼Ÿ<a aria-hidden="true" class="hash-link" href="#yurtctl-convert-åˆ°åº•åšäº†äº›ä»€ä¹ˆ" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="æ ¸å¿ƒæµç¨‹">æ ¸å¿ƒæµç¨‹<a aria-hidden="true" class="hash-link" href="#æ ¸å¿ƒæµç¨‹" title="Direct link to heading">â€‹</a></h3><p>è·ŸéšopenYurt<a href="https://github.com/openyurtio/openyurt/blob/5063752a9f6645270e3177e39a46df8c23145af2/pkg/yurtctl/cmd/convert/convert.go#L300" target="_blank" rel="noopener noreferrer">æºä»£ç </a>ï¼Œæ¢³ç†äº†convertçš„æ ¸å¿ƒæµç¨‹ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">1. æ£€æŸ¥</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   1.1 æ£€æŸ¥æ‰€æœ‰nodeèŠ‚ç‚¹çŠ¶æ€ä¸ºready</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2. ç»„ä»¶éƒ¨ç½²</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  2.1 ç»™nodeèŠ‚ç‚¹æ‰“ä¸Šç›¸åº”çš„labelã€‚</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  2.2 ä½¿ç”¨deploymentéƒ¨ç½²yurt-controller-managerã€‚</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  2.3 ä½¿ç”¨deploymentéƒ¨ç½²yurt-tunnel-serverã€‚</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  2.4 ä½¿ç”¨daemonsetéƒ¨ç½²yurt-tunnel-agentï¼Œéƒ¨ç½²åœ¨è¾¹ç¼˜èŠ‚ç‚¹ä¸Šã€‚</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  2.5 ä½¿ç”¨deploymentéƒ¨ç½²yurt-app-managerã€‚</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">3. k8sç»„ä»¶ä¿®æ”¹</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  3.1 ä¿®æ”¹kube-controller-manager.yamlï¼Œç”¨æ¥disable nodelifecycle controller</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">4. èŠ‚ç‚¹è½¬æ¢</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   4.1 å†™å…¥yurthub.yamlåˆ°/etc/kubernetes/manifestsï¼Œå¯åŠ¨é™æ€pod</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   4.2 ä¿®æ”¹kubeleté…ç½®ï¼Œä½¿å¾—kubeletè®¿é—®yurthubè€Œä¸æ˜¯ç›´è¿apiServer</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>å¯è§1ã€2å¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«ï¼Œåªæ˜¯å¸¸è§„çš„æœåŠ¡éƒ¨ç½²</p><p>3ï¼Œåˆ™æ˜¯å¯¹åŸæœ‰k8sç³»ç»Ÿç»„ä»¶çš„æ“ä½œï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„</p><p>4-èŠ‚ç‚¹è½¬æ¢çœ‹ç€ä¹Ÿå¹¶ä¸å¤æ‚ï¼Œå´å¯¹è¾¹ç¼˜è‡³å…³é‡è¦ã€‚</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="disable-nodelifecycle-controller-åšäº†ä»€ä¹ˆ">disable nodelifecycle controller åšäº†ä»€ä¹ˆï¼Ÿ<a aria-hidden="true" class="hash-link" href="#disable-nodelifecycle-controller-åšäº†ä»€ä¹ˆ" title="Direct link to heading">â€‹</a></h3><p>å·¥ä½œå†…å®¹ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">1. æŸ¥è¯¢æ§åˆ¶é¢èŠ‚ç‚¹</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2. åˆ›å»ºjobï¼Œé€šè¿‡` nodeName: {{.nodeName}}` ç¡®ä¿jobçš„podè°ƒåº¦åˆ°å¯¹åº”nodeä¸Šæ‰§è¡Œ(é€šè¿‡nsenterçš„æ–¹å¼æ‰§è¡Œï¼Œä¿®æ”¹å®¿ä¸»æœºä¸Šæ–‡ä»¶)ã€‚</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">3. sed -i &#x27;s/--controllers=/--controllers=-nodelifecycle,/g&#x27; /etc/kubernetes/manifests/kube-controller-manager.yaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>æŸ¥çœ‹kube-controller-manager.yaml</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">containers:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- command:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- kube-controller-manager</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- --allocate-node-cidrs=true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- --controllers=-nodelifecycle,*,bootstrapsigner,tokencleaner</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>å¯è§ï¼Œä¸Šé¢çš„ä¸€ç³»åˆ—æ“ä½œæœ€ç»ˆå°±æ˜¯ä¿®æ”¹äº†kube-controller-managerçš„å¯åŠ¨å‘½ä»¤ã€‚</p><p>æŸ¥çœ‹kube-controller-managerå¯åŠ¨å‚æ•°è¯´æ˜ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">--controllers ä»£è¡¨éœ€è¦å¼€å¯çš„controlleråˆ—è¡¨</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>å¯è§ï¼Œsedå‘½ä»¤å°±æ˜¯å»æ‰äº†nodelifecycleè¿™ä¸ªcontrollerã€‚</p><p>é‚£ï¼Œnodelifecycle controlleræ˜¯åšä»€ä¹ˆçš„ï¼Ÿ</p><p>ç®€å•æ¥è¯´ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">1. ä¸æ–­ç›‘å¬ï¼Œkubeletä¸ŠæŠ¥ä¸Šæ¥çš„nodeä¿¡æ¯</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2. å¦‚æœæŸä¸ªnodeçŠ¶æ€å¼‚å¸¸ï¼Œæˆ–è€…è¯´é•¿æ—¶é—´æ²¡æœ‰ä¸ŠæŠ¥ç­‰</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  2.1 é©±é€è¿™ä¸ªnodeèŠ‚ç‚¹æˆ–è€…å…¶ä»– ---&gt; å¯¼è‡´ä¸Šé¢çš„podè¢«é‡æ–°è°ƒåº¦</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>å¯è§ï¼Œå¯¹äºå¤„äºå¼±ç½‘ç¯å¢ƒçš„è¾¹ç¼˜èŠ‚ç‚¹ï¼Œå¾ˆå®¹æ˜“å°±å‘½ä¸­å¼‚å¸¸çŠ¶æ€ï¼Œå¯¼è‡´nodeè¢«é©±é€ï¼Œpodè¢«é‡æ–°è°ƒåº¦ã€‚</p><p>æ‰€ä»¥è¿™é‡ŒæŠŠå®ƒå»æ‰äº†ã€‚ä½¿ç”¨yurt-controller-manageræ¥ä»£æ›¿å®ƒã€‚</p><p>å³ä½¿èŠ‚ç‚¹å¿ƒè·³ä¸¢å¤±ï¼Œå¤„äºè‡ªæ²»æ¨¡å¼çš„èŠ‚ç‚¹ä¸­çš„podä¹Ÿä¸ä¼šä»APIServerä¸­é©±é€ã€‚</p><p>æ³¨ï¼šè¿™é‡Œè‡ªæ²»æ¨¡å¼çš„èŠ‚ç‚¹ï¼ŒæŒ‡çš„å°±æ˜¯è¾¹ç¼˜èŠ‚ç‚¹ã€‚æˆ‘ä»¬é€šå¸¸ä¼šé€šè¿‡åŠ annotationçš„æ–¹å¼æŠŠèŠ‚ç‚¹æ ‡è®°ä¸ºè‡ªæ²»èŠ‚ç‚¹ã€‚</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="èŠ‚ç‚¹è½¬æ¢æ˜¯æ€ä¹ˆå®ç°çš„äº‘ç«¯èŠ‚ç‚¹å’Œè¾¹ç¼˜èŠ‚ç‚¹æœ‰ä»€ä¹ˆå·®å¼‚">èŠ‚ç‚¹è½¬æ¢æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œäº‘ç«¯èŠ‚ç‚¹å’Œè¾¹ç¼˜èŠ‚ç‚¹æœ‰ä»€ä¹ˆå·®å¼‚?<a aria-hidden="true" class="hash-link" href="#èŠ‚ç‚¹è½¬æ¢æ˜¯æ€ä¹ˆå®ç°çš„äº‘ç«¯èŠ‚ç‚¹å’Œè¾¹ç¼˜èŠ‚ç‚¹æœ‰ä»€ä¹ˆå·®å¼‚" title="Direct link to heading">â€‹</a></h3><p>åŒæ ·ï¼Œæ˜¯é€šè¿‡è·‘jobçš„æ–¹å¼ï¼Œåœ¨ç›®æ ‡å®¿ä¸»æœºä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œç›¸å…³æ“ä½œã€‚</p><p>ä¸è¿‡ï¼Œç›¸æ¯”äºæš´åŠ›ä½¿ç”¨nsenterï¼Œè¿™é‡Œç”¨äº†æ›´åŠ ä¼˜é›…çš„æ–¹å¼ã€‚é€šè¿‡å°†å®¿ä¸»æœºæ ¹è·¯å¾„ volumeæŒ‚è½½åˆ°å®¹å™¨é‡Œçš„æ–¹å¼ã€‚</p><h5 class="anchor anchorWithStickyNavbar_y2LR" id="kubeletçš„ä¿®æ”¹">kubeletçš„ä¿®æ”¹<a aria-hidden="true" class="hash-link" href="#kubeletçš„ä¿®æ”¹" title="Direct link to heading">â€‹</a></h5><p>åœ¨æ–‡ä»¶/var/lib/kubelet/kubeadm-flags.env ä¸­ä¸ºKUBELET_KUBEADM_ARGSæ·»åŠ é…ç½®ï¼š</p><p><code>--kubeconfig=/var/lib/openyurt/kubelet.conf --bootstrap-kubeconfig=</code></p><p>ä½œç”¨ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">1. å‚æ•°ï¼š--kubeconfig ï¼Œ ç»™kubeletæŒ‡å®šäº†è®¿é—®apiServerçš„é…ç½®æ–‡ä»¶ã€‚</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2. å½“--kubeconfig æ–‡ä»¶å­˜åœ¨ï¼Œ--bootstrap-kubeconfigä¸ºç©ºæ—¶ï¼Œ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   kubeletå¯åŠ¨å°±ä¸éœ€è¦é€šè¿‡bootstrap-tokenç½®æ¢æ–‡ä»¶è¯ä¹¦ç­‰è¿‡ç¨‹ï¼Œç›´æ¥è¯»å–kubeconfigæ–‡ä»¶è®¿é—®apiServerã€‚</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">3. ç”±äºKUBELET_KUBEADM_ARGS æ˜¯kubeletå¯åŠ¨å‚æ•°çš„æœ€åä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥å¯ä»¥èµ·åˆ°è¦†ç›–å‰é¢å‚æ•°çš„ä½œç”¨ã€‚</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>å…¶ä¸­<code>/var/lib/openyurt/kubelet.conf</code>å†…å®¹å¦‚ä¸‹ï¼Œç›´æ¥å°†æµé‡æŒ‡å®šåˆ°yurthubï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">clusters:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- cluster:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">server: http://127.0.0.1:10261</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">name: default-cluster</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">contexts:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- context:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cluster: default-cluster</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">namespace: default</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user: default-auth</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">name: default-context</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">current-context: default-context</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kind: Config</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">preferences: {}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h5 class="anchor anchorWithStickyNavbar_y2LR" id="yurthubçš„å¯åŠ¨ç»†èŠ‚">yurthubçš„å¯åŠ¨ç»†èŠ‚<a aria-hidden="true" class="hash-link" href="#yurthubçš„å¯åŠ¨ç»†èŠ‚" title="Direct link to heading">â€‹</a></h5><p>yurthubå®¹å™¨å¯åŠ¨å‚æ•°å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">command:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- yurthub</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- --v=2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- --server-addr=__kubernetes_service_addr__</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- --node-name=$(NODE_NAME)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- --join-token=__join_token__</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- --working-mode=__working_mode__</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>é€šè¿‡å‚æ•°æˆ‘ä»¬å¯çœ‹å‡ºï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">1. server-addr æŒ‡å®šäº†äº‘ç«¯apiServeråœ°å€ã€‚æ³¨æ„è¿™é‡Œçš„åœ°å€ä¸€å®šæ˜¯å…¬ç½‘å¯è®¿é—®åœ°å€ï¼Œå¦åˆ™å¼‚æ„ç½‘ç»œä¸‹ä¼šæœ‰é—®é¢˜ã€‚</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2. join-token å°±æ˜¯åŠ å…¥èŠ‚ç‚¹çš„tokenï¼Œå¯ä½¿ç”¨`kubeadm token create`æ¥åˆ›å»ºã€‚k8sæä¾›æœºåˆ¶ï¼Œé€šè¿‡tokenç½®æ¢å‡ºæ­£å¸¸è®¿é—®çš„kubeconfæ–‡ä»¶ã€‚</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">3. working-modeï¼š cloud/edgeã€‚è¿™å°±æ˜¯è¾¹ç¼˜èŠ‚ç‚¹å’Œäº‘ç«¯èŠ‚ç‚¹çš„å·®å¼‚ã€‚</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>æˆ‘ä»¬éƒ½çŸ¥é“yurthubå¯ä»¥ç”¨æ¥åšç¼“å­˜ï¼Œæ˜¯è§£å†³è¾¹ç¼˜è‡ªæ²»çš„é‡è¦ç¯èŠ‚ã€‚é‚£ä¹ˆäº‘ç«¯ä¸ºä»€ä¹ˆä¹Ÿéœ€è¦éƒ¨ç½²ï¼Ÿä¸ºä»€ä¹ˆè¿˜è¦åŒºåˆ†edgeæˆ–è€…cloudå·¥ä½œæ¨¡å¼ï¼Ÿ</p><p>ç®€å•æŸ¥çœ‹yurthubæºä»£ç  cmd/yurthub/app/start.go:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI golang"><pre tabindex="0" class="prism-code language-golang codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">if cfg.WorkingMode == util.WorkingModeEdge {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    cacheMgr, err = cachemanager.NewCacheManager(cfg.StorageWrapper, cfg.SerializerManager, cfg.RESTMapperManager, cfg.SharedFactory)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">} else {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    klog.Infof(&quot;%d. disable cache manager for node %s because it is a cloud node&quot;, trace, cfg.NodeName)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if cfg.WorkingMode == util.WorkingModeEdge {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    gcMgr, err := gc.NewGCManager(cfg, restConfigMgr, stopCh)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">} else {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    klog.Infof(&quot;%d. disable gc manager for node %s because it is a cloud node&quot;, trace, cfg.NodeName)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>å¯è§ï¼Œäº‘ç«¯yurthubï¼Œå°‘åšäº† cacheã€GCçš„å·¥ä½œã€‚</p><p>æŸ¥çœ‹<a href="https://github.com/openyurtio/openyurt/issues/450" target="_blank" rel="noopener noreferrer">issue</a> å¯äº†è§£ï¼šäº‘ç«¯ä¹Ÿå¯ä»¥åˆ©ç”¨yurthubæä¾›çš„data-filteringèƒ½åŠ›æ¥æ§åˆ¶serviceçš„æµé‡</p><p>å½“ç„¶ï¼Œäº‘ç«¯ä¹Ÿä¸éœ€è¦åšcacheç­‰å·¥ä½œã€‚</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="å‘½ä»¤è¡Œå‚æ•°">å‘½ä»¤è¡Œå‚æ•°<a aria-hidden="true" class="hash-link" href="#å‘½ä»¤è¡Œå‚æ•°" title="Direct link to heading">â€‹</a></h3><p>åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ‰å‡ ä¸ªå‚æ•°æ¯”è¾ƒé‡è¦ï¼š</p><p>--cloud-nodes ç”¨äºæ ‡è¯†å“ªäº›æ˜¯äº‘ç«¯èŠ‚ç‚¹ï¼Œå¤šä¸ªèŠ‚ç‚¹ç”¨é€—å·åˆ†éš”ï¼šnode1,node2</p><p>--deploy-yurttunnel æ ‡è®°æ˜¯å¦è¦éƒ¨ç½²yurttunnel</p><p>--kubeadm-conf-path æ ‡è®°èŠ‚ç‚¹æœºå™¨ä¸Škubeadmé…ç½®æ–‡ä»¶è·¯å¾„ã€‚é»˜è®¤ï¼š/etc/systemd/system/kubelet.service.d/10-kubeadm.conf</p><p>æ›´å¤šå‚æ•°ï¼Œå¯ä½¿ç”¨ yurtctl convert --help æ¥æŸ¥çœ‹ã€‚</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="æ€»ç»“">æ€»ç»“<a aria-hidden="true" class="hash-link" href="#æ€»ç»“" title="Direct link to heading">â€‹</a></h3><p>ç®€å•æ¥è¯´ï¼Œconvertæ ¸å¿ƒåšäº†å‡ ä¸ªäº‹æƒ…ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">1. disable k8s çš„nodelifecontrollerï¼Œç”¨è‡ªå·±çš„yurtcontrollermanageræ¥æ›¿æ¢å®ƒçš„èŒè´£ã€‚</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2. å®‰è£…è‡ªå·±çš„å„ç±»ç»„ä»¶ï¼Œdeploymentã€damenonset ç­‰æ¨¡å¼éƒ¨ç½²ã€‚ï¼ˆè¿™ç±»èµ„æºéƒ¨ç½²æ— éœ€ä»»ä½•æ‹…å¿ƒï¼Œå› ä¸ºæä¸åé›†ç¾¤ï¼Œä¹Ÿä¸å¤ªä¼šå‡ºç°é—®é¢˜ã€‚ï¼‰</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">3. è¾¹ç¼˜èŠ‚ç‚¹ï¼šå¯åŠ¨yurthubé™æ€pod;å°†kubeletæµé‡è½¬å‘åˆ°yurthubã€‚</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>å¯è§ï¼Œconvertçš„äº‹æƒ…è¿˜æ˜¯æ¯”è¾ƒå¯æ§çš„ã€‚æ‰§è¡Œyurtctl convert ä¹Ÿä¸ç”¨å¤ªæ‹…å¿ƒã€‚</p><p>å½“ç„¶ï¼Œæœ€åçš„æ‹…å¿ƒä¹Ÿåº”è¯¥ç”± yurtctl revert æ¥å½»åº•æ¶ˆé™¤ï¼</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="yurtctl-revert-åˆå¹²äº†äº›ä»€ä¹ˆ">yurtctl revert åˆå¹²äº†äº›ä»€ä¹ˆï¼Ÿ<a aria-hidden="true" class="hash-link" href="#yurtctl-revert-åˆå¹²äº†äº›ä»€ä¹ˆ" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="æ ¸å¿ƒæµç¨‹-1">æ ¸å¿ƒæµç¨‹<a aria-hidden="true" class="hash-link" href="#æ ¸å¿ƒæµç¨‹-1" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">1. æ£€æŸ¥</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  1.1 ç¡®ä¿æ‰€æœ‰nodeéƒ½å·²ç»ready</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2. åˆ é™¤è‡ªèº«éƒ¨ç½²ç»„ä»¶</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  2.1 åˆ é™¤ yurt-controller-manager deploymentä»¥åŠç›¸å…³èµ„æº </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  2.2 åˆ é™¤yurt-tunnel-agentä»¥åŠç›¸å…³èµ„æº</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  2.2 åˆ é™¤yurt-tunnel-serverä»¥åŠç›¸å…³èµ„æº  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  2.3 åˆ é™¤yurt-app-managerä»¥åŠç›¸å…³èµ„æº</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">3. k8sç»„ä»¶ä¿®æ”¹</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  3.1 å¼€å¯nodelifecontroller, è¿™ä¸ªå¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯æŠŠä¿®æ”¹çš„å‘½ä»¤é€šè¿‡sedå‘½ä»¤æ”¹å›æ¥ã€‚</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">4. äº‘ç«¯ã€è¾¹ç¼˜èŠ‚ç‚¹è½¬æ¢ä¸ºåŸç”ŸèŠ‚ç‚¹</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  4.1 ä¿®æ”¹kubeleté…ç½®ï¼Œç›´è¿apiServer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  4.2 åˆ é™¤yurthubç›¸å…³é…ç½®ã€ç›®å½•</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>æ•´ä¸ªrevertçš„è¿‡ç¨‹å°±æ˜¯convertçš„åå‘æ“ä½œï¼Œè¿˜æ¯”è¾ƒå¥½ç†è§£ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ã€‚å¦‚æœconvertå¤±è´¥ï¼Œæ¯”å¦‚jobæ‰§è¡Œè¶…æ—¶æˆ–è€…å¤±è´¥ã€‚jobæ˜¯ä¸ä¼šè¢«åˆ é™¤çš„ã€‚</p><p>å³ä½¿yurtctl revert ä¹Ÿä¸ä¼šåˆ é™¤ã€‚ç›®çš„æ˜¯ä¸ºäº†ä¿ç•™ç°åœºæ–¹ä¾¿å®šä½é—®é¢˜ã€‚</p><p>å¦‚æœéœ€è¦é‡æ–°æ‰§è¡Œyurtctl convertï¼Œ éœ€è¦æ‰‹åŠ¨åˆ é™¤jobã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl get job -n kube-system -A |grep convert</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl delete job -n kube-system &lt; job-name&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="æ€»ç»“-1">æ€»ç»“<a aria-hidden="true" class="hash-link" href="#æ€»ç»“-1" title="Direct link to heading">â€‹</a></h2><p>yurtctl convert/revert å‘½ä»¤æ˜¯æœ€å¿«æ·ä½“éªŒopenYurtåŠŸèƒ½çš„æ–¹æ³•ä¹‹ä¸€ã€‚</p><p>åœ¨äº†è§£äº†è¿™ä¸¤ä¸ªå‘½ä»¤çš„å®ç°åŸç†ï¼Œä¹Ÿå°±å¯¹openYurtçš„æŠ€æœ¯æ–¹æ¡ˆäº†è§£å¤§åŠäº†ã€‚</p><p>æ‰§è¡Œå‘½ä»¤ä¹Ÿä¸æ‹…å¿ƒäº†ï¼Œso easyï¼</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/blog/tags/openyurt">openyurt</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about Seamless conversion between Kubernetes and OpenYurt" href="/blog/How-to-use-yurtctl-convert-revert"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_d4p0" itemprop="headline"><a itemprop="url" href="/blog/How-to-use-service-topology">Use service topology to realize topology-aware traffic routing</a></h2><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2021-11-24T00:00:00.000Z" itemprop="datePublished">November 24, 2021</time> Â· <!-- -->6 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://github.com/windydayc" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://github.com/windydayc.png" alt="Feng Zeng"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/windydayc" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Feng Zeng</span></a></div><small class="avatar__subtitle" itemprop="description">Zhejiang University student, Member of OpenYurt</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><em>Service Topology</em> enables a service to route traffic based on the Node topology of the cluster. For example, a service can specify that traffic be preferentially routed to endpoints that are on the same Node as the client, or in the same available NodePool. </p><p>The following picture shows the general function of the <em>service topology</em>.</p><p><img alt="service-topology" src="/assets/images/service-topology-example-60b16f131cb1d5e4fbdd797a79200a83.png"></p><p>To use <em>service topology</em>, the <code>EndpointSliceProxying</code> <a href="https://kubernetes.io/docs/reference/command-line-tools-reference/feature-gates/" target="_blank" rel="noopener noreferrer">feature gate</a> must be enabled, and kube-proxy needs to be configured to connect to Yurthub instead of the API server.</p><p>You can set the <code>topologyKeys</code> values of a service to direct traffic as follows. If <code>topologyKeys</code> is not specified or empty, no topology constraints will be applied.</p><table><thead><tr><th align="center"><strong>annotation Key</strong></th><th align="center"><strong>annotation Value</strong></th><th align="center"><strong>explain</strong></th></tr></thead><tbody><tr><td align="center">openyurt.io/topologyKeys</td><td align="center">kubernetes.io/hostname</td><td align="center">Only to endpoints on the same node.</td></tr><tr><td align="center">openyurt.io/topologyKeys</td><td align="center">kubernetes.io/zone<br> or <br>openyurt.io/nodepool</td><td align="center">Only to endpoints on the same nodepool.</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_y2LR" id="prerequisites">Prerequisites<a aria-hidden="true" class="hash-link" href="#prerequisites" title="Direct link to heading">â€‹</a></h2><ol><li>Kubernetes v1.18 or above, since EndpointSlice resource needs to be supported.</li><li>Yurt-app-manager is deployed in the cluster.</li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="how-to-use">How to use<a aria-hidden="true" class="hash-link" href="#how-to-use" title="Direct link to heading">â€‹</a></h2><p>Ensure that kubernetes version is v1.18+.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl get node</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME                 STATUS   ROLES    AGE     VERSION</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kind-control-plane   Ready    master   6m21s   v1.18.19</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kind-worker          Ready    </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain">   5m42s   v1.18.19</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kind-worker2         Ready    </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain">   5m42s   v1.18.19</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Ensure that yurt-app-manager is deployed in the cluster.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI BASH"><pre tabindex="0" class="prism-code language-BASH codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl get pod -n kube-system </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME                                         READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">coredns-66bff467f8-jxvnw                     1/1     Running   0          7m28s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">coredns-66bff467f8-lk8v5                     1/1     Running   0          7m28s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">etcd-kind-control-plane                      1/1     Running   0          7m39s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kindnet-5dpxt                                1/1     Running   0          7m28s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kindnet-ckz88                                1/1     Running   0          7m10s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kindnet-sqxs7                                1/1     Running   0          7m10s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kube-apiserver-kind-control-plane            1/1     Running   0          7m39s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kube-controller-manager-kind-control-plane   1/1     Running   0          5m38s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kube-proxy-ddgjt                             1/1     Running   0          7m28s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kube-proxy-j25kr                             1/1     Running   0          7m10s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kube-proxy-jt9cw                             1/1     Running   0          7m10s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kube-scheduler-kind-control-plane            1/1     Running   0          7m39s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">yurt-app-manager-699ffdcb78-8m9sf            1/1     Running   0          37s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">yurt-app-manager-699ffdcb78-fdqmq            1/1     Running   0          37s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">yurt-controller-manager-6c95788bf-jrqts      1/1     Running   0          6m17s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">yurt-hub-kind-control-plane                  1/1     Running   0          3m36s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">yurt-hub-kind-worker                         1/1     Running   0          4m50s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">yurt-hub-kind-worker2                        1/1     Running   0          4m50s</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="configure-kube-proxy">Configure kube-proxy<a aria-hidden="true" class="hash-link" href="#configure-kube-proxy" title="Direct link to heading">â€‹</a></h3><p>To use <em>service topology</em>, the <code>EndpointSliceProxying</code> <a href="https://kubernetes.io/docs/reference/command-line-tools-reference/feature-gates/" target="_blank" rel="noopener noreferrer">feature gate</a> must be enabled, and kube-proxy needs to be configured to connect to Yurthub instead of the API server.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl edit cm -n kube-system kube-proxy</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">data:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  config.conf: </span><span class="token operator">|</span><span class="token plain">-</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    apiVersion: kubeproxy.config.k8s.io/v1alpha1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    bindAddress: </span><span class="token number">0.0</span><span class="token plain">.0.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    featureGates: </span><span class="token comment" style="color:rgb(98, 114, 164)"># 1. enable EndpointSliceProxying feature gate.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      EndpointSliceProxying: </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    clientConnection:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      acceptContentTypes: </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      burst: </span><span class="token number">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      contentType: </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">#kubeconfig: /var/lib/kube-proxy/kubeconfig.conf # 2. comment this line.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      qps: </span><span class="token number">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    clusterCIDR: </span><span class="token number">10.244</span><span class="token plain">.0.0/16</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    configSyncPeriod: 0s</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Restart kube-proxy.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl delete pod --selector k8s-app</span><span class="token operator">=</span><span class="token plain">kube-proxy -n kube-system</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pod </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;kube-proxy-cbsmj&quot;</span><span class="token plain"> deleted</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pod </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;kube-proxy-cqwcs&quot;</span><span class="token plain"> deleted</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pod </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;kube-proxy-m9dgk&quot;</span><span class="token plain"> deleted</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="create-nodepools">Create NodePools<a aria-hidden="true" class="hash-link" href="#create-nodepools" title="Direct link to heading">â€‹</a></h3><ul><li>Create test nodepools.</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">cat</span><span class="token plain"> </span><span class="token operator">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">EOF</span><span class="token string bash punctuation" style="color:rgb(248, 248, 242)"> </span><span class="token string bash punctuation operator" style="color:rgb(248, 248, 242)">|</span><span class="token string bash punctuation" style="color:rgb(248, 248, 242)"> kubectl apply -f -</span><span class="token string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">apiVersion: apps.openyurt.io/v1alpha1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">kind: NodePool</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">metadata:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  name: beijing</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">spec:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  type: Cloud</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="display:inline-block;color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">---</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="display:inline-block;color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">apiVersion: apps.openyurt.io/v1alpha1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">kind: NodePool</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">metadata:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  name: hangzhou</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">spec:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  type: Edge</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  annotations:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    apps.openyurt.io/example: test-hangzhou</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  labels:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    apps.openyurt.io/example: test-hangzhou</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="display:inline-block;color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">---</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="display:inline-block;color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">apiVersion: apps.openyurt.io/v1alpha1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">kind: NodePool</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">metadata:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  name: shanghai</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">spec:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  type: Edge</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  annotations:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    apps.openyurt.io/example: test-shanghai</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  labels:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    apps.openyurt.io/example: test-shanghai</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">EOF</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>Add nodes to the nodepool.</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl label node kind-control-plane apps.openyurt.io/desired-nodepool</span><span class="token operator">=</span><span class="token plain">beijing</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">node/kind-control-plane labeled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl label node kind-worker apps.openyurt.io/desired-nodepool</span><span class="token operator">=</span><span class="token plain">hangzhou</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">node/kind-worker labeled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl label node kind-worker2 apps.openyurt.io/desired-nodepool</span><span class="token operator">=</span><span class="token plain">shanghai</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">node/kind-worker2 labeled</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>Get NodePool.</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl get np</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME       TYPE    READYNODES   NOTREADYNODES   AGE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">beijing    Cloud   </span><span class="token number">1</span><span class="token plain">            </span><span class="token number">0</span><span class="token plain">               63s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">hangzhou   Edge    </span><span class="token number">1</span><span class="token plain">            </span><span class="token number">0</span><span class="token plain">               63s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">shanghai   Edge    </span><span class="token number">1</span><span class="token plain">            </span><span class="token number">0</span><span class="token plain">               63s</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="create-uniteddeployment">Create UnitedDeployment<a aria-hidden="true" class="hash-link" href="#create-uniteddeployment" title="Direct link to heading">â€‹</a></h3><ul><li>Create test united-deployment1. To facilitate testing, we use a <code>serve_hostname</code> image. Each time port 9376 is accessed, the hostname container returns its own hostname.</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">cat</span><span class="token plain"> </span><span class="token operator">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">EOF</span><span class="token string bash punctuation" style="color:rgb(248, 248, 242)"> </span><span class="token string bash punctuation operator" style="color:rgb(248, 248, 242)">|</span><span class="token string bash punctuation" style="color:rgb(248, 248, 242)"> kubectl apply -f -</span><span class="token string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">apiVersion: apps.openyurt.io/v1alpha1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">kind: UnitedDeployment</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">metadata:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  labels:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    controller-tools.k8s.io: &quot;1.0&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  name: united-deployment1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">spec:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  selector:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    matchLabels:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      app: united-deployment1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  workloadTemplate:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    deploymentTemplate:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      metadata:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        labels:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          app: united-deployment1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      spec:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        template:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          metadata:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">            labels:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">              app: united-deployment1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          spec:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">            containers:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">              - name: hostname</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">                image: mirrorgooglecontainers/serve_hostname</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">                ports:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">                - containerPort: 9376</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">                  protocol: TCP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  topology:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    pools:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    - name: hangzhou</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      nodeSelectorTerm:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        matchExpressions:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        - key: apps.openyurt.io/nodepool</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          operator: In</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          values:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          - hangzhou</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      replicas: 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    - name: shanghai</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      nodeSelectorTerm:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        matchExpressions:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        - key: apps.openyurt.io/nodepool</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          operator: In</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          values:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          - shanghai</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      replicas: 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  revisionHistoryLimit: 5</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">EOF</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>Create test united-deployment2. Here we use <code>nginx</code> image, in order to access the <code>hostname</code> pod that created by united-deployment1 above.</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">cat</span><span class="token plain"> </span><span class="token operator">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">EOF</span><span class="token string bash punctuation" style="color:rgb(248, 248, 242)"> </span><span class="token string bash punctuation operator" style="color:rgb(248, 248, 242)">|</span><span class="token string bash punctuation" style="color:rgb(248, 248, 242)"> kubectl apply -f -</span><span class="token string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">apiVersion: apps.openyurt.io/v1alpha1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">kind: UnitedDeployment</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">metadata:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  labels:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    controller-tools.k8s.io: &quot;1.0&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  name: united-deployment2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">spec:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  selector:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    matchLabels:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      app: united-deployment2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  workloadTemplate:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    deploymentTemplate:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      metadata:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        labels:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          app: united-deployment2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      spec:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        template:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          metadata:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">            labels:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">              app: united-deployment2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          spec:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">            containers:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">              - name: nginx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">                image: nginx:1.19.3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">                ports:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">                - containerPort: 80</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">                  protocol: TCP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  topology:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    pools:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    - name: hangzhou</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      nodeSelectorTerm:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        matchExpressions:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        - key: apps.openyurt.io/nodepool</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          operator: In</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          values:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          - hangzhou</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      replicas: 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    - name: shanghai</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      nodeSelectorTerm:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        matchExpressions:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        - key: apps.openyurt.io/nodepool</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          operator: In</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          values:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          - shanghai</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      replicas: 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  revisionHistoryLimit: 5</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">EOF</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>Get pods that created by the unitedDeployment.</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl get pod -l </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;app in (united-deployment1,united-deployment2)&quot;</span><span class="token plain"> -owide</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME                                                 READY   STATUS    RESTARTS   AGE   IP           NODE           NOMINATED NODE   READINESS GATES</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">united-deployment1-hangzhou-fv6th-66ff6fd958-f2694   </span><span class="token number">1</span><span class="token plain">/1     Running   </span><span class="token number">0</span><span class="token plain">          18m   </span><span class="token number">10.244</span><span class="token plain">.2.3   kind-worker    </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain">           </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">united-deployment1-hangzhou-fv6th-66ff6fd958-twf95   </span><span class="token number">1</span><span class="token plain">/1     Running   </span><span class="token number">0</span><span class="token plain">          18m   </span><span class="token number">10.244</span><span class="token plain">.2.2   kind-worker    </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain">           </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">united-deployment1-shanghai-5p8zk-84bdd476b6-hr6xt   </span><span class="token number">1</span><span class="token plain">/1     Running   </span><span class="token number">0</span><span class="token plain">          18m   </span><span class="token number">10.244</span><span class="token plain">.1.3   kind-worker2   </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain">           </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">united-deployment1-shanghai-5p8zk-84bdd476b6-wjck2   </span><span class="token number">1</span><span class="token plain">/1     Running   </span><span class="token number">0</span><span class="token plain">          18m   </span><span class="token number">10.244</span><span class="token plain">.1.2   kind-worker2   </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain">           </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">united-deployment2-hangzhou-lpkzg-6d958b67b6-gf847   </span><span class="token number">1</span><span class="token plain">/1     Running   </span><span class="token number">0</span><span class="token plain">          15m   </span><span class="token number">10.244</span><span class="token plain">.2.4   kind-worker    </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain">           </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">united-deployment2-hangzhou-lpkzg-6d958b67b6-lbnwl   </span><span class="token number">1</span><span class="token plain">/1     Running   </span><span class="token number">0</span><span class="token plain">          15m   </span><span class="token number">10.244</span><span class="token plain">.2.5   kind-worker    </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain">           </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">united-deployment2-shanghai-tqgd4-57f7555494-9jvjb   </span><span class="token number">1</span><span class="token plain">/1     Running   </span><span class="token number">0</span><span class="token plain">          15m   </span><span class="token number">10.244</span><span class="token plain">.1.5   kind-worker2   </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain">           </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">united-deployment2-shanghai-tqgd4-57f7555494-rn8n8   </span><span class="token number">1</span><span class="token plain">/1     Running   </span><span class="token number">0</span><span class="token plain">          15m   </span><span class="token number">10.244</span><span class="token plain">.1.4   kind-worker2   </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain">           </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="create-service-with-topologykeys">Create Service with TopologyKeys<a aria-hidden="true" class="hash-link" href="#create-service-with-topologykeys" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">cat</span><span class="token plain"> </span><span class="token operator">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">EOF</span><span class="token string bash punctuation" style="color:rgb(248, 248, 242)"> </span><span class="token string bash punctuation operator" style="color:rgb(248, 248, 242)">|</span><span class="token string bash punctuation" style="color:rgb(248, 248, 242)"> kubectl apply -f -</span><span class="token string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">apiVersion: v1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">kind: Service</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">metadata:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  name: svc-ud1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  annotations:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    openyurt.io/topologyKeys: openyurt.io/nodepool</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">spec:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  selector:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    app: united-deployment1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  type: ClusterIP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  ports:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  - port: 80</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    targetPort: 9376</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">EOF</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="create-service-without-topologykeys">Create Service without TopologyKeys<a aria-hidden="true" class="hash-link" href="#create-service-without-topologykeys" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">cat</span><span class="token plain"> </span><span class="token operator">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">EOF</span><span class="token string bash punctuation" style="color:rgb(248, 248, 242)"> </span><span class="token string bash punctuation operator" style="color:rgb(248, 248, 242)">|</span><span class="token string bash punctuation" style="color:rgb(248, 248, 242)"> kubectl apply -f -</span><span class="token string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">apiVersion: v1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">kind: Service</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">metadata:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  name: svc-ud1-without-topology</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">spec:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  selector:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    app: united-deployment1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  type: ClusterIP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  ports:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  - port: 80</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    targetPort: 9376</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">EOF</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="test-service-topology">Test Service Topology<a aria-hidden="true" class="hash-link" href="#test-service-topology" title="Direct link to heading">â€‹</a></h3><p>We use the <code>nginx</code> pod in the shanghai nodepool to test <em>service topology</em>. Therefore, its traffic can only be routed to the nodes that in shanghai nodepool when it accesses a service with the <code>openyurt.io/topologyKeys: openyurt.io/nodepool</code> annotation.</p><p>For comparison, we first test the service without serviceTopology annotation. As we can see, its traffic can be routed to any nodes.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">exec</span><span class="token plain"> -it united-deployment2-shanghai-tqgd4-57f7555494-9jvjb </span><span class="token function" style="color:rgb(80, 250, 123)">bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/</span><span class="token comment" style="color:rgb(98, 114, 164)"># curl svc-ud1-without-topology:80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">united-deployment1-hangzhou-fv6th-66ff6fd958-twf95</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/</span><span class="token comment" style="color:rgb(98, 114, 164)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/</span><span class="token comment" style="color:rgb(98, 114, 164)"># curl svc-ud1-without-topology:80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">united-deployment1-shanghai-5p8zk-84bdd476b6-hr6xt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/</span><span class="token comment" style="color:rgb(98, 114, 164)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/</span><span class="token comment" style="color:rgb(98, 114, 164)"># curl svc-ud1-without-topology:80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">united-deployment1-hangzhou-fv6th-66ff6fd958-twf95</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/</span><span class="token comment" style="color:rgb(98, 114, 164)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/</span><span class="token comment" style="color:rgb(98, 114, 164)"># curl svc-ud1-without-topology:80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">united-deployment1-hangzhou-fv6th-66ff6fd958-f2694</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Then we test the service with serviceTopology annotation. As expected, its traffic can only be routed to the nodes in shanghai nodepool.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">exec</span><span class="token plain"> -it united-deployment2-shanghai-tqgd4-57f7555494-9jvjb </span><span class="token function" style="color:rgb(80, 250, 123)">bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/</span><span class="token comment" style="color:rgb(98, 114, 164)"># curl svc-ud1:80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">united-deployment1-shanghai-5p8zk-84bdd476b6-wjck2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/</span><span class="token comment" style="color:rgb(98, 114, 164)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/</span><span class="token comment" style="color:rgb(98, 114, 164)"># curl svc-ud1:80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">united-deployment1-shanghai-5p8zk-84bdd476b6-hr6xt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/</span><span class="token comment" style="color:rgb(98, 114, 164)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/</span><span class="token comment" style="color:rgb(98, 114, 164)"># curl svc-ud1:80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">united-deployment1-shanghai-5p8zk-84bdd476b6-wjck2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/</span><span class="token comment" style="color:rgb(98, 114, 164)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/</span><span class="token comment" style="color:rgb(98, 114, 164)"># curl svc-ud1:80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">united-deployment1-shanghai-5p8zk-84bdd476b6-hr6xt</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/blog/tags/openyurt">openyurt</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about Use service topology to realize topology-aware traffic routing" href="/blog/How-to-use-service-topology"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_d4p0" itemprop="headline"><a itemprop="url" href="/blog/How-run-business-pod-in-edge-scenarios">How Openyurt runs the business pod in edge scenarios</a></h2><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2021-10-15T00:00:00.000Z" itemprop="datePublished">October 15, 2021</time> Â· <!-- -->7 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://github.com/rambohe-ch" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://github.com/rambohe-ch.png" alt="rambohe"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/rambohe-ch" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">rambohe</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of OpenYurt</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h3 class="anchor anchorWithStickyNavbar_y2LR" id="1èƒŒæ™¯ä»‹ç»">1.èƒŒæ™¯ä»‹ç»<a aria-hidden="true" class="hash-link" href="#1èƒŒæ™¯ä»‹ç»" title="Direct link to heading">â€‹</a></h3><p>OpenYurtæ˜¯ä¸šç•Œé¦–ä¸ªéä¾µå…¥çš„è¾¹ç¼˜è®¡ç®—äº‘åŸç”Ÿå¼€æºé¡¹ç›®ï¼Œé€šè¿‡è¾¹ç¼˜è‡ªæ²»ï¼Œäº‘è¾¹ååŒï¼Œè¾¹ç¼˜å•å…ƒåŒ–ï¼Œè¾¹ç¼˜æµé‡é—­ç¯ç­‰èƒ½åŠ›ä¸ºç”¨æˆ·æä¾›äº‘è¾¹ä¸€ä½“åŒ–çš„ä½¿ç”¨ä½“éªŒã€‚ä¸å°‘ç”¨æˆ·åœ¨ä½¿ç”¨OpenYurtçš„æ—¶å€™ï¼Œç»å¸¸éœ€è¦æŠŠå­˜é‡çš„ä½¿ç”¨InClusterConfigè®¿é—®kube-apiserverçš„Podé€šè¿‡OpenYurtè¿ç§»åˆ°è¾¹ç¼˜ç¯å¢ƒä¸­ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/assets/images/InCluster1-1ef22d79567f77ccd6a6d7eeb72185ac.png"></p><p>åœ¨OpenYurté›†ç¾¤ä¸­ï¼Œæä¾›äº†ä½¿ç”¨InClusterConfigçš„ä¸šåŠ¡Podé›¶ä¿®æ”¹å°±å¯ä»¥è¿è¡Œåœ¨è¾¹ç¼˜ç¯å¢ƒçš„èƒ½åŠ›ã€‚</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="2é¢ä¸´æŒ‘æˆ˜">2.é¢ä¸´æŒ‘æˆ˜<a aria-hidden="true" class="hash-link" href="#2é¢ä¸´æŒ‘æˆ˜" title="Direct link to heading">â€‹</a></h3><p>ä½¿ç”¨InClusterConfigçš„ä¸šåŠ¡Podåœ¨è¾¹ç¼˜ç¯å¢ƒä¸­è¿è¡Œï¼Œéœ€è¦è§£å†³å¦‚ä¸‹é—®é¢˜ï¼š</p><ul><li><p>é—®é¢˜ä¸€ï¼šPodé€šè¿‡InClusterConfigåœ°å€è®¿é—®kube-apiserverï¼ŒèŠ‚ç‚¹ä¸Šé»˜è®¤ç½‘ç»œè§„åˆ™ï¼ˆiptables/ipvsï¼‰å°†ä¼šæŠŠè¯·æ±‚è½¬å‘åˆ°kube-apiserverçš„PodIPï¼ŒåŒæ—¶äº‘ç«¯ä¸è¾¹ç¼˜ä½äºä¸åŒç½‘ç»œå¹³é¢ï¼Œè¾¹ç¼˜æ˜¯æ— æ³•è®¿é—®åˆ°äº‘ç«¯çš„PodIPã€‚æ‰€ä»¥è¾¹ç¼˜ä¸šåŠ¡Podæ— æ³•é€šè¿‡InClusterConfigè®¿é—®åˆ°kube-apiserverã€‚</p><p><img alt="Incluster2" src="/assets/images/Incluster2-7f6a69f9c29152322fbc57bf978eca6e.png"></p></li><li><p>é—®é¢˜äºŒï¼šåœ¨è§£å†³é—®é¢˜ä¸€åï¼Œå¦‚æœäº‘è¾¹ç½‘ç»œæ–­å¼€æ—¶ä¸šåŠ¡Podå®¹å™¨å‡ºç°é‡å¯ç­‰çŠ¶å†µï¼Œè¾¹ç¼˜Podå°†æ— æ³•ä»kube-apiserverè·å–åˆ°ä¸šåŠ¡é…ç½®ï¼Œè¿™ä¼šå½±å“åˆ°ä¸šåŠ¡Podçš„é‡å¯è¿è¡Œã€‚</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="3è§£å†³æ–¹æ¡ˆ">3.è§£å†³æ–¹æ¡ˆ<a aria-hidden="true" class="hash-link" href="#3è§£å†³æ–¹æ¡ˆ" title="Direct link to heading">â€‹</a></h3><p>ä»ä¸Šè¿°é—®é¢˜å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬éœ€è¦æ— æ„ŸçŸ¥çš„è°ƒæ•´è¾¹ç¼˜podçš„è®¿é—®åœ°å€ï¼ŒåŒæ—¶éœ€è¦åœ¨è¾¹ç¼˜ç¯å¢ƒä¸­ç¼“å­˜ä¸šåŠ¡é…ç½®ï¼Œä¿è¯äº‘è¾¹æ–­ç½‘æ—¶ä¹Ÿå¯ä»¥åˆ©ç”¨è¾¹ç¼˜ç¼“å­˜ä¸šåŠ¡é…ç½®ï¼Œä¿è¯äº‘è¾¹æ–­ç½‘æ—¶ä¹Ÿå¯ä»¥åˆ©ç”¨è¾¹ç¼˜ç¼“å­˜æ¥è·å–ä¸šåŠ¡Podçš„é…ç½®ä¿¡æ¯ã€‚å…·ä½“è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼›</p><h5 class="anchor anchorWithStickyNavbar_y2LR" id="31è¾¹ç¼˜podè®¿é—®çš„äº‘ç«¯endpointä¼˜åŒ–">3.1è¾¹ç¼˜Podè®¿é—®çš„äº‘ç«¯endpointä¼˜åŒ–<a aria-hidden="true" class="hash-link" href="#31è¾¹ç¼˜podè®¿é—®çš„äº‘ç«¯endpointä¼˜åŒ–" title="Direct link to heading">â€‹</a></h5><ul><li><p>Podé€šè¿‡InClusterConfigè®¿é—®kube-apiserverï¼Œæºç å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">InClusterConfig</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token plain">Config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    tokenFile  </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;/var/run/secrets/kubernetes.io/serviceaccount/token&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    rootCAFile </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;/var/run/secrets/kubernetes.io/serviceaccount/ca.crt&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// é€šè¿‡Kuberentes serviceå¯¹åº”çš„ç¯å¢ƒå˜é‡æ¥è·å–è®¿é—®åœ°å€</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">host</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> port </span><span class="token operator">:=</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Getenv</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;KUBERNETES_SERVICE_HOST&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Getenv</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;KUBERNETES_SERVICE_PORT&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">len</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">host</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token operator">||</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">len</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">port</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token boolean">nil</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> ErrNotInCluster</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// skip some code...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token plain">Config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Host</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;https://&quot;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> net</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">JoinHostPort</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">host</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> port</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    TLSClientConfig</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> tlsClientConfig</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    BearerToken</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">     </span><span class="token function" style="color:rgb(80, 250, 123)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">token</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    BearerTokenFile</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> tokenFile</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token boolean">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li></ul><ul><li><p>å› æ­¤æƒ³æ— æ„ŸçŸ¥è°ƒæ•´è¾¹ç¼˜Podè®¿é—®çš„äº‘ç«¯endpointï¼Œåªéœ€è¦æ— ä¾µå…¥ä¿®æ”¹Podçš„KUBERNETES_SERVICE_HOSTå’ŒKUBERNETE_SERVICE_PORTä¸¤ä¸ªç¯å¢ƒå˜é‡æˆ–è€…ä¿®æ”¹kubernetes serviceåœ°å€ã€‚è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p><ul><li><p>è§£å†³æ–¹æ¡ˆä¸€ï¼šå¢åŠ ä¸€ä¸ªadmission controlleråœ¨è¾¹ç¼˜Podåˆ›å»ºæ—¶æŠŠkube-apiserverçš„å…¬ç½‘åœ°å€è‡ªåŠ¨æ³¨å…¥åˆ°Podçš„ç¯å¢ƒå˜é‡KUBERNETES_SERVICE_HOSTå’ŒKUBERNETE_SERVICE_PORT</p></li><li><p>è§£å†³æ–¹æ¡ˆäºŒï¼šè¾¹ç¼˜æ•°æ®è¿‡æ»¤æ¡†æ¶ä¸­å¢åŠ ä¸€ä¸ªfillter yurthubçš„è¾¹ç¼˜æ•°æ®è¿‡æ»¤æ¡†æ¶ç±»ä¼¼äºadmission controller ,ä¸“é—¨ç”¨äºè¾¹ç¼˜åœºæ™¯ä¸‹åœ¨è¾¹ç¼˜åº”ç”¨æ— æ„ŸçŸ¥çš„çŠ¶æ€ä¸‹ï¼Œæ— ä¾µå…¥çš„ä¿®æ”¹æˆ–è€…è¿‡æ»¤äº‘ç«¯è¿”å›çš„æ•°æ®ã€‚ç›®å‰æ”¯æŒçš„è¿‡æ»¤å™¨æœ‰ï¼šMasterserviceï¼Œservicetopologyï¼Œdiscardcloudserviceç­‰</p></li><li><p>è§£å†³æ–¹æ¡ˆå¯¹æ¯”ï¼š</p><table><thead><tr><th align="center"></th><th align="center">è§£å†³æ–¹æ¡ˆä¸€</th><th align="center">è§£å†³æ–¹æ¡ˆäºŒ</th></tr></thead><tbody><tr><td align="center">å®ç°æ–¹æ¡ˆ</td><td align="center">å¢åŠ ä¸€ä¸ªadmission controller</td><td align="center">è¾¹ç¼˜æ•°æ®è¿‡æ»¤æ¡†æ¶ä¸­å¢åŠ ä¸€ä¸ªfilter</td></tr><tr><td align="center">å¤æ‚åº¦</td><td align="center">é«˜ï¼ˆéœ€è¦åŒºåˆ«Podè¿è¡Œåœ¨è¾¹ç¼˜è¿˜æ˜¯äº‘ç«¯ï¼‰</td><td align="center">ä½</td></tr><tr><td align="center">æ˜¾ç¤ºä¿®æ”¹æ•°æ®</td><td align="center">Podä¸­å¢åŠ ç¯å¢ƒå˜é‡é…ç½®</td><td align="center">æ— </td></tr></tbody></table></li></ul></li></ul><p>ç»¼åˆå®ç°å¤æ‚åº¦ï¼Œéä¾µå…¥ç­‰è®¾è®¡ç†å¿µï¼Œåœ¨OpenYurtä¸­æˆ‘ä»¬é€‰æ‹©äº†è§£å†³æ–¹æ¡ˆäºŒã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/assets/images/InCluster3-4342c22777070b2df9e39d158a929ac3.png"></p><h5 class="anchor anchorWithStickyNavbar_y2LR" id="32ä¸šåŠ¡podçš„è¾¹ç¼˜è‡ªæ²»">3.2ä¸šåŠ¡Podçš„è¾¹ç¼˜è‡ªæ²»<a aria-hidden="true" class="hash-link" href="#32ä¸šåŠ¡podçš„è¾¹ç¼˜è‡ªæ²»" title="Direct link to heading">â€‹</a></h5><p>åœ¨äº‘è¾¹ç½‘ç»œæ–­å¼€çŠ¶æ€ä¸‹ï¼Œä¸šåŠ¡Podé‡å¯æ—¶ï¼Œå°†æ— æ³•ä»äº‘ç«¯kube-apiserverè·å–åˆ°ä¸šåŠ¡é…ç½®ä¿¡æ¯ï¼Œå› æ­¤éœ€è¦åœ¨è¾¹ç¼˜æœ¬åœ°ç¼“å­˜Podçš„ä¸šåŠ¡æ•°æ®ã€‚</p><p><img src="/assets/images/InCluster4-4a67ce6edd8af63676837754c51f97f3.png"></p><p>è¯´æ˜1ï¼šä¸šåŠ¡Podé€šè¿‡yurthubè®¿é—®kube-apiserverï¼Œä¹Ÿæ„å‘³ç€<!-- -->[3.1 è¾¹ç¼˜Podè®¿é—®çš„äº‘ç«¯endpointä¼˜åŒ–]<!-- -->ç« èŠ‚ä¸­æåˆ°çš„KUBERNETES_SERVICE_HOSTå’ŒKUBERNETE_SERVICE_PORTç¯å¢ƒå˜é‡è¢«ä¿®æ”¹ä¸ºyurthub https endpoint(169.254.2.1:10268)ã€‚</p><p>è¯´æ˜2ï¼šå¦‚æœä¸šåŠ¡Podçš„å¤§é‡list/watchæ“ä½œå¯¼è‡´å¤§é‡æœ¬åœ°cacheï¼Œå¯èƒ½ä¼šé€ æˆæœ¬åœ°ç£ç›˜å‹åŠ›ï¼Œå› æ­¤yurthubå¯¹ä¸šåŠ¡Podçš„ç¼“å­˜èƒ½åŠ›é»˜è®¤æ˜¯å…³é—­çš„ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡yurt-hub-cfg configmapçš„cache_agentså­—æ®µä¸­å¢åŠ User-Agentä¿¡æ¯æ¥æ‰“å¼€å¯¹åº”Podçš„æ•°æ®ç¼“å­˜ã€‚ä¾‹å¦‚ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">apiVersion</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kind</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> ConfigMap</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">metadata</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> yurt</span><span class="token operator">-</span><span class="token plain">hub</span><span class="token operator">-</span><span class="token plain">cfg</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  namespace</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> kube</span><span class="token operator">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  # ç¼“å­˜è¾¹ç¼˜ingress</span><span class="token operator">-</span><span class="token plain">controller podè®¿é—®kube</span><span class="token operator">-</span><span class="token plain">apiserverçš„æ•°æ®</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  cache_agents</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;ingress-controller&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="4æ€»ç»“">4.æ€»ç»“<a aria-hidden="true" class="hash-link" href="#4æ€»ç»“" title="Direct link to heading">â€‹</a></h3><ul><li><p>å¦‚æœå­˜é‡Podæ— éœ€è®¿é—®kube-apiserveræˆ–è€…InClusterConfigè®¿é—®kube-apiserverï¼Œè¿™äº›ç±»å‹Podå¯ä»¥é›¶ä¿®æ”¹è¿è¡Œåˆ°OpenYurté›†ç¾¤çš„è¾¹ç¼˜ç¯å¢ƒä¸Šã€‚é€šè¿‡å…¶ä»–æ–¹å¼è®¿é—®kube-apiserverçš„ä¸šåŠ¡Podç›®å‰æ— æ³•ä¿è¯é›¶ä¿®æ”¹è¿è¡Œåˆ°è¾¹ç¼˜ç¯å¢ƒã€‚</p></li><li><p>è¾¹ç¼˜ä¸šåŠ¡Podæ˜¯å¦æ­£å¸¸è®¿é—®kube-apiserverï¼Œé¦–å…ˆå¯ä»¥æŸ¥çœ‹ä¸šåŠ¡podçš„ç¯å¢ƒå˜é‡æ˜¯å¦æ­£å¸¸ï¼š</p><p>KUBERNETES_SERVICE_HOST=127.0.0.1æˆ–è€…169.254.2.1ï¼ŒKUBERNETES_SERVICE_PORT=10268ã€‚ç„¶åå¯ä»¥æŸ¥çœ‹yurthubç»„ä»¶çš„æ—¥å¿—æ˜¯å¦æœ‰ä¸šåŠ¡Podç›¸å…³çš„è¯·æ±‚æ—¥å¿—ã€‚å½“ç„¶ä¹Ÿå¯ä»¥æŸ¥è¯¢ä¸šåŠ¡Podçš„æ—¥å¿—æ˜¯å¦æ­£å¸¸ã€‚æœ€åå¯ä»¥ç¡®è®¤/etc/kubernetes/cacheç›®å½•æ˜¯å¦æœ‰ç›¸å…³ç»„ä»¶çš„ç¼“å­˜æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰å¯ä»¥å†ç¡®è®¤kube-system/yurt-hub-cfg configmapæ˜¯å¦å·²ç»é…ç½®ã€‚</p></li><li><p>ä½¿ç”¨InClusterConfigçš„Podé›¶ä¿®æ”¹è¿è¡Œåˆ°è¾¹ç¼˜ç¯å¢ƒçš„èƒ½åŠ›ï¼Œæ•´ä½“å®ç°ç”±yurthubç»„ä»¶æ‰¿è½½ï¼Œæ²¡æœ‰ç»™OpenYurtæ¶æ„å¢åŠ é¢å¤–çš„è´Ÿæ‹…ï¼ŒåŒæ—¶ç”¨æˆ·åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å¯¹è¯¥èƒ½åŠ›ä¹ŸåŸºæœ¬æ— æ„ŸçŸ¥ï¼Œå¯¹åŸç”Ÿä¸šåŠ¡Podæ— ä¾µå…¥ã€‚</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥ï¼š<a aria-hidden="true" class="hash-link" href="#å‚è€ƒé“¾æ¥" title="Direct link to heading">â€‹</a></h3><p>1.<a href="https://kubernetes.io/docs/tasks/access-application-cluster/access-cluster/#accessing-the-api-from-a-pod" target="_blank" rel="noopener noreferrer">Accessing the API from a Pod</a></p><p>2.<a href="https://github.com/openyurtio/openyurt/blob/master/docs/proposals/20210720-data-filtering-framework.md" target="_blank" rel="noopener noreferrer">data filtering framework on the edge</a></p><p>3.<a href="https://mp.weixin.qq.com/s/4BLfvMJJA623ZwRSgUE69A" target="_blank" rel="noopener noreferrer">æ·±åº¦è§£è¯»OpenYurtï¼šè¾¹ç¼˜è‡ªæ²»èƒ½åŠ›è®¾è®¡è§£æ</a></p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/blog/tags/openyurt">openyurt</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about How Openyurt runs the business pod in edge scenarios" href="/blog/How-run-business-pod-in-edge-scenarios"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_d4p0" itemprop="headline"><a itemprop="url" href="/blog/Play-with-OpenYurt-on-Raspberry-Pi">Getting Started with OpenYurt:play with OpenYurt on Raspberry Pi</a></h2><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2021-01-05T00:00:00.000Z" itemprop="datePublished">January 5, 2021</time> Â· <!-- -->18 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://github.com/zyjhtangtang" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://github.com/zyjhtangtang.png" alt="zyjhtangtang"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/zyjhtangtang" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">zyjhtangtang</span></a></div><small class="avatar__subtitle" itemprop="description">Member of OpenYurt</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><img alt="image" src="/assets/images/Raspberry_Pi-0d62d9c9627727b87279383f61ae8222.png"></p><p>éšç€è¾¹ç¼˜è®¡ç®—çš„å¿«é€Ÿå‘å±•ï¼Œè¶Šæ¥è¶Šå¤šçš„æ•°æ®éœ€è¦åˆ°ç½‘ç»œçš„è¾¹ç¼˜ä¾§è¿›è¡Œå­˜å‚¨ã€å¤„ç†å’Œåˆ†æï¼Œè¾¹ç¼˜çš„è®¾å¤‡å’Œåº”ç”¨å‘ˆçˆ†å‘å¼å¢é•¿ã€‚å¦‚ä½•é«˜æ•ˆçš„ç®¡ç†è¾¹ç¼˜ä¾§çš„èµ„æºå’Œåº”ç”¨æ˜¯ä¸šç•Œé¢ä¸´çš„ä¸€ä¸ªä¸»è¦é—®é¢˜ã€‚å½“å‰ï¼Œé‡‡ç”¨äº‘åŸç”Ÿçš„æ–¹æ³•ï¼Œå°†äº‘è®¡ç®—çš„èƒ½åŠ›ä¸‹æ²‰åˆ°è¾¹ç¼˜å¹¶åœ¨äº‘ç«¯åšç»Ÿä¸€è°ƒåº¦ã€ç®¡æ§çš„äº‘è¾¹ç«¯ä¸€ä½“åŒ–æ¶æ„å¾—åˆ°äº†ä¸šç•Œçš„å¹¿æ³›è®¤å¯ã€‚</p><p>2020 å¹´ 5 æœˆï¼Œé˜¿é‡Œå·´å·´å¼€æºé¦–ä¸ª Kubernetes æ— ä¾µå…¥çš„è¾¹ç¼˜è®¡ç®—äº‘åŸç”Ÿé¡¹ç›® OpenYurtï¼Œå¹¶äºåŒå¹´ 9 æœˆä»½è¿›å…¥ CNCF SandBoxã€‚OpenYurt é’ˆå¯¹è¾¹ç¼˜åœºæ™¯ä¸­ç½‘ç»œä¸ç¨³å®šã€äº‘è¾¹è¿ç»´å›°éš¾ç­‰é—®é¢˜ï¼Œå¯¹åŸç”Ÿ Kubernetes æ— ä¾µå…¥åœ°å¢å¼ºï¼Œé‡ç‚¹æä¾›äº†è¾¹ç¼˜èŠ‚ç‚¹è‡ªæ²»ã€äº‘è¾¹è¿ç»´é€šé“ã€è¾¹ç¼˜å•å…ƒåŒ–çš„èƒ½åŠ›ã€‚</p><p>å¦‚å›¾ä¸‹æ‰€ç¤ºï¼Œ
<img alt="image" src="/assets/images/kubernetes-324e5f10b1e66083e02453040890714b.png"></p><p>æœ¬æ–‡é€šè¿‡åœ¨äº‘ç«¯éƒ¨ç½² Kubernetes é›†ç¾¤çš„æ§åˆ¶é¢ï¼Œå¹¶å°†æ ‘è“æ´¾æ¥å…¥é›†ç¾¤æ¥æ­å»ºäº‘ç®¡è¾¹åœºæ™¯ã€‚åŸºäºè¿™ä¸ªç¯å¢ƒæ¼”ç¤º OpenYurt çš„æ ¸å¿ƒèƒ½åŠ›ï¼Œå¸¦å¤§å®¶å¿«é€Ÿä¸Šæ‰‹ OpenYurtã€‚</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="ç¯å¢ƒå‡†å¤‡">ç¯å¢ƒå‡†å¤‡<a aria-hidden="true" class="hash-link" href="#ç¯å¢ƒå‡†å¤‡" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="1åŸºç¡€ç¯å¢ƒä»‹ç»">1ï¼‰åŸºç¡€ç¯å¢ƒä»‹ç»<a aria-hidden="true" class="hash-link" href="#1åŸºç¡€ç¯å¢ƒä»‹ç»" title="Direct link to heading">â€‹</a></h3><p>åœ¨äº‘ç«¯ï¼Œè´­ä¹° ENS èŠ‚ç‚¹ï¼ˆENS èŠ‚ç‚¹å…·æœ‰å…¬ç½‘ IPï¼Œæ–¹ä¾¿é€šè¿‡å…¬ç½‘å¯¹å¤–æš´éœ²æœåŠ¡ï¼‰æ¥éƒ¨ç½²åŸç”Ÿ K8s é›†ç¾¤çš„ç®¡æ§ç»„ä»¶ã€‚å…¶ä¸­ç³»ç»Ÿé‡‡ç”¨ ubuntu18.04ã€hostname ä¸º master-nodeã€docker ç‰ˆæœ¬ä¸º 19.03.5ã€‚</p><p>åœ¨è¾¹ç¼˜ï¼Œå°†æ ‘è“æ´¾ 4 ä¸æœ¬åœ°çš„è·¯ç”±å™¨è¿æ¥ï¼Œç»„æˆè¾¹ç¼˜ç§ç½‘ç¯å¢ƒï¼Œè·¯ç”±å™¨é€šè¿‡ 4G ç½‘å¡è®¿é—®äº’è”ç½‘ã€‚å…¶ä¸­æ ‘è“æ´¾ 4 é¢„è£…ç³»ç»Ÿä¸º ubuntu18.04ã€hostnameä¸º edge-nodeã€docker ç‰ˆæœ¬ä¸º 19.03.5ã€‚
<img alt="image" src="/assets/images/edge_raspberry_pi-8b6984239d5bceffe23207955be08dfa.png"></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="2åŸç”Ÿk8sé›†ç¾¤æ­å»º">2)åŸç”ŸK8sé›†ç¾¤æ­å»º<a aria-hidden="true" class="hash-link" href="#2åŸç”Ÿk8sé›†ç¾¤æ­å»º" title="Direct link to heading">â€‹</a></h3><p>æœ¬æ–‡æ¼”ç¤ºç¯å¢ƒåŸºäºç¤¾åŒº1.16.6ç‰ˆæœ¬çš„K8sé›†ç¾¤ï¼Œå¹¶é‡‡ç”¨ç¤¾åŒºæä¾›çš„kubeadmå·¥å…·æ¥æ­å»ºé›†ç¾¤ï¼Œå…·ä½“æ“ä½œå¦‚ä¸‹ï¼š</p><ul><li>åœ¨äº‘ç«¯èŠ‚ç‚¹å’Œæ ‘è“æ´¾ä¸Šåˆ†åˆ«æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å®‰è£… Kubernetes ç»„ä»¶ã€‚</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">curl -s https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | sudo apt-key add -</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">echo &quot;deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main&quot; &gt; /etc/apt/sources.list.d/kubernetes.list</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo apt-get update</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo apt install -y kubelet=1.16.6-00 kubeadm=1.16.6-00 kubectl=1.16.6-00</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>ä½¿ç”¨kubeadm åˆå§‹åŒ–äº‘ç«¯èŠ‚ç‚¹ï¼ˆåœ¨äº‘ç«¯èŠ‚ç‚¹ä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼‰ï¼Œéƒ¨ç½²è¿‡ç¨‹ä¸­é‡‡ç”¨é˜¿é‡Œäº‘çš„é•œåƒä»“åº“ï¼Œä¸ºäº†æ”¯æŒæ ‘è“æ´¾çš„æ¥å…¥ï¼Œè¯¥ä»“åº“çš„é•œåƒåšäº† manifest åˆ—è¡¨ï¼Œèƒ½å¤Ÿæ”¯æŒ amd64/arm64 ä¸¤ç§ä¸åŒçš„ CPU æ¶æ„ã€‚</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># master-node</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubeadm init --image-repository=registry.cn-hangzhou.aliyuncs.com/edge-kubernetes --kubernetes-version=v1.16.6 --pod-network-cidr=10.244.0.0/16</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>ä¾æ®åˆå§‹åŒ–å®Œæˆä¹‹åçš„æç¤ºï¼Œæ‹·è´ config æ–‡ä»¶åˆ° $HOME/.kube ä¸­ï¼š</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mkdir -p $HOME/.kube</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>æ ‘è“æ´¾æ¥å…¥äº‘ç«¯é›†ç¾¤ä¾æ®ç¬¬äºŒæ­¥ä¸­åˆå§‹åŒ–å®Œæˆä»¥åè¾“å‡ºçš„èŠ‚ç‚¹æ¥å…¥ä¿¡æ¯ï¼Œåœ¨æ ‘è“æ´¾ä¸Šæ‰§è¡Œæ¥å…¥å‘½ä»¤ã€‚</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubeadm join 183.195.233.42:6443 --token XXXX \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> --discovery-token-ca-cert-hash XXXX</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>æ·»åŠ  cni é…ç½®ï¼ˆäº‘ç«¯ç®¡æ§èŠ‚ç‚¹å’Œæ ‘è“æ´¾éƒ½éœ€è¦é…ç½®ï¼‰ï¼Œæœ¬æ–‡æ­å»ºçš„é›†ç¾¤ä½¿ç”¨ä¸»æœºç½‘ç»œã€‚åˆ›å»º cni é…ç½®æ–‡ä»¶ /etc/cni/net.d/0-loopback.confï¼Œå¹¶å°†å¦‚ä¸‹å†…å®¹æ‹·è´åˆ°è¯¥æ–‡ä»¶ä¸­ã€‚</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> &quot;cniVersion&quot;: &quot;0.3.0&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> &quot;name&quot;: &quot;lo&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> &quot;type&quot;: &quot;loopback&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>åœ¨ master èŠ‚ç‚¹ä¸ŠæŸ¥çœ‹éƒ¨ç½²æ•ˆæœã€‚</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME STATUS ROLES AGE VERSION INTERNAL-IP EXTERNAL-IP OS-IMAGE KERNEL-VERSION CONTAINER-RUNTIME</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">edge-node Ready &lt;none&gt;   74s    v1.16.6   192.168.0.100    &lt;none&gt;        Ubuntu 18.04.4 LTS   4.19.105-v8-28      docker://19.3.5</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">master-node   Ready    master   2m5s   v1.16.6   183.195.233.42   &lt;none&gt;        Ubuntu 18.04.2 LTS   4.15.0-52-generic   docker://19.3.5</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>åˆ é™¤ CoreDNSï¼ˆæœ¬æ–‡ Demo ä¸­ CoreDNS ä¸éœ€è¦ä½¿ç”¨ï¼‰ï¼Œå¹¶å°† master èŠ‚ç‚¹çš„ taints å»æ‰ï¼ˆæ–¹ä¾¿åç»­éƒ¨ç½² OpenYurt ç»„ä»¶ï¼‰ã€‚</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl delete deployment coredns -n kube-system</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl taint node master-node node-role.kubernetes.io/master-</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="åŸç”Ÿ-k8s-é›†ç¾¤åœ¨è¾¹ç¼˜åœºæ™¯ä¸­çš„é—®é¢˜">åŸç”Ÿ K8s é›†ç¾¤åœ¨è¾¹ç¼˜åœºæ™¯ä¸­çš„é—®é¢˜<a aria-hidden="true" class="hash-link" href="#åŸç”Ÿ-k8s-é›†ç¾¤åœ¨è¾¹ç¼˜åœºæ™¯ä¸­çš„é—®é¢˜" title="Direct link to heading">â€‹</a></h2><p>åŸºäºä¸Šè¿°ç¯å¢ƒï¼Œæˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹åŸç”Ÿ K8s åœ¨äº‘ç®¡è¾¹æ¶æ„ä¸­å¯¹äº‘è¾¹è¿ç»´çš„æ”¯æŒå’Œå¯¹äº‘è¾¹ç½‘ç»œæ–­å¼€æ—¶çš„ååº”ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ä»äº‘ç«¯éƒ¨ç½²ä¸€ä¸ªæµ‹è¯•åº”ç”¨ nginxï¼Œåœ¨ master èŠ‚ç‚¹ä¸Šæ‰§è¡Œ kubectl apply -f nginx.yamlï¼Œå…·ä½“çš„éƒ¨ç½² yaml å¦‚ä¸‹ã€‚</p><p>æ³¨æ„ï¼šnodeSelector é€‰æ‹© edge-node èŠ‚ç‚¹ï¼Œä¸»æœºç½‘ç»œé…ç½®ä¸º trueï¼Œå¹¶é…ç½® pod çš„å®¹å¿æ—¶é—´ä¸º 5sï¼ˆé»˜è®¤ 5min, æ­¤å¤„é…ç½®ä¾¿äºæ¼”ç¤º pod é©±é€ï¼‰ã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kind: Pod</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> name: nginx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> tolerations:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> - key: &quot;node.kubernetes.io/unreachable&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> operator: &quot;Exists&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> effect: &quot;NoExecute&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> tolerationSeconds: 5</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> - key: &quot;node.kubernetes.io/not-ready&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> operator: &quot;Exists&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> effect: &quot;NoExecute&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> tolerationSeconds: 5</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> nodeSelector:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> kubernetes.io/hostname: edge-node</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> containers:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> - name: nginx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> image: nginx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> hostNetwork: true</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>æŸ¥çœ‹éƒ¨ç½²ç»“æœï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl get pods -owide</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">nginx 1/1 Running 0 11s 192.168.0.100 edge-node &lt;none&gt; </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="1æµ‹è¯•å¸¸ç”¨çš„é›†ç¾¤è¿ç»´æŒ‡ä»¤åŒ…æ‹¬-logsexecport-forward">1ï¼‰æµ‹è¯•å¸¸ç”¨çš„é›†ç¾¤è¿ç»´æŒ‡ä»¤ï¼ŒåŒ…æ‹¬ logsã€execã€port-forward<a aria-hidden="true" class="hash-link" href="#1æµ‹è¯•å¸¸ç”¨çš„é›†ç¾¤è¿ç»´æŒ‡ä»¤åŒ…æ‹¬-logsexecport-forward" title="Direct link to heading">â€‹</a></h3><p>åœ¨ master èŠ‚ç‚¹ä¸Šè¿ç»´è¾¹ç¼˜èŠ‚ç‚¹åº”ç”¨ï¼Œæ‰§è¡Œ logs/exec/port-forward ç­‰æŒ‡ä»¤ï¼ŒæŸ¥çœ‹ç»“æœã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl logs nginx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Error from server: Get https://192.168.0.100:10250/containerLogs/default/nginx/nginx: dial tcp 192.168.0.100:10250: connect: connection refused</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl exec -it nginx sh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl exec [POD] -- [COMMAND] instead.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Error from server: error dialing backend: dial tcp 192.168.0.100:10250: connect: connection refused</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl port-forward pod/nginx 8888:80</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">error: error upgrading connection: error dialing backend: dial tcp 192.168.0.100:10250: connect: connection refused</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ä»æ‰§è¡Œç»“æœçœ‹ï¼ŒåŸç”Ÿçš„k8såœ¨äº‘ç®¡è¾¹çš„åœºæ™¯ä¸­ï¼Œæ— æ³•æä¾›ä»äº‘ç«¯è¿ç»´è¾¹ç¼˜åº”ç”¨çš„èƒ½åŠ›ã€‚è¿™æ˜¯å› ä¸ºè¾¹ç¼˜èŠ‚ç‚¹éƒ¨ç½²åœ¨ç”¨æˆ·çš„ç§ç½‘ç¯å¢ƒï¼Œä»äº‘ç«¯æ— æ³•é€šè¿‡è¾¹ç¼˜èŠ‚ç‚¹çš„ IP åœ°å€ç›´æ¥è®¿é—®è¾¹ç¼˜èŠ‚ç‚¹ã€‚</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="2æµ‹è¯•è¾¹ç¼˜æ–­ç½‘æ—¶å¯¹ä¸šåŠ¡çš„å½±å“">2ï¼‰æµ‹è¯•è¾¹ç¼˜æ–­ç½‘æ—¶å¯¹ä¸šåŠ¡çš„å½±å“<a aria-hidden="true" class="hash-link" href="#2æµ‹è¯•è¾¹ç¼˜æ–­ç½‘æ—¶å¯¹ä¸šåŠ¡çš„å½±å“" title="Direct link to heading">â€‹</a></h3><p>è¾¹ç¼˜èŠ‚ç‚¹ä¸äº‘ç«¯ç®¡æ§é€šè¿‡å…¬ç½‘è¿æ¥ï¼Œç»å¸¸ä¼šå‡ºç°ç½‘ç»œä¸ç¨³å®šï¼Œäº‘ç«¯æ–­è¿çš„æƒ…å†µã€‚è¿™é‡Œæˆ‘ä»¬å°†åšä¸¤ä¸ªæ–­ç½‘ç›¸å…³çš„æµ‹è¯•ï¼š</p><ul><li><p>æ–­ç½‘ 1 åˆ†é’Ÿ-&gt;æ¢å¤ç½‘ç»œ</p></li><li><p>æ–­ç½‘ 1 åˆ†é’Ÿ-&gt;é‡å¯è¾¹ç¼˜èŠ‚ç‚¹-&gt;æ¢å¤ç½‘ç»œ</p></li></ul><p>è§‚å¯Ÿä¸¤ä¸ªæµ‹è¯•è¿‡ç¨‹ä¸­èŠ‚ç‚¹å’Œ Pod çš„çŠ¶æ€å˜åŒ–ã€‚æœ¬æ–‡ Demo ä¸­çš„æ–­ç½‘æ–¹å¼æ˜¯å°†è·¯ç”±å™¨çš„å…¬ç½‘è¿æ¥æ–­å¼€ã€‚</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="1æ–­ç½‘1åˆ†é’Ÿ-æ¢å¤ç½‘ç»œ">1.æ–­ç½‘1åˆ†é’Ÿ-&gt;æ¢å¤ç½‘ç»œ<a aria-hidden="true" class="hash-link" href="#1æ–­ç½‘1åˆ†é’Ÿ-æ¢å¤ç½‘ç»œ" title="Direct link to heading">â€‹</a></h4><p>æ–­å¼€ç½‘ç»œï¼Œå¤§çº¦ 40s åï¼ŒèŠ‚ç‚¹å˜æˆ NotReadyï¼ˆæ­£å¸¸èŠ‚ç‚¹ 10s é’Ÿä¸ŠæŠ¥ä¸€æ¬¡å¿ƒè·³ï¼Œå½“ 4 æ¬¡æ²¡æœ‰ä¸ŠæŠ¥å¿ƒè·³æ—¶ï¼Œç®¡æ§ç»„ä»¶è®¤ä¸ºèŠ‚ç‚¹å¼‚å¸¸ï¼‰ã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl get nodes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME STATUS ROLES AGE VERSION</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">edge-node NotReady &lt;none&gt;   5m13s   v1.16.6</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">master-node   Ready      master   6m4s    v1.16.6</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ç»§ç»­ç­‰å¾… 5s ä¹‹åï¼ˆæ­£å¸¸èŠ‚ç‚¹å˜ä¸º NotReady ä¹‹åï¼Œ5m æ‰å¼€å§‹é©±é€ podï¼Œæ­¤å¤„ä¸ºäº†æµ‹è¯•æ•ˆæœï¼Œå°† pod çš„å®¹å¿æ—¶é—´é…æˆäº† 5sï¼‰ï¼Œåº”ç”¨ pod è¢«é©±é€ï¼ŒçŠ¶æ€å˜ä¸º Terminatingã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl get pods</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME READY STATUS RESTARTS AGE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">nginx 1/1 Terminating 0 3m45s</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>å°†ç½‘ç»œæ¢å¤ï¼Œè§‚å¯ŸèŠ‚ç‚¹åŠ pod å˜åŒ–ã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl get pods</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">No resources found in default namespace.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ç½‘ç»œæ¢å¤åï¼ŒèŠ‚ç‚¹çŠ¶æ€å˜æˆ readyï¼Œä¸šåŠ¡ pod è¢«æ¸…é™¤ï¼Œè¿™æ˜¯å› ä¸ºè¾¹ç¼˜èŠ‚ç‚¹çš„ Kubelet è·å–åˆ°ä¸šåŠ¡ Pod çš„ Terminating çŠ¶æ€ï¼Œå¯¹ä¸šåŠ¡ Pod åšåˆ é™¤æ“ä½œï¼Œå¹¶è¿”å›åˆ é™¤æˆåŠŸï¼Œäº‘ç«¯ä¹Ÿåšäº†ç›¸åº”çš„æ¸…ç†ã€‚è‡³æ­¤ï¼Œä¸šåŠ¡ Pod ç”±äºäº‘è¾¹ç½‘ç»œçš„ä¸ç¨³å®šè€Œè¢«é©±é€ï¼Œç„¶è€Œåœ¨æ–­ç½‘æœŸé—´ï¼Œè¾¹ç¼˜èŠ‚ç‚¹å…¶å®æ˜¯å¯ä»¥æ­£å¸¸å·¥ä½œçš„ã€‚</p><p>é‡æ–°åˆ›å»ºåº”ç”¨ nginxï¼Œç”¨äºä¸‹é¢æµ‹è¯•ã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl get pods -owide</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">nginx 1/1 Running 0 4s 192.168.0.100 edge-node &lt;none&gt;           &lt;none&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="2æ–­ç½‘1åˆ†é’Ÿ-é‡å¯è¾¹ç¼˜èŠ‚ç‚¹-æ¢å¤ç½‘ç»œ">2.æ–­ç½‘1åˆ†é’Ÿ-&gt;é‡å¯è¾¹ç¼˜èŠ‚ç‚¹-&gt;æ¢å¤ç½‘ç»œ<a aria-hidden="true" class="hash-link" href="#2æ–­ç½‘1åˆ†é’Ÿ-é‡å¯è¾¹ç¼˜èŠ‚ç‚¹-æ¢å¤ç½‘ç»œ" title="Direct link to heading">â€‹</a></h4><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æµ‹è¯•åœ¨æ–­ç½‘çš„æƒ…å†µä¸‹ï¼Œè¾¹ç¼˜èŠ‚ç‚¹çš„é‡å¯å¯¹ä¸šåŠ¡çš„å½±å“ã€‚æ–­ç½‘ 1 åˆ†é’Ÿä¹‹åï¼ŒNode å’Œ Pod çŠ¶æ€åŒä¸Šé¢æµ‹è¯•ç»“æœï¼ŒNode å˜ä¸º NotReadyï¼ŒPod çš„çŠ¶æ€å˜ä¸º Terminatingã€‚æ­¤æ—¶ï¼Œåˆ‡æ¢åˆ°ç§æœ‰ç½‘ç»œç¯å¢ƒï¼Œç™»å½•åˆ°æ ‘è“æ´¾ä¸Šï¼Œå°†æ ‘è“æ´¾é‡å¯ï¼Œé‡å¯å®Œæˆåç­‰å¾…å¤§çº¦ 1 åˆ†é’Ÿï¼Œè§‚å¯Ÿé‡å¯å‰åèŠ‚ç‚¹ä¸Šçš„å®¹å™¨åˆ—è¡¨ã€‚</p><p>é‡å¯å‰è¾¹ç¼˜èŠ‚ç‚¹å®¹å™¨åˆ—è¡¨ï¼ˆæ­¤æ—¶äº‘è¾¹ç«¯å¼€ï¼Œè™½ç„¶åœ¨äº‘ç«¯è·å–çš„ pod æ˜¯ Terminating çŠ¶æ€ï¼Œä½†æ˜¯è¾¹ç¼˜å¹¶æœª Watch åˆ° Terminating çš„æ“ä½œï¼Œæ‰€ä»¥è¾¹ç¼˜çš„åº”ç”¨è¿˜æ­£å¸¸è¿è¡Œï¼‰ã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@edge-node:~# docker ps</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">9671cbf28ca6 e86f991e5d10 &quot;/docker-entrypoint.â€¦&quot; About a minute ago Up About a minute k8s_nginx_nginx_default_efdf11c6-a41c-4b95-8ac8-45e02c9e1f4d_0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">6272a46f93ef registry.cn-hangzhou.aliyuncs.com/edge-kubernetes/pause:3.1 &quot;/pause&quot; 2 minutes ago Up About a minute k8s_POD_nginx_default_efdf11c6-a41c-4b95-8ac8-45e02c9e1f4d_0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">698bb024c3db f9ea384ddb34 &quot;/usr/local/bin/kubeâ€¦&quot; 8 minutes ago Up 8 minutes k8s_kube-proxy_kube-proxy-rjws7_kube-system_51576be4-2b6d-434d-b50b-b88e2d436fef_0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">31952700c95b registry.cn-hangzhou.aliyuncs.com/edge-kubernetes/pause:3.1 &quot;/pause&quot; 8 minutes ago Up 8 minutes k8s_POD_kube-proxy-rjws7_kube-system_51576be4-2b6d-434d-b50b-b88e2d436fef_0</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>é‡å¯åèŠ‚ç‚¹å®¹å™¨åˆ—è¡¨ï¼Œæ–­ç½‘é‡å¯åï¼Œkubelet æ— æ³•ä»äº‘ç«¯è·å– Pod ä¿¡æ¯ï¼Œä¸ä¼šé‡å»º Podã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@edge-node:~# docker ps</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@edge-node:~#</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ä»é‡å¯å‰åçš„å¯¹æ¯”çœ‹ï¼Œè¾¹ç¼˜èŠ‚ç‚¹åœ¨æ–­ç½‘é‡å¯ä¹‹åï¼ŒèŠ‚ç‚¹ä¸Šçš„ Pod å…¨éƒ¨æ— æ³•æ¢å¤ã€‚è¿™å°±ä¼šå¯¼è‡´åœ¨äº‘è¾¹æ–­ç½‘æ—¶ï¼Œä¸€æ—¦èŠ‚ç‚¹é‡å¯ï¼Œåº”ç”¨å°†æ— æ³•å·¥ä½œã€‚</p><p>å°†ç½‘ç»œæ¢å¤ï¼Œè§‚å¯ŸèŠ‚ç‚¹åŠ pod å˜åŒ–ï¼ŒåŒä¸Šé¢æµ‹è¯•ç»“æœï¼Œç½‘ç»œæ¢å¤åï¼ŒèŠ‚ç‚¹å˜ä¸º Readyï¼Œä¸šåŠ¡ Pod è¢«æ¸…é™¤ã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl get nodes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME STATUS ROLES AGE VERSION</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">edge-node Ready &lt;none&gt;   11m   v1.16.6</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">master-node   Ready    master   12m   v1.16.6</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl get pods</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">No resources found in default namespace.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>æ¥ä¸‹æ¥ï¼Œå†æ¬¡éƒ¨ç½²ä¸šåŠ¡ nginxï¼Œæµ‹è¯• OpenYurt é›†ç¾¤å¯¹äº‘è¾¹è¿ç»´çš„æ”¯æŒå’Œå¯¹äº‘è¾¹æ–­ç½‘æ—¶çš„ååº”ã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl get pods -owide</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">nginx 1/1 Running 0 12s 192.168.0.100 edge-node &lt;none&gt;           &lt;none&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="åŸç”Ÿ-k8s-é›†ç¾¤ä¸€é”®è½¬æ¢ä¸º-openyurt-é›†ç¾¤">åŸç”Ÿ K8s é›†ç¾¤ä¸€é”®è½¬æ¢ä¸º OpenYurt é›†ç¾¤<a aria-hidden="true" class="hash-link" href="#åŸç”Ÿ-k8s-é›†ç¾¤ä¸€é”®è½¬æ¢ä¸º-openyurt-é›†ç¾¤" title="Direct link to heading">â€‹</a></h2><p>æ¢ç©¶äº†åŸç”Ÿ Kubernetes åœ¨äº‘è¾¹ä¸€ä½“åŒ–æ¶æ„ä¸­çš„ä¸è¶³ä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ OpenYurt é›†ç¾¤æ˜¯å¦èƒ½æ»¡è¶³è¿™ç§åœºæ™¯ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬åˆ©ç”¨ OpenYurt ç¤¾åŒºæä¾›çš„é›†ç¾¤è½¬æ¢å·¥å…· yurtctlï¼Œæ¥å°†åŸç”Ÿ K8s é›†ç¾¤è½¬æ¢æˆ OpenYurt é›†ç¾¤ã€‚åœ¨ master èŠ‚ç‚¹ä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œ è¯¥å‘½ä»¤æŒ‡å®šäº†ç»„ä»¶çš„é•œåƒä»¥åŠäº‘ç«¯èŠ‚ç‚¹ï¼Œå¹¶æŒ‡å®šå®‰è£…äº‘è¾¹è¿ç»´é€šé“ yurt-tunnelã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">yurtctl convert --yurt-controller-manager-image=registry.cn-hangzhou.aliyuncs.com/openyurt/yurt-controller-manager:v0.2.1 --yurt-tunnel-agent-image=registry.cn-hangzhou.aliyuncs.com/openyurt/yurt-tunnel-agent:v0.2.1 --yurt-tunnel-server-image=registry.cn-hangzhou.aliyuncs.com/openyurt/yurt-tunnel-server:v0.2.1 --yurtctl-servant-image=registry.cn-hangzhou.aliyuncs.com/openyurt/yurtctl-servant:v0.2.1 --yurthub-image=registry.cn-hangzhou.aliyuncs.com/openyurt/yurthub:v0.2.1 --cloud-nodes=master-node --deploy-yurttunnel</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è½¬æ¢å¤§æ¦‚éœ€è¦ 2minï¼Œè½¬æ¢å®Œæˆä¹‹åï¼Œè§‚å¯Ÿä¸šåŠ¡ pod çš„çŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°è½¬æ¢è¿‡ç¨‹ä¸­å¯¹ä¸šåŠ¡ pod æ— å½±å“ï¼ˆä¹Ÿå¯ä»¥åœ¨è½¬æ¢è¿‡ç¨‹ä¸­åœ¨æ–°çš„ç»ˆç«¯ä½¿ç”¨ kubectl get pod -w è§‚å¯Ÿä¸šåŠ¡ pod çš„çŠ¶æ€ï¼‰ã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl get pods -owide</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">nginx 1/1 Running 0 2m4s 192.168.0.100 edge-node &lt;none&gt;           &lt;none&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>æ‰§è¡Œå®Œæˆä¹‹åçš„ç»„ä»¶åˆ†å¸ƒå¦‚ä¸‹å›¾ æ‰€ç¤ºï¼Œå…¶ä¸­æ©™è‰²éƒ¨åˆ†æ˜¯ OpenYurt ç›¸å…³çš„ç»„ä»¶ï¼Œè“è‰²éƒ¨åˆ†æ˜¯åŸç”Ÿ K8s ç»„ä»¶ã€‚ç›¸åº”åœ°ï¼Œæˆ‘ä»¬è§‚å¯Ÿäº‘ç«¯èŠ‚ç‚¹å’Œè¾¹ç¼˜èŠ‚ç‚¹çš„ podã€‚</p><p><img alt="image" src="/assets/images/OpenYurt_Cluster-cf4d0928fd91e30dec6fc5ea7f13179b.png"></p><p>äº‘ç«¯èŠ‚ç‚¹ yurt ç›¸å…³çš„ podï¼šyurt-controller-manager å’Œ yurt-tunnel-serverã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl get pods --all-namespaces -owide | grep master | grep yurt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kube-system yurt-controller-manager-7d9db5bf85-6542h 1/1 Running 0 103s 183.195.233.42 master-node &lt;none&gt;           &lt;none&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kube-system   yurt-tunnel-server-65784dfdf-pl5bn         1/1     Running   0          103s    183.195.233.42   master-node   &lt;none&gt;           &lt;none&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¾¹ç¼˜èŠ‚ç‚¹æ–°å¢ yurt ç›¸å…³çš„ pod: yurt-hubï¼ˆstatic podï¼‰å’Œ yurt-tunnel-agentã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl get pods --all-namespaces -owide | grep edge | grep yurt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kube-system yurt-hub-edge-node 1/1 Running 0 117s 192.168.0.100 edge-node &lt;none&gt;           &lt;none&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kube-system   yurt-tunnel-agent-7l8nv                    1/1     Running   0          2m      192.168.0.100    edge-node     &lt;none&gt;           &lt;none&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="æµ‹è¯•-openyurt-é›†ç¾¤åœ¨è¾¹ç¼˜åœºæ™¯ä¸­çš„èƒ½åŠ›">æµ‹è¯• OpenYurt é›†ç¾¤åœ¨è¾¹ç¼˜åœºæ™¯ä¸­çš„èƒ½åŠ›<a aria-hidden="true" class="hash-link" href="#æµ‹è¯•-openyurt-é›†ç¾¤åœ¨è¾¹ç¼˜åœºæ™¯ä¸­çš„èƒ½åŠ›" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="1-æµ‹è¯•-logsexecport-forward-ç­‰è¿ç»´æŒ‡ä»¤æŸ¥çœ‹ç»“æœ">1. æµ‹è¯• logs/exec/port-forward ç­‰è¿ç»´æŒ‡ä»¤ï¼ŒæŸ¥çœ‹ç»“æœ<a aria-hidden="true" class="hash-link" href="#1-æµ‹è¯•-logsexecport-forward-ç­‰è¿ç»´æŒ‡ä»¤æŸ¥çœ‹ç»“æœ" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl logs nginx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 in /etc/nginx/conf.d/default.conf</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/docker-entrypoint.sh: Configuration complete; ready for start up</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl exec -it nginx sh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl exec [POD] -- [COMMAND] instead.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># ls</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">bin dev docker-entrypoint.sh home media opt root sbin sys usr</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">boot docker-entrypoint.d etc lib mnt proc run srv tmp var</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># exit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl port-forward pod/nginx 8888:80</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Forwarding from 127.0.0.1:8888 -&gt; 80</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Handling connection for 8888</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>æµ‹è¯• port-forward æ—¶ï¼Œåœ¨ master èŠ‚ç‚¹ä¸Šæ‰§è¡Œ curl 127.0.0.1:8888ï¼Œå¯ä»¥è®¿é—® nginx æœåŠ¡ã€‚</p><p>ä»æ¼”ç¤ºç»“æœçœ‹ï¼ŒOpenYurt èƒ½å¤Ÿå¾ˆå¥½åœ°æ”¯æŒå¸¸ç”¨çš„äº‘è¾¹è¿ç»´æŒ‡ä»¤ã€‚</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="2-æµ‹è¯•è¾¹ç¼˜æ–­ç½‘æ—¶å¯¹ä¸šåŠ¡çš„å½±å“">2. æµ‹è¯•è¾¹ç¼˜æ–­ç½‘æ—¶å¯¹ä¸šåŠ¡çš„å½±å“<a aria-hidden="true" class="hash-link" href="#2-æµ‹è¯•è¾¹ç¼˜æ–­ç½‘æ—¶å¯¹ä¸šåŠ¡çš„å½±å“" title="Direct link to heading">â€‹</a></h3><p>åŒæ ·æˆ‘ä»¬é‡å¤åŸç”Ÿ K8s ä¸­æ–­ç½‘çš„ä¸¤ä¸ªæµ‹è¯•ï¼Œåœ¨æµ‹è¯•ä¹‹å‰æˆ‘ä»¬å…ˆä¸ºè¾¹ç¼˜èŠ‚ç‚¹ edge-node å¼€å¯è‡ªæ²»ã€‚åœ¨ OpenYurt é›†ç¾¤ä¸­ï¼Œè¾¹ç¼˜èŠ‚ç‚¹çš„è‡ªæ²»æ˜¯é€šè¿‡ä¸€ä¸ª annotation æ¥æ ‡è¯†çš„ã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl annotate node edge-node node.beta.alibabacloud.com/autonomy=true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">node/edge-node annotated</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="1æ–­ç½‘-1-åˆ†é’Ÿ-ç½‘ç»œæ¢å¤">1ï¼‰æ–­ç½‘ 1 åˆ†é’Ÿ-&gt;ç½‘ç»œæ¢å¤<a aria-hidden="true" class="hash-link" href="#1æ–­ç½‘-1-åˆ†é’Ÿ-ç½‘ç»œæ¢å¤" title="Direct link to heading">â€‹</a></h4><p>åŒæ ·ï¼Œå°†è·¯ç”±å™¨å…¬ç½‘æ–­å¼€ï¼Œè§‚å¯Ÿ Node å’Œ Pod çš„çŠ¶æ€ã€‚å¤§çº¦è¿‡äº† 40sï¼ŒèŠ‚ç‚¹çš„çŠ¶æ€å˜æˆ NotReadyï¼Œè€Œå¤§çº¦è¿‡ 1min ä»¥åï¼ŒPod çš„çŠ¶æ€ä¸€ç›´æ˜¯ Runningï¼Œå¹¶ä¸ä¼šè¢«é©±é€ã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl get nodes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME STATUS ROLES AGE VERSION</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">edge-node NotReady &lt;none&gt;   24m   v1.16.6</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">master-node   Ready      master   25m   v1.16.6</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl get pods</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME    READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">nginx   1/1     Running   0          5m7s</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>æ¢å¤ç½‘ç»œï¼Œè§‚å¯Ÿ Node å’Œ Pod çš„çŠ¶æ€ï¼ŒNode çŠ¶æ€å˜ä¸º Readyï¼ŒPod ä¿æŒ Runningã€‚å¯è§äº‘è¾¹ç½‘ç»œä¸ç¨³å®šæ—¶ï¼Œå¯¹è¾¹ç¼˜èŠ‚ç‚¹çš„ä¸šåŠ¡ Pod æ— å½±å“ã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl get nodes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME STATUS ROLES AGE VERSION</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">edge-node Ready &lt;none&gt;   25m   v1.16.6</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">master-node   Ready    master   26m   v1.16.6</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl get pods</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME    READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">nginx   1/1     Running   0          6m30s</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="2æ–­ç½‘-1-åˆ†é’Ÿ-é‡å¯è¾¹ç¼˜èŠ‚ç‚¹-æ¢å¤ç½‘ç»œ">2ï¼‰æ–­ç½‘ 1 åˆ†é’Ÿ-&gt;é‡å¯è¾¹ç¼˜èŠ‚ç‚¹-&gt;æ¢å¤ç½‘ç»œ<a aria-hidden="true" class="hash-link" href="#2æ–­ç½‘-1-åˆ†é’Ÿ-é‡å¯è¾¹ç¼˜èŠ‚ç‚¹-æ¢å¤ç½‘ç»œ" title="Direct link to heading">â€‹</a></h4><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æµ‹è¯•åœ¨æ–­ç½‘çš„æƒ…å†µä¸‹ï¼Œè¾¹ç¼˜èŠ‚ç‚¹çš„é‡å¯å¯¹ä¸šåŠ¡çš„å½±å“ã€‚æ–­ç½‘ 1 åˆ†é’Ÿä¹‹åï¼ŒNode å’Œ Pod çŠ¶æ€åŒä¸Šé¢æµ‹è¯•ç»“æœï¼ŒNode å˜ä¸º NotReadyï¼ŒPod ä¿æŒ Runningã€‚åŒæ ·ï¼Œæˆ‘ä»¬ç™»å½•åˆ°æ ‘è“æ´¾ä¸Šï¼Œå°†æ ‘è“æ´¾é‡å¯ï¼Œè§‚å¯Ÿé‡å¯å‰åèŠ‚ç‚¹ä¸Šçš„å®¹å™¨åˆ—è¡¨ã€‚</p><p>é‡å¯å‰è¾¹ç¼˜èŠ‚ç‚¹å®¹å™¨åˆ—è¡¨ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@edge-node:~# docker ps</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">38727ec9270c 70bf6668c7eb &quot;yurthub --v=2 --serâ€¦&quot; 7 minutes ago Up 7 minutes k8s_yurt-hub_yurt-hub-edge-node_kube-system_d75d122e752b90d436a71af44c0a53be_0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">c403ace1d4ff registry.cn-hangzhou.aliyuncs.com/edge-kubernetes/pause:3.1 &quot;/pause&quot; 7 minutes ago Up 7 minutes k8s_POD_yurt-hub-edge-node_kube-system_d75d122e752b90d436a71af44c0a53be_0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">de0d693e9e74 473ae979be68 &quot;yurt-tunnel-agent -â€¦&quot; 7 minutes ago Up 7 minutes k8s_yurt-tunnel-agent_yurt-tunnel-agent-7l8nv_kube-system_75d28494-f577-43fa-9cac-6681a1215498_0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">a0763f143f74 registry.cn-hangzhou.aliyuncs.com/edge-kubernetes/pause:3.1 &quot;/pause&quot; 7 minutes ago Up 7 minutes k8s_POD_yurt-tunnel-agent-7l8nv_kube-system_75d28494-f577-43fa-9cac-6681a1215498_0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">80c247714402 e86f991e5d10 &quot;/docker-entrypoint.â€¦&quot; 7 minutes ago Up 7 minutes k8s_nginx_nginx_default_b45baaac-eebc-466b-9199-2ca5c1ede9fd_0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">01f7770cb0f7 registry.cn-hangzhou.aliyuncs.com/edge-kubernetes/pause:3.1 &quot;/pause&quot; 7 minutes ago Up 7 minutes k8s_POD_nginx_default_b45baaac-eebc-466b-9199-2ca5c1ede9fd_0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">7e65f83090f6 f9ea384ddb34 &quot;/usr/local/bin/kubeâ€¦&quot; 17 minutes ago Up 17 minutes k8s_kube-proxy_kube-proxy-rjws7_kube-system_51576be4-2b6d-434d-b50b-b88e2d436fef_1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">c1ed142fc75b registry.cn-hangzhou.aliyuncs.com/edge-kubernetes/pause:3.1 &quot;/pause&quot; 17 minutes ago Up 17 minutes k8s_POD_kube-proxy-rjws7_kube-system_51576be4-2b6d-434d-b50b-b88e2d436fef_1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>é‡å¯åè¾¹ç¼˜èŠ‚ç‚¹å®¹å™¨åˆ—è¡¨ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@edge-node:~# docker ps</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0c66b87066a0 473ae979be68 &quot;yurt-tunnel-agent -â€¦&quot; 12 seconds ago Up 11 seconds k8s_yurt-tunnel-agent_yurt-tunnel-agent-7l8nv_kube-system_75d28494-f577-43fa-9cac-6681a1215498_2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">a4fb3e4e8c8f e86f991e5d10 &quot;/docker-entrypoint.â€¦&quot; 58 seconds ago Up 56 seconds k8s_nginx_nginx_default_b45baaac-eebc-466b-9199-2ca5c1ede9fd_1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">fce730d64b32 f9ea384ddb34 &quot;/usr/local/bin/kubeâ€¦&quot; 58 seconds ago Up 57 seconds k8s_kube-proxy_kube-proxy-rjws7_kube-system_51576be4-2b6d-434d-b50b-b88e2d436fef_2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">c78166ea563f registry.cn-hangzhou.aliyuncs.com/edge-kubernetes/pause:3.1 &quot;/pause&quot; 59 seconds ago Up 57 seconds k8s_POD_yurt-tunnel-agent-7l8nv_kube-system_75d28494-f577-43fa-9cac-6681a1215498_1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">799ad14bcd3b registry.cn-hangzhou.aliyuncs.com/edge-kubernetes/pause:3.1 &quot;/pause&quot; 59 seconds ago Up 57 seconds k8s_POD_nginx_default_b45baaac-eebc-466b-9199-2ca5c1ede9fd_1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">627673da6a85 registry.cn-hangzhou.aliyuncs.com/edge-kubernetes/pause:3.1 &quot;/pause&quot; 59 seconds ago Up 58 seconds k8s_POD_kube-proxy-rjws7_kube-system_51576be4-2b6d-434d-b50b-b88e2d436fef_2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">04da705e4120 70bf6668c7eb &quot;yurthub --v=2 --serâ€¦&quot; About a minute ago Up About a minute k8s_yurt-hub_yurt-hub-edge-node_kube-system_d75d122e752b90d436a71af44c0a53be_1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">260057d935ee registry.cn-hangzhou.aliyuncs.com/edge-kubernetes/pause:3.1 &quot;/pause&quot; About a minute ago Up About a minute k8s_POD_yurt-hub-edge-node_kube-system_d75d122e752b90d436a71af44c0a53be_1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ä»é‡å¯å‰åçš„å¯¹æ¯”çœ‹ï¼Œè¾¹ç¼˜èŠ‚ç‚¹åœ¨æ–­ç½‘é‡å¯ä¹‹åï¼ŒèŠ‚ç‚¹ä¸Šçš„ pod èƒ½æ­£å¸¸æ‹‰èµ·ï¼ŒOpenYurt çš„èŠ‚ç‚¹è‡ªæ²»èƒ½åŠ›å¯ä»¥åœ¨æ–­ç½‘ä¸‹ä¿è¯ä¸šåŠ¡çš„ç¨³å®šè¿è¡Œã€‚</p><p>æ¢å¤ç½‘ç»œï¼ŒèŠ‚ç‚¹ Readyï¼Œè§‚å¯Ÿä¸šåŠ¡ pod çš„çŠ¶æ€ï¼Œç½‘ç»œæ¢å¤åï¼Œä¸šåŠ¡ pod çŠ¶æ€ä¿æŒ runningï¼Œæœ‰ä¸€æ¬¡é‡å¯è®°å½•ï¼Œç¬¦åˆé¢„æœŸã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl get pods -owide</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">nginx 1/1 Running 1 11m 192.168.0.100 edge-node &lt;none&gt;           &lt;none&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>æœ€åï¼Œæˆ‘ä»¬ä»yurtctlçš„èƒ½åŠ›å°†OpenYurté›†ç¾¤ï¼Œè½¬æ¢ä¸ºåŸç”ŸK8sé›†ç¾¤ã€‚åŒæ ·ï¼Œå¯ä»¥è§‚å¯Ÿè½¬æ¢è¿‡ç¨‹ä¸­å¯¹ç°æœ‰ä¸šåŠ¡ä¸ä¼šæœ‰å½±å“ã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">yurtctl revert --yurtctl-servant-image=registry.cn-hangzhou.aliyuncs.com/openyurt/yurtctl-servant:v0.2.1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>OpenYurt ä½œä¸ºé˜¿é‡Œé¦–ä¸ªè¾¹ç¼˜äº‘åŸç”Ÿå¼€æºé¡¹ç›®ï¼ŒåŸºäºå•†ä¸šåŒ–äº§å“ ACK@Edgeï¼Œåœ¨é›†å›¢å†…éƒ¨ç»å†äº†é•¿æ—¶é—´çš„æ‰“ç£¨ã€‚å·²ç»åº”ç”¨åœ¨ CDNã€IoTã€ç›’é©¬ã€ENSã€èœé¸Ÿç‰©æµç­‰ä¼—å¤šåœºæ™¯ã€‚é’ˆå¯¹è¾¹ç¼˜åœºæ™¯ï¼Œè¯¥é¡¹ç›®åšæŒä¿æŒåŸç”Ÿ K8s çš„ç‰¹æ€§ï¼Œä»¥ Addon çš„å½¢å¼æä¾›äº†è¾¹ç¼˜èŠ‚ç‚¹è‡ªæ²»ã€äº‘è¾¹ç«¯ä¸€ä½“åŒ–è¿ç»´é€šé“ç­‰èƒ½åŠ›ã€‚æœ€è¿‘åœ¨ç¤¾åŒºåŒå­¦çš„ä¸€èµ·åŠªåŠ›ä¸‹åˆå¼€æºäº†è¾¹ç¼˜å•å…ƒåŒ–ç®¡ç†èƒ½åŠ›ï¼ŒåŒæ—¶åç»­è¿˜ä¼šç»§ç»­å¼€æºæ›´å¤šçš„è¾¹ç¼˜ç®¡ç†èƒ½åŠ›ï¼Œæ¬¢è¿å¤§å®¶ç§¯æå‚ä¸è´¡çŒ®ã€‚</p><p><a href="https://mp.weixin.qq.com/s/Anr8UhTaNe3FCnKKfKoXNQ" target="_blank" rel="noopener noreferrer">åŸæ–‡é“¾æ¥</a></p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/blog/tags/openyurt">openyurt</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about Getting Started with OpenYurt:play with OpenYurt on Raspberry Pi" href="/blog/Play-with-OpenYurt-on-Raspberry-Pi"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_d4p0" itemprop="headline"><a itemprop="url" href="/blog/Introduce-of-OpenYurt">OpenYurt:edge computing cloud native project</a></h2><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2020-05-29T00:00:00.000Z" itemprop="datePublished">May 29, 2020</time> Â· <!-- -->9 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://github.com/Fei-Guo" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://github.com/Fei-Guo.png" alt="Fei Guo"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/Fei-Guo" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Fei Guo</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of OpenYurt</small></div></div></div><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://github.com/huangyuqi" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://github.com/huangyuqi.png" alt="frank-huangyuqi"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/huangyuqi" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">frank-huangyuqi</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of OpenYurt</small></div></div></div><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://github.com/rambohe-ch" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://github.com/rambohe-ch.png" alt="rambohe"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/rambohe-ch" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">rambohe</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of OpenYurt</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><img alt="image" src="/assets/images/OpenYurt-de0f93f0c16ddb05b6782cbe66107b22.png"></p><p>å¯¼è¯»ï¼šåŒ—äº¬æ—¶é—´ 5 æœˆ 29 æ—¥ï¼Œåœ¨é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡ ACK@Edgeï¼ˆè¾¹ç¼˜é›†ç¾¤æ‰˜ç®¡æœåŠ¡ï¼‰ ä¸Šçº¿ä¸€å‘¨å¹´ä¹‹é™…ï¼Œé˜¿é‡Œå·´å·´æ­£å¼å®£å¸ƒå°†å…¶æ ¸å¿ƒèƒ½åŠ›å¼€æºï¼Œå¹¶å‘ç¤¾åŒºè´¡çŒ®å®Œæ•´çš„è¾¹ç¼˜è®¡ç®—äº‘åŸç”Ÿé¡¹ç›® -- OpenYurtã€‚</p><p>è¾¹ç¼˜äº‘è®¡ç®—æ˜¯åŸºäºäº‘è®¡ç®—æŠ€æœ¯çš„æ ¸å¿ƒå’Œè¾¹ç¼˜è®¡ç®—çš„èƒ½åŠ›ï¼Œæ„ç­‘åœ¨è¾¹ç¼˜åŸºç¡€è®¾æ–½ä¹‹ä¸Šçš„æ–°å‹è®¡ç®—å¹³å°ï¼Œå¹¶æ­£åœ¨æˆä¸ºè¡Œä¸šçš„æ–°ç„¦ç‚¹ã€‚OpenYurt ä½œä¸ºé˜¿é‡Œå·´å·´é¦–ä¸ªè¾¹ç¼˜è®¡ç®—äº‘åŸç”Ÿå¼€æºé¡¹ç›®ï¼Œæ±‡èšäº†é˜¿é‡Œå·´å·´ä¼—å¤šè¾¹ç¼˜è®¡ç®—ä¸šåŠ¡å›¢é˜Ÿçš„æ·±åšæŠ€æœ¯ç§¯ç´¯ï¼Œæ·±åº¦æŒ–æ˜äº†è¾¹ç¼˜è®¡ç®— + äº‘åŸç”Ÿè½åœ°å®æ–½è¯‰æ±‚ã€‚</p><p>ä¸¤å¹´å‰ï¼ŒOpenYurt ä½œä¸ºå…¬å…±äº‘æœåŠ¡ ACK@Edge çš„æ ¸å¿ƒæ¡†æ¶ï¼Œå°±å·²ç»åº”ç”¨äº CDNã€éŸ³è§†é¢‘ç›´æ’­ã€ç‰©è”ç½‘ã€ç‰©æµã€å·¥ä¸šå¤§è„‘ã€åŸå¸‚å¤§è„‘ç­‰å®é™…åº”ç”¨åœºæ™¯ä¸­ï¼Œå¹¶æœåŠ¡äºé˜¿é‡Œäº‘ LinkEdgeã€ç›’é©¬ã€ä¼˜é…·ã€è§†é¢‘äº‘ï¼ˆè§†é¢‘ç‚¹æ’­ã€è§†é¢‘ç›´æ’­ã€å®æ—¶é€šä¿¡ã€è§†é¢‘ç›‘æ§ã€æ™ºèƒ½è§†è§‰ï¼‰ç­‰å¤šä¸ªä¸šåŠ¡æˆ–é¡¹ç›®ä¸­ã€‚</p><p>é˜¿é‡Œå·´å·´äº‘åŸç”Ÿå¼€æºè´Ÿè´£äººã€äº‘åŸç”Ÿåº”ç”¨å¹³å°èµ„æ·±æŠ€æœ¯ä¸“å®¶æå“è¡¨ç¤ºï¼šâ€œéšç€è¾¹ç¼˜è®¡ç®—çš„åœºæ™¯å’Œéœ€æ±‚ä¸æ–­å¢åŠ ï¼Œâ€˜äº‘è¾¹ååŒâ€™ã€â€˜è¾¹ç¼˜äº‘åŸç”Ÿâ€™æ­£åœ¨é€æ¸æˆä¸ºæ–°çš„æŠ€æœ¯ç„¦ç‚¹ã€‚OpenYurt å¼€æºé¡¹ç›®å®è·µâ€˜äº‘è¾¹ä¸€ä½“åŒ–â€™æ¦‚å¿µï¼Œä¾æ‰˜åŸç”Ÿ Kubernetes å¼ºå¤§çš„å®¹å™¨ç¼–æ’ã€è°ƒåº¦èƒ½åŠ›ï¼Œå®ç°å®Œå…¨è¾¹ç¼˜è®¡ç®—äº‘åŸç”ŸåŸºç¡€è®¾æ–½æ¶æ„ï¼Œå¸®åŠ©å¼€å‘è€…è½»æ¾å®Œæˆåœ¨æµ·é‡è¾¹ã€ç«¯èµ„æºä¸Šçš„å¤§è§„æ¨¡åº”ç”¨çš„äº¤ä»˜ã€è¿ç»´ã€ç®¡æ§ã€‚æˆ‘ä»¬å¸Œæœ› OpenYurt å¼€æºèƒ½æ¨åŠ¨ç¤¾åŒºåœ¨äº‘åŸç”Ÿå’Œè¾¹ç¼˜è®¡ç®—äº¤å‰é¢†åŸŸçš„ååŒå‘å±•ã€‚â€</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="ä»€ä¹ˆæ˜¯openyurt">ä»€ä¹ˆæ˜¯OpenYurt<a aria-hidden="true" class="hash-link" href="#ä»€ä¹ˆæ˜¯openyurt" title="Direct link to heading">â€‹</a></h2><p><img alt="image" src="/assets/images/OpenYurt-01-b706847ee60a69ed405be1564734ed6e.png"></p><p>ä½¿ç”¨ OpenYurtï¼ˆYurtï¼Œ/jÉœËrt/ï¼Œè’™å¤åŒ…ï¼‰ä½œä¸ºæœ¬æ¬¡å¼€æºé¡¹ç›®åç§°ï¼ŒæœŸæœ›ä»¥å…¶â€œå½¢â€æ¥è¡¨ç¤ºè¾¹ç¼˜è®¡ç®—ä¾§é‡äºåˆ›å»ºä¸€ä¸ªé›†ä¸­ç®¡ç†ä½†ç‰©ç†åˆ†å¸ƒçš„åŸºç¡€è®¾æ–½ï¼Œå¹¶æ”¯æŒè‡ªåŠ¨/è‡ªæ²»è¿è¡Œæ“ä½œçš„å«ä¹‰ã€‚</p><p>OpenYurt ä¸»æ‰“â€œäº‘è¾¹ä¸€ä½“åŒ–â€æ¦‚å¿µï¼Œä¾æ‰˜åŸç”Ÿ Kubernetes å¼ºå¤§çš„å®¹å™¨ç¼–æ’ã€è°ƒåº¦èƒ½åŠ›ï¼Œé€šè¿‡ä¼—å¤šè¾¹ç¼˜è®¡ç®—åº”ç”¨åœºæ™¯é”¤ç‚¼ï¼Œå®ç°äº†ä¸€æ•´å¥—å¯¹åŸç”Ÿ Kubernetesâ€œé›¶â€ä¾µå…¥çš„è¾¹ç¼˜äº‘åŸç”Ÿæ–¹æ¡ˆï¼Œæä¾›è¯¸å¦‚è¾¹ç¼˜è‡ªæ²»ã€é«˜æ•ˆè¿ç»´é€šé“ã€è¾¹ç¼˜å•å…ƒåŒ–ç®¡ç†ã€è¾¹ç¼˜æµé‡æ‹“æ‰‘ç®¡ç†ï¼Œå®‰å…¨å®¹å™¨ã€è¾¹ç¼˜ Serverless/FaaSã€å¼‚æ„èµ„æºæ”¯æŒç­‰èƒ½åŠ›ã€‚OpenYurt èƒ½å¸®ç”¨æˆ·è§£å†³åœ¨æµ·é‡è¾¹ã€ç«¯èµ„æºä¸Šå®Œæˆå¤§è§„æ¨¡åº”ç”¨äº¤ä»˜ã€è¿ç»´ã€ç®¡æ§çš„é—®é¢˜ï¼Œå¹¶æä¾›ä¸­å¿ƒæœåŠ¡ä¸‹æ²‰é€šé“ï¼Œå®ç°å’Œè¾¹ç¼˜è®¡ç®—åº”ç”¨çš„æ— ç¼å¯¹æ¥ã€‚</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="1openyurtè¯ç”ŸèƒŒæ™¯">1ï¼‰OpenYurtè¯ç”ŸèƒŒæ™¯<a aria-hidden="true" class="hash-link" href="#1openyurtè¯ç”ŸèƒŒæ™¯" title="Direct link to heading">â€‹</a></h3><p><img alt="image" src="/assets/images/OpenYurt-02-f917b1d6fc1c832f325baa2a27be7ed3.png">
ä» 2017 å¹´åº•å¼€å§‹ï¼Œé˜¿é‡Œäº‘ç‰©è”ç½‘ï¼ˆIoTï¼‰å’Œ CDN (å†…å®¹åˆ†å‘ç½‘ç»œ)æœåŠ¡ä½œä¸ºå…¸å‹çš„è¾¹ç¼˜è®¡ç®—ä¸šåŠ¡æ­£é¢ä¸´ç€äº§å“è§„æ¨¡çš„çˆ†å‘å¼å¢é•¿ã€è¿ç»´å¤æ‚åº¦æ€¥å‰§æ”€å‡ã€è¿ç»´æ•ˆç‡ä¸é«˜çš„â€œä¸‰éš¾â€å¢ƒåœ°ï¼Œå› æ­¤å¼•å…¥äº‘åŸç”Ÿç†å¿µã€å…¨é¢è½¬å‹è¾¹ç¼˜åº”ç”¨çš„è¿ç»´ç®¡ç†æ¨¡å¼æˆä¸ºäºŸéœ€è§£å†³çš„é—®é¢˜ã€‚</p><p>æ­£æ˜¯åœ¨è¿™æ ·çš„èƒŒæ™¯ä¸‹ï¼ŒOpenYurt è¯ç”Ÿäºé˜¿é‡Œäº‘å®¹å™¨æœåŠ¡å›¢é˜Ÿï¼Œå¹¶åœ¨æ¥ä¸‹æ¥çš„ä¸¤å¹´å¤šæ—¶é—´å†…ï¼Œä½œä¸ºå…¬å…±äº‘æœåŠ¡ ACK@Edge çš„æ ¸å¿ƒæ¡†æ¶è¢«å¹¿æ³›åº”ç”¨äº CDNã€éŸ³è§†é¢‘ç›´æ’­ã€ç‰©è”ç½‘ã€ç‰©æµã€å·¥ä¸šå¤§è„‘ã€åŸå¸‚å¤§è„‘ç­‰å®é™…åº”ç”¨åœºæ™¯ä¸­ï¼Œå¹¶æ­£åœ¨æœåŠ¡äºé˜¿é‡Œäº‘ LinkEdgeã€ç›’é©¬ã€ä¼˜é…·ã€è§†é¢‘äº‘ï¼ˆè§†é¢‘ç‚¹æ’­ï¼Œè§†é¢‘ç›´æ’­ï¼Œå®æ—¶é€šä¿¡ï¼Œè§†é¢‘ç›‘æ§ï¼Œæ™ºèƒ½è§†è§‰ï¼‰ç­‰å¤šä¸ªä¸šåŠ¡æˆ–é¡¹ç›®ä¸­ã€‚</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="2openyurtæŠ€æœ¯ç‰¹ç‚¹">2ï¼‰OpenYurtæŠ€æœ¯ç‰¹ç‚¹<a aria-hidden="true" class="hash-link" href="#2openyurtæŠ€æœ¯ç‰¹ç‚¹" title="Direct link to heading">â€‹</a></h3><p>OpenYurtæ²¿ç”¨äº†ç›®å‰ä¸šç•Œæµè¡Œçš„â€œä¸­å¿ƒç®¡æ§ã€è¾¹ç¼˜è‡ªæ²»â€çš„è¾¹ç¼˜åº”ç”¨ç®¡ç†æ¶æ„ï¼Œå°†â€œäº‘è¾¹ç«¯ä¸€ä½“åŒ–ååŒâ€ä½œä¸ºç›®æ ‡ï¼Œèµ‹èƒ½äº‘åŸç”Ÿèƒ½åŠ›å‘è¾¹ç¼˜ç«¯æ‹“å±•ã€‚åœ¨æŠ€æœ¯å®ç°ä¸Šï¼ŒOpenYurtè´¯å½»äº†â€œExtending your native Kubernetes to Edgeâ€çš„æ ¸å¿ƒè®¾è®¡ç†å¿µï¼Œå…¶æŠ€æœ¯æ–¹æ¡ˆæœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>å¯¹åŸç”ŸKubernetesâ€œé›¶â€ä¾µå…¥ï¼Œä¿è¯å¯¹åŸç”Ÿk8s APIçš„å®Œå…¨å…¼å®¹ã€‚</li></ul><p>OpenYurté€šè¿‡proxy node network trafficï¼Œå¯¹ Kubernetes èŠ‚ç‚¹åº”ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç†åŠ äº†ä¸€å±‚æ–°çš„å°è£…ï¼Œæä¾›è¾¹ç¼˜è®¡ç®—æ‰€éœ€è¦çš„æ ¸å¿ƒç®¡æ§èƒ½åŠ›ï¼›</p><ul><li><p>æ— ç¼è½¬æ¢ï¼ŒOpenYurtæä¾›äº†å·¥å…·å°†åŸç”ŸKubernetesâ€œä¸€é”®å¼â€è½¬æ¢æˆæ”¯æŒè¾¹ç¼˜è®¡ç®—èƒ½åŠ›çš„ Kubernetes é›†ç¾¤ï¼›</p></li><li><p>ä½Overheadï¼ŒOpenYurtå‚è€ƒäº†å¤§é‡è¾¹ç¼˜è®¡ç®—åœºæ™¯çš„å®é™…éœ€æ±‚ï¼Œåœ¨ä¿è¯åŠŸèƒ½å’Œå¯é æ€§çš„åŸºç¡€ä¸Šï¼Œæœ¬ç€æœ€å°åŒ–ï¼Œæœ€ç®€åŒ–çš„è®¾è®¡ç†å¿µï¼Œä¸¥æ ¼é™åˆ¶æ–°å¢ç»„ä»¶çš„èµ„æºè¯‰æ±‚ã€‚  </p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="3openyurtæ ¸å¿ƒèƒ½åŠ›">3ï¼‰OpenYurtæ ¸å¿ƒèƒ½åŠ›<a aria-hidden="true" class="hash-link" href="#3openyurtæ ¸å¿ƒèƒ½åŠ›" title="Direct link to heading">â€‹</a></h3><p><img alt="image" src="/assets/images/OpenYurt_arch-a3dcd2a758bb9c978f52c8a61c6a98f6.png"></p><ul><li>è¾¹ç¼˜è‡ªæ²»èƒ½åŠ›ï¼š </li></ul><p>YurtHubä½œä¸ºèŠ‚ç‚¹ä¸Šçš„ä¸´æ—¶é…ç½®ä¸­å¿ƒï¼Œåœ¨ç½‘ç»œè¿æ¥ä¸­æ–­çš„æƒ…å†µä¸‹ï¼ŒæŒç»­ä¸ºèŠ‚ç‚¹ä¸Šæ‰€æœ‰è®¾å¤‡å’Œå®¢æˆ·ä¸šåŠ¡æä¾›æ•°æ®é…ç½®æœåŠ¡ã€‚YurtHub æä¾›äº†å¯¹å¤§é‡åŸç”Ÿ Kubernetes APIçš„æ”¯æŒï¼Œå¯ä»¥åœ¨èŠ‚ç‚¹å’Œè¾¹ç¼˜å•å…ƒç»´åº¦æä¾›â€œShadowApiserverâ€çš„èƒ½åŠ›ï¼Œåœ¨è¾¹ç¼˜è®¡ç®—å¼±ç½‘ç»œé“¾æ¥åœºæ™¯çš„ä»·å€¼å°¤ä¸ºçªå‡ºï¼›</p><ul><li>è¾¹ç¼˜è¿ç»´é€šé“</li></ul><p>åœ¨è¾¹ç¼˜åœºæ™¯ï¼Œç”±äºå¤§å¤šæ•°è¾¹ç¼˜èŠ‚ç‚¹æ²¡æœ‰æš´éœ²åœ¨å…¬ç½‘ä¹‹ä¸Šï¼Œä¸­å¿ƒç®¡æ§æ— ç¼å’Œè¾¹ç¼˜èŠ‚ç‚¹ä¸»åŠ¨å»ºç«‹ç½‘ç»œé“¾æ¥ï¼Œæ‰€æœ‰çš„KubernetesåŸç”Ÿåº”ç”¨è¿ç»´APIsï¼ˆlogs/exec/metricsï¼‰ä¼šå¤±å»æ•ˆåŠ›ï¼›
YurtTunnel é€šè¿‡åœ¨ç®¡æ§ä¸è¾¹ç¼˜èŠ‚ç‚¹ä¹‹é—´å»ºç«‹åå‘é€šé“ï¼Œå¹¶å’ŒèŠ‚ç‚¹çš„ç”Ÿå‘½å‘¨æœŸå®Œæ•´è”åŠ¨ï¼Œæ‰¿è½½åŸç”Ÿè¿ç»´ APIs çš„æµé‡ï¼›</p><ul><li>é›†ç¾¤è½¬æ¢èƒ½åŠ›
Yurtctlä½œä¸ºOpenYurtå®˜æ–¹å‘½ä»¤è¡Œå·¥å…·ï¼Œæä¾›åŸç”ŸKubernetesé›†ç¾¤æ”¯æŒè¾¹ç¼˜è®¡ç®—infrastructureçš„ä¸€é”®å¼åˆ‡æ¢ã€‚</li></ul><p>å…¶ä»–æ›´é«˜çº§çš„åŠŸèƒ½æ¯”å¦‚è¾¹ç¼˜æµé‡ç®¡ç†ã€å•å…ƒåŒ–ç®¡ç†ï¼Œéƒ¨ç½²ã€åŒºåŸŸè‡ªæ²»ç­‰å°†ä¼šé€æ­¥å¼€æºã€‚</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="4openyurt-roadmap">4ï¼‰OpenYurt Roadmap<a aria-hidden="true" class="hash-link" href="#4openyurt-roadmap" title="Direct link to heading">â€‹</a></h3><p>ä½œä¸ºé˜¿é‡Œäº‘å®¹å™¨æœåŠ¡ ACK@Edge çš„å¼€æºç‰ˆæœ¬ï¼ŒOpenYurt å°†é‡‡ç”¨å…¨å¼€æºç¤¾åŒºå¼€å‘æ¨¡å¼ï¼Œæ¯å­£åº¦å‘å¸ƒæ–°ç‰ˆæœ¬æ›´æ–°ï¼ŒåŒ…å«ç¤¾åŒºä¸Šæ¸¸å®‰å…¨/å…³é”® bug ä¿®å¤å’Œæ–°ç‰¹æ€§ã€æ–°èƒ½åŠ›ï¼Œå¹¶é€æ­¥å°†äº§å“å®Œæ•´èƒ½åŠ›å¼€æºã€‚</p><p>ä¸»å¯¼è¿™æ¬¡å¼€æºçš„é˜¿é‡Œå·´å·´äº‘åŸç”Ÿåº”ç”¨å¹³å°å›¢é˜Ÿï¼Œç›®å‰å·²ç»å¼€æº OAMã€OpenKruiseã€Dragonflyã€Apache RocketMQã€Apache Dubbo ç­‰ä¼—å¤šæ˜æ˜Ÿé¡¹ç›®ï¼Œæ˜¯å›½å†…æœ€èµ„æ·±çš„äº‘åŸç”Ÿå¼€æºè´¡çŒ®å›¢é˜Ÿã€‚OpenYurt é¡¹ç›®çš„å¼€æºï¼Œæœ¬ç€â€œExtending your native Kubernetes to Edgeâ€çš„è®¾è®¡ç†å¿µï¼Œè®©äº‘åŸç”ŸæŠ€æœ¯åœ¨è¾¹ç¼˜è®¡ç®—é¢†åŸŸçš„ç”Ÿæ€å»ºè®¾ä¸æ™®åŠå‰è¿›äº†ä¸€å¤§æ­¥ï¼Œä¹Ÿä¸ºå…¨çƒå¼€å‘è€…æ‹“å±•äº‘åŸç”Ÿè¾¹ç•Œè´¡çŒ®äº†ä¸€ä»½åŠ›é‡ã€‚</p><p><a href="https://mp.weixin.qq.com/s/0LwCE4CpVdttmvx4FAMArg" target="_blank" rel="noopener noreferrer">åŸæ–‡é“¾æ¥</a></p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/blog/tags/openyurt">openyurt</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about OpenYurt:edge computing cloud native project" href="/blog/Introduce-of-OpenYurt"><b>Read More</b></a></div></footer></article></main></div></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/installation/yurtcluster">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://join.slack.com/t/openyurt/shared_invite/zt-rc5ecz4h-sEWU1vYx5gzc3_zx3En0jg" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>CNCF Slack ( #openyurt channel )<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a class="footer__link-item" href="/blog/tags/">DingTalk (31993519)</a></li><li class="footer__item"><a href="https://shimo.im/docs/rGK3cXYWYkPrvWp8" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Bi-week Meeting (APAC, Chinese)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/openyurtio/openyurt" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/openyurtio/community/blob/main/community-membership.md" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Community Membership<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
        <br>
        <strong>Copyright Â© 2022 The OpenYurt Authors. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage/"> Trademark Usage</a> page.</strong></div></div></div></footer></div>
<script src="/assets/js/runtime~main.34caa5e1.js"></script>
<script src="/assets/js/main.c87394d4.js"></script>
</body>
</html>