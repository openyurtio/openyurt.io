<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="OpenYurt RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="OpenYurt Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="OpenYurt" href="/opensearch.xml">
<link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
<link rel="shortcut icon" type="image/x-icon" href="/favicons/favicon.ico">
<link rel="manifest" href="/favicons/site.webmanifest">
<link rel="mask-icon" color="#ffffff" href="/favicons/safari-pinned-tab.svg">
<meta name="theme-color" content="#ffffff">
<meta name="msapplication-config" content="/favicons/browserconfig.xml"><title data-react-helmet="true">How to build Kubernetes Native Cloud side efficient collaborative network | OpenYurt</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://openyurt.io/blog/Build-side-efficient-collaborative-network"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="How to build Kubernetes Native Cloud side efficient collaborative network | OpenYurt"><meta data-react-helmet="true" name="description" content="å¯¼è¯»ï¼šOpenYurtæ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„äº‘è¾¹ååŒä¸€ä½“åŒ–æ¶æ„ï¼Œä¸åŒç±»å¼€æºæ–¹æ¡ˆç›¸æ¯”ï¼ŒOpenYurtæ‹¥æœ‰å¯å®ç°è¾¹ç¼˜è®¡ç®—å…¨åœºæ™¯è¦†ç›–çš„èƒ½åŠ›ã€‚"><meta data-react-helmet="true" property="og:description" content="å¯¼è¯»ï¼šOpenYurtæ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„äº‘è¾¹ååŒä¸€ä½“åŒ–æ¶æ„ï¼Œä¸åŒç±»å¼€æºæ–¹æ¡ˆç›¸æ¯”ï¼ŒOpenYurtæ‹¥æœ‰å¯å®ç°è¾¹ç¼˜è®¡ç®—å…¨åœºæ™¯è¦†ç›–çš„èƒ½åŠ›ã€‚"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2020-11-06T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://github.com/charleszheng44"><meta data-react-helmet="true" property="article:tag" content="yurttunnel"><link data-react-helmet="true" rel="shortcut icon" href="/img/openyurt.ico"><link data-react-helmet="true" rel="canonical" href="https://openyurt.io/blog/Build-side-efficient-collaborative-network"><link data-react-helmet="true" rel="alternate" href="https://openyurt.io/blog/Build-side-efficient-collaborative-network" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://openyurt.io/zh/blog/Build-side-efficient-collaborative-network" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://openyurt.io/blog/Build-side-efficient-collaborative-network" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.8a5667f5.css">
<link rel="preload" href="/assets/js/runtime~main.4de9919c.js" as="script">
<link rel="preload" href="/assets/js/main.0634d431.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><div class="announcementBar_axC9" role="banner"><div class="announcementBarPlaceholder_xYHE"></div><div class="announcementBarContent_6uhP">â­ï¸ If you like OpenYurt, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/openyurtio/openyurt">GitHub</a>! â­ï¸</div><button type="button" class="clean-btn close announcementBarClose_A3A1" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/openyurt.ico" alt="OpenYurt" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/openyurt.ico" alt="OpenYurt" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">OpenYurt</b></a><a class="navbar__item navbar__link" href="/docs/">Documentation</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a href="http://47.243.253.79/login" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Experience-Center<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/docs/">v0.7.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/">Next</a></li><li><a class="dropdown__link" href="/docs/">v0.7.0</a></li><li><a class="dropdown__link" href="/docs/v0.6.0/">v0.6.0</a></li><li><a class="dropdown__link" href="/docs/v0.5.0/">v0.5.0</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_EbrZ"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/blog/Build-side-efficient-collaborative-network" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">English</a></li><li><a href="/zh/blog/Build-side-efficient-collaborative-network" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">ç®€ä½“ä¸­æ–‡</a></li></ul></div><a href="https://github.com/openyurtio/openyurt" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ğŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ğŸŒ</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_NKBi"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_q+wC thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_9G5K margin-bottom--md">All posts</div><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/Enable-MetalLB-in-OpenYurt">Edge LoadBalancer service support based on MetalLB</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/How-to-use-yurtctl-convert-revert">Seamless conversion between Kubernetes and OpenYurt</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/How-to-use-service-topology">Use service topology to realize topology-aware traffic routing</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/How-run-business-pod-in-edge-scenarios">How Openyurt runs the business pod in edge scenarios</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/Edge-gateway-caching-capabilities">Elegant realization of edge gateway caching capabilities</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/Play-with-OpenYurt-on-Raspberry-Pi">Getting Started with OpenYurt:play with OpenYurt on Raspberry Pi</a></li><li class="sidebarItem_cjdF"><a aria-current="page" class="sidebarItemLink_zyXk sidebarItemLinkActive_wcJs" href="/blog/Build-side-efficient-collaborative-network">How to build Kubernetes Native Cloud side efficient collaborative network</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/Expansion-capability-of-Yurthub">Viewing Expansion Ability of YurtHub from Edge Autonomy</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/YurtHub-design-detail">YurtHub Design Detail:edge autonomy of OpenYurt</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/Use-of-yurtctl">Yurtctl:make the native k8s cluster achieve edge computing capabilities</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/Introduce-of-OpenYurt">OpenYurt:edge computing cloud native project</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_d4p0" itemprop="headline">How to build Kubernetes Native Cloud side efficient collaborative network</h1><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2020-11-06T00:00:00.000Z" itemprop="datePublished">November 6, 2020</time> Â· <!-- -->21 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://github.com/charleszheng44" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://github.com/charleszheng44.png" alt="Chao Zheng"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/charleszheng44" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Chao Zheng</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of OpenYurt</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>å¯¼è¯»ï¼šOpenYurtæ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„äº‘è¾¹ååŒä¸€ä½“åŒ–æ¶æ„ï¼Œä¸åŒç±»å¼€æºæ–¹æ¡ˆç›¸æ¯”ï¼ŒOpenYurtæ‹¥æœ‰å¯å®ç°è¾¹ç¼˜è®¡ç®—å…¨åœºæ™¯è¦†ç›–çš„èƒ½åŠ›ã€‚</p><ul><li>OpenYurtæ˜¯å¦‚ä½•åœ¨å¼±ç½‘å’Œæ–­ç½‘ç¯å¢ƒä¸‹å®ç°è¾¹ç¼˜è‡ªæ²»çš„â€”â€”<a href="/blog/Edge-gateway-caching-capabilities">YurtHub</a></li><li>OpenYurtå¦ä¸€ä¸ªæ ¸å¿ƒèƒ½åŠ›â€”â€”äº‘è¾¹é€šä¿¡ï¼Œä»¥åŠç›¸å…³ç»„ä»¶Yurttunnel</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="yurttunnelä½¿ç”¨åœºæ™¯">Yurttunnelä½¿ç”¨åœºæ™¯<a aria-hidden="true" class="hash-link" href="#yurttunnelä½¿ç”¨åœºæ™¯" title="Direct link to heading">â€‹</a></h2><p>åœ¨åº”ç”¨çš„éƒ¨ç½²å’Œè¿ç»´è¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·å¸¸å¸¸éœ€è¦è·å–åº”ç”¨çš„æ—¥å¿—ï¼Œæˆ–ç›´æ¥ç™»å½•åˆ°åº”ç”¨çš„è¿è¡Œç¯å¢ƒä¸­è¿›è¡Œè°ƒè¯•ã€‚åœ¨ Kubernetes ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨ kubectl logï¼Œkubectl exec ç­‰æŒ‡ä»¤æ¥å®ç°è¿™äº›éœ€æ±‚ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨ kubectl è¯·æ±‚é“¾è·¯ä¸Šï¼Œ kubelet å°†æ‰®æ¼”æœåŠ¡å™¨ç«¯ï¼Œè´Ÿè´£å¤„ç†ç”± kube-apiserver(KAS) è½¬å‘æ¥çš„è¯·æ±‚ï¼Œè¿™å°±è¦æ±‚ KAS å’Œ kubelet ä¹‹é—´éœ€è¦å­˜åœ¨ä¸€æ¡ç½‘ç»œé€šè·¯ï¼Œå…è®¸ KAS ä¸»åŠ¨è®¿é—® kubeletã€‚
<img alt="image" src="/assets/images/kubectl-a986c3e8d3b680dd93899fce88a92821.png">
ç„¶è€Œï¼Œåœ¨è¾¹ç¼˜è®¡ç®—åœºæ™¯ä¸­ï¼Œè¾¹ç¼˜èŠ‚ç‚¹å¸¸ä½äºæœ¬åœ°ä¸“æœ‰ç½‘ç»œä¸­ï¼Œè¿™è™½ç„¶ä¿è¯äº†è¾¹ç¼˜èŠ‚ç‚¹çš„å®‰å…¨ï¼Œä½†ä¹Ÿé€ æˆä½äºäº‘ç«¯ç®¡æ§èŠ‚ç‚¹çš„KASæ— æ³•ç›´æ¥è®¿é—®ä½äºè¾¹ç¼˜èŠ‚ç‚¹çš„kubeletã€‚å› æ­¤ï¼Œä¸ºäº†æ”¯æŒé€šè¿‡äº‘ç«¯èŠ‚ç‚¹å¯¹è¾¹ç¼˜ç«¯åº”ç”¨è¿›è¡Œè¿ç»´æ“ä½œï¼Œæˆ‘ä»¬å¿…é¡»åœ¨äº‘ã€è¾¹ä¹‹é—´å»ºç«‹åå‘è¿ç»´é€šé“ã€‚</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="åå‘é€šé“">åå‘é€šé“<a aria-hidden="true" class="hash-link" href="#åå‘é€šé“" title="Direct link to heading">â€‹</a></h2><p>Yurttunnelæ˜¯OpenYurtè¿‘æœŸå¼€æºçš„ä¸€ä¸ªé‡è¦ç»„ä»¶ï¼Œç”¨æ¥è§£å†³äº‘è¾¹é€šä¿¡é—®é¢˜ã€‚åå‘é€šé“æ˜¯è§£å†³è·¨ç½‘ç»œé€šä¿¡çš„ä¸€ç§å¸¸è§æ–¹å¼ï¼Œè€Œ Yurttunnel çš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ªåå‘é€šé“ã€‚ä¸€ä¸ªè¾¹ç¼˜é›†ç¾¤ä¸‹å±çš„èŠ‚ç‚¹å¸¸ä½äºä¸åŒçš„ network region ä¸­ï¼Œè€Œä½äºåŒä¸€ä¸ª region å†…çš„èŠ‚ç‚¹ä¹‹é—´æ˜¯å¯ä»¥ç›¸äº’é€šä¿¡çš„ï¼Œå› æ­¤åœ¨è®¾ç½®åå‘é€šé“æ—¶ï¼Œæˆ‘ä»¬åªéœ€ä¿è¯åœ¨æ¯ä¸ª region å†…è®¾ç½®ä¸€ä¸ªä¸ proxy server ç›¸è¿çš„ agent å³å¯ã€‚å…·ä½“åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ul><li><p>åœ¨ç®¡æ§ç»„ä»¶æ‰€åœ¨ç½‘ç»œå†…ï¼Œéƒ¨ç½² proxy serverã€‚</p></li><li><p>proxy server å¯¹å¤–å¼€æ”¾ä¸€ä¸ªå…¬ç½‘å¯ä»¥è®¿é—®çš„ IPã€‚</p></li><li><p>åœ¨æ¯ä¸ª region éƒ¨ç½²ä¸ª agentï¼Œå¹¶é€šè¿‡ server çš„å…¬ç½‘ IP ä¸ server å»ºç«‹é•¿è¿æ¥ã€‚</p></li><li><p>ç®¡æ§ç»„ä»¶å¯¹è¾¹ç¼˜èŠ‚ç‚¹çš„è®¿é—®è¯·æ±‚éƒ½å°†è½¬å‘è‡´ proxy serverã€‚</p></li><li><p>proxy server å†å°†è¯·æ±‚é€šè¿‡å¯¹åº”çš„é•¿è¿æ¥å‘å¾€ç›®æ ‡èŠ‚ç‚¹ã€‚</p></li></ul><p><img alt="image" src="/assets/images/proxy_server_agent-58a080cbcdc31c0c7b82a500d94f9849.png">
åœ¨ Yurttunnel ä¸­ï¼Œæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨ä¸Šæ¸¸<a href="https://github.com/kubernetes-sigs/apiserver-network-proxy" target="_blank" rel="noopener noreferrer">é¡¹ç›®apiserver-network-proxy(ANP)</a> æ¥å®ç°server å’Œ agent é—´çš„é€šä¿¡ã€‚ANP æ˜¯åŸºäº kubernetes 1.16 Alpha æ–°åŠŸèƒ½<a href="https://github.com/kubernetes/kubernetes/blob/master/staging/src/k8s.io/apiserver/pkg/server/egressselector/egress_selector.go" target="_blank" rel="noopener noreferrer">EgressSelector</a> å¼€å‘ï¼Œæ„åœ¨å®ç° Kubernetes é›†ç¾¤ç»„ä»¶çš„è·¨ intranet é€šä¿¡ï¼ˆä¾‹å¦‚ï¼Œmaster ä½äºç®¡æ§ VPCï¼Œè€Œ kubelet ç­‰å…¶ä»–ç»„ä»¶ä½äºç”¨æˆ· VPCï¼‰ã€‚</p><p>è¯»è€…å¯èƒ½ä¼šå¥½å¥‡ï¼Œæ—¢ç„¶ OpenYurt æ˜¯åŸºäº ACK@Edge å¼€æºçš„ï¼Œè€Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œ ACK@Edge çš„äº‘è¾¹è¿ç»´é€šé“ä½¿ç”¨çš„æ˜¯è‡ªç ”ç»„ä»¶ tunnellibï¼Œé‚£ä¸ºä»€ä¹ˆåœ¨å¼€æºç‰ˆæœ¬é‡Œæˆ‘ä»¬è¦é€‰ç”¨ä¸€ä¸ªæ–°çš„ç»„ä»¶å‘¢ï¼Ÿè¿™é‡Œä¸å¾—ä¸å†æ¬¡æåˆ° OpenYurt çš„æ ¸å¿ƒè®¾è®¡ç†å¿µ â€œExtend upstream Kubernetes to Edgeâ€ã€‚</p><p>è¯šç„¶ï¼Œtunnellib ç»è¿‡äº†å¤æ‚çº¿ä¸Šç¯å¢ƒçš„è€ƒéªŒï¼Œç»„ä»¶æ€§èƒ½ç¨³å®šï¼Œä½†æˆ‘ä»¬æ›´å¸Œæœ›èƒ½ä¸ä¸Šæ¸¸ä¿æŒæœ€å¤§çš„æŠ€æœ¯å…¬çº¦æ•°ï¼Œè®© OpenYurt çš„ç”¨æˆ·ä½“éªŒæ›´æ¥è¿‘åŸç”Ÿ Kubernetes ï¼›åŒæ—¶ï¼Œåœ¨ ACK@Edge çš„å¼€å‘å’Œè¿ç»´è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å‘ç°ï¼Œè¾¹ç¼˜é›†ç¾¤çš„è®¸å¤šéœ€æ±‚ä¹ŸåŒæ ·å­˜åœ¨äºå…¶ä»–åœºæ™¯ä¸­ï¼ˆä¾‹å¦‚ï¼Œå¤§å¤šæ•°äº‘å‚å•†ä¹Ÿéœ€è¦å®ç°èŠ‚ç‚¹è·¨ç½‘ç»œé€šä¿¡ï¼‰ï¼Œå¹¶ä¸”è¿ç»´é€šé“çš„ä¼ è¾“æ•ˆç‡ä¹Ÿèƒ½è¿›ä¸€æ­¥ä¼˜åŒ–ï¼ˆ4.5ç« å°†è¯¦è¿°ä¼˜åŒ–è¿‡ç¨‹ï¼‰ã€‚å› æ­¤ï¼Œç§‰æ‰¿å¼€æ”¾åˆ†äº«ã€å¹³ç­‰æ™®æƒ çš„å¼€æºç²¾ç¥ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å°†å¼€å‘å’Œè¿ç»´è¿‡ç¨‹ä¸­ç§¯ç´¯çš„çš„å®è´µç»éªŒåœ¨ä¸Šæ¸¸ç¤¾åŒºä¸æ›´å¤šçš„å¼€å‘è€…åˆ†äº«ã€‚</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="anpå¹¶éå¼€ç®±å³ç”¨">ANPå¹¶éå¼€ç®±å³ç”¨<a aria-hidden="true" class="hash-link" href="#anpå¹¶éå¼€ç®±å³ç”¨" title="Direct link to heading">â€‹</a></h2><p>ç„¶è€Œ ANP é¡¹ç›®ä»å¤„äºèµ·æ­¥é˜¶æ®µï¼ŒåŠŸèƒ½å°šæœªå®Œå–„ï¼Œè®¸å¤šé—®é¢˜ä»æœ‰å¾…è§£å†³ã€‚æˆ‘ä»¬ä»å®è·µä¸­å‘ç°çš„ä¸»è¦é—®é¢˜åŒ…æ‹¬ï¼š</p><ul><li><p>å¦‚ä½•è½¬å‘äº‘ç«¯èŠ‚ç‚¹çš„è¯·æ±‚ -- åå‘é€šé“æ­£å¸¸å·¥ä½œçš„ä¸€ä¸ªå‰ææ˜¯ï¼Œç®¡æ§èŠ‚ç‚¹å‘å¾€è¾¹ç¼˜èŠ‚ç‚¹çš„è¯·æ±‚å¿…é¡»å…ˆç»è¿‡ proxy serverã€‚å¯¹äº Kubernetes 1.16 + ç‰ˆæœ¬ï¼ŒKAS èƒ½å€Ÿç”± EgressSelector å°†å‘å¾€èŠ‚ç‚¹çš„è¯·æ±‚å…ˆå‘å¾€æŒ‡å®šçš„ proxy serverã€‚ä½†å¯¹äº 1.16 ä»¥å‰çš„ç‰ˆæœ¬ï¼ŒKAS åŠå…¶ä»–ç®¡æ§ç»„ä»¶ï¼ˆPrometheus å’Œ metrics serverï¼‰åªèƒ½ç›´æ¥è®¿é—®èŠ‚ç‚¹ï¼Œè€Œä¸èƒ½ç»•é“ proxy serverã€‚å¯ä»¥é¢„è§çš„æ˜¯ï¼Œéƒ¨åˆ†ç”¨æˆ·åœ¨çŸ­æœŸå†…ï¼Œä»å°†ä½¿ç”¨ 1.16 ä»¥å‰çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸” Prometheus å’Œ metrics server ç­‰ç®¡æ§ç»„ä»¶åœ¨çŸ­æœŸå†…ä¹Ÿæ²¡æœ‰æ”¯æŒ EgressSelector çš„è®¡åˆ’ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è¦è§£å†³çš„ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œå¦‚ä½•å°†ç®¡æ§ç»„ä»¶å‘å¾€èŠ‚ç‚¹çš„è¯·æ±‚è½¬å‘è‡´ proxy serverã€‚</p></li><li><p>å¦‚ä½•ç¡®ä¿ server å‰¯æœ¬è¦†ç›–æ‰€æœ‰çš„ region -- åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä¸€ä¸ªè¾¹ç¼˜é›†ç¾¤å¸¸å¸¸åŒ…å«ä¸Šä¸‡ä¸ªèŠ‚ç‚¹ï¼Œå¹¶åŒæ—¶æœåŠ¡ä¸Šç™¾åç”¨æˆ·ï¼Œå¦‚æœä¸€ä¸ªé›†ç¾¤åªæœ‰ä¸€ä¸ª proxy serverï¼Œ é‚£ä¹ˆï¼Œä¸€æ—¦ proxy server å‡ºç°æ•…éšœï¼Œæ‰€æœ‰ç”¨æˆ·éƒ½å°†æ— æ³•å¯¹ä½äºè¾¹ç¼˜èŠ‚ç‚¹ä¸Šçš„ pod è¿›è¡Œæ“ä½œã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»åŒæ—¶éƒ¨ç½²å¤šä¸ª proxy server å‰¯æœ¬ä»¥ä¿è¯é›†ç¾¤é«˜å¯ç”¨ã€‚åŒæ—¶ï¼Œproxy server çš„å·¥ä½œè´Ÿè·å°†éšç€è®¿é—®æµé‡çš„å¢å¤§è€Œå¢å¤§ï¼Œç”¨æˆ·çš„è®¿é—®å»¶æ—¶ä¹ŸåŠ¿å¿…å¢åŠ ã€‚å› æ­¤åœ¨éƒ¨ç½² proxy server æ—¶ï¼Œæˆ‘ä»¬è¿˜éœ€è€ƒè™‘å¦‚ä½•å¯¹ proxy server è¿›è¡Œæ°´å¹³æ‹“å±•ï¼Œä»¥åº”å¯¹é«˜å¹¶å‘åœºæ™¯ã€‚ä¸€ä¸ªåº”å¯¹å•ç‚¹æ•…éšœå’Œé«˜å¹¶å‘åœºæ™¯çš„ç»å…¸è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œéƒ¨ç½²å¤šä¸ª proxy server å‰¯æœ¬ï¼Œå¹¶ä½¿ç”¨è´Ÿè½½å‡è¡¡è¿›è¡Œæµé‡åˆ†å‘ã€‚ç„¶è€Œåœ¨ OpenYurt åœºæ™¯ä¸‹ï¼Œå¯¹äº KAS å‘æ¥çš„ä»»æ„è¯·æ±‚ï¼ŒLoadBalancer (LB) ä¼šè½¬å‘ç»™å“ªä¸ª server å‰¯æœ¬æ˜¯ä¸å¯æ§çš„ï¼Œå› æ­¤ï¼Œéœ€è¦è§£å†³çš„ç¬¬äºŒä¸ªé—®é¢˜æ˜¯ï¼Œå¦‚ä½•ä¿è¯æ¯ä¸ª server å‰¯æœ¬éƒ½èƒ½ä¸æ‰€æœ‰çš„ agent å»ºç«‹è¿æ¥ã€‚</p></li><li><p>å¦‚ä½•å°†è¯·æ±‚è½¬å‘ç»™æ­£ç¡®çš„ agent -- åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œproxy server åœ¨æ”¶åˆ°è¯·æ±‚åï¼Œéœ€æ ¹æ®è¯·æ±‚çš„ destination IPï¼Œå°†è¯·æ±‚è½¬å‘è‡³ä½äºå¯¹åº” network region å†…çš„ agentã€‚ç„¶è€Œï¼ŒANPç›®å‰çš„å®ç°ï¼Œå‡è®¾æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½ä½äºä¸€ä¸ªç½‘ç»œç©ºé—´å†…ï¼Œ server ä¼šéšæœºæŒ‘é€‰ä¸€ä¸ª agent è½¬å‘è¯·æ±‚ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦è§£å†³çš„ç¬¬ä¸‰ä¸ªé—®é¢˜æ˜¯ï¼Œå¦‚ä½•å°†è¯·æ±‚æ­£ç¡®åœ°è½¬å‘ç»™æŒ‡å®šçš„ agentã€‚ </p></li><li><p>å¦‚ä½•è§£é™¤ç»„ä»¶å¯¹èŠ‚ç‚¹è¯ä¹¦çš„ä¾èµ– -- åœ¨è¿è¡Œæ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸º server æä¾›ä¸€å¥— TLS è¯ä¹¦ï¼Œä»¥å®ç° server ä¸ KASï¼Œserver ä¸ agent é—´çš„å®‰å…¨é€šä¿¡ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦ä¸º agent å‡†å¤‡ä¸€å¥— TLS client è¯ä¹¦ï¼Œç”¨ä»¥å»ºç«‹ agent å’Œ server é—´çš„ gRPC ä¿¡é“ã€‚ANP ç›®å‰çš„å®ç°ï¼Œè¦æ±‚ server å¿…é¡»å’Œ KAS éƒ¨ç½²åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œå¹¶ä¸”åœ¨å¯åŠ¨æ—¶æŒ‚è½½èŠ‚ç‚¹ volume å…±äº« KAS tls è¯ä¹¦ã€‚åŒæ ·ï¼Œagent ä¹Ÿéœ€è¦åœ¨å¯åŠ¨æ—¶æŒ‚è½½ volume å…±äº« kubelet tls è¯ä¹¦ã€‚è¿™æ— å½¢ä¸­é™ä½äº†éƒ¨ç½²çš„çµæ´»æ€§ï¼Œé€ æˆäº†ç»„ä»¶å¯¹èŠ‚ç‚¹è¯ä¹¦çš„å¼ºä¾èµ–ï¼Œåœ¨æœ‰äº›æƒ…å†µä¸‹ï¼Œç”¨æˆ·å¯èƒ½å¸Œæœ›å°† server éƒ¨ç½²åœ¨é KAS æ‰€åœ¨èŠ‚ç‚¹ä¸Šã€‚å› æ­¤ï¼Œå¦ä¸€ä¸ªéœ€è¦å…³æ³¨çš„é—®é¢˜æ˜¯ï¼Œå¦‚ä½•è§£é™¤ç»„ä»¶å¯¹èŠ‚ç‚¹è¯ä¹¦çš„ä¾èµ–ã€‚</p></li></ul><ul><li>å¦‚ä½•ç¼©å° Tunnel å¸¦å®½ -- ANP çš„ä¸€ä¸ªæ ¸å¿ƒè®¾è®¡æ€æƒ³ï¼Œæ˜¯ä½¿ç”¨ gRPC å°è£… KAS æ‰€æœ‰å¯¹å¤– HTTP è¯·æ±‚ã€‚è¿™é‡Œé€‰æ‹© gRPCï¼Œä¸»è¦æ˜¯çœ‹é‡å…¶å¯¹æµï¼ˆstreamï¼‰çš„æ”¯æŒå’Œæ¸…æ™°çš„æ¥å£è§„èŒƒï¼Œæ­¤å¤–ï¼Œå¼ºç±»å‹çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯å¯ä»¥æœ‰æ•ˆå‡å°‘è¿è¡Œæ—¶é”™è¯¯ï¼Œæé«˜ç³»ç»Ÿç¨³å®šæ€§ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬ä¹Ÿå‘ç°ï¼Œç›¸è¾ƒäºç›´æ¥ä½¿ç”¨ TCP åè®®ï¼Œé‡‡ç”¨ ANP ä¹Ÿä¼šå¸¦æ¥é¢å¤–çš„å¼€é”€å¢åŠ å¸¦å®½ã€‚ä»äº§å“å±‚é¢è€ƒè™‘ï¼ŒTunnel æµé‡èµ°çš„æ˜¯å…¬ç½‘ï¼Œå¸¦å®½çš„å¢åŠ ä¹Ÿæ„å‘³ç€ç”¨æˆ·æˆæœ¬çš„å¢åŠ ã€‚å› æ­¤ï¼Œä¸€ä¸ªéå¸¸é‡è¦çš„é—®é¢˜æ˜¯ï¼Œåœ¨æé«˜ç³»ç»Ÿç¨³å®šæ€§çš„åŒæ—¶ï¼Œæˆ‘ä»¬æ˜¯å¦ä¹Ÿèƒ½ç¼©å°å¸¦å®½ï¼Ÿ </li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="yurttunnelè®¾è®¡è§£æ">Yurttunnelè®¾è®¡è§£æ<a aria-hidden="true" class="hash-link" href="#yurttunnelè®¾è®¡è§£æ" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="1åˆ¶å®šdnatè§„åˆ™è½¬å‘äº‘ç«¯èŠ‚ç‚¹çš„è¯·æ±‚">1.åˆ¶å®šDNATè§„åˆ™è½¬å‘äº‘ç«¯èŠ‚ç‚¹çš„è¯·æ±‚<a aria-hidden="true" class="hash-link" href="#1åˆ¶å®šdnatè§„åˆ™è½¬å‘äº‘ç«¯èŠ‚ç‚¹çš„è¯·æ±‚" title="Direct link to heading">â€‹</a></h3><p>å¦‚å‰æ–‡æ‰€è¿°ï¼ŒANP æ˜¯åŸºäºä¸Šæ¸¸æ–°åŠŸèƒ½ EgressSelector å¼€å‘çš„ï¼Œè¯¥åŠŸèƒ½å…è®¸ç”¨æˆ·åœ¨å¯åŠ¨ KAS æ—¶é€šè¿‡ä¼ å…¥ egress configuration æ¥è¦æ±‚ KAS å°† egress è¯·æ±‚è½¬å‘åˆ°æŒ‡å®šçš„ proxy serverã€‚ä½†ç”±äºæˆ‘ä»¬éœ€è¦å…¼é¡¾æ–°è€ç‰ˆæœ¬çš„ Kubernetes é›†ç¾¤ï¼Œå¹¶ä¸”è€ƒè™‘åˆ°ï¼Œå…¶ä»–ç®¡æ§ç»„ä»¶ï¼ˆPrometheus å’Œ metric serverï¼‰å¹¶ä¸æ”¯æŒ EgressSelector ç‰¹æ€§ï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯åœ¨æ— æ³•ä½¿ç”¨ EgressSelector çš„æƒ…å†µä¸‹ä¹Ÿèƒ½å°† KAS egress è¯·æ±‚è½¬å‘è‡´ proxy serverã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬åœ¨æ¯ä¸€ä¸ªäº‘ç«¯ç®¡æ§èŠ‚ç‚¹ä¸Šéƒ½éƒ¨ç½²ä¸€ä¸ª Yurttunnel Server å‰¯æœ¬ï¼Œå¹¶åœ¨ Server ä¸­å†…åµŒä¸€ä¸ªæ–°ç»„ä»¶ Iptabel Managerã€‚Iptable Manager ä¼šé€šè¿‡åœ¨å®¿ä¸»æœºçš„ Iptable ä¸­çš„ OUTPUT é“¾ä¸­æ·»åŠ  DNAT è§„åˆ™ï¼Œå°†ç®¡æ§ç»„ä»¶å¯¹èŠ‚ç‚¹çš„è¯·æ±‚è½¬å‘è‡´ Yurttunnel Serverã€‚</p><p>åŒæ—¶ï¼Œå½“å¯ç”¨ EgressSelector åï¼ŒKAS å¯¹å¤–è¯·æ±‚éƒ½éµå¾ªä¸€ä¸ªç»Ÿä¸€çš„æ ¼å¼ï¼Œå› æ­¤æˆ‘ä»¬æ–°å¢ä¸€ä¸ªç»„ä»¶ï¼Œ ANP interceptorã€‚ANP interceptor ä¼šè´Ÿè´£æˆªå–ä» master å‘æ¥çš„ http è¯·æ±‚ï¼Œå¹¶å°†å…¶å°è£…æˆ EgressSelector æ ¼å¼ã€‚Yurttunnel è¯·æ±‚è½¬å‘çš„å…·ä½“æµç¨‹è§å›¾ä¸‰ã€‚
<img alt="image" src="/assets/images/yurttunnel-37d6b1940619816205bf637ecda07532.png"></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="2åŠ¨æ€è·å–serverå‰¯æœ¬æ•°">2.åŠ¨æ€è·å–Serverå‰¯æœ¬æ•°<a aria-hidden="true" class="hash-link" href="#2åŠ¨æ€è·å–serverå‰¯æœ¬æ•°" title="Direct link to heading">â€‹</a></h3><p>åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬æåˆ°ï¼Œæˆ‘ä»¬å°†é‡‡ç”¨è´Ÿè½½å‡è¡¡çš„æ–¹å¼æ¥ç®¡ç†yurttunnel serverï¼Œæ‰€æœ‰çš„ingressè¯·æ±‚éƒ½ä¼šé€šè¿‡LBåˆ†å‘ç»™ä¸€ä¸ªserverå‰¯æœ¬ã€‚ç”±äºæˆ‘ä»¬æ— æ³•é¢„æµ‹LBä¼šæŒ‘é€‰å“ªä¸ªserverå‰¯æœ¬ï¼Œæˆ‘ä»¬å¿…é¡»ä¿è¯æ¯ä¸ª server å‰¯æœ¬éƒ½è¦ä¸æ‰€æœ‰çš„ agent å»ºç«‹è¿æ¥ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ ANP è‡ªå¸¦çš„åŠŸèƒ½å®ç°è¿™ä¸€éœ€æ±‚ï¼Œå…·ä½“æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li><p>åœ¨å¯åŠ¨ yurttunnel server æ—¶ï¼Œæˆ‘ä»¬ä¼šå°†å‰¯æœ¬æ•°ï¼ˆserverCountï¼‰ä¼ å…¥æ¯ä¸ª server å‰¯æœ¬ä¸­ï¼Œå¹¶ä¸”ä¸ºæ¯ä¸ªå‰¯æœ¬æŒ‡å®šä¸€ä¸ª server IDï¼›</p></li><li><p>agent è¿æ¥ LB åï¼ŒLBä¼šéšæœºé€‰æ‹©ä¸€ä¸ª server å‰¯æœ¬å¹¶è®©å…¶ä¸ agent å»ºç«‹é•¿è¿æ¥ï¼›</p></li><li><p>ä¸æ­¤åŒæ—¶ï¼Œserver ä¼šé€šè¿‡è¯¥é€šé“å‘ agent è¿”å›ä¸€ä¸ª ACK packageï¼Œè¿™ä¸ª package ä¸­å°†åŒ…å« serverCount å’Œ serverIDï¼›</p></li><li><p>agent é€šè¿‡è§£æ ACK packageï¼Œå¯ä»¥è·æ‚‰ server å‰¯æœ¬çš„ä¸ªæ•°ï¼Œå¹¶åœ¨æœ¬åœ°è®°å½•å·²è¿æ¥çš„ serverIDï¼›</p></li><li><p>å¦‚æœ agent å‘ç°ï¼Œæœ¬åœ°è¿æ¥çš„ server å‰¯æœ¬æ•°å°äº serverCountï¼Œåˆ™ä¼šå†æ¬¡å‘ LB å‘é€è¿æ¥è¯·æ±‚ï¼Œç›´è‡³æœ¬åœ°è®°å½•çš„ serverID æ•°ä¸ server Count æ•°ä¸€è‡´ä¸ºæ­¢ã€‚</p></li></ul><p>è¯¥æœºåˆ¶è™½ç„¶å¸®åŠ©æˆ‘ä»¬å®ç°äº†serverå‰¯æœ¬çš„å…¨ç½‘æ®µè¦†ç›–ã€‚ä½†åŒæ—¶ï¼Œä¹Ÿå­˜åœ¨ä¸å¯å¿½è§†çš„ç¼ºç‚¹ï¼Œç”±äº agent æ— æ³•é€‰æ‹©ä¸å“ªä¸ª server å‰¯æœ¬å»ºç«‹è¿æ¥ï¼Œå› æ­¤ï¼Œä¸ºäº†è¿æ¥æ‰€æœ‰çš„ server å‰¯æœ¬ï¼Œagent å¿…é¡»åå¤è®¿é—® LBã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œserver ç”±äºè¿˜æ²¡æœ‰ä¸æ‰€æœ‰çš„ agent å»ºç«‹è¿æ¥ï¼ŒKAS å‘æ¥çš„è¯·æ±‚å¯èƒ½æ— æ³•è½¬å‘è‡³å¯¹åº”çš„èŠ‚ç‚¹ã€‚ä¸€ä¸ªæ½œåœ¨çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œä¸ºæ¯ä¸ª serverå‰¯æœ¬åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„ LBï¼Œè´Ÿè´£ä¸ agent ä¹‹é—´çš„è¿æ¥ï¼ŒåŒæ—¶åœ¨agentç«¯è®°å½•æ‰€æœ‰ serverå‰¯æœ¬å¯¹åº” LB çš„ä¿¡æ¯ï¼Œè¿™ä¸€æ–¹æ¡ˆèƒ½å¸®åŠ© agent å¿«é€Ÿåœ°ä¸æ‰€æœ‰çš„ server å‰¯æœ¬å»ºç«‹è¿æ¥ã€‚è¯¥æ–¹æ¡ˆçš„å…·ä½“å®ç°ç»†èŠ‚ï¼Œç›®å‰ä»åœ¨ä¸ä¸Šæ¸¸ç¤¾åŒºçš„å¼€å‘è€…è®¨è®ºä¸­ã€‚</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="3ä¸ºanpæ·»åŠ ä»£ç†ç­–ç•¥">3.ä¸ºANPæ·»åŠ ä»£ç†ç­–ç•¥<a aria-hidden="true" class="hash-link" href="#3ä¸ºanpæ·»åŠ ä»£ç†ç­–ç•¥" title="Direct link to heading">â€‹</a></h3><p>åœ¨OpenYurtçš„ç½‘ç»œæ¨¡å‹ä¸‹ï¼Œè¾¹ç¼˜èŠ‚ç‚¹åˆ†å¸ƒåœ¨ä¸åŒçš„network regionä¸­ï¼Œéšæœºé€‰æ‹©çš„ agent å¯èƒ½æ— æ³•å°†è¯·æ±‚è½¬å‘è‡³ä½äºå…¶ä»– region å†…çš„èŠ‚ç‚¹ä¸Šã€‚å› æ­¤æˆ‘ä»¬ä¸å¾—ä¸ä¿®æ”¹ ANP server åº•å±‚ä»£ç†è½¬å‘çš„é€»è¾‘ã€‚ç„¶è€Œï¼Œæ ¹æ®é•¿æœŸçš„ç»éªŒï¼Œæˆ‘ä»¬ç›¸ä¿¡ï¼Œproxy server æ”¯æŒä¸åŒçš„ä»£ç†ç­–ç•¥ï¼Œä¾‹å¦‚ï¼Œå°†è¯·æ±‚è½¬å‘è‡³æŒ‡å®šæ•°æ®ä¸­å¿ƒï¼Œregionï¼Œæˆ–è€…æŒ‡å®šä¸»æœºï¼Œæ˜¯ä¸€ä¸ªè¾ƒä¸ºé€šç”¨çš„éœ€æ±‚ã€‚ç»è¿‡å’Œ ANP ç¤¾åŒºå¼€å‘è€…è®¨è®ºï¼Œæˆ‘ä»¬å†³å®šé‡æ„ ANP ç®¡ç† agent è¿æ¥çš„æ¥å£ï¼Œå…è®¸ç”¨æˆ·æ ¹æ®éœ€æ±‚å®ç°æ–°çš„ä»£ç†ç­–ç•¥ï¼Œå¹¶è®¡åˆ’å°†è¯¥ feature æœ€ç»ˆåˆå…¥ä¸Šæ¸¸ä»£ç åº“ã€‚ç›®å‰é‡æ„å·¥ä½œä»åœ¨è¿›è¡Œä¸­ï¼Œåœ¨ Yurttunnel ç¬¬ä¸€ä¸ªå¼€æºç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬æš‚æ—¶é‡‡ç”¨ä»¥ä¸‹é…ç½®ï¼š</p><ul><li><p>åœ¨æ¯ä¸ªè¾¹ç¼˜èŠ‚ç‚¹ä¸Šéƒ¨ç½²ä¸€ä¸ª agentã€‚</p></li><li><p>agent åœ¨ server å¤„ç™»è®°æ—¶ï¼Œä½¿ç”¨ agent æ‰€åœ¨èŠ‚ç‚¹çš„ IP ä½œä¸º agentIDã€‚</p></li><li><p>server åœ¨è½¬å‘è¯·æ±‚æ—¶ï¼Œé€šè¿‡åŒ¹é…è¯·æ±‚ç›®æ ‡ IP å’Œ agentIDï¼Œå°†è¯·æ±‚è½¬å‘è‡³å¯¹åº”çš„ agentã€‚</p></li></ul><p>æˆ‘ä»¬è®¡åˆ’åœ¨OpenYurtåç»­å‘å¸ƒYurt Unitï¼ˆè¾¹ç¼˜èŠ‚ç‚¹åˆ†åŒºç®¡æ§ï¼‰ä¹‹åï¼Œé…åˆæ–°å¢çš„ANPä»£ç†è½¬å‘ç­–ç•¥ï¼Œå®ç°agentçš„åˆ†åŒºéƒ¨ç½²ï¼Œå’Œè¯·æ±‚çš„åˆ†åŒºè½¬å‘ã€‚</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="4åŠ¨æ€ç”³è¯·å®‰å…¨è¯ä¹¦">4.åŠ¨æ€ç”³è¯·å®‰å…¨è¯ä¹¦<a aria-hidden="true" class="hash-link" href="#4åŠ¨æ€ç”³è¯·å®‰å…¨è¯ä¹¦" title="Direct link to heading">â€‹</a></h3><p>ä¸ºäº†è§£é™¤yurttunnelç»„ä»¶å¯¹èŠ‚ç‚¹è¯ä¹¦çš„ä¾èµ–ï¼Œæˆ‘ä»¬åœ¨yurttunnelä¸­æ–°å¢cert managerç»„ä»¶ï¼Œcert managerä¼šåœ¨serverå’Œagentè¿è¡Œåï¼Œå‘KASæäº¤certificate signning request(CSR)ã€‚server å°†ä½¿ç”¨ç”³è¯·åˆ°çš„è¯ä¹¦æ¥ç¡®ä¿å…¶ä¸ KAS å’Œ agent é—´çš„å®‰å…¨é€šä¿¡ï¼Œagent ä¼šä½¿ç”¨ç”³è¯·åˆ°çš„è¯ä¹¦ç¡®ä¿å…¶ä¸ server é—´ gRPC ä¿¡é“çš„å®‰å…¨ã€‚ç”±äº agent å’Œ kubelet é—´æ˜¯é€šè¿‡ tcp åè®®è¿æ¥ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬æ— éœ€ä¸º agent å’Œ kubelet é—´çš„è¿æ¥å‡†å¤‡è¯ä¹¦ã€‚</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="5å‹ç¼©tunnelå¸¦å®½èŠ‚çº¦æˆæœ¬">5.å‹ç¼©Tunnelå¸¦å®½ï¼ŒèŠ‚çº¦æˆæœ¬<a aria-hidden="true" class="hash-link" href="#5å‹ç¼©tunnelå¸¦å®½èŠ‚çº¦æˆæœ¬" title="Direct link to heading">â€‹</a></h3><p>åœ¨ä¸Šæ–‡ï¼Œæˆ‘ä»¬æåˆ°ï¼Œä½¿ç”¨gRPCå°è£…Tunnelè™½ç„¶å¯ä»¥æé«˜ä¼ è¾“ç¨³å®šæ€§ï¼Œä½†åŒæ—¶ä¹Ÿä¼šå¢åŠ å…¬ç½‘æµé‡ã€‚è¿™æ˜¯å¦æ„å‘³ç€ç¨³å®šæ€§å’Œæ€§èƒ½ï¼Œæˆ‘ä»¬åªèƒ½äºŒé€‰ä¸€ï¼Ÿé€šè¿‡å¯¹ä¸åŒç”¨æˆ·åœºæ™¯çš„åˆ†æï¼Œæˆ‘ä»¬å‘ç°ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç”¨æˆ·ä½¿ç”¨è¿ç»´é€šé“æ˜¯ä¸ºäº†è·å–å®¹å™¨æ—¥å¿—ï¼ˆå³ kubectl logï¼‰ï¼Œè€Œä¼ ç»Ÿæ—¥å¿—æ–‡ä»¶ï¼Œå­˜åœ¨è®¸å¤šç›¸åŒçš„æ–‡æœ¬ä¿¡æ¯ï¼Œå› æ­¤æˆ‘ä»¬æ¨æ–­ä½¿ç”¨ gzip ç­‰å‹ç¼©ç®—æ³•èƒ½æœ‰æ•ˆç¼©å°å¸¦å®½ã€‚ä¸ºäº†éªŒè¯è¿™ä¸€å‡è®¾ï¼Œæˆ‘ä»¬åœ¨ ANP åº•å±‚çš„ gRPC åº“ä¸­æ·»åŠ äº† gzip compressorï¼Œå¹¶ä¸”å¯¹æ¯”äº†ä¸ä½¿ç”¨åŸç”Ÿ TCP è¿æ¥åœºæ™¯ä¸‹çš„æ•°æ®ä¼ è¾“é‡ã€‚</p><p>æˆ‘ä»¬è€ƒè™‘çš„ç¬¬ä¸€ä¸ªå®éªŒåœºæ™¯æ˜¯ï¼Œåˆ†åˆ«é€šè¿‡ TCP è¿æ¥å’Œ ANP è·å–åŒä¸€ kubeproxy å®¹å™¨çš„æ—¥å¿—ï¼Œæˆ‘ä»¬æˆªå–äº†è¿™ä¸€è¿‡ç¨‹ä¸­ Tunnel ä¸ŠåŒå‘ package å’Œ bytes æ€»é‡ã€‚</p><p><img alt="image" src="data:image/png;base64,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"></p><p>å¦‚ä¸Šè¡¨æ‰€ç¤ºï¼Œé€šè¿‡ä½¿ç”¨ ANPï¼Œ æ€»ä¼ è¾“æ•°æ®é‡ä¸‹é™äº† 29.93%ã€‚</p><p>ç»è¿‡é•¿æ—¶é—´è¿è¡Œï¼Œå®¹å™¨çš„æ—¥å¿—æ–‡æœ¬å¸¸å¸¸å¯ä»¥è¾¾åˆ°åå‡ å…†ï¼Œä¸ºäº†æ¨¡æ‹Ÿè·å–å¤§æ–‡æœ¬æ—¥å¿—çš„åœºæ™¯ã€‚æˆ‘ä»¬åˆ›å»ºäº†ä¸€åŒ…å« 10.5M systemd logï¼ˆå³ journalctlï¼‰çš„ ubuntu å®¹å™¨ï¼ŒåŒæ ·æˆ‘ä»¬åˆ†åˆ«ä½¿ç”¨åŸç”Ÿ TCP è¿æ¥å’Œ ANP ä¼ è¾“è¯¥æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶æµ‹é‡äº† Tunnel ä¸Šçš„æ•°æ®æ€»é‡
<img alt="image" src="/assets/images/large_log-134be99fb1d206593ae4701ab02ec08a.png"></p><p>å¦‚ä¸Šè¡¨æ‰€ç¤ºï¼Œåœ¨æ—¥å¿—æ–‡æœ¬è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡ä½¿ç”¨ ANPï¼Œ æ€»ä¼ è¾“æ•°æ®é‡ä¸‹é™äº† 40.85%ã€‚</p><p>ç”±æ­¤å¯è§ï¼Œç›¸è¾ƒäºåŸç”Ÿ TCP è¿æ¥ï¼ŒANP ä¸ä»…èƒ½æä¾›æ›´é«˜çš„ä¼ è¾“ç¨³å®šæ€§ï¼Œè¿˜å¯ä»¥å¤§å¹…é™ä½å…¬ç½‘æµé‡ã€‚è€ƒè™‘åˆ°è¾¹ç¼˜é›†ç¾¤åŠ¨è¾„ä¸Šä¸‡çš„èŠ‚ç‚¹è§„æ¨¡ï¼Œæ–°çš„è§£å†³æ–¹æ¡ˆå°†å¸®åŠ©ç”¨æˆ·åœ¨å…¬ç½‘æµé‡æ–¹é¢èŠ‚çº¦å¤§é‡å¼€é”€ã€‚</p><p>##Yurttunnelç³»ç»Ÿæ¶æ„
<img alt="image" src="/assets/images/Yurttunnel_arch-a35ea31101910abdd501f7313b7d0a43.png"></p><p>ç»¼ä¸Šï¼ŒYurttunnel ä¸»è¦åŒ…å«ä»¥ä¸‹ç»„ä»¶ï¼š</p><ul><li><p>Yurttunnel Server - è´Ÿè´£å°† apiserverï¼Œprometheusï¼Œmetrics server ç­‰ç®¡æ§ç»„ä»¶å‘å¾€èŠ‚ç‚¹çš„è¯·æ±‚ï¼Œè½¬å‘è‡³å¯¹åº”çš„ agentã€‚å…·ä½“åŒ…æ‹¬ä»¥ä¸‹å­ç»„ä»¶ï¼š</p><ul><li>ANP Proxy Server - å¯¹ ANP gRPC server çš„å°è£…ï¼Œè´Ÿè´£ç®¡ç†ä¸ Yurttunnel Agent ä¹‹é—´çš„é•¿è¿æ¥ï¼Œå¹¶è½¬å‘è¯·æ±‚ã€‚</li><li>Iptable Manager - ä¿®æ”¹ç®¡æ§èŠ‚ç‚¹çš„ DNAT è§„åˆ™ï¼Œä»¥ç¡®ä¿ç®¡æ§ç»„ä»¶çš„è¯·æ±‚èƒ½è¢«è½¬å‘è‡³ Yurttunnel Serverã€‚</li><li>Cert Manager - ä¸º Yurttunnel Server ç”Ÿæˆ TLS è¯ä¹¦ã€‚</li><li>Request Interceptor - å°† KAS å¯¹èŠ‚ç‚¹çš„ HTTP è¯·æ±‚å°è£…åˆ°ç¬¦åˆ ANP è§„åˆ™çš„ gRPC åŒ…é‡Œã€‚</li></ul></li><li><p>Yurttunnel Agent - ä¸ Yurttunnel Server ä¸»åŠ¨å»ºç«‹è¿æ¥ï¼Œå¹¶å°† Yurttunnel Server å‘æ¥çš„è¯·æ±‚è½¬å‘ç»™ Kubeletã€‚å…·ä½“åŒ…æ‹¬ä¸¤ä¸ªå­ç»„ä»¶ï¼š</p><ul><li>ANP Proxy Agent - å¯¹ ANP gRPC agent çš„å°è£…ï¼Œç›¸è¾ƒäºä¸Šæ¸¸ï¼Œæˆ‘ä»¬é¢å¤–åŠ å…¥äº† gzip compressor ä»¥å‹ç¼©æ•°æ®ã€‚</li><li>Cert Manager - ä¸º Yurttunnel Agent ç”Ÿæˆ TLS è¯ä¹¦ã€‚</li></ul></li><li><p>Yurttunnel Server Service - é€šå¸¸æ˜¯ä¸€ä¸ª SLBï¼Œè´Ÿè´£å°†ç®¡æ§ç»„ä»¶å‘æ¥çš„è¯·æ±‚åˆ†å‘ç»™åˆé€‚çš„ Yurttunnel Server å‰¯æœ¬ï¼Œä¿è¯ Yurttunnel çš„é«˜å¯ç”¨å’Œè´Ÿè½½å‡è¡¡ã€‚</p></li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="æ€»ç»“å’Œå±•æœ›">æ€»ç»“å’Œå±•æœ›<a aria-hidden="true" class="hash-link" href="#æ€»ç»“å’Œå±•æœ›" title="Direct link to heading">â€‹</a></h2><p>Yurttunnel ä½œä¸º OpenYurt è¿‘æœŸå¼€æºçš„é‡è¦ç»„ä»¶ï¼Œæ‰“é€šäº† OpenYurt é›†ç¾¤çš„äº‘è¾¹é€šé“ï¼Œä¸ºè¾¹ç¼˜é›†ç¾¤ä¸Šçš„å®¹å™¨è¿ç»´æä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„å…¥å£ã€‚é€šè¿‡å¯¹ä¸Šæ¸¸è§£å†³æ–¹æ¡ˆè¿›è¡Œæ”¹é€ ï¼ŒYurttunnel ä¸ä»…æä¾›äº†æ›´é«˜çš„ä¼ è¾“ç¨³å®šæ€§ï¼Œä¹Ÿå¤§å¹…é™ä½äº†æ•°æ®ä¼ è¾“é‡ã€‚</p><p><a href="https://mp.weixin.qq.com/s/nRUv4u9JbiIdrUPB_cZOBg" target="_blank" rel="noopener noreferrer">åŸæ–‡é“¾æ¥</a></p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_xD8n"><div class="col"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/blog/tags/yurttunnel">yurttunnel</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/openyurtio/openyurt.io/tree/master/blog/blog/2020-11-06-Build-side-efficient-collaborative-network.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/Play-with-OpenYurt-on-Raspberry-Pi"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Â« <!-- -->Getting Started with OpenYurt:play with OpenYurt on Raspberry Pi</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/Expansion-capability-of-Yurthub"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Viewing Expansion Ability of YurtHub from Edge Autonomy<!-- --> Â»</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#yurttunnelä½¿ç”¨åœºæ™¯" class="table-of-contents__link toc-highlight">Yurttunnelä½¿ç”¨åœºæ™¯</a></li><li><a href="#åå‘é€šé“" class="table-of-contents__link toc-highlight">åå‘é€šé“</a></li><li><a href="#anpå¹¶éå¼€ç®±å³ç”¨" class="table-of-contents__link toc-highlight">ANPå¹¶éå¼€ç®±å³ç”¨</a></li><li><a href="#yurttunnelè®¾è®¡è§£æ" class="table-of-contents__link toc-highlight">Yurttunnelè®¾è®¡è§£æ</a><ul><li><a href="#1åˆ¶å®šdnatè§„åˆ™è½¬å‘äº‘ç«¯èŠ‚ç‚¹çš„è¯·æ±‚" class="table-of-contents__link toc-highlight">1.åˆ¶å®šDNATè§„åˆ™è½¬å‘äº‘ç«¯èŠ‚ç‚¹çš„è¯·æ±‚</a></li><li><a href="#2åŠ¨æ€è·å–serverå‰¯æœ¬æ•°" class="table-of-contents__link toc-highlight">2.åŠ¨æ€è·å–Serverå‰¯æœ¬æ•°</a></li><li><a href="#3ä¸ºanpæ·»åŠ ä»£ç†ç­–ç•¥" class="table-of-contents__link toc-highlight">3.ä¸ºANPæ·»åŠ ä»£ç†ç­–ç•¥</a></li><li><a href="#4åŠ¨æ€ç”³è¯·å®‰å…¨è¯ä¹¦" class="table-of-contents__link toc-highlight">4.åŠ¨æ€ç”³è¯·å®‰å…¨è¯ä¹¦</a></li><li><a href="#5å‹ç¼©tunnelå¸¦å®½èŠ‚çº¦æˆæœ¬" class="table-of-contents__link toc-highlight">5.å‹ç¼©Tunnelå¸¦å®½ï¼ŒèŠ‚çº¦æˆæœ¬</a></li></ul></li><li><a href="#æ€»ç»“å’Œå±•æœ›" class="table-of-contents__link toc-highlight">æ€»ç»“å’Œå±•æœ›</a></li></ul></div></div></div></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/installation/summary">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://join.slack.com/t/openyurt/shared_invite/zt-rc5ecz4h-sEWU1vYx5gzc3_zx3En0jg" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>CNCF Slack ( #openyurt channel )<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a class="footer__link-item" href="/blog/">DingTalk (31993519)</a></li><li class="footer__item"><a href="https://shimo.im/docs/rGK3cXYWYkPrvWp8" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Bi-week Meeting (APAC, Chinese)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/openyurtio/openyurt" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/openyurtio/community/blob/main/community-membership.md" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Community Membership<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="http://47.243.253.79/login" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>OpenYurt Experience Center<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
        <br>
        <strong>Copyright Â© 2022 The OpenYurt Authors. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage/"> Trademark Usage</a> page.</strong></div></div></div></footer></div>
<script src="/assets/js/runtime~main.4de9919c.js"></script>
<script src="/assets/js/main.0634d431.js"></script>
</body>
</html>