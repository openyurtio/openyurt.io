<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="OpenYurt RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="OpenYurt Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="OpenYurt" href="/opensearch.xml"><title data-react-helmet="true">Blog | OpenYurt</title><meta data-react-helmet="true" property="og:title" content="Blog | OpenYurt"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="description" content="Blog"><meta data-react-helmet="true" property="og:description" content="Blog"><meta data-react-helmet="true" property="og:url" content="https://openyurt.io/blog"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-react-helmet="true" rel="shortcut icon" href="/img/openyurt.ico"><link data-react-helmet="true" rel="canonical" href="https://openyurt.io/blog"><link data-react-helmet="true" rel="alternate" href="https://openyurt.io/blog" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://openyurt.io/zh/blog" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://openyurt.io/blog" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.4691cb76.css">
<link rel="preload" href="/assets/js/runtime~main.c932ca61.js" as="script">
<link rel="preload" href="/assets/js/main.ef1da988.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><div class="announcementBar_axC9" role="banner"><div class="announcementBarPlaceholder_xYHE"></div><div class="announcementBarContent_6uhP">‚≠êÔ∏è If you like OpenYurt, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/openyurtio/openyurt">GitHub</a>! ‚≠êÔ∏è</div><button type="button" class="clean-btn close announcementBarClose_A3A1" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/openyurt.ico" alt="OpenYurt" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/openyurt.ico" alt="OpenYurt" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">OpenYurt</b></a><a class="navbar__item navbar__link" href="/docs/">Documentation</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/">Next</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_EbrZ"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/blog" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">English</a></li><li><a href="/zh/blog" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">ÁÆÄ‰Ωì‰∏≠Êñá</a></li></ul></div><a href="https://github.com/openyurtio/openyurt" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">üåú</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">üåû</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_NKBi"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-list-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_q+wC thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_9G5K margin-bottom--md">All posts</div><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/How-to-use-service-topology">Use service topology to realize topology-aware traffic routing</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/How-run-business-pod-in-edge-scenarios">How Openyurt runs the business pod in edge scenarios</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/Edge-gateway-caching-capabilities">Elegant realization of edge gateway caching capabilities</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/Play-with-OpenYurt-on-Raspberry-Pi">Getting Started with OpenYurt:play with OpenYurt on Raspberry Pi</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/Build-side-efficient-collaborative-network">How to build Kubernetes Native Cloud side efficient collaborative network</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/Expansion-capability-of-Yurthub">Viewing Expansion Ability of YurtHub from Edge Autonomy</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/YurtHub-design-detail">YurtHub Design Detail:edge autonomy of OpenYurt</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/Use-of-yurtctl">Yurtctl:make the native k8s cluster achieve edge computing capabilities</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/Introduce-of-OpenYurt">OpenYurt:edge computing cloud native project</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_d4p0" itemprop="headline"><a itemprop="url" href="/blog/How-to-use-service-topology">Use service topology to realize topology-aware traffic routing</a></h2><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2021-11-24T00:00:00.000Z" itemprop="datePublished">November 24, 2021</time> ¬∑ <!-- -->6 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://github.com/windydayc" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://github.com/windydayc.png" alt="Feng Zeng"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/windydayc" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Feng Zeng</span></a></div><small class="avatar__subtitle" itemprop="description">Zhejiang University student, Member of OpenYurt</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><em>Service Topology</em> enables a service to route traffic based on the Node topology of the cluster. For example, a service can specify that traffic be preferentially routed to endpoints that are on the same Node as the client, or in the same availability NodePool. </p><p>The following picture shows the general function of the <em>service topology</em>.</p><p><img alt="service-topology" src="/assets/images/service-topology-example-4fd2ecf0d4a663ff1fb33adbcfebad43.png"></p><p>To use <em>service topology</em>, the <code>EndpointSliceProxying</code> <a href="https://kubernetes.io/docs/reference/command-line-tools-reference/feature-gates/" target="_blank" rel="noopener noreferrer">feature gate</a> must be enabled, and kube-proxy needs to be configured to connect to Yurthub instead of the API server.</p><p>You can set the <code>topologyKeys</code> values of a service to direct traffic as follows. If <code>topologyKeys</code> is not specified or empty, no topology constraints will be applied.</p><table><thead><tr><th align="center"><strong>annotation Key</strong></th><th align="center"><strong>annotation Value</strong></th><th align="center"><strong>explain</strong></th></tr></thead><tbody><tr><td align="center">openyurt.io/topologyKeys</td><td align="center">kubernetes.io/hostname</td><td align="center">Only to endpoints on the same node.</td></tr><tr><td align="center">openyurt.io/topologyKeys</td><td align="center">kubernetes.io/zone<br> or <br>openyurt.io/nodepool</td><td align="center">Only to endpoints on the same nodepool.</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_y2LR" id="prerequisites">Prerequisites<a aria-hidden="true" class="hash-link" href="#prerequisites" title="Direct link to heading">‚Äã</a></h2><ol><li>Kubernetes v1.18 or above, since EndpointSlice resource needs to be supported.</li><li>Yurt-app-manager is deployed in the cluster.</li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="how-to-use">How to use<a aria-hidden="true" class="hash-link" href="#how-to-use" title="Direct link to heading">‚Äã</a></h2><p>Ensure that kubernetes version is v1.18+.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl get node</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME                 STATUS   ROLES    AGE     VERSION</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kind-control-plane   Ready    master   6m21s   v1.18.19</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kind-worker          Ready    </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain">   5m42s   v1.18.19</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kind-worker2         Ready    </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain">   5m42s   v1.18.19</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Ensure that yurt-app-manager is deployed in the cluster.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI BASH"><pre tabindex="0" class="prism-code language-BASH codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl get pod -n kube-system </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME                                         READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">coredns-66bff467f8-jxvnw                     1/1     Running   0          7m28s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">coredns-66bff467f8-lk8v5                     1/1     Running   0          7m28s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">etcd-kind-control-plane                      1/1     Running   0          7m39s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kindnet-5dpxt                                1/1     Running   0          7m28s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kindnet-ckz88                                1/1     Running   0          7m10s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kindnet-sqxs7                                1/1     Running   0          7m10s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kube-apiserver-kind-control-plane            1/1     Running   0          7m39s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kube-controller-manager-kind-control-plane   1/1     Running   0          5m38s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kube-proxy-ddgjt                             1/1     Running   0          7m28s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kube-proxy-j25kr                             1/1     Running   0          7m10s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kube-proxy-jt9cw                             1/1     Running   0          7m10s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kube-scheduler-kind-control-plane            1/1     Running   0          7m39s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">yurt-app-manager-699ffdcb78-8m9sf            1/1     Running   0          37s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">yurt-app-manager-699ffdcb78-fdqmq            1/1     Running   0          37s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">yurt-controller-manager-6c95788bf-jrqts      1/1     Running   0          6m17s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">yurt-hub-kind-control-plane                  1/1     Running   0          3m36s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">yurt-hub-kind-worker                         1/1     Running   0          4m50s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">yurt-hub-kind-worker2                        1/1     Running   0          4m50s</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="configure-kube-proxy">Configure kube-proxy<a aria-hidden="true" class="hash-link" href="#configure-kube-proxy" title="Direct link to heading">‚Äã</a></h3><p>To use <em>service topology</em>, the <code>EndpointSliceProxying</code> <a href="https://kubernetes.io/docs/reference/command-line-tools-reference/feature-gates/" target="_blank" rel="noopener noreferrer">feature gate</a> must be enabled, and kube-proxy needs to be configured to connect to Yurthub instead of the API server.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl edit cm -n kube-system kube-proxy</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">data:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  config.conf: </span><span class="token operator">|</span><span class="token plain">-</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    apiVersion: kubeproxy.config.k8s.io/v1alpha1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    bindAddress: </span><span class="token number">0.0</span><span class="token plain">.0.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    featureGates: </span><span class="token comment" style="color:rgb(98, 114, 164)"># 1. enable EndpointSliceProxying feature gate.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      EndpointSliceProxying: </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    clientConnection:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      acceptContentTypes: </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      burst: </span><span class="token number">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      contentType: </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">#kubeconfig: /var/lib/kube-proxy/kubeconfig.conf # 2. comment this line.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      qps: </span><span class="token number">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    clusterCIDR: </span><span class="token number">10.244</span><span class="token plain">.0.0/16</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    configSyncPeriod: 0s</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Restart kube-proxy.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl delete pod --selector k8s-app</span><span class="token operator">=</span><span class="token plain">kube-proxy -n kube-system</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pod </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;kube-proxy-cbsmj&quot;</span><span class="token plain"> deleted</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pod </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;kube-proxy-cqwcs&quot;</span><span class="token plain"> deleted</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pod </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;kube-proxy-m9dgk&quot;</span><span class="token plain"> deleted</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="create-nodepools">Create NodePools<a aria-hidden="true" class="hash-link" href="#create-nodepools" title="Direct link to heading">‚Äã</a></h3><ul><li>Create test nodepools.</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">cat</span><span class="token plain"> </span><span class="token operator">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">EOF</span><span class="token string bash punctuation" style="color:rgb(248, 248, 242)"> </span><span class="token string bash punctuation operator" style="color:rgb(248, 248, 242)">|</span><span class="token string bash punctuation" style="color:rgb(248, 248, 242)"> kubectl apply -f -</span><span class="token string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">apiVersion: apps.openyurt.io/v1alpha1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">kind: NodePool</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">metadata:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  name: beijing</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">spec:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  type: Cloud</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="display:inline-block;color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">---</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="display:inline-block;color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">apiVersion: apps.openyurt.io/v1alpha1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">kind: NodePool</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">metadata:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  name: hangzhou</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">spec:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  type: Edge</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  annotations:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    apps.openyurt.io/example: test-hangzhou</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  labels:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    apps.openyurt.io/example: test-hangzhou</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="display:inline-block;color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">---</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="display:inline-block;color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">apiVersion: apps.openyurt.io/v1alpha1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">kind: NodePool</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">metadata:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  name: shanghai</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">spec:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  type: Edge</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  annotations:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    apps.openyurt.io/example: test-shanghai</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  labels:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    apps.openyurt.io/example: test-shanghai</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">EOF</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>Add nodes to the nodepool.</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl label node kind-control-plane apps.openyurt.io/desired-nodepool</span><span class="token operator">=</span><span class="token plain">beijing</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">node/kind-control-plane labeled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl label node kind-worker apps.openyurt.io/desired-nodepool</span><span class="token operator">=</span><span class="token plain">hangzhou</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">node/kind-worker labeled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl label node kind-worker2 apps.openyurt.io/desired-nodepool</span><span class="token operator">=</span><span class="token plain">shanghai</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">node/kind-worker2 labeled</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>Get NodePool.</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl get np</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME       TYPE    READYNODES   NOTREADYNODES   AGE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">beijing    Cloud   </span><span class="token number">1</span><span class="token plain">            </span><span class="token number">0</span><span class="token plain">               63s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">hangzhou   Edge    </span><span class="token number">1</span><span class="token plain">            </span><span class="token number">0</span><span class="token plain">               63s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">shanghai   Edge    </span><span class="token number">1</span><span class="token plain">            </span><span class="token number">0</span><span class="token plain">               63s</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="create-uniteddeployment">Create UnitedDeployment<a aria-hidden="true" class="hash-link" href="#create-uniteddeployment" title="Direct link to heading">‚Äã</a></h3><ul><li>Create test united-deployment1. To facilitate testing, we use a <code>serve_hostname</code> image. Each time port 9376 is accessed, the hostname container returns its own hostname.</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">cat</span><span class="token plain"> </span><span class="token operator">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">EOF</span><span class="token string bash punctuation" style="color:rgb(248, 248, 242)"> </span><span class="token string bash punctuation operator" style="color:rgb(248, 248, 242)">|</span><span class="token string bash punctuation" style="color:rgb(248, 248, 242)"> kubectl apply -f -</span><span class="token string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">apiVersion: apps.openyurt.io/v1alpha1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">kind: UnitedDeployment</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">metadata:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  labels:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    controller-tools.k8s.io: &quot;1.0&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  name: united-deployment1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">spec:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  selector:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    matchLabels:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      app: united-deployment1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  workloadTemplate:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    deploymentTemplate:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      metadata:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        labels:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          app: united-deployment1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      spec:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        template:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          metadata:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">            labels:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">              app: united-deployment1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          spec:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">            containers:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">              - name: hostname</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">                image: mirrorgooglecontainers/serve_hostname</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">                ports:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">                - containerPort: 9376</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">                  protocol: TCP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  topology:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    pools:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    - name: hangzhou</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      nodeSelectorTerm:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        matchExpressions:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        - key: apps.openyurt.io/nodepool</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          operator: In</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          values:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          - hangzhou</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      replicas: 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    - name: shanghai</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      nodeSelectorTerm:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        matchExpressions:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        - key: apps.openyurt.io/nodepool</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          operator: In</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          values:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          - shanghai</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      replicas: 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  revisionHistoryLimit: 5</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">EOF</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>Create test united-deployment2. Here we use <code>nginx</code> image, in order to access the <code>hostname</code> pod that created by united-deployment1 above.</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">cat</span><span class="token plain"> </span><span class="token operator">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">EOF</span><span class="token string bash punctuation" style="color:rgb(248, 248, 242)"> </span><span class="token string bash punctuation operator" style="color:rgb(248, 248, 242)">|</span><span class="token string bash punctuation" style="color:rgb(248, 248, 242)"> kubectl apply -f -</span><span class="token string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">apiVersion: apps.openyurt.io/v1alpha1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">kind: UnitedDeployment</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">metadata:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  labels:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    controller-tools.k8s.io: &quot;1.0&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  name: united-deployment2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">spec:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  selector:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    matchLabels:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      app: united-deployment2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  workloadTemplate:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    deploymentTemplate:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      metadata:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        labels:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          app: united-deployment2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      spec:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        template:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          metadata:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">            labels:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">              app: united-deployment2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          spec:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">            containers:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">              - name: nginx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">                image: nginx:1.19.3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">                ports:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">                - containerPort: 80</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">                  protocol: TCP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  topology:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    pools:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    - name: hangzhou</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      nodeSelectorTerm:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        matchExpressions:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        - key: apps.openyurt.io/nodepool</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          operator: In</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          values:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          - hangzhou</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      replicas: 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    - name: shanghai</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      nodeSelectorTerm:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        matchExpressions:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        - key: apps.openyurt.io/nodepool</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          operator: In</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          values:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          - shanghai</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      replicas: 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  revisionHistoryLimit: 5</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">EOF</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>Get pods that created by the unitedDeployment.</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl get pod -l </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;app in (united-deployment1,united-deployment2)&quot;</span><span class="token plain"> -owide</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME                                                 READY   STATUS    RESTARTS   AGE   IP           NODE           NOMINATED NODE   READINESS GATES</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">united-deployment1-hangzhou-fv6th-66ff6fd958-f2694   </span><span class="token number">1</span><span class="token plain">/1     Running   </span><span class="token number">0</span><span class="token plain">          18m   </span><span class="token number">10.244</span><span class="token plain">.2.3   kind-worker    </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain">           </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">united-deployment1-hangzhou-fv6th-66ff6fd958-twf95   </span><span class="token number">1</span><span class="token plain">/1     Running   </span><span class="token number">0</span><span class="token plain">          18m   </span><span class="token number">10.244</span><span class="token plain">.2.2   kind-worker    </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain">           </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">united-deployment1-shanghai-5p8zk-84bdd476b6-hr6xt   </span><span class="token number">1</span><span class="token plain">/1     Running   </span><span class="token number">0</span><span class="token plain">          18m   </span><span class="token number">10.244</span><span class="token plain">.1.3   kind-worker2   </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain">           </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">united-deployment1-shanghai-5p8zk-84bdd476b6-wjck2   </span><span class="token number">1</span><span class="token plain">/1     Running   </span><span class="token number">0</span><span class="token plain">          18m   </span><span class="token number">10.244</span><span class="token plain">.1.2   kind-worker2   </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain">           </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">united-deployment2-hangzhou-lpkzg-6d958b67b6-gf847   </span><span class="token number">1</span><span class="token plain">/1     Running   </span><span class="token number">0</span><span class="token plain">          15m   </span><span class="token number">10.244</span><span class="token plain">.2.4   kind-worker    </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain">           </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">united-deployment2-hangzhou-lpkzg-6d958b67b6-lbnwl   </span><span class="token number">1</span><span class="token plain">/1     Running   </span><span class="token number">0</span><span class="token plain">          15m   </span><span class="token number">10.244</span><span class="token plain">.2.5   kind-worker    </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain">           </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">united-deployment2-shanghai-tqgd4-57f7555494-9jvjb   </span><span class="token number">1</span><span class="token plain">/1     Running   </span><span class="token number">0</span><span class="token plain">          15m   </span><span class="token number">10.244</span><span class="token plain">.1.5   kind-worker2   </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain">           </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">united-deployment2-shanghai-tqgd4-57f7555494-rn8n8   </span><span class="token number">1</span><span class="token plain">/1     Running   </span><span class="token number">0</span><span class="token plain">          15m   </span><span class="token number">10.244</span><span class="token plain">.1.4   kind-worker2   </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><span class="token plain">           </span><span class="token operator">&lt;</span><span class="token plain">none</span><span class="token operator">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="create-service-with-topologykeys">Create Service with TopologyKeys<a aria-hidden="true" class="hash-link" href="#create-service-with-topologykeys" title="Direct link to heading">‚Äã</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">cat</span><span class="token plain"> </span><span class="token operator">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">EOF</span><span class="token string bash punctuation" style="color:rgb(248, 248, 242)"> </span><span class="token string bash punctuation operator" style="color:rgb(248, 248, 242)">|</span><span class="token string bash punctuation" style="color:rgb(248, 248, 242)"> kubectl apply -f -</span><span class="token string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">apiVersion: v1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">kind: Service</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">metadata:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  name: svc-ud1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  annotations:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    openyurt.io/topologyKeys: openyurt.io/nodepool</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">spec:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  selector:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    app: united-deployment1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  type: ClusterIP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  ports:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  - port: 80</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    targetPort: 9376</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">EOF</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="create-service-without-topologykeys">Create Service without TopologyKeys<a aria-hidden="true" class="hash-link" href="#create-service-without-topologykeys" title="Direct link to heading">‚Äã</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">cat</span><span class="token plain"> </span><span class="token operator">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">EOF</span><span class="token string bash punctuation" style="color:rgb(248, 248, 242)"> </span><span class="token string bash punctuation operator" style="color:rgb(248, 248, 242)">|</span><span class="token string bash punctuation" style="color:rgb(248, 248, 242)"> kubectl apply -f -</span><span class="token string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">apiVersion: v1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">kind: Service</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">metadata:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  name: svc-ud1-without-topology</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">spec:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  selector:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    app: united-deployment1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  type: ClusterIP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  ports:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  - port: 80</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    targetPort: 9376</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">EOF</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="test-service-topology">Test Service Topology<a aria-hidden="true" class="hash-link" href="#test-service-topology" title="Direct link to heading">‚Äã</a></h3><p>We use the <code>nginx</code> pod in the shanghai nodepool to test <em>service topology</em>. Therefore, its traffic can only be routed to the nodes that in shanghai nodepool when it accesses a service with the <code>openyurt.io/topologyKeys: openyurt.io/nodepool</code> annotation.</p><p>For comparison, we first test the service without serviceTopology annotation. As we can see, its traffic can be routed to any nodes.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">exec</span><span class="token plain"> -it united-deployment2-shanghai-tqgd4-57f7555494-9jvjb </span><span class="token function" style="color:rgb(80, 250, 123)">bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/</span><span class="token comment" style="color:rgb(98, 114, 164)"># curl svc-ud1-without-topology:80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">united-deployment1-hangzhou-fv6th-66ff6fd958-twf95</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/</span><span class="token comment" style="color:rgb(98, 114, 164)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/</span><span class="token comment" style="color:rgb(98, 114, 164)"># curl svc-ud1-without-topology:80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">united-deployment1-shanghai-5p8zk-84bdd476b6-hr6xt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/</span><span class="token comment" style="color:rgb(98, 114, 164)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/</span><span class="token comment" style="color:rgb(98, 114, 164)"># curl svc-ud1-without-topology:80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">united-deployment1-hangzhou-fv6th-66ff6fd958-twf95</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/</span><span class="token comment" style="color:rgb(98, 114, 164)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/</span><span class="token comment" style="color:rgb(98, 114, 164)"># curl svc-ud1-without-topology:80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">united-deployment1-hangzhou-fv6th-66ff6fd958-f2694</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Then we test the service with serviceTopology annotation. As expected, its traffic can only be routed to the nodes in shanghai nodepool.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">exec</span><span class="token plain"> -it united-deployment2-shanghai-tqgd4-57f7555494-9jvjb </span><span class="token function" style="color:rgb(80, 250, 123)">bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/</span><span class="token comment" style="color:rgb(98, 114, 164)"># curl svc-ud1:80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">united-deployment1-shanghai-5p8zk-84bdd476b6-wjck2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/</span><span class="token comment" style="color:rgb(98, 114, 164)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/</span><span class="token comment" style="color:rgb(98, 114, 164)"># curl svc-ud1:80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">united-deployment1-shanghai-5p8zk-84bdd476b6-hr6xt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/</span><span class="token comment" style="color:rgb(98, 114, 164)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/</span><span class="token comment" style="color:rgb(98, 114, 164)"># curl svc-ud1:80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">united-deployment1-shanghai-5p8zk-84bdd476b6-wjck2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/</span><span class="token comment" style="color:rgb(98, 114, 164)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/</span><span class="token comment" style="color:rgb(98, 114, 164)"># curl svc-ud1:80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">united-deployment1-shanghai-5p8zk-84bdd476b6-hr6xt</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/blog/tags/openyurt">openyurt</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_d4p0" itemprop="headline"><a itemprop="url" href="/blog/How-run-business-pod-in-edge-scenarios">How Openyurt runs the business pod in edge scenarios</a></h2><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2021-10-15T00:00:00.000Z" itemprop="datePublished">October 15, 2021</time> ¬∑ <!-- -->7 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://github.com/rambohe-ch" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://github.com/rambohe-ch.png" alt="rambohe"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/rambohe-ch" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">rambohe</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of OpenYurt</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h3 class="anchor anchorWithStickyNavbar_y2LR" id="1ËÉåÊôØ‰ªãÁªç">1.ËÉåÊôØ‰ªãÁªç<a aria-hidden="true" class="hash-link" href="#1ËÉåÊôØ‰ªãÁªç" title="Direct link to heading">‚Äã</a></h3><p>OpenYurtÊòØ‰∏öÁïåÈ¶ñ‰∏™Èùû‰æµÂÖ•ÁöÑËæπÁºòËÆ°ÁÆó‰∫ëÂéüÁîüÂºÄÊ∫êÈ°πÁõÆÔºåÈÄöËøáËæπÁºòËá™Ê≤ªÔºå‰∫ëËæπÂçèÂêåÔºåËæπÁºòÂçïÂÖÉÂåñÔºåËæπÁºòÊµÅÈáèÈó≠ÁéØÁ≠âËÉΩÂäõ‰∏∫Áî®Êà∑Êèê‰æõ‰∫ëËæπ‰∏Ä‰ΩìÂåñÁöÑ‰ΩøÁî®‰ΩìÈ™å„ÄÇ‰∏çÂ∞ëÁî®Êà∑Âú®‰ΩøÁî®OpenYurtÁöÑÊó∂ÂÄôÔºåÁªèÂ∏∏ÈúÄË¶ÅÊääÂ≠òÈáèÁöÑ‰ΩøÁî®InClusterConfigËÆøÈóÆkube-apiserverÁöÑPodÈÄöËøáOpenYurtËøÅÁßªÂà∞ËæπÁºòÁéØÂ¢É‰∏≠„ÄÇÂ¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö</p><p><img src="/assets/images/InCluster1-1ef22d79567f77ccd6a6d7eeb72185ac.png"></p><p>Âú®OpenYurtÈõÜÁæ§‰∏≠ÔºåÊèê‰æõ‰∫Ü‰ΩøÁî®InClusterConfigÁöÑ‰∏öÂä°PodÈõ∂‰øÆÊîπÂ∞±ÂèØ‰ª•ËøêË°åÂú®ËæπÁºòÁéØÂ¢ÉÁöÑËÉΩÂäõ„ÄÇ</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="2Èù¢‰∏¥ÊåëÊàò">2.Èù¢‰∏¥ÊåëÊàò<a aria-hidden="true" class="hash-link" href="#2Èù¢‰∏¥ÊåëÊàò" title="Direct link to heading">‚Äã</a></h3><p>‰ΩøÁî®InClusterConfigÁöÑ‰∏öÂä°PodÂú®ËæπÁºòÁéØÂ¢É‰∏≠ËøêË°åÔºåÈúÄË¶ÅËß£ÂÜ≥Â¶Ç‰∏ãÈóÆÈ¢òÔºö</p><ul><li><p>ÈóÆÈ¢ò‰∏ÄÔºöPodÈÄöËøáInClusterConfigÂú∞ÂùÄËÆøÈóÆkube-apiserverÔºåËäÇÁÇπ‰∏äÈªòËÆ§ÁΩëÁªúËßÑÂàôÔºàiptables/ipvsÔºâÂ∞Ü‰ºöÊääËØ∑Ê±ÇËΩ¨ÂèëÂà∞kube-apiserverÁöÑPodIPÔºåÂêåÊó∂‰∫ëÁ´Ø‰∏éËæπÁºò‰Ωç‰∫é‰∏çÂêåÁΩëÁªúÂπ≥Èù¢ÔºåËæπÁºòÊòØÊó†Ê≥ïËÆøÈóÆÂà∞‰∫ëÁ´ØÁöÑPodIP„ÄÇÊâÄ‰ª•ËæπÁºò‰∏öÂä°PodÊó†Ê≥ïÈÄöËøáInClusterConfigËÆøÈóÆÂà∞kube-apiserver„ÄÇ</p><p><img alt="Incluster2" src="/assets/images/Incluster2-7f6a69f9c29152322fbc57bf978eca6e.png"></p></li><li><p>ÈóÆÈ¢ò‰∫åÔºöÂú®Ëß£ÂÜ≥ÈóÆÈ¢ò‰∏ÄÂêéÔºåÂ¶ÇÊûú‰∫ëËæπÁΩëÁªúÊñ≠ÂºÄÊó∂‰∏öÂä°PodÂÆπÂô®Âá∫Áé∞ÈáçÂêØÁ≠âÁä∂ÂÜµÔºåËæπÁºòPodÂ∞ÜÊó†Ê≥ï‰ªékube-apiserverËé∑ÂèñÂà∞‰∏öÂä°ÈÖçÁΩÆÔºåËøô‰ºöÂΩ±ÂìçÂà∞‰∏öÂä°PodÁöÑÈáçÂêØËøêË°å„ÄÇ</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="3Ëß£ÂÜ≥ÊñπÊ°à">3.Ëß£ÂÜ≥ÊñπÊ°à<a aria-hidden="true" class="hash-link" href="#3Ëß£ÂÜ≥ÊñπÊ°à" title="Direct link to heading">‚Äã</a></h3><p>‰ªé‰∏äËø∞ÈóÆÈ¢òÂèØ‰ª•ÁúãÂá∫ÔºåÊàë‰ª¨ÈúÄË¶ÅÊó†ÊÑüÁü•ÁöÑË∞ÉÊï¥ËæπÁºòpodÁöÑËÆøÈóÆÂú∞ÂùÄÔºåÂêåÊó∂ÈúÄË¶ÅÂú®ËæπÁºòÁéØÂ¢É‰∏≠ÁºìÂ≠ò‰∏öÂä°ÈÖçÁΩÆÔºå‰øùËØÅ‰∫ëËæπÊñ≠ÁΩëÊó∂‰πüÂèØ‰ª•Âà©Áî®ËæπÁºòÁºìÂ≠ò‰∏öÂä°ÈÖçÁΩÆÔºå‰øùËØÅ‰∫ëËæπÊñ≠ÁΩëÊó∂‰πüÂèØ‰ª•Âà©Áî®ËæπÁºòÁºìÂ≠òÊù•Ëé∑Âèñ‰∏öÂä°PodÁöÑÈÖçÁΩÆ‰ø°ÊÅØ„ÄÇÂÖ∑‰ΩìËß£ÂÜ≥ÊñπÊ°àÂ¶Ç‰∏ãÔºõ</p><h5 class="anchor anchorWithStickyNavbar_y2LR" id="31ËæπÁºòpodËÆøÈóÆÁöÑ‰∫ëÁ´Øendpoint‰ºòÂåñ">3.1ËæπÁºòPodËÆøÈóÆÁöÑ‰∫ëÁ´Øendpoint‰ºòÂåñ<a aria-hidden="true" class="hash-link" href="#31ËæπÁºòpodËÆøÈóÆÁöÑ‰∫ëÁ´Øendpoint‰ºòÂåñ" title="Direct link to heading">‚Äã</a></h5><ul><li><p>PodÈÄöËøáInClusterConfigËÆøÈóÆkube-apiserverÔºåÊ∫êÁ†ÅÂ¶Ç‰∏ãÔºö</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">InClusterConfig</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token plain">Config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    tokenFile  </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;/var/run/secrets/kubernetes.io/serviceaccount/token&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    rootCAFile </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;/var/run/secrets/kubernetes.io/serviceaccount/ca.crt&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// ÈÄöËøáKuberentes serviceÂØπÂ∫îÁöÑÁéØÂ¢ÉÂèòÈáèÊù•Ëé∑ÂèñËÆøÈóÆÂú∞ÂùÄ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">host</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> port </span><span class="token operator">:=</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Getenv</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;KUBERNETES_SERVICE_HOST&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Getenv</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;KUBERNETES_SERVICE_PORT&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">len</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">host</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token operator">||</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">len</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">port</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token boolean">nil</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> ErrNotInCluster</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// skip some code...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token plain">Config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Host</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;https://&quot;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> net</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">JoinHostPort</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">host</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> port</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    TLSClientConfig</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> tlsClientConfig</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    BearerToken</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">     </span><span class="token function" style="color:rgb(80, 250, 123)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">token</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    BearerTokenFile</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> tokenFile</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token boolean">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li></ul><ul><li><p>Âõ†Ê≠§ÊÉ≥Êó†ÊÑüÁü•Ë∞ÉÊï¥ËæπÁºòPodËÆøÈóÆÁöÑ‰∫ëÁ´ØendpointÔºåÂè™ÈúÄË¶ÅÊó†‰æµÂÖ•‰øÆÊîπPodÁöÑKUBERNETES_SERVICE_HOSTÂíåKUBERNETE_SERVICE_PORT‰∏§‰∏™ÁéØÂ¢ÉÂèòÈáèÊàñËÄÖ‰øÆÊîπkubernetes serviceÂú∞ÂùÄ„ÄÇËß£ÂÜ≥ÊñπÊ°àÂ¶Ç‰∏ãÔºö</p><ul><li><p>Ëß£ÂÜ≥ÊñπÊ°à‰∏ÄÔºöÂ¢ûÂä†‰∏Ä‰∏™admission controllerÂú®ËæπÁºòPodÂàõÂª∫Êó∂Êääkube-apiserverÁöÑÂÖ¨ÁΩëÂú∞ÂùÄËá™Âä®Ê≥®ÂÖ•Âà∞PodÁöÑÁéØÂ¢ÉÂèòÈáèKUBERNETES_SERVICE_HOSTÂíåKUBERNETE_SERVICE_PORT</p></li><li><p>Ëß£ÂÜ≥ÊñπÊ°à‰∫åÔºöËæπÁºòÊï∞ÊçÆËøáÊª§Ê°ÜÊû∂‰∏≠Â¢ûÂä†‰∏Ä‰∏™fillter yurthubÁöÑËæπÁºòÊï∞ÊçÆËøáÊª§Ê°ÜÊû∂Á±ª‰ºº‰∫éadmission controller ,‰∏ìÈó®Áî®‰∫éËæπÁºòÂú∫ÊôØ‰∏ãÂú®ËæπÁºòÂ∫îÁî®Êó†ÊÑüÁü•ÁöÑÁä∂ÊÄÅ‰∏ãÔºåÊó†‰æµÂÖ•ÁöÑ‰øÆÊîπÊàñËÄÖËøáÊª§‰∫ëÁ´ØËøîÂõûÁöÑÊï∞ÊçÆ„ÄÇÁõÆÂâçÊîØÊåÅÁöÑËøáÊª§Âô®ÊúâÔºöMasterserviceÔºåservicetopologyÔºådiscardcloudserviceÁ≠â</p></li><li><p>Ëß£ÂÜ≥ÊñπÊ°àÂØπÊØîÔºö</p><table><thead><tr><th align="center"></th><th align="center">Ëß£ÂÜ≥ÊñπÊ°à‰∏Ä</th><th align="center">Ëß£ÂÜ≥ÊñπÊ°à‰∫å</th></tr></thead><tbody><tr><td align="center">ÂÆûÁé∞ÊñπÊ°à</td><td align="center">Â¢ûÂä†‰∏Ä‰∏™admission controller</td><td align="center">ËæπÁºòÊï∞ÊçÆËøáÊª§Ê°ÜÊû∂‰∏≠Â¢ûÂä†‰∏Ä‰∏™filter</td></tr><tr><td align="center">Â§çÊùÇÂ∫¶</td><td align="center">È´òÔºàÈúÄË¶ÅÂå∫Âà´PodËøêË°åÂú®ËæπÁºòËøòÊòØ‰∫ëÁ´ØÔºâ</td><td align="center">‰Ωé</td></tr><tr><td align="center">ÊòæÁ§∫‰øÆÊîπÊï∞ÊçÆ</td><td align="center">Pod‰∏≠Â¢ûÂä†ÁéØÂ¢ÉÂèòÈáèÈÖçÁΩÆ</td><td align="center">Êó†</td></tr></tbody></table></li></ul></li></ul><p>ÁªºÂêàÂÆûÁé∞Â§çÊùÇÂ∫¶ÔºåÈùû‰æµÂÖ•Á≠âËÆæËÆ°ÁêÜÂøµÔºåÂú®OpenYurt‰∏≠Êàë‰ª¨ÈÄâÊã©‰∫ÜËß£ÂÜ≥ÊñπÊ°à‰∫å„ÄÇÂ¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö</p><p><img src="/assets/images/InCluster3-4342c22777070b2df9e39d158a929ac3.png"></p><h5 class="anchor anchorWithStickyNavbar_y2LR" id="32‰∏öÂä°podÁöÑËæπÁºòËá™Ê≤ª">3.2‰∏öÂä°PodÁöÑËæπÁºòËá™Ê≤ª<a aria-hidden="true" class="hash-link" href="#32‰∏öÂä°podÁöÑËæπÁºòËá™Ê≤ª" title="Direct link to heading">‚Äã</a></h5><p>Âú®‰∫ëËæπÁΩëÁªúÊñ≠ÂºÄÁä∂ÊÄÅ‰∏ãÔºå‰∏öÂä°PodÈáçÂêØÊó∂ÔºåÂ∞ÜÊó†Ê≥ï‰ªé‰∫ëÁ´Økube-apiserverËé∑ÂèñÂà∞‰∏öÂä°ÈÖçÁΩÆ‰ø°ÊÅØÔºåÂõ†Ê≠§ÈúÄË¶ÅÂú®ËæπÁºòÊú¨Âú∞ÁºìÂ≠òPodÁöÑ‰∏öÂä°Êï∞ÊçÆ„ÄÇ</p><p><img src="/assets/images/InCluster4-4a67ce6edd8af63676837754c51f97f3.png"></p><p>ËØ¥Êòé1Ôºö‰∏öÂä°PodÈÄöËøáyurthubËÆøÈóÆkube-apiserverÔºå‰πüÊÑèÂë≥ÁùÄ<!-- -->[3.1 ËæπÁºòPodËÆøÈóÆÁöÑ‰∫ëÁ´Øendpoint‰ºòÂåñ]<!-- -->Á´†ËäÇ‰∏≠ÊèêÂà∞ÁöÑKUBERNETES_SERVICE_HOSTÂíåKUBERNETE_SERVICE_PORTÁéØÂ¢ÉÂèòÈáèË¢´‰øÆÊîπ‰∏∫yurthub https endpoint(169.254.2.1:10268)„ÄÇ</p><p>ËØ¥Êòé2ÔºöÂ¶ÇÊûú‰∏öÂä°PodÁöÑÂ§ßÈáèlist/watchÊìç‰ΩúÂØºËá¥Â§ßÈáèÊú¨Âú∞cacheÔºåÂèØËÉΩ‰ºöÈÄ†ÊàêÊú¨Âú∞Á£ÅÁõòÂéãÂäõÔºåÂõ†Ê≠§yurthubÂØπ‰∏öÂä°PodÁöÑÁºìÂ≠òËÉΩÂäõÈªòËÆ§ÊòØÂÖ≥Èó≠ÁöÑÔºåÁî®Êà∑ÂèØ‰ª•ÈÄöËøáyurt-hub-cfg configmapÁöÑcache_agentsÂ≠óÊÆµ‰∏≠Â¢ûÂä†User-Agent‰ø°ÊÅØÊù•ÊâìÂºÄÂØπÂ∫îPodÁöÑÊï∞ÊçÆÁºìÂ≠ò„ÄÇ‰æãÂ¶ÇÔºö</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">apiVersion</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kind</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> ConfigMap</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">metadata</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> yurt</span><span class="token operator">-</span><span class="token plain">hub</span><span class="token operator">-</span><span class="token plain">cfg</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  namespace</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> kube</span><span class="token operator">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  # ÁºìÂ≠òËæπÁºòingress</span><span class="token operator">-</span><span class="token plain">controller podËÆøÈóÆkube</span><span class="token operator">-</span><span class="token plain">apiserverÁöÑÊï∞ÊçÆ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  cache_agents</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;ingress-controller&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="4ÊÄªÁªì">4.ÊÄªÁªì<a aria-hidden="true" class="hash-link" href="#4ÊÄªÁªì" title="Direct link to heading">‚Äã</a></h3><ul><li><p>Â¶ÇÊûúÂ≠òÈáèPodÊó†ÈúÄËÆøÈóÆkube-apiserverÊàñËÄÖInClusterConfigËÆøÈóÆkube-apiserverÔºåËøô‰∫õÁ±ªÂûãPodÂèØ‰ª•Èõ∂‰øÆÊîπËøêË°åÂà∞OpenYurtÈõÜÁæ§ÁöÑËæπÁºòÁéØÂ¢É‰∏ä„ÄÇÈÄöËøáÂÖ∂‰ªñÊñπÂºèËÆøÈóÆkube-apiserverÁöÑ‰∏öÂä°PodÁõÆÂâçÊó†Ê≥ï‰øùËØÅÈõ∂‰øÆÊîπËøêË°åÂà∞ËæπÁºòÁéØÂ¢É„ÄÇ</p></li><li><p>ËæπÁºò‰∏öÂä°PodÊòØÂê¶Ê≠£Â∏∏ËÆøÈóÆkube-apiserverÔºåÈ¶ñÂÖàÂèØ‰ª•Êü•Áúã‰∏öÂä°podÁöÑÁéØÂ¢ÉÂèòÈáèÊòØÂê¶Ê≠£Â∏∏Ôºö</p><p>KUBERNETES_SERVICE_HOST=127.0.0.1ÊàñËÄÖ169.254.2.1ÔºåKUBERNETES_SERVICE_PORT=10268„ÄÇÁÑ∂ÂêéÂèØ‰ª•Êü•ÁúãyurthubÁªÑ‰ª∂ÁöÑÊó•ÂøóÊòØÂê¶Êúâ‰∏öÂä°PodÁõ∏ÂÖ≥ÁöÑËØ∑Ê±ÇÊó•Âøó„ÄÇÂΩìÁÑ∂‰πüÂèØ‰ª•Êü•ËØ¢‰∏öÂä°PodÁöÑÊó•ÂøóÊòØÂê¶Ê≠£Â∏∏„ÄÇÊúÄÂêéÂèØ‰ª•Á°ÆËÆ§/etc/kubernetes/cacheÁõÆÂΩïÊòØÂê¶ÊúâÁõ∏ÂÖ≥ÁªÑ‰ª∂ÁöÑÁºìÂ≠òÊï∞ÊçÆÔºåÂ¶ÇÊûúÊ≤°ÊúâÂèØ‰ª•ÂÜçÁ°ÆËÆ§kube-system/yurt-hub-cfg configmapÊòØÂê¶Â∑≤ÁªèÈÖçÁΩÆ„ÄÇ</p></li><li><p>‰ΩøÁî®InClusterConfigÁöÑPodÈõ∂‰øÆÊîπËøêË°åÂà∞ËæπÁºòÁéØÂ¢ÉÁöÑËÉΩÂäõÔºåÊï¥‰ΩìÂÆûÁé∞Áî±yurthubÁªÑ‰ª∂ÊâøËΩΩÔºåÊ≤°ÊúâÁªôOpenYurtÊû∂ÊûÑÂ¢ûÂä†È¢ùÂ§ñÁöÑË¥üÊãÖÔºåÂêåÊó∂Áî®Êà∑Âú®‰ΩøÁî®ËøáÁ®ã‰∏≠ÂØπËØ•ËÉΩÂäõ‰πüÂü∫Êú¨Êó†ÊÑüÁü•ÔºåÂØπÂéüÁîü‰∏öÂä°PodÊó†‰æµÂÖ•„ÄÇ</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ÂèÇËÄÉÈìæÊé•">ÂèÇËÄÉÈìæÊé•Ôºö<a aria-hidden="true" class="hash-link" href="#ÂèÇËÄÉÈìæÊé•" title="Direct link to heading">‚Äã</a></h3><p>1.<a href="https://kubernetes.io/docs/tasks/access-application-cluster/access-cluster/#accessing-the-api-from-a-pod" target="_blank" rel="noopener noreferrer">Accessing the API from a Pod</a></p><p>2.<a href="https://github.com/openyurtio/openyurt/blob/master/docs/proposals/20210720-data-filtering-framework.md" target="_blank" rel="noopener noreferrer">data filtering framework on the edge</a></p><p>3.<a href="https://mp.weixin.qq.com/s/4BLfvMJJA623ZwRSgUE69A" target="_blank" rel="noopener noreferrer">Ê∑±Â∫¶Ëß£ËØªOpenYurtÔºöËæπÁºòËá™Ê≤ªËÉΩÂäõËÆæËÆ°Ëß£Êûê</a></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/blog/tags/openyurt">openyurt</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_d4p0" itemprop="headline"><a itemprop="url" href="/blog/Edge-gateway-caching-capabilities">Elegant realization of edge gateway caching capabilities</a></h2><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2021-03-29T00:00:00.000Z" itemprop="datePublished">March 29, 2021</time> ¬∑ <!-- -->7 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://github.com/rambohe-ch" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://github.com/rambohe-ch.png" alt="rambohe"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/rambohe-ch" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">rambohe</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of OpenYurt</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><img alt="image" src="/assets/images/OpenYurt-de0f93f0c16ddb05b6782cbe66107b22.png"></p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="openyurtÂ¶Ç‰ΩïËß£ÂÜ≥ËæπÁºòËá™Ê≤ªÈóÆÈ¢ò">OpenYurtÂ¶Ç‰ΩïËß£ÂÜ≥ËæπÁºòËá™Ê≤ªÈóÆÈ¢ò<a aria-hidden="true" class="hash-link" href="#openyurtÂ¶Ç‰ΩïËß£ÂÜ≥ËæπÁºòËá™Ê≤ªÈóÆÈ¢ò" title="Direct link to heading">‚Äã</a></h2><p>ÊÉ≥Ë¶ÅÂÆûÁé∞Â∞Ü Kubernetes Á≥ªÁªüÂª∂Â±ïÂà∞ËæπÁºòËÆ°ÁÆóÂú∫ÊôØÔºåÈÇ£‰πàËæπÁºòËäÇÁÇπÂ∞ÜÈÄöËøáÂÖ¨ÁΩëÂíå‰∫ëÁ´ØËøûÊé•ÔºåÁΩëÁªúËøûÊé•ÊúâÂæàÂ§ß‰∏çÂèØÊéßÂõ†Á¥†ÔºåÂèØËÉΩÂ∏¶Êù•ËæπÁºò‰∏öÂä°ËøêË°åÁöÑ‰∏çÁ®≥ÂÆöÂõ†Á¥†ÔºåËøôÊòØ‰∫ëÂéüÁîüÂíåËæπÁºòËÆ°ÁÆóËûçÂêàÁöÑ‰∏ªË¶ÅÈöæÁÇπ‰πã‰∏Ä„ÄÇ</p><p>Ëß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢òÔºåÈúÄË¶Å‰ΩøËæπÁºò‰æßÂÖ∑ÊúâËá™Ê≤ªËÉΩÂäõÔºåÂç≥ÂΩì‰∫ëËæπÁΩëÁªúÊñ≠ÂºÄÊàñËÄÖËøûÊé•‰∏çÁ®≥ÂÆöÊó∂ÔºåÁ°Æ‰øùËæπÁºò‰∏öÂä°ÂèØ‰ª•ÊåÅÁª≠ËøêË°å„ÄÇÂú® OpenYurt ‰∏≠ÔºåËØ•ËÉΩÂäõÁî± yurt-controller-manager Âíå YurtHub ÁªÑ‰ª∂Êèê‰æõ„ÄÇ</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="1yurthubÊû∂ÊûÑ">1ÔºâYurthubÊû∂ÊûÑ<a aria-hidden="true" class="hash-link" href="#1yurthubÊû∂ÊûÑ" title="Direct link to heading">‚Äã</a></h3><p>Âú®‰πãÂâçÁöÑÊñáÁ´†‰∏≠ÔºåÊàë‰ª¨ËØ¶ÁªÜ‰ªãÁªç‰∫ÜYurtHub ÁªÑ‰ª∂ÁöÑËÉΩÂäõ„ÄÇÂÖ∂Êû∂ÊûÑÂõæÂ¶Ç‰∏ãÔºö</p><p><img alt="image" src="/assets/images/yurthub-40267e14a620859d35d3085eb5de2d24.png">
YurtHubÊòØ‰∏Ä‰∏™Â∏¶ÊúâÊï∞ÊçÆÁºìÂ≠òÂäüËÉΩÁöÑ‚ÄúÈÄèÊòéÁΩëÂÖ≥‚ÄùÔºåÂíå‰∫ëÁ´ØÁΩëÁªúÊñ≠ËøûÁä∂ÊÄÅ‰∏ãÔºåÂ¶ÇÊûúËäÇÁÇπÊàñËÄÖÁªÑ‰ª∂ÈáçÂêØÔºåÂêÑ‰∏™ÁªÑ‰ª∂Ôºàkubelet/kube-proxy Á≠â)Â∞Ü‰ªé YurtHub ‰∏≠Ëé∑ÂèñÂà∞‰∏öÂä°ÂÆπÂô®Áõ∏ÂÖ≥Êï∞ÊçÆÔºåÊúâÊïàËß£ÂÜ≥ËæπÁºòËá™Ê≤ªÁöÑÈóÆÈ¢ò„ÄÇËøô‰πüÊÑèÂë≥ÁùÄÊàë‰ª¨ÈúÄË¶ÅÂÆûÁé∞‰∏Ä‰∏™ËΩªÈáèÁöÑÂ∏¶Êï∞ÊçÆÁºìÂ≠òËÉΩÂäõÁöÑÂèçÂêë‰ª£ÁêÜ„ÄÇ</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="2Á¨¨‰∏ÄÊÉ≥Ê≥ï">2ÔºâÁ¨¨‰∏ÄÊÉ≥Ê≥ï<a aria-hidden="true" class="hash-link" href="#2Á¨¨‰∏ÄÊÉ≥Ê≥ï" title="Direct link to heading">‚Äã</a></h3><p>ÂÆûÁé∞‰∏Ä‰∏™ÁºìÂ≠òÊï∞ÊçÆÁöÑÂèçÂêë‰ª£ÁêÜÔºåÁ¨¨‰∏ÄÊÉ≥Ê≥ïÂ∞±ÊòØ‰ªé response.Body ‰∏≠ËØªÂèñÊï∞ÊçÆÔºåÁÑ∂ÂêéÂàÜÂà´ËøîÂõûÁªôËØ∑Ê±Ç client ÂíåÊú¨Âú∞ÁöÑ Cache Ê®°Âùó„ÄÇ‰º™‰ª£Á†ÅÂ¶Ç‰∏ã:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">func HandleResponse(rw http.ResponseWriter, resp *http.Response) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        bodyBytes, _ := ioutil.ReadAll(resp.Body)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        go func() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                // cache response on local disk</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                cacher.Write(bodyBytes)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // client reads data from response</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        rw.Write(bodyBytes)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ÂΩìÊ∑±ÂÖ•ÊÄùËÄÉÂêéÔºåÂú® Kubernetes Á≥ªÁªü‰∏≠Ôºå‰∏äËø∞ÂÆûÁé∞‰ºöÂºïÂèë‰∏ãÈù¢ÁöÑÈóÆÈ¢òÔºö</p><ul><li><p>ÈóÆÈ¢ò 1ÔºöÊµÅÂºèÊï∞ÊçÆÈúÄË¶ÅÂ¶Ç‰ΩïÂ§ÑÁêÜ(Â¶Ç: K8s ‰∏≠ÁöÑ watch ËØ∑Ê±Ç)ÔºåÊÑèÂë≥ ioutil.ReadAll() ‰∏ÄÊ¨°Ë∞ÉÁî®Êó†Ê≥ïËøîÂõûÊâÄÊúâÊï∞ÊçÆ„ÄÇÂç≥Â¶Ç‰ΩïÂèØ‰ª•ËøîÂõûÊµÅÊï∞ÊçÆÂêåÊó∂ÂèàÁºìÂ≠òÊµÅÊï∞ÊçÆ„ÄÇ</p></li><li><p>ÈóÆÈ¢ò 2ÔºöÂêåÊó∂Âú®Êú¨Âú∞ÁºìÂ≠òÊï∞ÊçÆÂâçÔºåÊúâÂèØËÉΩÈúÄË¶ÅÂØπ‰º†ÂÖ•ÁöÑ byte slice Êï∞ÊçÆÂÖàËøõË°åÊ∏ÖÊ¥óÂ§ÑÁêÜ„ÄÇËøôÊÑèÂë≥ÁùÄÈúÄË¶Å‰øÆÊîπ byte sliceÔºåÊàñËÄÖÂÖàÂ§á‰ªΩ byte slice ÂÜçÂ§ÑÁêÜ„ÄÇËøôÊ†∑‰ºöÈÄ†ÊàêÂÜÖÂ≠òÁöÑÂ§ßÈáèÊ∂àËÄóÔºåÂêåÊó∂ÈíàÂØπÊµÅÂºèÊï∞ÊçÆÔºåÂà∞Â∫ïÁî≥ËØ∑Â§öÂ§ßÁöÑ slice ‰πü‰∏çÂ•ΩÂ§ÑÁêÜ„ÄÇ</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="3-‰ºòÈõÖÂÆûÁé∞Êé¢ËÆ®">3) ‰ºòÈõÖÂÆûÁé∞Êé¢ËÆ®<a aria-hidden="true" class="hash-link" href="#3-‰ºòÈõÖÂÆûÁé∞Êé¢ËÆ®" title="Direct link to heading">‚Äã</a></h3><p>ÈíàÂØπ‰∏äÈù¢ÁöÑÈóÆÈ¢òÔºåÊàë‰ª¨Â∞ÜÈóÆÈ¢òÈÄê‰∏™ÊäΩË±°ÔºåÂèØ‰ª•ÂèëÁé∞Êõ¥‰ºòÈõÖÁöÑÂÆûÁé∞ÊñπÊ≥ï„ÄÇ</p><ul><li>ÈóÆÈ¢ò 1ÔºöÂ¶Ç‰ΩïÂØπÊµÅÊï∞ÊçÆÂêåÊó∂ËøõË°åËØªÂÜô</li></ul><p>ÈíàÂØπÊµÅÂºèÊï∞ÊçÆÁöÑËØªÂÜô(‰∏ÄËæπËøîÂõû‰∏ÄËæπÁºìÂ≠ò)ÔºåÂ¶Ç‰∏ãÂõæÊâÄÁ§∫ÔºåÂÖ∂ÂÆûÈúÄË¶ÅÁöÑ‰∏çËøáÊòØÊää response.Body(io.Reader) ËΩ¨Êç¢Êàê‰∏Ä‰∏™ io.Reader Âíå‰∏Ä‰∏™ io.Writer„ÄÇÊàñËÄÖËØ¥ÊòØ‰∏Ä‰∏™ io.Reader Âíå io.Writer ÂêàÊàê‰∏Ä‰∏™ io.Reader„ÄÇËøôÂæàÂÆπÊòìÂ∞±ËÅîÊÉ≥Âà∞ Linux ÈáåÈù¢ÁöÑ Tee ÂëΩ‰ª§„ÄÇ</p><p><img alt="image" src="/assets/images/responsebody_write-624eba73126f446b3e854e546b75d539.png"></p><p>ËÄåÂú® Golang ‰∏≠ Tee ÂëΩ‰ª§ÊòØÂÆûÁé∞Â∞±ÊòØ io.TeeReaderÔºåÈÇ£ÈóÆÈ¢ò 1 ÁöÑ‰º™‰ª£Á†ÅÂ¶Ç‰∏ã:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">func HandleResponse(rw http.ResponseWriter, resp *http.Response) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // create TeeReader with response.Body and cacher</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        newRespBody := io.TeeReader(resp.Body, cacher)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // client reads data from response</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        io.Copy(rw, newRespBody)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ÈÄöËøá TeeReader ÁöÑÂØπ Response.Body Âíå Cacher ÁöÑÊï¥ÂêàÔºåÂΩìËØ∑Ê±Ç client Á´Ø‰ªé response.Body ‰∏≠ËØªÂèñÊï∞ÊçÆÊó∂ÔºåÂ∞ÜÂêåÊó∂Âêë Cache ‰∏≠ÂÜôÂÖ•ËøîÂõûÊï∞ÊçÆÔºå‰ºòÈõÖÁöÑËß£ÂÜ≥‰∫ÜÊµÅÂºèÊï∞ÊçÆÁöÑÂ§ÑÁêÜ„ÄÇ</p><ul><li>ÈóÆÈ¢ò 2ÔºöÂ¶Ç‰ΩïÂú®ÁºìÂ≠òÂâçÂÖàÊ∏ÖÊ¥óÊµÅÊï∞ÊçÆ</li></ul><p>Â¶Ç‰∏ãÂõæÊâÄÁ§∫ÔºåÁºìÂ≠òÂâçÂÖàÊ∏ÖÊ¥óÊµÅÊï∞ÊçÆÔºåËØ∑Ê±ÇÁ´ØÂíåËøáÊª§Á´ØÈúÄË¶ÅÂêåÊó∂ËØªÂèñ response.BodyÔºà2 Ê¨°ËØªÂèñÈóÆÈ¢òÔºâ„ÄÇ‰πüÂ∞±ÊòØÈúÄË¶ÅÂ∞Ü response.Body(io.Reader) ËΩ¨Êç¢Êàê‰∏§‰∏™ io.Reader„ÄÇ</p><p><img alt="image" src="data:image/png;base64,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"></p><p>‰πüÊÑèÂë≥ÁùÄÈóÆÈ¢ò 2 ËΩ¨ÂåñÊàêÔºöÈóÆÈ¢ò 1 ‰∏≠ÁºìÂ≠òÁ´ØÁöÑ io.Writer ËΩ¨Êç¢Êàê Data Filter ÁöÑ io.Reader„ÄÇÂÖ∂ÂÆûÂú® Linux ÂëΩ‰ª§‰∏≠‰πüËÉΩÊâæÂà∞Á±ª‰ººÂëΩ‰ª§ÔºåÂ∞±ÊòØÁÆ°ÈÅì„ÄÇÂõ†Ê≠§ÈóÆÈ¢ò 2 ÁöÑ‰º™‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">func HandleResponse(rw http.ResponseWriter, resp *http.Response) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pr, pw := io.Pipe()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // create TeeReader with response.Body and Pipe writer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        newRespBody := io.TeeReader(resp.Body, pw)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        go func() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                // filter reads data from response </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                io.Copy(dataFilter, pr)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // client reads data from response</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        io.Copy(rw, newRespBody)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ÈÄöËøá io.TeeReader Âíå io.PiPeÔºåÂΩìËØ∑Ê±Ç client Á´Ø‰ªé response.Body ‰∏≠ËØªÂèñÊï∞ÊçÆÊó∂ÔºåFilter Â∞ÜÂêåÊó∂‰ªé Response ËØªÂèñÂà∞Êï∞ÊçÆÔºå‰ºòÈõÖÁöÑËß£ÂÜ≥‰∫ÜÊµÅÂºèÊï∞ÊçÆÁöÑ 2 Ê¨°ËØªÂèñÈóÆÈ¢ò„ÄÇ</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="yurthubÂÆûÁé∞">YurtHubÂÆûÁé∞<a aria-hidden="true" class="hash-link" href="#yurthubÂÆûÁé∞" title="Direct link to heading">‚Äã</a></h2><p>ÊúÄÂêéÁúã‰∏Ä‰∏ã YurtHub ‰∏≠Áõ∏ÂÖ≥ÂÆûÁé∞ÔºåÁî±‰∫é Response.Body ‰∏∫ io.ReadCloserÔºåÊâÄ‰ª•ÂÆûÁé∞‰∫Ü dualReadCloser„ÄÇÂêåÊó∂ YurtHub ÂèØËÉΩ‰πüÈù¢‰∏¥ÂØπ http.Request ÁöÑÁºìÂ≠òÔºåÊâÄ‰ª•Â¢ûÂä†‰∫Ü isRespBody ÂèÇÊï∞Áî®‰∫éÂà§ÂÆöÊòØÂê¶ÈúÄË¶ÅË¥üË¥£ÂÖ≥Èó≠ response.Body„ÄÇ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">// https://github.com/openyurtio/openyurt/blob/master/pkg/yurthub/util/util.go#L156</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// NewDualReadCloser create an dualReadCloser object</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">func NewDualReadCloser(rc io.ReadCloser, isRespBody bool) (io.ReadCloser, io.ReadCloser) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pr, pw := io.Pipe()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    dr := &amp;dualReadCloser{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        rc:         rc,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pw:         pw,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        isRespBody: isRespBody,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return dr, pr</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">type dualReadCloser struct {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    rc io.ReadCloser</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pw *io.PipeWriter</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // isRespBody shows rc(is.ReadCloser) is a response.Body</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // or not(maybe a request.Body). if it is true(it&#x27;s a response.Body),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // we should close the response body in Close func, else not,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // it(request body) will be closed by http request caller</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    isRespBody bool</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Read read data into p and write into pipe</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">func (dr *dualReadCloser) Read(p []byte) (n int, err error) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    n, err = dr.rc.Read(p)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if n &gt; 0 {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if n, err := dr.pw.Write(p[:n]); err != nil {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            klog.Errorf(&quot;dualReader: failed to write %v&quot;, err)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            return n, err</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Close close two readers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">func (dr *dualReadCloser) Close() error {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    errs := make([]error, 0)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if dr.isRespBody {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if err := dr.rc.Close(); err != nil {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            errs = append(errs, err)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if err := dr.pw.Close(); err != nil {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        errs = append(errs, err)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if len(errs) != 0 {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return fmt.Errorf(&quot;failed to close dualReader, %v&quot;, errs)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return nil</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Âú®‰ΩøÁî® dualReadCloser Êó∂ÔºåÂèØ‰ª•Âú® httputil.NewSingleHostReverseProxy ÁöÑ modifyResponse() ÊñπÊ≥ï‰∏≠ÁúãÂà∞„ÄÇ‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">// https://github.com/openyurtio/openyurt/blob/master/pkg/yurthub/proxy/remote/remote.go#L85</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">func (rp *RemoteProxy) modifyResponse(resp *http.Response) error {rambohe-ch, 10 months ago: ‚Ä¢ hello openyurt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            // ÁúÅÁï•ÈÉ®ÂàÜÂâçÁΩÆÊ£ÄÊü•                                                          </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            rc, prc := util.NewDualReadCloser(resp.Body, true)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            go func(ctx context.Context, prc io.ReadCloser, stopCh &lt;-chan struct{}) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                err := rp.cacheMgr.CacheResponse(ctx, prc, stopCh)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                if err != nil &amp;&amp; err != io.EOF &amp;&amp; err != context.Canceled {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    klog.Errorf(&quot;%s response cache ended with error, %v&quot;, util.ReqString(req), err)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }(ctx, prc, rp.stopCh)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            resp.Body = rc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="ÊÄªÁªì">ÊÄªÁªì<a aria-hidden="true" class="hash-link" href="#ÊÄªÁªì" title="Direct link to heading">‚Äã</a></h2><p>OpenYurt ‰∫é 2020 Âπ¥ 9 ÊúàËøõÂÖ• CNCF Ê≤ôÁÆ±ÂêéÔºåÊåÅÁª≠‰øùÊåÅ‰∫ÜÂø´ÈÄüÂèëÂ±ïÂíåËø≠‰ª£ÔºåÂú®Á§æÂå∫ÂêåÂ≠¶‰∏ÄËµ∑Âä™Âäõ‰∏ãÔºåÁõÆÂâçÂ∑≤ÁªèÂºÄÊ∫êÁöÑËÉΩÂäõÊúâÔºö</p><ul><li>ËæπÁºòËá™Ê≤ª</li><li>ËæπÁºòÂçïÂÖÉÂåñÁÆ°ÁêÜ</li><li>‰∫ëËæπÂçèÂêåËøêÁª¥</li><li>‰∏ÄÈîÆÂºèÊó†ÁºùËΩ¨Êç¢ËÉΩÂäõ</li></ul><p><a href="https://mp.weixin.qq.com/s/vdFrCDiIhPLVbOnf6vRxEw" target="_blank" rel="noopener noreferrer">ÂéüÊñáÈìæÊé•</a></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/blog/tags/yurthub">yurthub</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_d4p0" itemprop="headline"><a itemprop="url" href="/blog/Play-with-OpenYurt-on-Raspberry-Pi">Getting Started with OpenYurt:play with OpenYurt on Raspberry Pi</a></h2><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2021-01-05T00:00:00.000Z" itemprop="datePublished">January 5, 2021</time> ¬∑ <!-- -->18 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://github.com/zyjhtangtang" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://github.com/zyjhtangtang.png" alt="zyjhtangtang"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/zyjhtangtang" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">zyjhtangtang</span></a></div><small class="avatar__subtitle" itemprop="description">Member of OpenYurt</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><img alt="image" src="/assets/images/Raspberry_Pi-0d62d9c9627727b87279383f61ae8222.png"></p><p>ÈöèÁùÄËæπÁºòËÆ°ÁÆóÁöÑÂø´ÈÄüÂèëÂ±ïÔºåË∂äÊù•Ë∂äÂ§öÁöÑÊï∞ÊçÆÈúÄË¶ÅÂà∞ÁΩëÁªúÁöÑËæπÁºò‰æßËøõË°åÂ≠òÂÇ®„ÄÅÂ§ÑÁêÜÂíåÂàÜÊûêÔºåËæπÁºòÁöÑËÆæÂ§áÂíåÂ∫îÁî®ÂëàÁàÜÂèëÂºèÂ¢ûÈïø„ÄÇÂ¶Ç‰ΩïÈ´òÊïàÁöÑÁÆ°ÁêÜËæπÁºò‰æßÁöÑËµÑÊ∫êÂíåÂ∫îÁî®ÊòØ‰∏öÁïåÈù¢‰∏¥ÁöÑ‰∏Ä‰∏™‰∏ªË¶ÅÈóÆÈ¢ò„ÄÇÂΩìÂâçÔºåÈááÁî®‰∫ëÂéüÁîüÁöÑÊñπÊ≥ïÔºåÂ∞Ü‰∫ëËÆ°ÁÆóÁöÑËÉΩÂäõ‰∏ãÊ≤âÂà∞ËæπÁºòÂπ∂Âú®‰∫ëÁ´ØÂÅöÁªü‰∏ÄË∞ÉÂ∫¶„ÄÅÁÆ°ÊéßÁöÑ‰∫ëËæπÁ´Ø‰∏Ä‰ΩìÂåñÊû∂ÊûÑÂæóÂà∞‰∫Ü‰∏öÁïåÁöÑÂπøÊ≥õËÆ§ÂèØ„ÄÇ</p><p>2020 Âπ¥ 5 ÊúàÔºåÈòøÈáåÂ∑¥Â∑¥ÂºÄÊ∫êÈ¶ñ‰∏™ Kubernetes Êó†‰æµÂÖ•ÁöÑËæπÁºòËÆ°ÁÆó‰∫ëÂéüÁîüÈ°πÁõÆ OpenYurtÔºåÂπ∂‰∫éÂêåÂπ¥ 9 Êúà‰ªΩËøõÂÖ• CNCF SandBox„ÄÇOpenYurt ÈíàÂØπËæπÁºòÂú∫ÊôØ‰∏≠ÁΩëÁªú‰∏çÁ®≥ÂÆö„ÄÅ‰∫ëËæπËøêÁª¥Âõ∞ÈöæÁ≠âÈóÆÈ¢òÔºåÂØπÂéüÁîü Kubernetes Êó†‰æµÂÖ•Âú∞Â¢ûÂº∫ÔºåÈáçÁÇπÊèê‰æõ‰∫ÜËæπÁºòËäÇÁÇπËá™Ê≤ª„ÄÅ‰∫ëËæπËøêÁª¥ÈÄöÈÅì„ÄÅËæπÁºòÂçïÂÖÉÂåñÁöÑËÉΩÂäõ„ÄÇ</p><p>Â¶ÇÂõæ‰∏ãÊâÄÁ§∫Ôºå
<img alt="image" src="/assets/images/kubernetes-324e5f10b1e66083e02453040890714b.png"></p><p>Êú¨ÊñáÈÄöËøáÂú®‰∫ëÁ´ØÈÉ®ÁΩ≤ Kubernetes ÈõÜÁæ§ÁöÑÊéßÂà∂Èù¢ÔºåÂπ∂Â∞ÜÊ†ëËéìÊ¥æÊé•ÂÖ•ÈõÜÁæ§Êù•Êê≠Âª∫‰∫ëÁÆ°ËæπÂú∫ÊôØ„ÄÇÂü∫‰∫éËøô‰∏™ÁéØÂ¢ÉÊºîÁ§∫ OpenYurt ÁöÑÊ†∏ÂøÉËÉΩÂäõÔºåÂ∏¶Â§ßÂÆ∂Âø´ÈÄü‰∏äÊâã OpenYurt„ÄÇ</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="ÁéØÂ¢ÉÂáÜÂ§á">ÁéØÂ¢ÉÂáÜÂ§á<a aria-hidden="true" class="hash-link" href="#ÁéØÂ¢ÉÂáÜÂ§á" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="1Âü∫Á°ÄÁéØÂ¢É‰ªãÁªç">1ÔºâÂü∫Á°ÄÁéØÂ¢É‰ªãÁªç<a aria-hidden="true" class="hash-link" href="#1Âü∫Á°ÄÁéØÂ¢É‰ªãÁªç" title="Direct link to heading">‚Äã</a></h3><p>Âú®‰∫ëÁ´ØÔºåË¥≠‰π∞ ENS ËäÇÁÇπÔºàENS ËäÇÁÇπÂÖ∑ÊúâÂÖ¨ÁΩë IPÔºåÊñπ‰æøÈÄöËøáÂÖ¨ÁΩëÂØπÂ§ñÊö¥Èú≤ÊúçÂä°ÔºâÊù•ÈÉ®ÁΩ≤ÂéüÁîü K8s ÈõÜÁæ§ÁöÑÁÆ°ÊéßÁªÑ‰ª∂„ÄÇÂÖ∂‰∏≠Á≥ªÁªüÈááÁî® ubuntu18.04„ÄÅhostname ‰∏∫ master-node„ÄÅdocker ÁâàÊú¨‰∏∫ 19.03.5„ÄÇ</p><p>Âú®ËæπÁºòÔºåÂ∞ÜÊ†ëËéìÊ¥æ 4 ‰∏éÊú¨Âú∞ÁöÑË∑ØÁî±Âô®ËøûÊé•ÔºåÁªÑÊàêËæπÁºòÁßÅÁΩëÁéØÂ¢ÉÔºåË∑ØÁî±Âô®ÈÄöËøá 4G ÁΩëÂç°ËÆøÈóÆ‰∫íËÅîÁΩë„ÄÇÂÖ∂‰∏≠Ê†ëËéìÊ¥æ 4 È¢ÑË£ÖÁ≥ªÁªü‰∏∫ ubuntu18.04„ÄÅhostname‰∏∫ edge-node„ÄÅdocker ÁâàÊú¨‰∏∫ 19.03.5„ÄÇ
<img alt="image" src="/assets/images/edge_raspberry_pi-8b6984239d5bceffe23207955be08dfa.png"></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="2ÂéüÁîük8sÈõÜÁæ§Êê≠Âª∫">2)ÂéüÁîüK8sÈõÜÁæ§Êê≠Âª∫<a aria-hidden="true" class="hash-link" href="#2ÂéüÁîük8sÈõÜÁæ§Êê≠Âª∫" title="Direct link to heading">‚Äã</a></h3><p>Êú¨ÊñáÊºîÁ§∫ÁéØÂ¢ÉÂü∫‰∫éÁ§æÂå∫1.16.6ÁâàÊú¨ÁöÑK8sÈõÜÁæ§ÔºåÂπ∂ÈááÁî®Á§æÂå∫Êèê‰æõÁöÑkubeadmÂ∑•ÂÖ∑Êù•Êê≠Âª∫ÈõÜÁæ§ÔºåÂÖ∑‰ΩìÊìç‰ΩúÂ¶Ç‰∏ãÔºö</p><ul><li>Âú®‰∫ëÁ´ØËäÇÁÇπÂíåÊ†ëËéìÊ¥æ‰∏äÂàÜÂà´ÊâßË°åÂ¶Ç‰∏ãÂëΩ‰ª§ÂÆâË£Ö Kubernetes ÁªÑ‰ª∂„ÄÇ</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">curl -s https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | sudo apt-key add -</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">echo &quot;deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main&quot; &gt; /etc/apt/sources.list.d/kubernetes.list</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo apt-get update</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo apt install -y kubelet=1.16.6-00 kubeadm=1.16.6-00 kubectl=1.16.6-00</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>‰ΩøÁî®kubeadm ÂàùÂßãÂåñ‰∫ëÁ´ØËäÇÁÇπÔºàÂú®‰∫ëÁ´ØËäÇÁÇπ‰∏äÊâßË°åÂ¶Ç‰∏ãÂëΩ‰ª§ÔºâÔºåÈÉ®ÁΩ≤ËøáÁ®ã‰∏≠ÈááÁî®ÈòøÈáå‰∫ëÁöÑÈïúÂÉè‰ªìÂ∫ìÔºå‰∏∫‰∫ÜÊîØÊåÅÊ†ëËéìÊ¥æÁöÑÊé•ÂÖ•ÔºåËØ•‰ªìÂ∫ìÁöÑÈïúÂÉèÂÅö‰∫Ü manifest ÂàóË°®ÔºåËÉΩÂ§üÊîØÊåÅ amd64/arm64 ‰∏§Áßç‰∏çÂêåÁöÑ CPU Êû∂ÊûÑ„ÄÇ</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># master-node</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubeadm init --image-repository=registry.cn-hangzhou.aliyuncs.com/edge-kubernetes --kubernetes-version=v1.16.6 --pod-network-cidr=10.244.0.0/16</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>‰æùÊçÆÂàùÂßãÂåñÂÆåÊàê‰πãÂêéÁöÑÊèêÁ§∫ÔºåÊã∑Ë¥ù config Êñá‰ª∂Âà∞ $HOME/.kube ‰∏≠Ôºö</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mkdir -p $HOME/.kube</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>Ê†ëËéìÊ¥æÊé•ÂÖ•‰∫ëÁ´ØÈõÜÁæ§‰æùÊçÆÁ¨¨‰∫åÊ≠•‰∏≠ÂàùÂßãÂåñÂÆåÊàê‰ª•ÂêéËæìÂá∫ÁöÑËäÇÁÇπÊé•ÂÖ•‰ø°ÊÅØÔºåÂú®Ê†ëËéìÊ¥æ‰∏äÊâßË°åÊé•ÂÖ•ÂëΩ‰ª§„ÄÇ</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubeadm join 183.195.233.42:6443 --token XXXX \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> --discovery-token-ca-cert-hash XXXX</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>Ê∑ªÂä† cni ÈÖçÁΩÆÔºà‰∫ëÁ´ØÁÆ°ÊéßËäÇÁÇπÂíåÊ†ëËéìÊ¥æÈÉΩÈúÄË¶ÅÈÖçÁΩÆÔºâÔºåÊú¨ÊñáÊê≠Âª∫ÁöÑÈõÜÁæ§‰ΩøÁî®‰∏ªÊú∫ÁΩëÁªú„ÄÇÂàõÂª∫ cni ÈÖçÁΩÆÊñá‰ª∂ /etc/cni/net.d/0-loopback.confÔºåÂπ∂Â∞ÜÂ¶Ç‰∏ãÂÜÖÂÆπÊã∑Ë¥ùÂà∞ËØ•Êñá‰ª∂‰∏≠„ÄÇ</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> &quot;cniVersion&quot;: &quot;0.3.0&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> &quot;name&quot;: &quot;lo&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> &quot;type&quot;: &quot;loopback&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>Âú® master ËäÇÁÇπ‰∏äÊü•ÁúãÈÉ®ÁΩ≤ÊïàÊûú„ÄÇ</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME STATUS ROLES AGE VERSION INTERNAL-IP EXTERNAL-IP OS-IMAGE KERNEL-VERSION CONTAINER-RUNTIME</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">edge-node Ready &lt;none&gt;   74s    v1.16.6   192.168.0.100    &lt;none&gt;        Ubuntu 18.04.4 LTS   4.19.105-v8-28      docker://19.3.5</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">master-node   Ready    master   2m5s   v1.16.6   183.195.233.42   &lt;none&gt;        Ubuntu 18.04.2 LTS   4.15.0-52-generic   docker://19.3.5</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>Âà†Èô§ CoreDNSÔºàÊú¨Êñá Demo ‰∏≠ CoreDNS ‰∏çÈúÄË¶Å‰ΩøÁî®ÔºâÔºåÂπ∂Â∞Ü master ËäÇÁÇπÁöÑ taints ÂéªÊéâÔºàÊñπ‰æøÂêéÁª≠ÈÉ®ÁΩ≤ OpenYurt ÁªÑ‰ª∂Ôºâ„ÄÇ</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl delete deployment coredns -n kube-system</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl taint node master-node node-role.kubernetes.io/master-</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="ÂéüÁîü-k8s-ÈõÜÁæ§Âú®ËæπÁºòÂú∫ÊôØ‰∏≠ÁöÑÈóÆÈ¢ò">ÂéüÁîü K8s ÈõÜÁæ§Âú®ËæπÁºòÂú∫ÊôØ‰∏≠ÁöÑÈóÆÈ¢ò<a aria-hidden="true" class="hash-link" href="#ÂéüÁîü-k8s-ÈõÜÁæ§Âú®ËæπÁºòÂú∫ÊôØ‰∏≠ÁöÑÈóÆÈ¢ò" title="Direct link to heading">‚Äã</a></h2><p>Âü∫‰∫é‰∏äËø∞ÁéØÂ¢ÉÔºåÊàë‰ª¨Êù•ÊµãËØï‰∏Ä‰∏ãÂéüÁîü K8s Âú®‰∫ëÁÆ°ËæπÊû∂ÊûÑ‰∏≠ÂØπ‰∫ëËæπËøêÁª¥ÁöÑÊîØÊåÅÂíåÂØπ‰∫ëËæπÁΩëÁªúÊñ≠ÂºÄÊó∂ÁöÑÂèçÂ∫î„ÄÇÈ¶ñÂÖàÔºåÊàë‰ª¨‰ªé‰∫ëÁ´ØÈÉ®ÁΩ≤‰∏Ä‰∏™ÊµãËØïÂ∫îÁî® nginxÔºåÂú® master ËäÇÁÇπ‰∏äÊâßË°å kubectl apply -f nginx.yamlÔºåÂÖ∑‰ΩìÁöÑÈÉ®ÁΩ≤ yaml Â¶Ç‰∏ã„ÄÇ</p><p>Ê≥®ÊÑèÔºönodeSelector ÈÄâÊã© edge-node ËäÇÁÇπÔºå‰∏ªÊú∫ÁΩëÁªúÈÖçÁΩÆ‰∏∫ trueÔºåÂπ∂ÈÖçÁΩÆ pod ÁöÑÂÆπÂøçÊó∂Èó¥‰∏∫ 5sÔºàÈªòËÆ§ 5min, Ê≠§Â§ÑÈÖçÁΩÆ‰æø‰∫éÊºîÁ§∫ pod È©±ÈÄêÔºâ„ÄÇ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kind: Pod</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> name: nginx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> tolerations:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> - key: &quot;node.kubernetes.io/unreachable&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> operator: &quot;Exists&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> effect: &quot;NoExecute&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> tolerationSeconds: 5</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> - key: &quot;node.kubernetes.io/not-ready&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> operator: &quot;Exists&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> effect: &quot;NoExecute&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> tolerationSeconds: 5</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> nodeSelector:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> kubernetes.io/hostname: edge-node</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> containers:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> - name: nginx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> image: nginx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> hostNetwork: true</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Êü•ÁúãÈÉ®ÁΩ≤ÁªìÊûúÔºö</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl get pods -owide</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">nginx 1/1 Running 0 11s 192.168.0.100 edge-node &lt;none&gt; </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="1ÊµãËØïÂ∏∏Áî®ÁöÑÈõÜÁæ§ËøêÁª¥Êåá‰ª§ÂåÖÊã¨-logsexecport-forward">1ÔºâÊµãËØïÂ∏∏Áî®ÁöÑÈõÜÁæ§ËøêÁª¥Êåá‰ª§ÔºåÂåÖÊã¨ logs„ÄÅexec„ÄÅport-forward<a aria-hidden="true" class="hash-link" href="#1ÊµãËØïÂ∏∏Áî®ÁöÑÈõÜÁæ§ËøêÁª¥Êåá‰ª§ÂåÖÊã¨-logsexecport-forward" title="Direct link to heading">‚Äã</a></h3><p>Âú® master ËäÇÁÇπ‰∏äËøêÁª¥ËæπÁºòËäÇÁÇπÂ∫îÁî®ÔºåÊâßË°å logs/exec/port-forward Á≠âÊåá‰ª§ÔºåÊü•ÁúãÁªìÊûú„ÄÇ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl logs nginx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Error from server: Get https://192.168.0.100:10250/containerLogs/default/nginx/nginx: dial tcp 192.168.0.100:10250: connect: connection refused</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl exec -it nginx sh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl exec [POD] -- [COMMAND] instead.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Error from server: error dialing backend: dial tcp 192.168.0.100:10250: connect: connection refused</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl port-forward pod/nginx 8888:80</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">error: error upgrading connection: error dialing backend: dial tcp 192.168.0.100:10250: connect: connection refused</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>‰ªéÊâßË°åÁªìÊûúÁúãÔºåÂéüÁîüÁöÑk8sÂú®‰∫ëÁÆ°ËæπÁöÑÂú∫ÊôØ‰∏≠ÔºåÊó†Ê≥ïÊèê‰æõ‰ªé‰∫ëÁ´ØËøêÁª¥ËæπÁºòÂ∫îÁî®ÁöÑËÉΩÂäõ„ÄÇËøôÊòØÂõ†‰∏∫ËæπÁºòËäÇÁÇπÈÉ®ÁΩ≤Âú®Áî®Êà∑ÁöÑÁßÅÁΩëÁéØÂ¢ÉÔºå‰ªé‰∫ëÁ´ØÊó†Ê≥ïÈÄöËøáËæπÁºòËäÇÁÇπÁöÑ IP Âú∞ÂùÄÁõ¥Êé•ËÆøÈóÆËæπÁºòËäÇÁÇπ„ÄÇ</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="2ÊµãËØïËæπÁºòÊñ≠ÁΩëÊó∂ÂØπ‰∏öÂä°ÁöÑÂΩ±Âìç">2ÔºâÊµãËØïËæπÁºòÊñ≠ÁΩëÊó∂ÂØπ‰∏öÂä°ÁöÑÂΩ±Âìç<a aria-hidden="true" class="hash-link" href="#2ÊµãËØïËæπÁºòÊñ≠ÁΩëÊó∂ÂØπ‰∏öÂä°ÁöÑÂΩ±Âìç" title="Direct link to heading">‚Äã</a></h3><p>ËæπÁºòËäÇÁÇπ‰∏é‰∫ëÁ´ØÁÆ°ÊéßÈÄöËøáÂÖ¨ÁΩëËøûÊé•ÔºåÁªèÂ∏∏‰ºöÂá∫Áé∞ÁΩëÁªú‰∏çÁ®≥ÂÆöÔºå‰∫ëÁ´ØÊñ≠ËøûÁöÑÊÉÖÂÜµ„ÄÇËøôÈáåÊàë‰ª¨Â∞ÜÂÅö‰∏§‰∏™Êñ≠ÁΩëÁõ∏ÂÖ≥ÁöÑÊµãËØïÔºö</p><ul><li><p>Êñ≠ÁΩë 1 ÂàÜÈíü-&gt;ÊÅ¢Â§çÁΩëÁªú</p></li><li><p>Êñ≠ÁΩë 1 ÂàÜÈíü-&gt;ÈáçÂêØËæπÁºòËäÇÁÇπ-&gt;ÊÅ¢Â§çÁΩëÁªú</p></li></ul><p>ËßÇÂØü‰∏§‰∏™ÊµãËØïËøáÁ®ã‰∏≠ËäÇÁÇπÂíå Pod ÁöÑÁä∂ÊÄÅÂèòÂåñ„ÄÇÊú¨Êñá Demo ‰∏≠ÁöÑÊñ≠ÁΩëÊñπÂºèÊòØÂ∞ÜË∑ØÁî±Âô®ÁöÑÂÖ¨ÁΩëËøûÊé•Êñ≠ÂºÄ„ÄÇ</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="1Êñ≠ÁΩë1ÂàÜÈíü-ÊÅ¢Â§çÁΩëÁªú">1.Êñ≠ÁΩë1ÂàÜÈíü-&gt;ÊÅ¢Â§çÁΩëÁªú<a aria-hidden="true" class="hash-link" href="#1Êñ≠ÁΩë1ÂàÜÈíü-ÊÅ¢Â§çÁΩëÁªú" title="Direct link to heading">‚Äã</a></h4><p>Êñ≠ÂºÄÁΩëÁªúÔºåÂ§ßÁ∫¶ 40s ÂêéÔºåËäÇÁÇπÂèòÊàê NotReadyÔºàÊ≠£Â∏∏ËäÇÁÇπ 10s Èíü‰∏äÊä•‰∏ÄÊ¨°ÂøÉË∑≥ÔºåÂΩì 4 Ê¨°Ê≤°Êúâ‰∏äÊä•ÂøÉË∑≥Êó∂ÔºåÁÆ°ÊéßÁªÑ‰ª∂ËÆ§‰∏∫ËäÇÁÇπÂºÇÂ∏∏Ôºâ„ÄÇ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl get nodes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME STATUS ROLES AGE VERSION</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">edge-node NotReady &lt;none&gt;   5m13s   v1.16.6</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">master-node   Ready      master   6m4s    v1.16.6</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ÁªßÁª≠Á≠âÂæÖ 5s ‰πãÂêéÔºàÊ≠£Â∏∏ËäÇÁÇπÂèò‰∏∫ NotReady ‰πãÂêéÔºå5m ÊâçÂºÄÂßãÈ©±ÈÄê podÔºåÊ≠§Â§Ñ‰∏∫‰∫ÜÊµãËØïÊïàÊûúÔºåÂ∞Ü pod ÁöÑÂÆπÂøçÊó∂Èó¥ÈÖçÊàê‰∫Ü 5sÔºâÔºåÂ∫îÁî® pod Ë¢´È©±ÈÄêÔºåÁä∂ÊÄÅÂèò‰∏∫ Terminating„ÄÇ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl get pods</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME READY STATUS RESTARTS AGE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">nginx 1/1 Terminating 0 3m45s</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Â∞ÜÁΩëÁªúÊÅ¢Â§çÔºåËßÇÂØüËäÇÁÇπÂèä pod ÂèòÂåñ„ÄÇ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl get pods</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">No resources found in default namespace.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ÁΩëÁªúÊÅ¢Â§çÂêéÔºåËäÇÁÇπÁä∂ÊÄÅÂèòÊàê readyÔºå‰∏öÂä° pod Ë¢´Ê∏ÖÈô§ÔºåËøôÊòØÂõ†‰∏∫ËæπÁºòËäÇÁÇπÁöÑ Kubelet Ëé∑ÂèñÂà∞‰∏öÂä° Pod ÁöÑ Terminating Áä∂ÊÄÅÔºåÂØπ‰∏öÂä° Pod ÂÅöÂà†Èô§Êìç‰ΩúÔºåÂπ∂ËøîÂõûÂà†Èô§ÊàêÂäüÔºå‰∫ëÁ´Ø‰πüÂÅö‰∫ÜÁõ∏Â∫îÁöÑÊ∏ÖÁêÜ„ÄÇËá≥Ê≠§Ôºå‰∏öÂä° Pod Áî±‰∫é‰∫ëËæπÁΩëÁªúÁöÑ‰∏çÁ®≥ÂÆöËÄåË¢´È©±ÈÄêÔºåÁÑ∂ËÄåÂú®Êñ≠ÁΩëÊúüÈó¥ÔºåËæπÁºòËäÇÁÇπÂÖ∂ÂÆûÊòØÂèØ‰ª•Ê≠£Â∏∏Â∑•‰ΩúÁöÑ„ÄÇ</p><p>ÈáçÊñ∞ÂàõÂª∫Â∫îÁî® nginxÔºåÁî®‰∫é‰∏ãÈù¢ÊµãËØï„ÄÇ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl get pods -owide</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">nginx 1/1 Running 0 4s 192.168.0.100 edge-node &lt;none&gt;           &lt;none&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="2Êñ≠ÁΩë1ÂàÜÈíü-ÈáçÂêØËæπÁºòËäÇÁÇπ-ÊÅ¢Â§çÁΩëÁªú">2.Êñ≠ÁΩë1ÂàÜÈíü-&gt;ÈáçÂêØËæπÁºòËäÇÁÇπ-&gt;ÊÅ¢Â§çÁΩëÁªú<a aria-hidden="true" class="hash-link" href="#2Êñ≠ÁΩë1ÂàÜÈíü-ÈáçÂêØËæπÁºòËäÇÁÇπ-ÊÅ¢Â§çÁΩëÁªú" title="Direct link to heading">‚Äã</a></h4><p>Êé•‰∏ãÊù•ÔºåÊàë‰ª¨ÊµãËØïÂú®Êñ≠ÁΩëÁöÑÊÉÖÂÜµ‰∏ãÔºåËæπÁºòËäÇÁÇπÁöÑÈáçÂêØÂØπ‰∏öÂä°ÁöÑÂΩ±Âìç„ÄÇÊñ≠ÁΩë 1 ÂàÜÈíü‰πãÂêéÔºåNode Âíå Pod Áä∂ÊÄÅÂêå‰∏äÈù¢ÊµãËØïÁªìÊûúÔºåNode Âèò‰∏∫ NotReadyÔºåPod ÁöÑÁä∂ÊÄÅÂèò‰∏∫ Terminating„ÄÇÊ≠§Êó∂ÔºåÂàáÊç¢Âà∞ÁßÅÊúâÁΩëÁªúÁéØÂ¢ÉÔºåÁôªÂΩïÂà∞Ê†ëËéìÊ¥æ‰∏äÔºåÂ∞ÜÊ†ëËéìÊ¥æÈáçÂêØÔºåÈáçÂêØÂÆåÊàêÂêéÁ≠âÂæÖÂ§ßÁ∫¶ 1 ÂàÜÈíüÔºåËßÇÂØüÈáçÂêØÂâçÂêéËäÇÁÇπ‰∏äÁöÑÂÆπÂô®ÂàóË°®„ÄÇ</p><p>ÈáçÂêØÂâçËæπÁºòËäÇÁÇπÂÆπÂô®ÂàóË°®ÔºàÊ≠§Êó∂‰∫ëËæπÁ´ØÂºÄÔºåËôΩÁÑ∂Âú®‰∫ëÁ´ØËé∑ÂèñÁöÑ pod ÊòØ Terminating Áä∂ÊÄÅÔºå‰ΩÜÊòØËæπÁºòÂπ∂Êú™ Watch Âà∞ Terminating ÁöÑÊìç‰ΩúÔºåÊâÄ‰ª•ËæπÁºòÁöÑÂ∫îÁî®ËøòÊ≠£Â∏∏ËøêË°åÔºâ„ÄÇ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@edge-node:~# docker ps</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">9671cbf28ca6 e86f991e5d10 &quot;/docker-entrypoint.‚Ä¶&quot; About a minute ago Up About a minute k8s_nginx_nginx_default_efdf11c6-a41c-4b95-8ac8-45e02c9e1f4d_0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">6272a46f93ef registry.cn-hangzhou.aliyuncs.com/edge-kubernetes/pause:3.1 &quot;/pause&quot; 2 minutes ago Up About a minute k8s_POD_nginx_default_efdf11c6-a41c-4b95-8ac8-45e02c9e1f4d_0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">698bb024c3db f9ea384ddb34 &quot;/usr/local/bin/kube‚Ä¶&quot; 8 minutes ago Up 8 minutes k8s_kube-proxy_kube-proxy-rjws7_kube-system_51576be4-2b6d-434d-b50b-b88e2d436fef_0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">31952700c95b registry.cn-hangzhou.aliyuncs.com/edge-kubernetes/pause:3.1 &quot;/pause&quot; 8 minutes ago Up 8 minutes k8s_POD_kube-proxy-rjws7_kube-system_51576be4-2b6d-434d-b50b-b88e2d436fef_0</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ÈáçÂêØÂêéËäÇÁÇπÂÆπÂô®ÂàóË°®ÔºåÊñ≠ÁΩëÈáçÂêØÂêéÔºåkubelet Êó†Ê≥ï‰ªé‰∫ëÁ´ØËé∑Âèñ Pod ‰ø°ÊÅØÔºå‰∏ç‰ºöÈáçÂª∫ Pod„ÄÇ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@edge-node:~# docker ps</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@edge-node:~#</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>‰ªéÈáçÂêØÂâçÂêéÁöÑÂØπÊØîÁúãÔºåËæπÁºòËäÇÁÇπÂú®Êñ≠ÁΩëÈáçÂêØ‰πãÂêéÔºåËäÇÁÇπ‰∏äÁöÑ Pod ÂÖ®ÈÉ®Êó†Ê≥ïÊÅ¢Â§ç„ÄÇËøôÂ∞±‰ºöÂØºËá¥Âú®‰∫ëËæπÊñ≠ÁΩëÊó∂Ôºå‰∏ÄÊó¶ËäÇÁÇπÈáçÂêØÔºåÂ∫îÁî®Â∞ÜÊó†Ê≥ïÂ∑•‰Ωú„ÄÇ</p><p>Â∞ÜÁΩëÁªúÊÅ¢Â§çÔºåËßÇÂØüËäÇÁÇπÂèä pod ÂèòÂåñÔºåÂêå‰∏äÈù¢ÊµãËØïÁªìÊûúÔºåÁΩëÁªúÊÅ¢Â§çÂêéÔºåËäÇÁÇπÂèò‰∏∫ ReadyÔºå‰∏öÂä° Pod Ë¢´Ê∏ÖÈô§„ÄÇ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl get nodes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME STATUS ROLES AGE VERSION</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">edge-node Ready &lt;none&gt;   11m   v1.16.6</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">master-node   Ready    master   12m   v1.16.6</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl get pods</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">No resources found in default namespace.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Êé•‰∏ãÊù•ÔºåÂÜçÊ¨°ÈÉ®ÁΩ≤‰∏öÂä° nginxÔºåÊµãËØï OpenYurt ÈõÜÁæ§ÂØπ‰∫ëËæπËøêÁª¥ÁöÑÊîØÊåÅÂíåÂØπ‰∫ëËæπÊñ≠ÁΩëÊó∂ÁöÑÂèçÂ∫î„ÄÇ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl get pods -owide</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">nginx 1/1 Running 0 12s 192.168.0.100 edge-node &lt;none&gt;           &lt;none&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="ÂéüÁîü-k8s-ÈõÜÁæ§‰∏ÄÈîÆËΩ¨Êç¢‰∏∫-openyurt-ÈõÜÁæ§">ÂéüÁîü K8s ÈõÜÁæ§‰∏ÄÈîÆËΩ¨Êç¢‰∏∫ OpenYurt ÈõÜÁæ§<a aria-hidden="true" class="hash-link" href="#ÂéüÁîü-k8s-ÈõÜÁæ§‰∏ÄÈîÆËΩ¨Êç¢‰∏∫-openyurt-ÈõÜÁæ§" title="Direct link to heading">‚Äã</a></h2><p>Êé¢Á©∂‰∫ÜÂéüÁîü Kubernetes Âú®‰∫ëËæπ‰∏Ä‰ΩìÂåñÊû∂ÊûÑ‰∏≠ÁöÑ‰∏çË∂≥‰πãÂêéÔºåÊàë‰ª¨Êù•Áúã‰∏ã OpenYurt ÈõÜÁæ§ÊòØÂê¶ËÉΩÊª°Ë∂≥ËøôÁßçÂú∫ÊôØ„ÄÇÁé∞Âú®ÔºåÊàë‰ª¨Âà©Áî® OpenYurt Á§æÂå∫Êèê‰æõÁöÑÈõÜÁæ§ËΩ¨Êç¢Â∑•ÂÖ∑ yurtctlÔºåÊù•Â∞ÜÂéüÁîü K8s ÈõÜÁæ§ËΩ¨Êç¢Êàê OpenYurt ÈõÜÁæ§„ÄÇÂú® master ËäÇÁÇπ‰∏äÊâßË°åÂ¶Ç‰∏ãÂëΩ‰ª§Ôºå ËØ•ÂëΩ‰ª§ÊåáÂÆö‰∫ÜÁªÑ‰ª∂ÁöÑÈïúÂÉè‰ª•Âèä‰∫ëÁ´ØËäÇÁÇπÔºåÂπ∂ÊåáÂÆöÂÆâË£Ö‰∫ëËæπËøêÁª¥ÈÄöÈÅì yurt-tunnel„ÄÇ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">yurtctl convert --yurt-controller-manager-image=registry.cn-hangzhou.aliyuncs.com/openyurt/yurt-controller-manager:v0.2.1 --yurt-tunnel-agent-image=registry.cn-hangzhou.aliyuncs.com/openyurt/yurt-tunnel-agent:v0.2.1 --yurt-tunnel-server-image=registry.cn-hangzhou.aliyuncs.com/openyurt/yurt-tunnel-server:v0.2.1 --yurtctl-servant-image=registry.cn-hangzhou.aliyuncs.com/openyurt/yurtctl-servant:v0.2.1 --yurthub-image=registry.cn-hangzhou.aliyuncs.com/openyurt/yurthub:v0.2.1 --cloud-nodes=master-node --deploy-yurttunnel</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ËΩ¨Êç¢Â§ßÊ¶ÇÈúÄË¶Å 2minÔºåËΩ¨Êç¢ÂÆåÊàê‰πãÂêéÔºåËßÇÂØü‰∏öÂä° pod ÁöÑÁä∂ÊÄÅÔºåÂèØ‰ª•ÁúãÂà∞ËΩ¨Êç¢ËøáÁ®ã‰∏≠ÂØπ‰∏öÂä° pod Êó†ÂΩ±ÂìçÔºà‰πüÂèØ‰ª•Âú®ËΩ¨Êç¢ËøáÁ®ã‰∏≠Âú®Êñ∞ÁöÑÁªàÁ´Ø‰ΩøÁî® kubectl get pod -w ËßÇÂØü‰∏öÂä° pod ÁöÑÁä∂ÊÄÅÔºâ„ÄÇ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl get pods -owide</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">nginx 1/1 Running 0 2m4s 192.168.0.100 edge-node &lt;none&gt;           &lt;none&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ÊâßË°åÂÆåÊàê‰πãÂêéÁöÑÁªÑ‰ª∂ÂàÜÂ∏ÉÂ¶Ç‰∏ãÂõæ ÊâÄÁ§∫ÔºåÂÖ∂‰∏≠Ê©ôËâ≤ÈÉ®ÂàÜÊòØ OpenYurt Áõ∏ÂÖ≥ÁöÑÁªÑ‰ª∂ÔºåËìùËâ≤ÈÉ®ÂàÜÊòØÂéüÁîü K8s ÁªÑ‰ª∂„ÄÇÁõ∏Â∫îÂú∞ÔºåÊàë‰ª¨ËßÇÂØü‰∫ëÁ´ØËäÇÁÇπÂíåËæπÁºòËäÇÁÇπÁöÑ pod„ÄÇ</p><p><img alt="image" src="/assets/images/OpenYurt_Cluster-cf4d0928fd91e30dec6fc5ea7f13179b.png"></p><p>‰∫ëÁ´ØËäÇÁÇπ yurt Áõ∏ÂÖ≥ÁöÑ podÔºöyurt-controller-manager Âíå yurt-tunnel-server„ÄÇ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl get pods --all-namespaces -owide | grep master | grep yurt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kube-system yurt-controller-manager-7d9db5bf85-6542h 1/1 Running 0 103s 183.195.233.42 master-node &lt;none&gt;           &lt;none&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kube-system   yurt-tunnel-server-65784dfdf-pl5bn         1/1     Running   0          103s    183.195.233.42   master-node   &lt;none&gt;           &lt;none&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ËæπÁºòËäÇÁÇπÊñ∞Â¢û yurt Áõ∏ÂÖ≥ÁöÑ pod: yurt-hubÔºàstatic podÔºâÂíå yurt-tunnel-agent„ÄÇ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl get pods --all-namespaces -owide | grep edge | grep yurt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kube-system yurt-hub-edge-node 1/1 Running 0 117s 192.168.0.100 edge-node &lt;none&gt;           &lt;none&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kube-system   yurt-tunnel-agent-7l8nv                    1/1     Running   0          2m      192.168.0.100    edge-node     &lt;none&gt;           &lt;none&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="ÊµãËØï-openyurt-ÈõÜÁæ§Âú®ËæπÁºòÂú∫ÊôØ‰∏≠ÁöÑËÉΩÂäõ">ÊµãËØï OpenYurt ÈõÜÁæ§Âú®ËæπÁºòÂú∫ÊôØ‰∏≠ÁöÑËÉΩÂäõ<a aria-hidden="true" class="hash-link" href="#ÊµãËØï-openyurt-ÈõÜÁæ§Âú®ËæπÁºòÂú∫ÊôØ‰∏≠ÁöÑËÉΩÂäõ" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="1-ÊµãËØï-logsexecport-forward-Á≠âËøêÁª¥Êåá‰ª§Êü•ÁúãÁªìÊûú">1. ÊµãËØï logs/exec/port-forward Á≠âËøêÁª¥Êåá‰ª§ÔºåÊü•ÁúãÁªìÊûú<a aria-hidden="true" class="hash-link" href="#1-ÊµãËØï-logsexecport-forward-Á≠âËøêÁª¥Êåá‰ª§Êü•ÁúãÁªìÊûú" title="Direct link to heading">‚Äã</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl logs nginx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 in /etc/nginx/conf.d/default.conf</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/docker-entrypoint.sh: Configuration complete; ready for start up</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl exec -it nginx sh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl exec [POD] -- [COMMAND] instead.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># ls</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">bin dev docker-entrypoint.sh home media opt root sbin sys usr</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">boot docker-entrypoint.d etc lib mnt proc run srv tmp var</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># exit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl port-forward pod/nginx 8888:80</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Forwarding from 127.0.0.1:8888 -&gt; 80</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Handling connection for 8888</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ÊµãËØï port-forward Êó∂ÔºåÂú® master ËäÇÁÇπ‰∏äÊâßË°å curl 127.0.0.1:8888ÔºåÂèØ‰ª•ËÆøÈóÆ nginx ÊúçÂä°„ÄÇ</p><p>‰ªéÊºîÁ§∫ÁªìÊûúÁúãÔºåOpenYurt ËÉΩÂ§üÂæàÂ•ΩÂú∞ÊîØÊåÅÂ∏∏Áî®ÁöÑ‰∫ëËæπËøêÁª¥Êåá‰ª§„ÄÇ</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="2-ÊµãËØïËæπÁºòÊñ≠ÁΩëÊó∂ÂØπ‰∏öÂä°ÁöÑÂΩ±Âìç">2. ÊµãËØïËæπÁºòÊñ≠ÁΩëÊó∂ÂØπ‰∏öÂä°ÁöÑÂΩ±Âìç<a aria-hidden="true" class="hash-link" href="#2-ÊµãËØïËæπÁºòÊñ≠ÁΩëÊó∂ÂØπ‰∏öÂä°ÁöÑÂΩ±Âìç" title="Direct link to heading">‚Äã</a></h3><p>ÂêåÊ†∑Êàë‰ª¨ÈáçÂ§çÂéüÁîü K8s ‰∏≠Êñ≠ÁΩëÁöÑ‰∏§‰∏™ÊµãËØïÔºåÂú®ÊµãËØï‰πãÂâçÊàë‰ª¨ÂÖà‰∏∫ËæπÁºòËäÇÁÇπ edge-node ÂºÄÂêØËá™Ê≤ª„ÄÇÂú® OpenYurt ÈõÜÁæ§‰∏≠ÔºåËæπÁºòËäÇÁÇπÁöÑËá™Ê≤ªÊòØÈÄöËøá‰∏Ä‰∏™ annotation Êù•Ê†áËØÜÁöÑ„ÄÇ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl annotate node edge-node node.beta.alibabacloud.com/autonomy=true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">node/edge-node annotated</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="1Êñ≠ÁΩë-1-ÂàÜÈíü-ÁΩëÁªúÊÅ¢Â§ç">1ÔºâÊñ≠ÁΩë 1 ÂàÜÈíü-&gt;ÁΩëÁªúÊÅ¢Â§ç<a aria-hidden="true" class="hash-link" href="#1Êñ≠ÁΩë-1-ÂàÜÈíü-ÁΩëÁªúÊÅ¢Â§ç" title="Direct link to heading">‚Äã</a></h4><p>ÂêåÊ†∑ÔºåÂ∞ÜË∑ØÁî±Âô®ÂÖ¨ÁΩëÊñ≠ÂºÄÔºåËßÇÂØü Node Âíå Pod ÁöÑÁä∂ÊÄÅ„ÄÇÂ§ßÁ∫¶Ëøá‰∫Ü 40sÔºåËäÇÁÇπÁöÑÁä∂ÊÄÅÂèòÊàê NotReadyÔºåËÄåÂ§ßÁ∫¶Ëøá 1min ‰ª•ÂêéÔºåPod ÁöÑÁä∂ÊÄÅ‰∏ÄÁõ¥ÊòØ RunningÔºåÂπ∂‰∏ç‰ºöË¢´È©±ÈÄê„ÄÇ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl get nodes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME STATUS ROLES AGE VERSION</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">edge-node NotReady &lt;none&gt;   24m   v1.16.6</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">master-node   Ready      master   25m   v1.16.6</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl get pods</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME    READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">nginx   1/1     Running   0          5m7s</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ÊÅ¢Â§çÁΩëÁªúÔºåËßÇÂØü Node Âíå Pod ÁöÑÁä∂ÊÄÅÔºåNode Áä∂ÊÄÅÂèò‰∏∫ ReadyÔºåPod ‰øùÊåÅ Running„ÄÇÂèØËßÅ‰∫ëËæπÁΩëÁªú‰∏çÁ®≥ÂÆöÊó∂ÔºåÂØπËæπÁºòËäÇÁÇπÁöÑ‰∏öÂä° Pod Êó†ÂΩ±Âìç„ÄÇ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl get nodes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME STATUS ROLES AGE VERSION</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">edge-node Ready &lt;none&gt;   25m   v1.16.6</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">master-node   Ready    master   26m   v1.16.6</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl get pods</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME    READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">nginx   1/1     Running   0          6m30s</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="2Êñ≠ÁΩë-1-ÂàÜÈíü-ÈáçÂêØËæπÁºòËäÇÁÇπ-ÊÅ¢Â§çÁΩëÁªú">2ÔºâÊñ≠ÁΩë 1 ÂàÜÈíü-&gt;ÈáçÂêØËæπÁºòËäÇÁÇπ-&gt;ÊÅ¢Â§çÁΩëÁªú<a aria-hidden="true" class="hash-link" href="#2Êñ≠ÁΩë-1-ÂàÜÈíü-ÈáçÂêØËæπÁºòËäÇÁÇπ-ÊÅ¢Â§çÁΩëÁªú" title="Direct link to heading">‚Äã</a></h4><p>Êé•‰∏ãÊù•ÔºåÊàë‰ª¨ÊµãËØïÂú®Êñ≠ÁΩëÁöÑÊÉÖÂÜµ‰∏ãÔºåËæπÁºòËäÇÁÇπÁöÑÈáçÂêØÂØπ‰∏öÂä°ÁöÑÂΩ±Âìç„ÄÇÊñ≠ÁΩë 1 ÂàÜÈíü‰πãÂêéÔºåNode Âíå Pod Áä∂ÊÄÅÂêå‰∏äÈù¢ÊµãËØïÁªìÊûúÔºåNode Âèò‰∏∫ NotReadyÔºåPod ‰øùÊåÅ Running„ÄÇÂêåÊ†∑ÔºåÊàë‰ª¨ÁôªÂΩïÂà∞Ê†ëËéìÊ¥æ‰∏äÔºåÂ∞ÜÊ†ëËéìÊ¥æÈáçÂêØÔºåËßÇÂØüÈáçÂêØÂâçÂêéËäÇÁÇπ‰∏äÁöÑÂÆπÂô®ÂàóË°®„ÄÇ</p><p>ÈáçÂêØÂâçËæπÁºòËäÇÁÇπÂÆπÂô®ÂàóË°®Ôºö</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@edge-node:~# docker ps</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">38727ec9270c 70bf6668c7eb &quot;yurthub --v=2 --ser‚Ä¶&quot; 7 minutes ago Up 7 minutes k8s_yurt-hub_yurt-hub-edge-node_kube-system_d75d122e752b90d436a71af44c0a53be_0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">c403ace1d4ff registry.cn-hangzhou.aliyuncs.com/edge-kubernetes/pause:3.1 &quot;/pause&quot; 7 minutes ago Up 7 minutes k8s_POD_yurt-hub-edge-node_kube-system_d75d122e752b90d436a71af44c0a53be_0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">de0d693e9e74 473ae979be68 &quot;yurt-tunnel-agent -‚Ä¶&quot; 7 minutes ago Up 7 minutes k8s_yurt-tunnel-agent_yurt-tunnel-agent-7l8nv_kube-system_75d28494-f577-43fa-9cac-6681a1215498_0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">a0763f143f74 registry.cn-hangzhou.aliyuncs.com/edge-kubernetes/pause:3.1 &quot;/pause&quot; 7 minutes ago Up 7 minutes k8s_POD_yurt-tunnel-agent-7l8nv_kube-system_75d28494-f577-43fa-9cac-6681a1215498_0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">80c247714402 e86f991e5d10 &quot;/docker-entrypoint.‚Ä¶&quot; 7 minutes ago Up 7 minutes k8s_nginx_nginx_default_b45baaac-eebc-466b-9199-2ca5c1ede9fd_0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">01f7770cb0f7 registry.cn-hangzhou.aliyuncs.com/edge-kubernetes/pause:3.1 &quot;/pause&quot; 7 minutes ago Up 7 minutes k8s_POD_nginx_default_b45baaac-eebc-466b-9199-2ca5c1ede9fd_0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">7e65f83090f6 f9ea384ddb34 &quot;/usr/local/bin/kube‚Ä¶&quot; 17 minutes ago Up 17 minutes k8s_kube-proxy_kube-proxy-rjws7_kube-system_51576be4-2b6d-434d-b50b-b88e2d436fef_1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">c1ed142fc75b registry.cn-hangzhou.aliyuncs.com/edge-kubernetes/pause:3.1 &quot;/pause&quot; 17 minutes ago Up 17 minutes k8s_POD_kube-proxy-rjws7_kube-system_51576be4-2b6d-434d-b50b-b88e2d436fef_1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ÈáçÂêØÂêéËæπÁºòËäÇÁÇπÂÆπÂô®ÂàóË°®Ôºö</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@edge-node:~# docker ps</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0c66b87066a0 473ae979be68 &quot;yurt-tunnel-agent -‚Ä¶&quot; 12 seconds ago Up 11 seconds k8s_yurt-tunnel-agent_yurt-tunnel-agent-7l8nv_kube-system_75d28494-f577-43fa-9cac-6681a1215498_2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">a4fb3e4e8c8f e86f991e5d10 &quot;/docker-entrypoint.‚Ä¶&quot; 58 seconds ago Up 56 seconds k8s_nginx_nginx_default_b45baaac-eebc-466b-9199-2ca5c1ede9fd_1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">fce730d64b32 f9ea384ddb34 &quot;/usr/local/bin/kube‚Ä¶&quot; 58 seconds ago Up 57 seconds k8s_kube-proxy_kube-proxy-rjws7_kube-system_51576be4-2b6d-434d-b50b-b88e2d436fef_2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">c78166ea563f registry.cn-hangzhou.aliyuncs.com/edge-kubernetes/pause:3.1 &quot;/pause&quot; 59 seconds ago Up 57 seconds k8s_POD_yurt-tunnel-agent-7l8nv_kube-system_75d28494-f577-43fa-9cac-6681a1215498_1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">799ad14bcd3b registry.cn-hangzhou.aliyuncs.com/edge-kubernetes/pause:3.1 &quot;/pause&quot; 59 seconds ago Up 57 seconds k8s_POD_nginx_default_b45baaac-eebc-466b-9199-2ca5c1ede9fd_1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">627673da6a85 registry.cn-hangzhou.aliyuncs.com/edge-kubernetes/pause:3.1 &quot;/pause&quot; 59 seconds ago Up 58 seconds k8s_POD_kube-proxy-rjws7_kube-system_51576be4-2b6d-434d-b50b-b88e2d436fef_2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">04da705e4120 70bf6668c7eb &quot;yurthub --v=2 --ser‚Ä¶&quot; About a minute ago Up About a minute k8s_yurt-hub_yurt-hub-edge-node_kube-system_d75d122e752b90d436a71af44c0a53be_1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">260057d935ee registry.cn-hangzhou.aliyuncs.com/edge-kubernetes/pause:3.1 &quot;/pause&quot; About a minute ago Up About a minute k8s_POD_yurt-hub-edge-node_kube-system_d75d122e752b90d436a71af44c0a53be_1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>‰ªéÈáçÂêØÂâçÂêéÁöÑÂØπÊØîÁúãÔºåËæπÁºòËäÇÁÇπÂú®Êñ≠ÁΩëÈáçÂêØ‰πãÂêéÔºåËäÇÁÇπ‰∏äÁöÑ pod ËÉΩÊ≠£Â∏∏ÊãâËµ∑ÔºåOpenYurt ÁöÑËäÇÁÇπËá™Ê≤ªËÉΩÂäõÂèØ‰ª•Âú®Êñ≠ÁΩë‰∏ã‰øùËØÅ‰∏öÂä°ÁöÑÁ®≥ÂÆöËøêË°å„ÄÇ</p><p>ÊÅ¢Â§çÁΩëÁªúÔºåËäÇÁÇπ ReadyÔºåËßÇÂØü‰∏öÂä° pod ÁöÑÁä∂ÊÄÅÔºåÁΩëÁªúÊÅ¢Â§çÂêéÔºå‰∏öÂä° pod Áä∂ÊÄÅ‰øùÊåÅ runningÔºåÊúâ‰∏ÄÊ¨°ÈáçÂêØËÆ∞ÂΩïÔºåÁ¨¶ÂêàÈ¢ÑÊúü„ÄÇ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@master-node:~# kubectl get pods -owide</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">nginx 1/1 Running 1 11m 192.168.0.100 edge-node &lt;none&gt;           &lt;none&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ÊúÄÂêéÔºåÊàë‰ª¨‰ªéyurtctlÁöÑËÉΩÂäõÂ∞ÜOpenYurtÈõÜÁæ§ÔºåËΩ¨Êç¢‰∏∫ÂéüÁîüK8sÈõÜÁæ§„ÄÇÂêåÊ†∑ÔºåÂèØ‰ª•ËßÇÂØüËΩ¨Êç¢ËøáÁ®ã‰∏≠ÂØπÁé∞Êúâ‰∏öÂä°‰∏ç‰ºöÊúâÂΩ±Âìç„ÄÇ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">yurtctl revert --yurtctl-servant-image=registry.cn-hangzhou.aliyuncs.com/openyurt/yurtctl-servant:v0.2.1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>OpenYurt ‰Ωú‰∏∫ÈòøÈáåÈ¶ñ‰∏™ËæπÁºò‰∫ëÂéüÁîüÂºÄÊ∫êÈ°πÁõÆÔºåÂü∫‰∫éÂïÜ‰∏öÂåñ‰∫ßÂìÅ ACK@EdgeÔºåÂú®ÈõÜÂõ¢ÂÜÖÈÉ®ÁªèÂéÜ‰∫ÜÈïøÊó∂Èó¥ÁöÑÊâìÁ£®„ÄÇÂ∑≤ÁªèÂ∫îÁî®Âú® CDN„ÄÅIoT„ÄÅÁõíÈ©¨„ÄÅENS„ÄÅËèúÈ∏üÁâ©ÊµÅÁ≠â‰ºóÂ§öÂú∫ÊôØ„ÄÇÈíàÂØπËæπÁºòÂú∫ÊôØÔºåËØ•È°πÁõÆÂùöÊåÅ‰øùÊåÅÂéüÁîü K8s ÁöÑÁâπÊÄßÔºå‰ª• Addon ÁöÑÂΩ¢ÂºèÊèê‰æõ‰∫ÜËæπÁºòËäÇÁÇπËá™Ê≤ª„ÄÅ‰∫ëËæπÁ´Ø‰∏Ä‰ΩìÂåñËøêÁª¥ÈÄöÈÅìÁ≠âËÉΩÂäõ„ÄÇÊúÄËøëÂú®Á§æÂå∫ÂêåÂ≠¶ÁöÑ‰∏ÄËµ∑Âä™Âäõ‰∏ãÂèàÂºÄÊ∫ê‰∫ÜËæπÁºòÂçïÂÖÉÂåñÁÆ°ÁêÜËÉΩÂäõÔºåÂêåÊó∂ÂêéÁª≠Ëøò‰ºöÁªßÁª≠ÂºÄÊ∫êÊõ¥Â§öÁöÑËæπÁºòÁÆ°ÁêÜËÉΩÂäõÔºåÊ¨¢ËøéÂ§ßÂÆ∂ÁßØÊûÅÂèÇ‰∏éË¥°ÁåÆ„ÄÇ</p><p><a href="https://mp.weixin.qq.com/s/Anr8UhTaNe3FCnKKfKoXNQ" target="_blank" rel="noopener noreferrer">ÂéüÊñáÈìæÊé•</a></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/blog/tags/openyurt">openyurt</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_d4p0" itemprop="headline"><a itemprop="url" href="/blog/Build-side-efficient-collaborative-network">How to build Kubernetes Native Cloud side efficient collaborative network</a></h2><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2020-11-06T00:00:00.000Z" itemprop="datePublished">November 6, 2020</time> ¬∑ <!-- -->21 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://github.com/charleszheng44" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://github.com/charleszheng44.png" alt="Chao Zheng"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/charleszheng44" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Chao Zheng</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of OpenYurt</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>ÂØºËØªÔºöOpenYurtÊòØÈòøÈáåÂ∑¥Â∑¥ÂºÄÊ∫êÁöÑ‰∫ëËæπÂçèÂêå‰∏Ä‰ΩìÂåñÊû∂ÊûÑÔºå‰∏éÂêåÁ±ªÂºÄÊ∫êÊñπÊ°àÁõ∏ÊØîÔºåOpenYurtÊã•ÊúâÂèØÂÆûÁé∞ËæπÁºòËÆ°ÁÆóÂÖ®Âú∫ÊôØË¶ÜÁõñÁöÑËÉΩÂäõ„ÄÇ</p><ul><li>OpenYurtÊòØÂ¶Ç‰ΩïÂú®Âº±ÁΩëÂíåÊñ≠ÁΩëÁéØÂ¢É‰∏ãÂÆûÁé∞ËæπÁºòËá™Ê≤ªÁöÑ‚Äî‚Äî<a href="/blog/Edge-gateway-caching-capabilities">YurtHub</a></li><li>OpenYurtÂè¶‰∏Ä‰∏™Ê†∏ÂøÉËÉΩÂäõ‚Äî‚Äî‰∫ëËæπÈÄö‰ø°Ôºå‰ª•ÂèäÁõ∏ÂÖ≥ÁªÑ‰ª∂Yurttunnel</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="yurttunnel‰ΩøÁî®Âú∫ÊôØ">Yurttunnel‰ΩøÁî®Âú∫ÊôØ<a aria-hidden="true" class="hash-link" href="#yurttunnel‰ΩøÁî®Âú∫ÊôØ" title="Direct link to heading">‚Äã</a></h2><p>Âú®Â∫îÁî®ÁöÑÈÉ®ÁΩ≤ÂíåËøêÁª¥ËøáÁ®ã‰∏≠ÔºåÁî®Êà∑Â∏∏Â∏∏ÈúÄË¶ÅËé∑ÂèñÂ∫îÁî®ÁöÑÊó•ÂøóÔºåÊàñÁõ¥Êé•ÁôªÂΩïÂà∞Â∫îÁî®ÁöÑËøêË°åÁéØÂ¢É‰∏≠ËøõË°åË∞ÉËØï„ÄÇÂú® Kubernetes ÁéØÂ¢É‰∏≠ÔºåÊàë‰ª¨ÈÄöÂ∏∏‰ΩøÁî® kubectl logÔºåkubectl exec Á≠âÊåá‰ª§Êù•ÂÆûÁé∞Ëøô‰∫õÈúÄÊ±Ç„ÄÇÂ¶Ç‰∏ãÂõæÊâÄÁ§∫ÔºåÂú® kubectl ËØ∑Ê±ÇÈìæË∑Ø‰∏äÔºå kubelet Â∞ÜÊâÆÊºîÊúçÂä°Âô®Á´ØÔºåË¥üË¥£Â§ÑÁêÜÁî± kube-apiserver(KAS) ËΩ¨ÂèëÊù•ÁöÑËØ∑Ê±ÇÔºåËøôÂ∞±Ë¶ÅÊ±Ç KAS Âíå kubelet ‰πãÈó¥ÈúÄË¶ÅÂ≠òÂú®‰∏ÄÊù°ÁΩëÁªúÈÄöË∑ØÔºåÂÖÅËÆ∏ KAS ‰∏ªÂä®ËÆøÈóÆ kubelet„ÄÇ
<img alt="image" src="/assets/images/kubectl-a986c3e8d3b680dd93899fce88a92821.png">
ÁÑ∂ËÄåÔºåÂú®ËæπÁºòËÆ°ÁÆóÂú∫ÊôØ‰∏≠ÔºåËæπÁºòËäÇÁÇπÂ∏∏‰Ωç‰∫éÊú¨Âú∞‰∏ìÊúâÁΩëÁªú‰∏≠ÔºåËøôËôΩÁÑ∂‰øùËØÅ‰∫ÜËæπÁºòËäÇÁÇπÁöÑÂÆâÂÖ®Ôºå‰ΩÜ‰πüÈÄ†Êàê‰Ωç‰∫é‰∫ëÁ´ØÁÆ°ÊéßËäÇÁÇπÁöÑKASÊó†Ê≥ïÁõ¥Êé•ËÆøÈóÆ‰Ωç‰∫éËæπÁºòËäÇÁÇπÁöÑkubelet„ÄÇÂõ†Ê≠§Ôºå‰∏∫‰∫ÜÊîØÊåÅÈÄöËøá‰∫ëÁ´ØËäÇÁÇπÂØπËæπÁºòÁ´ØÂ∫îÁî®ËøõË°åËøêÁª¥Êìç‰ΩúÔºåÊàë‰ª¨ÂøÖÈ°ªÂú®‰∫ë„ÄÅËæπ‰πãÈó¥Âª∫Á´ãÂèçÂêëËøêÁª¥ÈÄöÈÅì„ÄÇ</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="ÂèçÂêëÈÄöÈÅì">ÂèçÂêëÈÄöÈÅì<a aria-hidden="true" class="hash-link" href="#ÂèçÂêëÈÄöÈÅì" title="Direct link to heading">‚Äã</a></h2><p>YurttunnelÊòØOpenYurtËøëÊúüÂºÄÊ∫êÁöÑ‰∏Ä‰∏™ÈáçË¶ÅÁªÑ‰ª∂ÔºåÁî®Êù•Ëß£ÂÜ≥‰∫ëËæπÈÄö‰ø°ÈóÆÈ¢ò„ÄÇÂèçÂêëÈÄöÈÅìÊòØËß£ÂÜ≥Ë∑®ÁΩëÁªúÈÄö‰ø°ÁöÑ‰∏ÄÁßçÂ∏∏ËßÅÊñπÂºèÔºåËÄå Yurttunnel ÁöÑÊú¨Ë¥®Â∞±ÊòØ‰∏Ä‰∏™ÂèçÂêëÈÄöÈÅì„ÄÇ‰∏Ä‰∏™ËæπÁºòÈõÜÁæ§‰∏ãÂ±ûÁöÑËäÇÁÇπÂ∏∏‰Ωç‰∫é‰∏çÂêåÁöÑ network region ‰∏≠ÔºåËÄå‰Ωç‰∫éÂêå‰∏Ä‰∏™ region ÂÜÖÁöÑËäÇÁÇπ‰πãÈó¥ÊòØÂèØ‰ª•Áõ∏‰∫íÈÄö‰ø°ÁöÑÔºåÂõ†Ê≠§Âú®ËÆæÁΩÆÂèçÂêëÈÄöÈÅìÊó∂ÔºåÊàë‰ª¨Âè™ÈúÄ‰øùËØÅÂú®ÊØè‰∏™ region ÂÜÖËÆæÁΩÆ‰∏Ä‰∏™‰∏é proxy server Áõ∏ËøûÁöÑ agent Âç≥ÂèØ„ÄÇÂÖ∑‰ΩìÂåÖÊã¨‰ª•‰∏ãÂá†‰∏™Ê≠•È™§Ôºö</p><ul><li><p>Âú®ÁÆ°ÊéßÁªÑ‰ª∂ÊâÄÂú®ÁΩëÁªúÂÜÖÔºåÈÉ®ÁΩ≤ proxy server„ÄÇ</p></li><li><p>proxy server ÂØπÂ§ñÂºÄÊîæ‰∏Ä‰∏™ÂÖ¨ÁΩëÂèØ‰ª•ËÆøÈóÆÁöÑ IP„ÄÇ</p></li><li><p>Âú®ÊØè‰∏™ region ÈÉ®ÁΩ≤‰∏™ agentÔºåÂπ∂ÈÄöËøá server ÁöÑÂÖ¨ÁΩë IP ‰∏é server Âª∫Á´ãÈïøËøûÊé•„ÄÇ</p></li><li><p>ÁÆ°ÊéßÁªÑ‰ª∂ÂØπËæπÁºòËäÇÁÇπÁöÑËÆøÈóÆËØ∑Ê±ÇÈÉΩÂ∞ÜËΩ¨ÂèëËá¥ proxy server„ÄÇ</p></li><li><p>proxy server ÂÜçÂ∞ÜËØ∑Ê±ÇÈÄöËøáÂØπÂ∫îÁöÑÈïøËøûÊé•ÂèëÂæÄÁõÆÊ†áËäÇÁÇπ„ÄÇ</p></li></ul><p><img alt="image" src="/assets/images/proxy_server_agent-58a080cbcdc31c0c7b82a500d94f9849.png">
Âú® Yurttunnel ‰∏≠ÔºåÊàë‰ª¨ÈÄâÊã©‰ΩøÁî®‰∏äÊ∏∏<a href="https://github.com/kubernetes-sigs/apiserver-network-proxy" target="_blank" rel="noopener noreferrer">È°πÁõÆapiserver-network-proxy(ANP)</a> Êù•ÂÆûÁé∞server Âíå agent Èó¥ÁöÑÈÄö‰ø°„ÄÇANP ÊòØÂü∫‰∫é kubernetes 1.16 Alpha Êñ∞ÂäüËÉΩ<a href="https://github.com/kubernetes/kubernetes/blob/master/staging/src/k8s.io/apiserver/pkg/server/egressselector/egress_selector.go" target="_blank" rel="noopener noreferrer">EgressSelector</a> ÂºÄÂèëÔºåÊÑèÂú®ÂÆûÁé∞ Kubernetes ÈõÜÁæ§ÁªÑ‰ª∂ÁöÑË∑® intranet ÈÄö‰ø°Ôºà‰æãÂ¶ÇÔºåmaster ‰Ωç‰∫éÁÆ°Êéß VPCÔºåËÄå kubelet Á≠âÂÖ∂‰ªñÁªÑ‰ª∂‰Ωç‰∫éÁî®Êà∑ VPCÔºâ„ÄÇ</p><p>ËØªËÄÖÂèØËÉΩ‰ºöÂ•ΩÂ•áÔºåÊó¢ÁÑ∂ OpenYurt ÊòØÂü∫‰∫é ACK@Edge ÂºÄÊ∫êÁöÑÔºåËÄåÂú®Áîü‰∫ßÁéØÂ¢É‰∏≠Ôºå ACK@Edge ÁöÑ‰∫ëËæπËøêÁª¥ÈÄöÈÅì‰ΩøÁî®ÁöÑÊòØËá™Á†îÁªÑ‰ª∂ tunnellibÔºåÈÇ£‰∏∫‰ªÄ‰πàÂú®ÂºÄÊ∫êÁâàÊú¨ÈáåÊàë‰ª¨Ë¶ÅÈÄâÁî®‰∏Ä‰∏™Êñ∞ÁöÑÁªÑ‰ª∂Âë¢ÔºüËøôÈáå‰∏çÂæó‰∏çÂÜçÊ¨°ÊèêÂà∞ OpenYurt ÁöÑÊ†∏ÂøÉËÆæËÆ°ÁêÜÂøµ ‚ÄúExtend upstream Kubernetes to Edge‚Äù„ÄÇ</p><p>ËØöÁÑ∂Ôºåtunnellib ÁªèËøá‰∫ÜÂ§çÊùÇÁ∫ø‰∏äÁéØÂ¢ÉÁöÑËÄÉÈ™åÔºåÁªÑ‰ª∂ÊÄßËÉΩÁ®≥ÂÆöÔºå‰ΩÜÊàë‰ª¨Êõ¥Â∏åÊúõËÉΩ‰∏é‰∏äÊ∏∏‰øùÊåÅÊúÄÂ§ßÁöÑÊäÄÊúØÂÖ¨Á∫¶Êï∞ÔºåËÆ© OpenYurt ÁöÑÁî®Êà∑‰ΩìÈ™åÊõ¥Êé•ËøëÂéüÁîü Kubernetes ÔºõÂêåÊó∂ÔºåÂú® ACK@Edge ÁöÑÂºÄÂèëÂíåËøêÁª¥ËøáÁ®ã‰∏≠ÔºåÊàë‰ª¨ÂèëÁé∞ÔºåËæπÁºòÈõÜÁæ§ÁöÑËÆ∏Â§öÈúÄÊ±Ç‰πüÂêåÊ†∑Â≠òÂú®‰∫éÂÖ∂‰ªñÂú∫ÊôØ‰∏≠Ôºà‰æãÂ¶ÇÔºåÂ§ßÂ§öÊï∞‰∫ëÂéÇÂïÜ‰πüÈúÄË¶ÅÂÆûÁé∞ËäÇÁÇπË∑®ÁΩëÁªúÈÄö‰ø°ÔºâÔºåÂπ∂‰∏îËøêÁª¥ÈÄöÈÅìÁöÑ‰º†ËæìÊïàÁéá‰πüËÉΩËøõ‰∏ÄÊ≠•‰ºòÂåñÔºà4.5Á´†Â∞ÜËØ¶Ëø∞‰ºòÂåñËøáÁ®ãÔºâ„ÄÇÂõ†Ê≠§ÔºåÁßâÊâøÂºÄÊîæÂàÜ‰∫´„ÄÅÂπ≥Á≠âÊôÆÊÉ†ÁöÑÂºÄÊ∫êÁ≤æÁ•ûÔºåÊàë‰ª¨Â∏åÊúõËÉΩÂ∞ÜÂºÄÂèëÂíåËøêÁª¥ËøáÁ®ã‰∏≠ÁßØÁ¥ØÁöÑÁöÑÂÆùË¥µÁªèÈ™åÂú®‰∏äÊ∏∏Á§æÂå∫‰∏éÊõ¥Â§öÁöÑÂºÄÂèëËÄÖÂàÜ‰∫´„ÄÇ</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="anpÂπ∂ÈùûÂºÄÁÆ±Âç≥Áî®">ANPÂπ∂ÈùûÂºÄÁÆ±Âç≥Áî®<a aria-hidden="true" class="hash-link" href="#anpÂπ∂ÈùûÂºÄÁÆ±Âç≥Áî®" title="Direct link to heading">‚Äã</a></h2><p>ÁÑ∂ËÄå ANP È°πÁõÆ‰ªçÂ§Ñ‰∫éËµ∑Ê≠•Èò∂ÊÆµÔºåÂäüËÉΩÂ∞öÊú™ÂÆåÂñÑÔºåËÆ∏Â§öÈóÆÈ¢ò‰ªçÊúâÂæÖËß£ÂÜ≥„ÄÇÊàë‰ª¨‰ªéÂÆûË∑µ‰∏≠ÂèëÁé∞ÁöÑ‰∏ªË¶ÅÈóÆÈ¢òÂåÖÊã¨Ôºö</p><ul><li><p>Â¶Ç‰ΩïËΩ¨Âèë‰∫ëÁ´ØËäÇÁÇπÁöÑËØ∑Ê±Ç -- ÂèçÂêëÈÄöÈÅìÊ≠£Â∏∏Â∑•‰ΩúÁöÑ‰∏Ä‰∏™ÂâçÊèêÊòØÔºåÁÆ°ÊéßËäÇÁÇπÂèëÂæÄËæπÁºòËäÇÁÇπÁöÑËØ∑Ê±ÇÂøÖÈ°ªÂÖàÁªèËøá proxy server„ÄÇÂØπ‰∫é Kubernetes 1.16 + ÁâàÊú¨ÔºåKAS ËÉΩÂÄüÁî± EgressSelector Â∞ÜÂèëÂæÄËäÇÁÇπÁöÑËØ∑Ê±ÇÂÖàÂèëÂæÄÊåáÂÆöÁöÑ proxy server„ÄÇ‰ΩÜÂØπ‰∫é 1.16 ‰ª•ÂâçÁöÑÁâàÊú¨ÔºåKAS ÂèäÂÖ∂‰ªñÁÆ°ÊéßÁªÑ‰ª∂ÔºàPrometheus Âíå metrics serverÔºâÂè™ËÉΩÁõ¥Êé•ËÆøÈóÆËäÇÁÇπÔºåËÄå‰∏çËÉΩÁªïÈÅì proxy server„ÄÇÂèØ‰ª•È¢ÑËßÅÁöÑÊòØÔºåÈÉ®ÂàÜÁî®Êà∑Âú®Áü≠ÊúüÂÜÖÔºå‰ªçÂ∞Ü‰ΩøÁî® 1.16 ‰ª•ÂâçÁöÑÁâàÊú¨ÔºåÂπ∂‰∏î Prometheus Âíå metrics server Á≠âÁÆ°ÊéßÁªÑ‰ª∂Âú®Áü≠ÊúüÂÜÖ‰πüÊ≤°ÊúâÊîØÊåÅ EgressSelector ÁöÑËÆ°Âàí„ÄÇÂõ†Ê≠§ÔºåÊàë‰ª¨Ë¶ÅËß£ÂÜ≥ÁöÑÁ¨¨‰∏Ä‰∏™ÈóÆÈ¢òÊòØÔºåÂ¶Ç‰ΩïÂ∞ÜÁÆ°ÊéßÁªÑ‰ª∂ÂèëÂæÄËäÇÁÇπÁöÑËØ∑Ê±ÇËΩ¨ÂèëËá¥ proxy server„ÄÇ</p></li><li><p>Â¶Ç‰ΩïÁ°Æ‰øù server ÂâØÊú¨Ë¶ÜÁõñÊâÄÊúâÁöÑ region -- Âú®Áîü‰∫ßÁéØÂ¢É‰∏≠Ôºå‰∏Ä‰∏™ËæπÁºòÈõÜÁæ§Â∏∏Â∏∏ÂåÖÂê´‰∏ä‰∏á‰∏™ËäÇÁÇπÔºåÂπ∂ÂêåÊó∂ÊúçÂä°‰∏äÁôæÂêçÁî®Êà∑ÔºåÂ¶ÇÊûú‰∏Ä‰∏™ÈõÜÁæ§Âè™Êúâ‰∏Ä‰∏™ proxy serverÔºå ÈÇ£‰πàÔºå‰∏ÄÊó¶ proxy server Âá∫Áé∞ÊïÖÈöúÔºåÊâÄÊúâÁî®Êà∑ÈÉΩÂ∞ÜÊó†Ê≥ïÂØπ‰Ωç‰∫éËæπÁºòËäÇÁÇπ‰∏äÁöÑ pod ËøõË°åÊìç‰Ωú„ÄÇÂõ†Ê≠§ÔºåÊàë‰ª¨ÂøÖÈ°ªÂêåÊó∂ÈÉ®ÁΩ≤Â§ö‰∏™ proxy server ÂâØÊú¨‰ª•‰øùËØÅÈõÜÁæ§È´òÂèØÁî®„ÄÇÂêåÊó∂Ôºåproxy server ÁöÑÂ∑•‰ΩúË¥üËç∑Â∞ÜÈöèÁùÄËÆøÈóÆÊµÅÈáèÁöÑÂ¢ûÂ§ßËÄåÂ¢ûÂ§ßÔºåÁî®Êà∑ÁöÑËÆøÈóÆÂª∂Êó∂‰πüÂäøÂøÖÂ¢ûÂä†„ÄÇÂõ†Ê≠§Âú®ÈÉ®ÁΩ≤ proxy server Êó∂ÔºåÊàë‰ª¨ËøòÈúÄËÄÉËôëÂ¶Ç‰ΩïÂØπ proxy server ËøõË°åÊ∞¥Âπ≥ÊãìÂ±ïÔºå‰ª•Â∫îÂØπÈ´òÂπ∂ÂèëÂú∫ÊôØ„ÄÇ‰∏Ä‰∏™Â∫îÂØπÂçïÁÇπÊïÖÈöúÂíåÈ´òÂπ∂ÂèëÂú∫ÊôØÁöÑÁªèÂÖ∏Ëß£ÂÜ≥ÊñπÊ°àÊòØÔºåÈÉ®ÁΩ≤Â§ö‰∏™ proxy server ÂâØÊú¨ÔºåÂπ∂‰ΩøÁî®Ë¥üËΩΩÂùáË°°ËøõË°åÊµÅÈáèÂàÜÂèë„ÄÇÁÑ∂ËÄåÂú® OpenYurt Âú∫ÊôØ‰∏ãÔºåÂØπ‰∫é KAS ÂèëÊù•ÁöÑ‰ªªÊÑèËØ∑Ê±ÇÔºåLoadBalancer (LB) ‰ºöËΩ¨ÂèëÁªôÂì™‰∏™ server ÂâØÊú¨ÊòØ‰∏çÂèØÊéßÁöÑÔºåÂõ†Ê≠§ÔºåÈúÄË¶ÅËß£ÂÜ≥ÁöÑÁ¨¨‰∫å‰∏™ÈóÆÈ¢òÊòØÔºåÂ¶Ç‰Ωï‰øùËØÅÊØè‰∏™ server ÂâØÊú¨ÈÉΩËÉΩ‰∏éÊâÄÊúâÁöÑ agent Âª∫Á´ãËøûÊé•„ÄÇ</p></li><li><p>Â¶Ç‰ΩïÂ∞ÜËØ∑Ê±ÇËΩ¨ÂèëÁªôÊ≠£Á°ÆÁöÑ agent -- Âú®ËøêË°åËøáÁ®ã‰∏≠Ôºåproxy server Âú®Êî∂Âà∞ËØ∑Ê±ÇÂêéÔºåÈúÄÊ†πÊçÆËØ∑Ê±ÇÁöÑ destination IPÔºåÂ∞ÜËØ∑Ê±ÇËΩ¨ÂèëËá≥‰Ωç‰∫éÂØπÂ∫î network region ÂÜÖÁöÑ agent„ÄÇÁÑ∂ËÄåÔºåANPÁõÆÂâçÁöÑÂÆûÁé∞ÔºåÂÅáËÆæÊâÄÊúâÁöÑËäÇÁÇπÈÉΩ‰Ωç‰∫é‰∏Ä‰∏™ÁΩëÁªúÁ©∫Èó¥ÂÜÖÔºå server ‰ºöÈöèÊú∫ÊåëÈÄâ‰∏Ä‰∏™ agent ËΩ¨ÂèëËØ∑Ê±Ç„ÄÇÂõ†Ê≠§ÔºåÊàë‰ª¨ÈúÄË¶ÅËß£ÂÜ≥ÁöÑÁ¨¨‰∏â‰∏™ÈóÆÈ¢òÊòØÔºåÂ¶Ç‰ΩïÂ∞ÜËØ∑Ê±ÇÊ≠£Á°ÆÂú∞ËΩ¨ÂèëÁªôÊåáÂÆöÁöÑ agent„ÄÇ </p></li><li><p>Â¶Ç‰ΩïËß£Èô§ÁªÑ‰ª∂ÂØπËäÇÁÇπËØÅ‰π¶ÁöÑ‰æùËµñ -- Âú®ËøêË°åÊó∂ÔºåÊàë‰ª¨ÈúÄË¶Å‰∏∫ server Êèê‰æõ‰∏ÄÂ•ó TLS ËØÅ‰π¶Ôºå‰ª•ÂÆûÁé∞ server ‰∏é KASÔºåserver ‰∏é agent Èó¥ÁöÑÂÆâÂÖ®ÈÄö‰ø°„ÄÇÂêåÊó∂ÔºåÊàë‰ª¨‰πüÈúÄË¶Å‰∏∫ agent ÂáÜÂ§á‰∏ÄÂ•ó TLS client ËØÅ‰π¶ÔºåÁî®‰ª•Âª∫Á´ã agent Âíå server Èó¥ÁöÑ gRPC ‰ø°ÈÅì„ÄÇANP ÁõÆÂâçÁöÑÂÆûÁé∞ÔºåË¶ÅÊ±Ç server ÂøÖÈ°ªÂíå KAS ÈÉ®ÁΩ≤Âú®Âêå‰∏Ä‰∏™ËäÇÁÇπ‰∏äÔºåÂπ∂‰∏îÂú®ÂêØÂä®Êó∂ÊåÇËΩΩËäÇÁÇπ volume ÂÖ±‰∫´ KAS tls ËØÅ‰π¶„ÄÇÂêåÊ†∑Ôºåagent ‰πüÈúÄË¶ÅÂú®ÂêØÂä®Êó∂ÊåÇËΩΩ volume ÂÖ±‰∫´ kubelet tls ËØÅ‰π¶„ÄÇËøôÊó†ÂΩ¢‰∏≠Èôç‰Ωé‰∫ÜÈÉ®ÁΩ≤ÁöÑÁÅµÊ¥ªÊÄßÔºåÈÄ†Êàê‰∫ÜÁªÑÂª∫ÂØπËäÇÁÇπËØÅ‰π¶ÁöÑÂº∫‰æùËµñÔºåÂú®Êúâ‰∫õÊÉÖÂÜµ‰∏ãÔºåÁî®Êà∑ÂèØËÉΩÂ∏åÊúõÂ∞Ü server ÈÉ®ÁΩ≤Âú®Èùû KAS ÊâÄÂú®ËäÇÁÇπ‰∏ä„ÄÇÂõ†Ê≠§ÔºåÂè¶‰∏Ä‰∏™ÈúÄË¶ÅÂÖ≥Ê≥®ÁöÑÈóÆÈ¢òÊòØÔºåÂ¶Ç‰ΩïËß£Èô§ÁªÑ‰ª∂ÂØπËäÇÁÇπËØÅ‰π¶ÁöÑ‰æùËµñ„ÄÇ</p></li></ul><ul><li>Â¶Ç‰ΩïÁº©Â∞è Tunnel Â∏¶ÂÆΩ -- ANP ÁöÑ‰∏Ä‰∏™Ê†∏ÂøÉËÆæËÆ°ÊÄùÊÉ≥ÔºåÊòØ‰ΩøÁî® gRPC Â∞ÅË£Ö KAS ÊâÄÊúâÂØπÂ§ñ HTTP ËØ∑Ê±Ç„ÄÇËøôÈáåÈÄâÊã© gRPCÔºå‰∏ªË¶ÅÊòØÁúãÈáçÂÖ∂ÂØπÊµÅÔºàstreamÔºâÁöÑÊîØÊåÅÂíåÊ∏ÖÊô∞ÁöÑÊé•Âè£ËßÑËåÉÔºåÊ≠§Â§ñÔºåÂº∫Á±ªÂûãÁöÑÂÆ¢Êà∑Á´ØÂíåÊúçÂä°Âô®Á´ØÂèØ‰ª•ÊúâÊïàÂáèÂ∞ëËøêË°åÊó∂ÈîôËØØÔºåÊèêÈ´òÁ≥ªÁªüÁ®≥ÂÆöÊÄß„ÄÇÁÑ∂ËÄåÔºåÊàë‰ª¨‰πüÂèëÁé∞ÔºåÁõ∏ËæÉ‰∫éÁõ¥Êé•‰ΩøÁî® TCP ÂçèËÆÆÔºåÈááÁî® ANP ‰πü‰ºöÂ∏¶Êù•È¢ùÂ§ñÁöÑÂºÄÈîÄÂ¢ûÂä†Â∏¶ÂÆΩ„ÄÇ‰ªé‰∫ßÂìÅÂ±ÇÈù¢ËÄÉËôëÔºåTunnel ÊµÅÈáèËµ∞ÁöÑÊòØÂÖ¨ÁΩëÔºåÂ∏¶ÂÆΩÁöÑÂ¢ûÂä†‰πüÊÑèÂë≥ÁùÄÁî®Êà∑ÊàêÊú¨ÁöÑÂ¢ûÂä†„ÄÇÂõ†Ê≠§Ôºå‰∏Ä‰∏™ÈùûÂ∏∏ÈáçË¶ÅÁöÑÈóÆÈ¢òÊòØÔºåÂú®ÊèêÈ´òÁ≥ªÁªüÁ®≥ÂÆöÊÄßÁöÑÂêåÊó∂ÔºåÊàë‰ª¨ÊòØÂê¶‰πüËÉΩÁº©Â∞èÂ∏¶ÂÆΩÔºü </li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="yurttunnelËÆæËÆ°Ëß£Êûê">YurttunnelËÆæËÆ°Ëß£Êûê<a aria-hidden="true" class="hash-link" href="#yurttunnelËÆæËÆ°Ëß£Êûê" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="1Âà∂ÂÆödnatËßÑÂàôËΩ¨Âèë‰∫ëÁ´ØËäÇÁÇπÁöÑËØ∑Ê±Ç">1.Âà∂ÂÆöDNATËßÑÂàôËΩ¨Âèë‰∫ëÁ´ØËäÇÁÇπÁöÑËØ∑Ê±Ç<a aria-hidden="true" class="hash-link" href="#1Âà∂ÂÆödnatËßÑÂàôËΩ¨Âèë‰∫ëÁ´ØËäÇÁÇπÁöÑËØ∑Ê±Ç" title="Direct link to heading">‚Äã</a></h3><p>Â¶ÇÂâçÊñáÊâÄËø∞ÔºåANP ÊòØÂü∫‰∫é‰∏äÊ∏∏Êñ∞ÂäüËÉΩ EgressSelector ÂºÄÂèëÁöÑÔºåËØ•ÂäüËÉΩÂÖÅËÆ∏Áî®Êà∑Âú®ÂêØÂä® KAS Êó∂ÈÄöËøá‰º†ÂÖ• egress configuration Êù•Ë¶ÅÊ±Ç KAS Â∞Ü egress ËØ∑Ê±ÇËΩ¨ÂèëÂà∞ÊåáÂÆöÁöÑ proxy server„ÄÇ‰ΩÜÁî±‰∫éÊàë‰ª¨ÈúÄË¶ÅÂÖºÈ°æÊñ∞ËÄÅÁâàÊú¨ÁöÑ Kubernetes ÈõÜÁæ§ÔºåÂπ∂‰∏îËÄÉËôëÂà∞ÔºåÂÖ∂‰ªñÁÆ°ÊéßÁªÑ‰ª∂ÔºàPrometheus Âíå metric serverÔºâÂπ∂‰∏çÊîØÊåÅ EgressSelector ÁâπÊÄßÔºåÊàë‰ª¨ÈúÄË¶Å‰øùËØÅÂú®Êó†Ê≥ï‰ΩøÁî® EgressSelector ÁöÑÊÉÖÂÜµ‰∏ã‰πüËÉΩÂ∞Ü KAS egress ËØ∑Ê±ÇËΩ¨ÂèëËá¥ proxy server„ÄÇ‰∏∫Ê≠§ÔºåÊàë‰ª¨Âú®ÊØè‰∏Ä‰∏™‰∫ëÁ´ØÁÆ°ÊéßËäÇÁÇπ‰∏äÈÉΩÈÉ®ÁΩ≤‰∏Ä‰∏™ Yurttunnel Server ÂâØÊú¨ÔºåÂπ∂Âú® Server ‰∏≠ÂÜÖÂµå‰∏Ä‰∏™Êñ∞ÁªÑ‰ª∂ Iptabel Manager„ÄÇIptable Manager ‰ºöÈÄöËøáÂú®ÂÆø‰∏ªÊú∫ÁöÑ Iptable ‰∏≠ÁöÑ OUTPUT Èìæ‰∏≠Ê∑ªÂä† DNAT ËßÑÂàôÔºåÂ∞ÜÁÆ°ÊéßÁªÑ‰ª∂ÂØπËäÇÁÇπÁöÑËØ∑Ê±ÇËΩ¨ÂèëËá¥ Yurttunnel Server„ÄÇ</p><p>ÂêåÊó∂ÔºåÂΩìÂêØÁî® EgressSelector ÂêéÔºåKAS ÂØπÂ§ñËØ∑Ê±ÇÈÉΩÈÅµÂæ™‰∏Ä‰∏™Áªü‰∏ÄÁöÑÊ†ºÂºèÔºåÂõ†Ê≠§Êàë‰ª¨Êñ∞Â¢û‰∏Ä‰∏™ÁªÑ‰ª∂Ôºå ANP interceptor„ÄÇANP interceptor ‰ºöË¥üË¥£Êà™Âèñ‰ªé master ÂèëÊù•ÁöÑ http ËØ∑Ê±ÇÔºåÂπ∂Â∞ÜÂÖ∂Â∞ÅË£ÖÊàê EgressSelector Ê†ºÂºè„ÄÇYurttunnel ËØ∑Ê±ÇËΩ¨ÂèëÁöÑÂÖ∑‰ΩìÊµÅÁ®ãËßÅÂõæ‰∏â„ÄÇ
<img alt="image" src="/assets/images/yurttunnel-37d6b1940619816205bf637ecda07532.png"></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="2Âä®ÊÄÅËé∑ÂèñserverÂâØÊú¨Êï∞">2.Âä®ÊÄÅËé∑ÂèñServerÂâØÊú¨Êï∞<a aria-hidden="true" class="hash-link" href="#2Âä®ÊÄÅËé∑ÂèñserverÂâØÊú¨Êï∞" title="Direct link to heading">‚Äã</a></h3><p>Âú®‰∏ä‰∏ÄËäÇ‰∏≠ÔºåÊàë‰ª¨ÊèêÂà∞ÔºåÊàë‰ª¨Â∞ÜÈááÁî®Ë¥üËΩΩÂùáË°°ÁöÑÊñπÂºèÊù•ÁÆ°ÁêÜyurttunnel serverÔºåÊâÄÊúâÁöÑingressËØ∑Ê±ÇÈÉΩ‰ºöÈÄöËøáLBÂàÜÂèëÁªô‰∏Ä‰∏™serverÂâØÊú¨„ÄÇÁî±‰∫éÊàë‰ª¨Êó†Ê≥ïÈ¢ÑÊµãLB‰ºöÊåëÈÄâÂì™‰∏™serverÂâØÊú¨ÔºåÊàë‰ª¨ÂøÖÈ°ª‰øùËØÅÊØè‰∏™ server ÂâØÊú¨ÈÉΩË¶Å‰∏éÊâÄÊúâÁöÑ agent Âª∫Á´ãËøûÊé•„ÄÇËøôÈáåÔºåÊàë‰ª¨Â∞Ü‰ΩøÁî® ANP Ëá™Â∏¶ÁöÑÂäüËÉΩÂÆûÁé∞Ëøô‰∏ÄÈúÄÊ±ÇÔºåÂÖ∑‰ΩìÊµÅÁ®ãÂ¶Ç‰∏ãÔºö</p><ul><li><p>Âú®ÂêØÂä® yurttunnel server Êó∂ÔºåÊàë‰ª¨‰ºöÂ∞ÜÂâØÊú¨Êï∞ÔºàserverCountÔºâ‰º†ÂÖ•ÊØè‰∏™ server ÂâØÊú¨‰∏≠ÔºåÂπ∂‰∏î‰∏∫ÊØè‰∏™ÂâØÊú¨ÊåáÂÆö‰∏Ä‰∏™ server IDÔºõ</p></li><li><p>agent ËøûÊé• LB ÂêéÔºåLB‰ºöÈöèÊú∫ÈÄâÊã©‰∏Ä‰∏™ server ÂâØÊú¨Âπ∂ËÆ©ÂÖ∂‰∏é agent Âª∫Á´ãÈïøËøûÊé•Ôºõ</p></li><li><p>‰∏éÊ≠§ÂêåÊó∂Ôºåserver ‰ºöÈÄöËøáËØ•ÈÄöÈÅìÂêë agent ËøîÂõû‰∏Ä‰∏™ ACK packageÔºåËøô‰∏™ package ‰∏≠Â∞ÜÂåÖÂê´ serverCount Âíå serverIDÔºõ</p></li><li><p>agent ÈÄöËøáËß£Êûê ACK packageÔºåÂèØ‰ª•Ëé∑ÊÇâ server ÂâØÊú¨ÁöÑ‰∏™Êï∞ÔºåÂπ∂Âú®Êú¨Âú∞ËÆ∞ÂΩïÂ∑≤ËøûÊé•ÁöÑ serverIDÔºõ</p></li><li><p>Â¶ÇÊûú agent ÂèëÁé∞ÔºåÊú¨Âú∞ËøûÊé•ÁöÑ server ÂâØÊú¨Êï∞Â∞è‰∫é serverCountÔºåÂàô‰ºöÂÜçÊ¨°Âêë LB ÂèëÈÄÅËøûÊé•ËØ∑Ê±ÇÔºåÁõ¥Ëá≥Êú¨Âú∞ËÆ∞ÂΩïÁöÑ serverID Êï∞‰∏é server Count Êï∞‰∏ÄËá¥‰∏∫Ê≠¢„ÄÇ</p></li></ul><p>ËØ•Êú∫Âà∂ËôΩÁÑ∂Â∏ÆÂä©Êàë‰ª¨ÂÆûÁé∞‰∫ÜserverÂâØÊú¨ÁöÑÂÖ®ÁΩëÊÆµË¶ÜÁõñ„ÄÇ‰ΩÜÂêåÊó∂Ôºå‰πüÂ≠òÂú®‰∏çÂèØÂøΩËßÜÁöÑÁº∫ÁÇπÔºåÁî±‰∫é agent Êó†Ê≥ïÈÄâÊã©‰∏éÂì™‰∏™ server ÂâØÊú¨Âª∫Á´ãËøûÊé•ÔºåÂõ†Ê≠§Ôºå‰∏∫‰∫ÜËøûÊé•ÊâÄÊúâÁöÑ server ÂâØÊú¨Ôºåagent ÂøÖÈ°ªÂèçÂ§çËÆøÈóÆ LB„ÄÇÂú®Ëøô‰∏™ËøáÁ®ã‰∏≠Ôºåserver Áî±‰∫éËøòÊ≤°Êúâ‰∏éÊâÄÊúâÁöÑ agent Âª∫Á´ãËøûÊé•ÔºåKAS ÂèëÊù•ÁöÑËØ∑Ê±ÇÂèØËÉΩÊó†Ê≥ïËΩ¨ÂèëËá≥ÂØπÂ∫îÁöÑËäÇÁÇπ„ÄÇ‰∏Ä‰∏™ÊΩúÂú®ÁöÑËß£ÂÜ≥ÊñπÊ°àÊòØÔºå‰∏∫ÊØè‰∏™ serverÂâØÊú¨ÂàõÂª∫‰∏Ä‰∏™Áã¨Á´ãÁöÑ LBÔºåË¥üË¥£‰∏é agent ‰πãÈó¥ÁöÑËøûÊé•ÔºåÂêåÊó∂Âú®agentÁ´ØËÆ∞ÂΩïÊâÄÊúâ serverÂâØÊú¨ÂØπÂ∫î LB ÁöÑ‰ø°ÊÅØÔºåËøô‰∏ÄÊñπÊ°àËÉΩÂ∏ÆÂä© agent Âø´ÈÄüÂú∞‰∏éÊâÄÊúâÁöÑ server ÂâØÊú¨Âª∫Á´ãËøûÊé•„ÄÇËØ•ÊñπÊ°àÁöÑÂÖ∑‰ΩìÂÆûÁé∞ÁªÜËäÇÔºåÁõÆÂâç‰ªçÂú®‰∏é‰∏äÊ∏∏Á§æÂå∫ÁöÑÂºÄÂèëËÄÖËÆ®ËÆ∫‰∏≠„ÄÇ</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="3‰∏∫anpÊ∑ªÂä†‰ª£ÁêÜÁ≠ñÁï•">3.‰∏∫ANPÊ∑ªÂä†‰ª£ÁêÜÁ≠ñÁï•<a aria-hidden="true" class="hash-link" href="#3‰∏∫anpÊ∑ªÂä†‰ª£ÁêÜÁ≠ñÁï•" title="Direct link to heading">‚Äã</a></h3><p>Âú®OpenYurtÁöÑÁΩëÁªúÊ®°Âûã‰∏ãÔºåËæπÁºòËäÇÁÇπÂàÜÂ∏ÉÂú®‰∏çÂêåÁöÑnetwork region‰∏≠ÔºåÈöèÊú∫ÈÄâÊã©ÁöÑ agent ÂèØËÉΩÊó†Ê≥ïÂ∞ÜËØ∑Ê±ÇËΩ¨ÂèëËá≥‰Ωç‰∫éÂÖ∂‰ªñ region ÂÜÖÁöÑËäÇÁÇπ‰∏ä„ÄÇÂõ†Ê≠§Êàë‰ª¨‰∏çÂæó‰∏ç‰øÆÊîπ ANP server Â∫ïÂ±Ç‰ª£ÁêÜËΩ¨ÂèëÁöÑÈÄªËæë„ÄÇÁÑ∂ËÄåÔºåÊ†πÊçÆÈïøÊúüÁöÑÁªèÈ™åÔºåÊàë‰ª¨Áõ∏‰ø°Ôºåproxy server ÊîØÊåÅ‰∏çÂêåÁöÑ‰ª£ÁêÜÁ≠ñÁï•Ôºå‰æãÂ¶ÇÔºåÂ∞ÜËØ∑Ê±ÇËΩ¨ÂèëËá≥ÊåáÂÆöÊï∞ÊçÆ‰∏≠ÂøÉÔºåregionÔºåÊàñËÄÖÊåáÂÆö‰∏ªÊú∫ÔºåÊòØ‰∏Ä‰∏™ËæÉ‰∏∫ÈÄöÁî®ÁöÑÈúÄÊ±Ç„ÄÇÁªèËøáÂíå ANP Á§æÂå∫ÂºÄÂèëËÄÖËÆ®ËÆ∫ÔºåÊàë‰ª¨ÂÜ≥ÂÆöÈáçÊûÑ ANP ÁÆ°ÁêÜ agent ËøûÊé•ÁöÑÊé•Âè£ÔºåÂÖÅËÆ∏Áî®Êà∑Ê†πÊçÆÈúÄÊ±ÇÂÆûÁé∞Êñ∞ÁöÑ‰ª£ÁêÜÁ≠ñÁï•ÔºåÂπ∂ËÆ°ÂàíÂ∞ÜËØ• feature ÊúÄÁªàÂêàÂÖ•‰∏äÊ∏∏‰ª£Á†ÅÂ∫ì„ÄÇÁõÆÂâçÈáçÊûÑÂ∑•‰Ωú‰ªçÂú®ËøõË°å‰∏≠ÔºåÂú® Yurttunnel Á¨¨‰∏Ä‰∏™ÂºÄÊ∫êÁâàÊú¨‰∏≠ÔºåÊàë‰ª¨ÊöÇÊó∂ÈááÁî®‰ª•‰∏ãÈÖçÁΩÆÔºö</p><ul><li><p>Âú®ÊØè‰∏™ËæπÁºòËäÇÁÇπ‰∏äÈÉ®ÁΩ≤‰∏Ä‰∏™ agent„ÄÇ</p></li><li><p>agent Âú® server Â§ÑÁôªËÆ∞Êó∂Ôºå‰ΩøÁî® agent ÊâÄÂú®ËäÇÁÇπÁöÑ IP ‰Ωú‰∏∫ agentID„ÄÇ</p></li><li><p>server Âú®ËΩ¨ÂèëËØ∑Ê±ÇÊó∂ÔºåÈÄöËøáÂåπÈÖçËØ∑Ê±ÇÁõÆÊ†á IP Âíå agentIDÔºåÂ∞ÜËØ∑Ê±ÇËΩ¨ÂèëËá≥ÂØπÂ∫îÁöÑ agent„ÄÇ</p></li></ul><p>Êàë‰ª¨ËÆ°ÂàíÂú®OpenYurtÂêéÁª≠ÂèëÂ∏ÉYurt UnitÔºàËæπÁºòËäÇÁÇπÂàÜÂå∫ÁÆ°ÊéßÔºâ‰πãÂêéÔºåÈÖçÂêàÊñ∞Â¢ûÁöÑANP‰ª£ÁêÜËΩ¨ÂèëÁ≠ñÁï•ÔºåÂÆûÁé∞agentÁöÑÂàÜÂå∫ÈÉ®ÁΩ≤ÔºåÂíåËØ∑Ê±ÇÁöÑÂàÜÂå∫ËΩ¨Âèë„ÄÇ</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="4Âä®ÊÄÅÁî≥ËØ∑ÂÆâÂÖ®ËØÅ‰π¶">4.Âä®ÊÄÅÁî≥ËØ∑ÂÆâÂÖ®ËØÅ‰π¶<a aria-hidden="true" class="hash-link" href="#4Âä®ÊÄÅÁî≥ËØ∑ÂÆâÂÖ®ËØÅ‰π¶" title="Direct link to heading">‚Äã</a></h3><p>‰∏∫‰∫ÜËß£Èô§yurttunnelÁªÑ‰ª∂ÂØπËäÇÁÇπËØÅ‰π¶ÁöÑ‰æùËµñÔºåÊàë‰ª¨Âú®yurttunnel‰∏≠Êñ∞Â¢ûcert managerÁªÑ‰ª∂Ôºåcert manager‰ºöÂú®serverÂíåagentËøêË°åÂêéÔºåÂêëKASÊèê‰∫§certificate signning request(CSR)„ÄÇserver Â∞Ü‰ΩøÁî®Áî≥ËØ∑Âà∞ÁöÑËØÅ‰π¶Êù•Á°Æ‰øùÂÖ∂‰∏é KAS Âíå agent Èó¥ÁöÑÂÆâÂÖ®ÈÄö‰ø°Ôºåagent ‰ºö‰ΩøÁî®Áî≥ËØ∑Âà∞ÁöÑËØÅ‰π¶Á°Æ‰øùÂÖ∂‰∏é server Èó¥ gRPC ‰ø°ÈÅìÁöÑÂÆâÂÖ®„ÄÇÁî±‰∫é agent Âíå kubelet Èó¥ÊòØÈÄöËøá tcp ÂçèËÆÆËøûÊé•ÔºåÂõ†Ê≠§ÔºåÊàë‰ª¨Êó†ÈúÄ‰∏∫ agent Âíå kubelet Èó¥ÁöÑËøûÊé•ÂáÜÂ§áËØÅ‰π¶„ÄÇ</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="5ÂéãÁº©tunnelÂ∏¶ÂÆΩËäÇÁ∫¶ÊàêÊú¨">5.ÂéãÁº©TunnelÂ∏¶ÂÆΩÔºåËäÇÁ∫¶ÊàêÊú¨<a aria-hidden="true" class="hash-link" href="#5ÂéãÁº©tunnelÂ∏¶ÂÆΩËäÇÁ∫¶ÊàêÊú¨" title="Direct link to heading">‚Äã</a></h3><p>Âú®‰∏äÊñáÔºåÊàë‰ª¨ÊèêÂà∞Ôºå‰ΩøÁî®gRPCÂ∞ÅË£ÖTunnelËôΩÁÑ∂ÂèØ‰ª•ÊèêÈ´ò‰º†ËæìÁ®≥ÂÆöÊÄßÔºå‰ΩÜÂêåÊó∂‰πü‰ºöÂ¢ûÂä†ÂÖ¨ÁΩëÊµÅÈáè„ÄÇËøôÊòØÂê¶ÊÑèÂë≥ÁùÄÁ®≥ÂÆöÊÄßÂíåÊÄßËÉΩÔºåÊàë‰ª¨Âè™ËÉΩ‰∫åÈÄâ‰∏ÄÔºüÈÄöËøáÂØπ‰∏çÂêåÁî®Êà∑Âú∫ÊôØÁöÑÂàÜÊûêÔºåÊàë‰ª¨ÂèëÁé∞ÔºåÂú®Â§ßÂ§öÊï∞ÊÉÖÂÜµ‰∏ãÔºåÁî®Êà∑‰ΩøÁî®ËøêÁª¥ÈÄöÈÅìÊòØ‰∏∫‰∫ÜËé∑ÂèñÂÆπÂô®Êó•ÂøóÔºàÂç≥ kubectl logÔºâÔºåËÄå‰º†ÁªüÊó•ÂøóÊñá‰ª∂ÔºåÂ≠òÂú®ËÆ∏Â§öÁõ∏ÂêåÁöÑÊñáÊú¨‰ø°ÊÅØÔºåÂõ†Ê≠§Êàë‰ª¨Êé®Êñ≠‰ΩøÁî® gzip Á≠âÂéãÁº©ÁÆóÊ≥ïËÉΩÊúâÊïàÁº©Â∞èÂ∏¶ÂÆΩ„ÄÇ‰∏∫‰∫ÜÈ™åËØÅËøô‰∏ÄÂÅáËÆæÔºåÊàë‰ª¨Âú® ANP Â∫ïÂ±ÇÁöÑ gRPC Â∫ì‰∏≠Ê∑ªÂä†‰∫Ü gzip compressorÔºåÂπ∂‰∏îÂØπÊØî‰∫Ü‰∏é‰ΩøÁî®ÂéüÁîü TCP ËøûÊé•Âú∫ÊôØ‰∏ãÁöÑÊï∞ÊçÆ‰º†ËæìÈáè„ÄÇ</p><p>Êàë‰ª¨ËÄÉËôëÁöÑÁ¨¨‰∏Ä‰∏™ÂÆûÈ™åÂú∫ÊôØÊòØÔºåÂàÜÂà´ÈÄöËøá TCP ËøûÊé•Âíå ANP Ëé∑ÂèñÂêå‰∏Ä kubeproxy ÂÆπÂô®ÁöÑÊó•ÂøóÔºåÊàë‰ª¨Êà™Âèñ‰∫ÜËøô‰∏ÄËøáÁ®ã‰∏≠ Tunnel ‰∏äÂèåÂêë package Âíå bytes ÊÄªÈáè„ÄÇ</p><p><img alt="image" src="data:image/png;base64,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"></p><p>Â¶Ç‰∏äË°®ÊâÄÁ§∫ÔºåÈÄöËøá‰ΩøÁî® ANPÔºå ÊÄª‰º†ËæìÊï∞ÊçÆÈáè‰∏ãÈôç‰∫Ü 29.93%„ÄÇ</p><p>ÁªèËøáÈïøÊó∂Èó¥ËøêË°åÔºåÂÆπÂô®ÁöÑÊó•ÂøóÊñáÊú¨Â∏∏Â∏∏ÂèØ‰ª•ËææÂà∞ÂçÅÂá†ÂÖÜÔºå‰∏∫‰∫ÜÊ®°ÊãüËé∑ÂèñÂ§ßÊñáÊú¨Êó•ÂøóÁöÑÂú∫ÊôØ„ÄÇÊàë‰ª¨ÂàõÂª∫‰∫Ü‰∏ÄÂåÖÂê´ 10.5M systemd logÔºàÂç≥ journalctlÔºâÁöÑ ubuntu ÂÆπÂô®ÔºåÂêåÊ†∑Êàë‰ª¨ÂàÜÂà´‰ΩøÁî®ÂéüÁîü TCP ËøûÊé•Âíå ANP ‰º†ËæìËØ•Êó•ÂøóÊñá‰ª∂ÔºåÂπ∂ÊµãÈáè‰∫Ü Tunnel ‰∏äÁöÑÊï∞ÊçÆÊÄªÈáè
<img alt="image" src="/assets/images/large_log-134be99fb1d206593ae4701ab02ec08a.png"></p><p>Â¶Ç‰∏äË°®ÊâÄÁ§∫ÔºåÂú®Êó•ÂøóÊñáÊú¨ËæÉÂ§ßÁöÑÊÉÖÂÜµ‰∏ãÔºåÈÄöËøá‰ΩøÁî® ANPÔºå ÊÄª‰º†ËæìÊï∞ÊçÆÈáè‰∏ãÈôç‰∫Ü 40.85%„ÄÇ</p><p>Áî±Ê≠§ÂèØËßÅÔºåÁõ∏ËæÉ‰∫éÂéüÁîü TCP ËøûÊé•ÔºåANP ‰∏ç‰ªÖËÉΩÊèê‰æõÊõ¥È´òÁöÑ‰º†ËæìÁ®≥ÂÆöÊÄßÔºåËøòÂèØ‰ª•Â§ßÂπÖÈôç‰ΩéÂÖ¨ÁΩëÊµÅÈáè„ÄÇËÄÉËôëÂà∞ËæπÁºòÈõÜÁæ§Âä®ËæÑ‰∏ä‰∏áÁöÑËäÇÁÇπËßÑÊ®°ÔºåÊñ∞ÁöÑËß£ÂÜ≥ÊñπÊ°àÂ∞ÜÂ∏ÆÂä©Áî®Êà∑Âú®ÂÖ¨ÁΩëÊµÅÈáèÊñπÈù¢ËäÇÁ∫¶Â§ßÈáèÂºÄÈîÄ„ÄÇ</p><p>##YurttunnelÁ≥ªÁªüÊû∂ÊûÑ
<img alt="image" src="/assets/images/Yurttunnel_arch-a35ea31101910abdd501f7313b7d0a43.png"></p><p>Áªº‰∏äÔºåYurttunnel ‰∏ªË¶ÅÂåÖÂê´‰ª•‰∏ãÁªÑ‰ª∂Ôºö</p><ul><li><p>Yurttunnel Server - Ë¥üË¥£Â∞Ü apiserverÔºåprometheusÔºåmetrics server Á≠âÁÆ°ÊéßÁªÑ‰ª∂ÂèëÂæÄËäÇÁÇπÁöÑËØ∑Ê±ÇÔºåËΩ¨ÂèëËá≥ÂØπÂ∫îÁöÑ agent„ÄÇÂÖ∑‰ΩìÂåÖÊã¨‰ª•‰∏ãÂ≠êÁªÑ‰ª∂Ôºö</p><ul><li>ANP Proxy Server - ÂØπ ANP gRPC server ÁöÑÂ∞ÅË£ÖÔºåË¥üË¥£ÁÆ°ÁêÜ‰∏é Yurttunnel Agent ‰πãÈó¥ÁöÑÈïøËøûÊé•ÔºåÂπ∂ËΩ¨ÂèëËØ∑Ê±Ç„ÄÇ</li><li>Iptable Manager - ‰øÆÊîπÁÆ°ÊéßËäÇÁÇπÁöÑ DNAT ËßÑÂàôÔºå‰ª•Á°Æ‰øùÁÆ°ÊéßÁªÑ‰ª∂ÁöÑËØ∑Ê±ÇËÉΩË¢´ËΩ¨ÂèëËá≥ Yurttunnel Server„ÄÇ</li><li>Cert Manager - ‰∏∫ Yurttunnel Server ÁîüÊàê TLS ËØÅ‰π¶„ÄÇ</li><li>Request Interceptor - Â∞Ü KAS ÂØπËäÇÁÇπÁöÑ HTTP ËØ∑Ê±ÇÂ∞ÅË£ÖÂà∞Á¨¶Âêà ANP ËßÑÂàôÁöÑ gRPC ÂåÖÈáå„ÄÇ</li></ul></li><li><p>Yurttunnel Agent - ‰∏é Yurttunnel Server ‰∏ªÂä®Âª∫Á´ãËøûÊé•ÔºåÂπ∂Â∞Ü Yurttunnel Server ÂèëÊù•ÁöÑËØ∑Ê±ÇËΩ¨ÂèëÁªô Kubelet„ÄÇÂÖ∑‰ΩìÂåÖÊã¨‰∏§‰∏™Â≠êÁªÑ‰ª∂Ôºö</p><ul><li>ANP Proxy Agent - ÂØπ ANP gRPC agent ÁöÑÂ∞ÅË£ÖÔºåÁõ∏ËæÉ‰∫é‰∏äÊ∏∏ÔºåÊàë‰ª¨È¢ùÂ§ñÂä†ÂÖ•‰∫Ü gzip compressor ‰ª•ÂéãÁº©Êï∞ÊçÆ„ÄÇ</li><li>Cert Manager - ‰∏∫ Yurttunnel Agent ÁîüÊàê TLS ËØÅ‰π¶„ÄÇ</li></ul></li><li><p>Yurttunnel Server Service - ÈÄöÂ∏∏ÊòØ‰∏Ä‰∏™ SLBÔºåË¥üË¥£Â∞ÜÁÆ°ÊéßÁªÑ‰ª∂ÂèëÊù•ÁöÑËØ∑Ê±ÇÂàÜÂèëÁªôÂêàÈÄÇÁöÑ Yurttunnel Server ÂâØÊú¨Ôºå‰øùËØÅ Yurttunnel ÁöÑÈ´òÂèØÁî®ÂíåË¥üËΩΩÂùáË°°„ÄÇ</p></li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="ÊÄªÁªìÂíåÂ±ïÊúõ">ÊÄªÁªìÂíåÂ±ïÊúõ<a aria-hidden="true" class="hash-link" href="#ÊÄªÁªìÂíåÂ±ïÊúõ" title="Direct link to heading">‚Äã</a></h2><p>Yurttunnel ‰Ωú‰∏∫ OpenYurt ËøëÊúüÂºÄÊ∫êÁöÑÈáçË¶ÅÁªÑ‰ª∂ÔºåÊâìÈÄö‰∫Ü OpenYurt ÈõÜÁæ§ÁöÑ‰∫ëËæπÈÄöÈÅìÔºå‰∏∫ËæπÁºòÈõÜÁæ§‰∏äÁöÑÂÆπÂô®ËøêÁª¥Êèê‰æõ‰∫Ü‰∏Ä‰∏™Áªü‰∏ÄÁöÑÂÖ•Âè£„ÄÇÈÄöËøáÂØπ‰∏äÊ∏∏Ëß£ÂÜ≥ÊñπÊ°àËøõË°åÊîπÈÄ†ÔºåYurttunnel ‰∏ç‰ªÖÊèê‰æõ‰∫ÜÊõ¥È´òÁöÑ‰º†ËæìÁ®≥ÂÆöÊÄßÔºå‰πüÂ§ßÂπÖÈôç‰Ωé‰∫ÜÊï∞ÊçÆ‰º†ËæìÈáè„ÄÇ</p><p><a href="https://mp.weixin.qq.com/s/nRUv4u9JbiIdrUPB_cZOBg" target="_blank" rel="noopener noreferrer">ÂéüÊñáÈìæÊé•</a></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/blog/tags/yurttunnel">yurttunnel</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_d4p0" itemprop="headline"><a itemprop="url" href="/blog/Expansion-capability-of-Yurthub">Viewing Expansion Ability of YurtHub from Edge Autonomy</a></h2><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2020-06-29T00:00:00.000Z" itemprop="datePublished">June 29, 2020</time> ¬∑ <!-- -->10 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://github.com/rambohe-ch" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://github.com/rambohe-ch.png" alt="rambohe"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/rambohe-ch" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">rambohe</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of OpenYurt</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>ÂØºËØªÔºöOpenYurt Ëá™ÂºÄÊ∫ê‰ª•Êù•Ôºå‰ª•Èùû‰æµÂÖ•ÂºèÁöÑÊû∂ÊûÑËÆæËÆ°ËûçÂêà‰∫ëÂéüÁîüÂíåËæπÁºòËÆ°ÁÆó‰∏§Â§ßÈ¢ÜÂüüÔºåÂºïËµ∑‰∫Ü‰∏çÂ∞ëË°å‰∏öÂÜÖÂêåÂ≠¶ÁöÑÂÖ≥Ê≥®„ÄÇÈòøÈáå‰∫ëÊé®Âá∫ÂºÄÊ∫êÈ°πÁõÆ OpenYurtÔºå‰∏ÄÊñπÈù¢ÊòØÊääÈòøÈáå‰∫ëÂú®‰∫ëÂéüÁîüËæπÁºòËÆ°ÁÆóÈ¢ÜÂüüÁöÑÁªèÈ™åÂõûÈ¶àÁªôÂºÄÊ∫êÁ§æÂå∫ÔºåÂè¶‰∏ÄÊñπÈù¢‰πüÂ∏åÊúõÂä†ÈÄü‰∫ëËÆ°ÁÆóÂêëËæπÁºòÂª∂‰º∏ÁöÑËøõÁ®ãÔºåÂπ∂ÂíåÁ§æÂå∫ÂÖ±ÂêåÊé¢ËÆ®Êú™Êù•‰∫ëÂéüÁîüËæπÁºòËÆ°ÁÆóÊû∂ÊûÑÁöÑÁªü‰∏ÄÊ†áÂáÜ„ÄÇ
Êú¨Êñá‰∏ªË¶Å‰ªãÁªç‰∫Ü OpenYurt ‰∏≠ÁªÑ‰ª∂ YurtHub ÁöÑÊâ©Â±ïËÉΩÂäõ„ÄÇ</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="openyurt‰ªãÁªç">OpenYurt‰ªãÁªç<a aria-hidden="true" class="hash-link" href="#openyurt‰ªãÁªç" title="Direct link to heading">‚Äã</a></h2><p>ÈòøÈáå‰∫ëËæπÁºòÂÆπÂô®ÊúçÂä°‰∏äÁ∫ø 1 Âπ¥ÂêéÔºåÊ≠£ÂºèÂºÄÊ∫ê‰∫Ü‰∫ëÂéüÁîüËæπÁºòËÆ°ÁÆóËß£ÂÜ≥ÊñπÊ°à OpenYurtÔºåË∑üÂÖ∂‰ªñÂºÄÊ∫êÁöÑÂÆπÂô®ÂåñËæπÁºòËÆ°ÁÆóÊñπÊ°àÁöÑÂå∫Âà´Âú®‰∫éÔºöOpenYurt ÁßâÊåÅ Extending your native Kubernetes to edge ÁöÑÁêÜÂøµÔºåÂØπ Kubernetes Á≥ªÁªüÈõ∂‰øÆÊîπÔºåÂπ∂Êèê‰æõ‰∏ÄÈîÆÂºèËΩ¨Êç¢ÂéüÁîü Kubernetes ‰∏∫ openyurtÔºåËÆ©ÂéüÁîü K8s ÈõÜÁæ§ÂÖ∑Â§áËæπÁºòÈõÜÁæ§ËÉΩÂäõ„ÄÇ</p><p>ÂêåÊó∂ÈöèÁùÄ OpenYurt ÁöÑÊåÅÁª≠ÊºîËøõÔºå‰πü‰∏ÄÂÆö‰ºöÁªßÁª≠‰øùÊåÅÂ¶Ç‰∏ãÂèëÂ±ïÁêÜÂøµÔºö</p><ul><li><p>Èùû‰æµÂÖ•ÂºèÂ¢ûÂº∫ K8s</p></li><li><p>‰øùÊåÅÂíå‰∫ëÂéüÁîüÁ§æÂå∫‰∏ªÊµÅÊäÄÊúØÂêåÊ≠•ÊºîËøõ</p></li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="yurthubÊû∂ÊûÑËØ¥Êòé">YurtHubÊû∂ÊûÑËØ¥Êòé<a aria-hidden="true" class="hash-link" href="#yurthubÊû∂ÊûÑËØ¥Êòé" title="Direct link to heading">‚Äã</a></h2><p>Âú®<a href="/blog/YurtHub-design-detail">ÂâçÈù¢ÁöÑÊñáÁ´†</a>‰∏≠ÔºåÊàë‰ª¨‰ªãÁªç‰∫Ü OpenYurt ÁöÑËæπÁºòËá™Ê≤ªËÉΩÂäõÔºåÈáçÁÇπËß£ËØª‰∫ÜÂÖ∂‰∏≠ÁöÑÁªÑ‰ª∂ YurtHub„ÄÇÂÖ∂Êû∂ÊûÑÂõæÂ¶Ç‰∏ãÔºö
OpenYurtÁªÑ‰ª∂YurtHubÊûÑÊû∂ÂõæÔºö</p><p><img alt="image" src="/assets/images/yurthub-40267e14a620859d35d3085eb5de2d24.png"></p><p>‰∏éKubernetesËÆæËÆ°ÁêÜÂøµÂ•ëÂêàÔºåYurtHubÁöÑ‰ºòÂäø‰πã‰∏ÄÊòØÔºåÈùûÂ∏∏ÂÆπÊòìÊâ©Â±ïÂá∫Êõ¥Â§öÁöÑËÉΩÂäõ„ÄÇ</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="yurthubÁöÑÊãìÂ±ïËÉΩÂäõ">YurtHubÁöÑÊãìÂ±ïËÉΩÂäõ<a aria-hidden="true" class="hash-link" href="#yurthubÁöÑÊãìÂ±ïËÉΩÂäõ" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="1ËæπÁºòÁΩëÁªúËá™Ê≤ª">1ÔºâËæπÁºòÁΩëÁªúËá™Ê≤ª<a aria-hidden="true" class="hash-link" href="#1ËæπÁºòÁΩëÁªúËá™Ê≤ª" title="Direct link to heading">‚Äã</a></h3><p>È¶ñÂÖà‰ªãÁªç‰∏Ä‰∏ã‰ΩïË∞ìËæπÁºòÁΩëÁªúËá™Ê≤ªÔºöÂç≥Âú®ËæπÁºòÂíå‰∫ëÁ´ØÁΩëÁªúÊñ≠ËøûÊó∂Ôºå‰∏çÁÆ°ÊòØ‰∏öÂä°ÂÆπÂô®ÈáçÂêØÔºåÊàñÊòØËæπÁºòËäÇÁÇπÈáçÂêØÁ≠âÔºåËæπÁºò‰∏öÂä°ÁöÑË∑®ËäÇÁÇπÈÄö‰ø°ÂèØ‰ª•ÊåÅÁª≠Â∑•‰ΩúÊàñÊòØËá™Âä®ÊÅ¢Â§ç„ÄÇ</p><p>Âú®OpenYurt‰∏≠ÔºåÂÆûÁé∞ËæπÁºòËá™Ê≤ªÈúÄË¶ÅËß£ÂÜ≥Â¶Ç‰∏ãÁöÑÈóÆÈ¢òÔºà‰ª•flannel vxlan overlayÁΩëÁªú‰∏∫‰æãÔºâÔºö</p><ul><li>ÈóÆÈ¢ò 1: ËäÇÁÇπ‰∏äÁöÑÁΩëÁªúÈÖçÁΩÆÂèØ‰ª•Ëá™Ê≤ªÔºåkube-proxy ÁöÑ iptables / ipvs ËßÑÂàôÔºåflannel ÁöÑ fdb / arp / route ÈÖçÁΩÆÔºåcoredns ÁöÑÂüüÂêçËß£ÊûêÁ≠âÁΩëÁªúÈÖçÁΩÆÔºåÂú®ËäÇÁÇπÈáçÂêØÂêéÂèØ‰ª•Ëá™Âä®ÊÅ¢Â§çÔºåÂê¶ÂàôËæπÁºòË∑®ËäÇÁÇπÈÄö‰ø°Â∞ÜÊó†Ê≥ïÊåÅÁª≠Ôºõ</li><li>ÈóÆÈ¢ò 2: ‰∏öÂä°ÂÆπÂô® IP ‰øùÊåÅ‰∏çÂèòÔºåÂõ†‰∏∫Âíå‰∫ëÁ´ØÁΩëÁªúÊñ≠ËøûÁä∂ÊÄÅ‰∏ãÂÆπÂô® IP ÂèòÂåñÂ∞ÜÊó†Ê≥ïÈÄöÁü•Âà∞ÂÖ∂‰ªñËäÇÁÇπÔºõ</li><li>ÈóÆÈ¢ò 3: vtep(vxlan tunnel endpoint) ÁöÑ mac Âú∞ÂùÄ‰øùÊåÅ‰∏çÂèòÔºåÂéüÂõ†ÂíåÂÆπÂô® IP ‰øùÊåÅ‰∏çÂèòÁ±ª‰ºº„ÄÇ</li></ul><p>‰ªéÈóÆÈ¢ò 1 ÂèØ‰ª•ÁúãÂá∫ÔºåÂøÖÈ°ªËß£ÂÜ≥ kube-proxy / flannel / coredns Á≠âÁªÑ‰ª∂ÁöÑËá™Ê≤ªÔºåÊâçËÉΩÂÆûÁé∞ÁΩëÁªúÈÖçÁΩÆÁöÑËá™Ê≤ª„ÄÇÂ¶ÇÊûú‰πãÂâçËæπÁºòËá™Ê≤ªÊòØÈááÁî®ÈáçÊûÑ kubelet Êù•ÂÆûÁé∞ÁöÑËØùÔºåË¶ÅÂÆûÁé∞ËæπÁºòÁΩëÁªúËá™Ê≤ªÂ∞±‰ºöÁ¢∞Âà∞ÂæàÂ§ßÁöÑÈ∫ªÁÉ¶ÔºåÂ¶ÇÊûúÂº∫Ë°åÊääÈáçÊûÑÁöÑ kubelet Ëá™Ê≤ªËÉΩÂäõÁßªÊ§çÂà∞ÂêÑ‰∏™ÁΩëÁªúÁªÑ‰ª∂ (kube-proxy / flannel / coredns)Ôºå‰πüÂØπÊï¥‰∏™Êû∂ÊûÑÂ∞ÜÊòØÂô©Ê¢¶„ÄÇ</p><p>Âú® OpenYurt ‰∏≠Âõ†‰∏∫ YurtHub ÁöÑÁã¨Á´ãÊÄßÔºåkube-proxy / flannel / coredns Á≠âÁΩëÁªúÁªÑ‰ª∂ËΩªÊùæ‰ΩøÁî® YurtHub Êù•ÂÆûÁé∞ÁΩëÁªúÈÖçÁΩÆÁöÑËá™Ê≤ªËÉΩÂäõ„ÄÇÂõ†‰∏∫ YurtHub ÁºìÂ≠ò‰∫Ü service Á≠âÁΩëÁªúÈÖçÁΩÆËµÑÊ∫êÂú® local storageÔºåÂç≥‰ΩøÊñ≠ÁΩëÂπ∂‰∏îËäÇÁÇπÈáçÂêØÔºåÁΩëÁªúÁªÑ‰ª∂‰ªçÁÑ∂ÂèØ‰ª•Ëé∑ÂæóÊñ≠ÁΩëÂâçÁöÑ object Áä∂ÊÄÅ‰ª•ÂèäÁõ∏Â∫îÁöÑÈÖçÁΩÆ‰ø°ÊÅØ„ÄÇÂ¶Ç‰∏ãÂõæÊâÄÁ§∫:</p><p><img alt="image" src="/assets/images/local_storage-1840a2ad53f7d9f8ea961465a9104ee8.png"></p><p>ÈóÆÈ¢ò 2Ôºå3 Âíå Kubernetes core Êó†ÂÖ≥Ôºå‰∏ªË¶ÅÊ∂âÂèäÂà∞ cni Êèí‰ª∂Âíå flanneld ÁöÑÂ¢ûÂº∫ÔºåÂêéÁª≠ÊñáÁ´†‰∏≠ÂÜçËØ¶ÁªÜ‰ªãÁªç„ÄÇ</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="2Â§ö‰∫ëÁ´ØÂú∞ÂùÄÊîØÊåÅ">2ÔºâÂ§ö‰∫ëÁ´ØÂú∞ÂùÄÊîØÊåÅ<a aria-hidden="true" class="hash-link" href="#2Â§ö‰∫ëÁ´ØÂú∞ÂùÄÊîØÊåÅ" title="Direct link to heading">‚Äã</a></h3><p>ÂÖ¨Êúâ‰∫ë‰∏äÁöÑ Kubernetes È´òÂèØÁî®ÈÉ®ÁΩ≤Êó∂ÔºåÂ§öÂÆû‰æã kube-apiserver ÂâçÈù¢‰∏ÄËà¨ÈÉΩÊåÇ‰∫Ü‰∏Ä‰∏™ SLBÔºå‰ΩÜÊòØÂú®‰∏ìÊúâ‰∫ëÂú∫ÊôØ‰∏ãÊàñËÄÖËæπÁºòËÆ°ÁÆóÂú∫ÊôØ‰∏ãÔºåËäÇÁÇπÈúÄË¶ÅÈÄöËøáÂ§ö‰∏™‰∫ëÁ´ØÂú∞ÂùÄÊù•ËÆøÈóÆ„ÄÇÊØîÂ¶Ç:</p><ul><li>‰∏ìÊúâ‰∫ëÂú∫ÊôØÔºöÂõ†‰∏∫Ê≤°Êúâ SLB ÊúçÂä°ÔºåÁî®Êà∑ÈúÄË¶ÅÂú®‰∫ëÁ´ØÈÄöËøá VIP ÊñπÂºèÊù•Ëá™Ë°åÂÆûÁé∞ kube-apiserver ÁöÑË¥üËΩΩÂùáË°°ÔºåÊàñËÄÖÂÉè kubespray ÈÇ£Ê†∑Âú®ÊØè‰∏™ËäÇÁÇπ‰∏äÈÉ®ÁΩ≤‰∏Ä‰∏™ nginx Êù•ÂÆûÁé∞Â§ö‰∫ëÁ´ØÂú∞ÂùÄÁöÑËÆøÈóÆÔºõ</li><li>ËæπÁºòËÆ°ÁÆóÂú∫ÊôØ: ËÄÉËôëÂà∞ËæπÁºòÂíå‰∫ëÁ´Ø‰πãÈó¥ÁΩëÁªúÁöÑÁ®≥ÂÆöÊÄßÂíåÂÆâÂÖ®ÊÄßË¶ÅÊ±ÇÔºåÊüê‰∫õÂú∫ÊôØ‰∏ãÁî®Êà∑‰πüÈÄöËøá‰∏ìÁ∫øÂíåÂÖ¨ÁΩë‰∏§ÁßçÊñπÂºèÂíå‰∫ëÁ´ØÈÄö‰ø°ÔºåÊØîÂ¶Ç‰ºòÂÖàÈááÁî®‰∏ìÁ∫øÔºåÂΩì‰∏ìÁ∫øÊïÖÈöúÊó∂ËÉΩËá™Âä®ÂàáÊç¢Âà∞ÂÖ¨ÁΩëÈÄö‰ø°„ÄÇ</li></ul><p>YurtHubÊ≠£ÂºèËÄÉËôëÂà∞‰∫Ü‰∏äËø∞ÁöÑÈúÄÊ±ÇÔºåÊîØÊåÅÂ§ö‰∫ëÁ´ØÂú∞ÂùÄËÆøÈóÆ„ÄÇ‰∫ëÁ´ØÂú∞ÂùÄÁöÑË¥üËΩΩÂùáË°°Ê®°ÂºèÂèØ‰ª•ÈÄâÊã©Ôºö</p><ul><li><p>rr(round-robin)ÔºöËΩÆËΩ¨Ê®°ÂºèÔºåÈªòËÆ§ÈÄâÊã©ËØ•Ê®°ÂºèÔºõ</p></li><li><p>priority: ‰ºòÂÖàÁ∫ßÊ®°ÂºèÔºåÈ´ò‰ºòÂÖàÁ∫ßÂú∞ÂùÄÊïÖÈöúÂêéÊâç‰ΩøÁî®‰Ωé‰ºòÂÖàÁ∫ßÂú∞ÂùÄ„ÄÇ</p></li></ul><p>ÂÖ∑‰ΩìÂèØ‰ª•ÂèÇÁÖß YurtHub ÁöÑ LB Ê®°ÂùóÔºåÂ¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö</p><p><img alt="image" src="/assets/images/local_storage-1840a2ad53f7d9f8ea961465a9104ee8.png"></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="3ËäÇÁÇπÁª¥Â∫¶ÁöÑ‰∫ëÁ´ØÊµÅÊéß">3ÔºâËäÇÁÇπÁª¥Â∫¶ÁöÑ‰∫ëÁ´ØÊµÅÊéß<a aria-hidden="true" class="hash-link" href="#3ËäÇÁÇπÁª¥Â∫¶ÁöÑ‰∫ëÁ´ØÊµÅÊéß" title="Direct link to heading">‚Äã</a></h3><p>ÂØπ‰∫é‰∏Ä‰∏™ÂàÜÂ∏ÉÂºèÁ≥ªÁªüÊù•ËØ¥ÔºåÊµÅÊéßÈÉΩÊòØ‰∏Ä‰∏™Êó†Ê≥ïÂõûÈÅøÁöÑÈóÆÈ¢ò„ÄÇÂéüÁîü Kubernetes ‰ªéÈõÜÁæ§ËßÜËßíÂú® kube-apiserver ‰∏≠‰ª•Âèä‰ªéËÆøÈóÆËÄÖËßÜËßíÂú® client-go Â∫ì‰∏≠Â∞ÅË£Ö‰∫ÜÊµÅÈáèÁÆ°ÊéßÔºåÂú®ËæπÁºòËÆ°ÁÆóÂú∫ÊôØ‰∏ãÔºåclient-go ÁöÑÊµÅÈáèÁÆ°ÊéßÊó¢ÂàÜÊï£ÂèàÂØπ‰∏öÂä°Êúâ‰∏ÄÂÆö‰æµÂÖ•ÔºåÊòæÁÑ∂‰∏çËÉΩÂæàÂ•ΩÁöÑËß£ÂÜ≥ÊµÅÊéßÈóÆÈ¢ò„ÄÇ</p><p>YurtHub Âú®ËæπÁºòÂèØ‰ª•Êé•ÁÆ°‰∏çËÆ∫ÊòØÁ≥ªÁªüÁªÑ‰ª∂ËøòÊòØ‰∏öÂä°ÂÆπÂô®ÂØπ‰∫ëÁ´ØËÆøÈóÆÁöÑÊµÅÈáèÔºåÂèØ‰ª•ÂæàÂ•ΩÁöÑËß£ÂÜ≥ËäÇÁÇπÁª¥Â∫¶ÁöÑ‰∫ëÁ´ØÊµÅÊéßÈóÆÈ¢ò„ÄÇÁõÆÂâç YurtHub ÁöÑÊµÅÊéßÈÖçÁΩÆÊòØÔºöÂçïËäÇÁÇπ‰∏äÂØπ‰∫ëÁ´ØÁöÑÂπ∂ÂèëËØ∑Ê±ÇÊï∞Ë∂ÖËøá 250 ‰∏™Êó∂ÔºåÂ∞ÜÊãíÁªùÊñ∞ÁöÑËØ∑Ê±Ç„ÄÇ</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="4ËäÇÁÇπËØÅ‰π¶ËΩÆËΩ¨ÁÆ°ÁêÜ">4ÔºâËäÇÁÇπËØÅ‰π¶ËΩÆËΩ¨ÁÆ°ÁêÜ<a aria-hidden="true" class="hash-link" href="#4ËäÇÁÇπËØÅ‰π¶ËΩÆËΩ¨ÁÆ°ÁêÜ" title="Direct link to heading">‚Äã</a></h3><p>Kubernetes Â∑≤ÁªèÊîØÊåÅËäÇÁÇπËØÅ‰π¶Ëá™Âä®ËΩÆÊç¢ÔºåÂç≥ÂΩìËäÇÁÇπËØÅ‰π¶Âø´ËøáÊúüÂâçÔºåkubelet ‰ºöËá™Âä®Âêë‰∫ëÁ´ØÁî≥ËØ∑Êñ∞ÁöÑËäÇÁÇπËØÅ‰π¶„ÄÇ‰ΩÜÊòØÂú®ËæπÁºòËÆ°ÁÆóÂú∫ÊôØ‰∏ãÔºåÂæàÊúâÂèØËÉΩÂõ†‰∏∫ËæπÁºòÂíå‰∫ëÁ´ØÁΩëÁªúÁöÑÊñ≠ËøûÔºåÈÄ†Êàê kubelet Â∞ÜÊó†Ê≥ïÂÆåÊàêËØÅ‰π¶ÁöÑËΩÆÊç¢„ÄÇËØÅ‰π¶ËøáÊúüÂêéÂç≥‰ΩøÂíå‰∫ëÁ´ØÁΩëÁªúËøûÊé•ÊÅ¢Â§çÔºåËäÇÁÇπËØÅ‰π¶‰πüÂèØËÉΩÊó†Ê≥ïËá™Âä®ËΩÆÊç¢ÔºåÂπ∂ÈÄ†Êàê kubelet ÁöÑÈ¢ëÁπÅÈáçÂêØ„ÄÇ</p><p>YurtHub Âú®Êé•ÁÆ°ËäÇÁÇπÂíå‰∫ëÁ´ØÈÄö‰ø°ÊµÅÈáèÊó∂ÔºåÂêåÊó∂‰πüÂèØ‰ª•Êé•ÁÆ°ËäÇÁÇπÁöÑËØÅ‰π¶ÁÆ°ÁêÜ„ÄÇËøôÊ†∑Êó¢Ëß£ÂÜ≥‰∫ÜÂêÑÁ±ªÂÆâË£ÖÂ∑•ÂÖ∑ÂØπËäÇÁÇπËØÅ‰π¶ÁöÑÁÆ°ÁêÜÁöÑ‰∏ç‰∏ÄËá¥Ôºå‰πüËß£ÂÜ≥‰∫ÜËØÅ‰π¶ËøáÊúüÂêéÁΩëÁªúÂÜçÊÅ¢Â§çÊó∂ÁöÑËØÅ‰π¶ËΩÆÊç¢ÈóÆÈ¢ò„ÄÇÂè¶Â§ñÁõÆÂâç YurtHub ËøòÊòØ kubelet ÂÖ±‰∫´ËäÇÁÇπËØÅ‰π¶ÔºåYurtHub ÁöÑÁã¨Á´ãËäÇÁÇπËØÅ‰π¶ÁÆ°ÁêÜÂäüËÉΩÂ∞ÜÂú®ËøëÊúüÂºÄÊ∫ê„ÄÇ</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="5ÂÖ∂‰ªñ">5ÔºâÂÖ∂‰ªñ<a aria-hidden="true" class="hash-link" href="#5ÂÖ∂‰ªñ" title="Direct link to heading">‚Äã</a></h3><p>YurtHub Èô§‰∫ÜÂâçÈù¢‰ªãÁªçÁöÑÊâ©Â±ïËÉΩÂäõÔºåËøòÊúâÂæàÂ§öÊúâ‰ª∑ÂÄºÁöÑËÉΩÂäõÔºåÂú®Ê≠§‰πüÁÆÄÂçï‰ªãÁªçÔºö</p><ul><li>ËäÇÁÇπÂ§öÁßüÈöîÁ¶ªÁÆ°ÁêÜÔºöÂú®ÂÖ∑Â§áÂ§öÁßüÈöîÁ¶ªËÉΩÂäõÁöÑ Kubernetes ÈõÜÁæ§‰∏≠ÔºåÂÅáÂÆöËäÇÁÇπÂΩíÂ±û‰∫éÊüê‰∏™ÁßüÊà∑ÔºåÈÇ£‰πà YurtHub Â∞ÜÂèØ‰ª•Á°Æ‰øùËäÇÁÇπ‰∏äÊâÄÊúâ‰∫ëÁ´ØËØ∑Ê±ÇÈÉΩÂè™ËøîÂõûËäÇÁÇπÊâÄÂ±ûÁßüÊà∑ÁöÑËµÑÊ∫ê„ÄÇÊØîÂ¶ÇËØ¥ list service Â∞ÜÂè™ËøîÂõûËØ•ÁßüÊà∑ÁöÑ service„ÄÇËÄåËøôÁßçÂ§öÁßüÈöîÁ¶ªËÉΩÂäõ‰∏çÈúÄË¶ÅÂÖ∂‰ªñÁªÑ‰ª∂ÂÅö‰ªª‰Ωï‰øÆÊîπ„ÄÇÂΩìÁÑ∂Â¶ÇÊûúË¶ÅÂÆûÁé∞ÈõÜÁæ§ÂÜÖÁöÑÂ§öÁßüÈöîÁ¶ªÔºåÈúÄË¶ÅÈÖçÂêàÁõ∏Â∫îÁöÑÂ§öÁªÑ CRD Á≠âÔºåËØ¶ÁªÜÂèØ‰ª•ÂèÇÁÖß<a href="https://github.com/kubernetes-sigs/multi-tenancy" target="_blank" rel="noopener noreferrer">È°πÁõÆkubernetes-sigs/multi-tenancy</a></li><li>ÈõÜÁæ§Èó¥ËäÇÁÇπËøÅÁßªÔºöÊüê‰∫õÂú∫ÊôØ‰∏ãÔºåËæπÁºòËäÇÁÇπÈúÄË¶Å‰ªéÈõÜÁæ§ A ËøÅÁßªÂà∞ÈõÜÁæ§ BÔºåÂ∏∏ËßÑÊìç‰ΩúÊòØÂÖà‰ªéÈõÜÁæ§ A ‰∏ãÁ∫øÔºåÁÑ∂ÂêéÂÜçÊ¨°Êé•ÂÖ•ÈõÜÁæ§ BÔºåÊúÄÂêéÂú®ÈõÜÁæ§ B ÈÉ®ÁΩ≤ËäÇÁÇπ‰∏äÁöÑÂ∫îÁî®„ÄÇÂõ†‰∏∫ YurtHub ÂØπËäÇÁÇπÊµÅÈáè‰ª•ÂèäËäÇÁÇπËØÅ‰π¶ÁöÑÊé•ÁÆ°ÔºåÂèØ‰ª•Áõ¥Êé•ÂØπ YurtHub Ê≥®ÂÖ•ÈõÜÁæ§BÁöÑ‰ø°ÊÅØÔºåËÆ©ËäÇÁÇπÊó†ÊçüËøÅÁßªÂà∞ÈõÜÁæ§ BÔºõ</li><li>ÈÄöËøáÂüüÂêçËÆøÈóÆ‰∫ëÁ´Økube-apiserverÁ≠âÁ≠â‰∏Ä‰∫õÂÖ∂‰ªñÂäüËÉΩ„ÄÇ</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="ÊÄªÁªì">ÊÄªÁªì<a aria-hidden="true" class="hash-link" href="#ÊÄªÁªì" title="Direct link to heading">‚Äã</a></h2><p>ÈÄöËøá‰∏äËø∞ÁöÑÊâ©Â±ïËÉΩÂäõÂèØ‰ª•ÁúãÂá∫Ôºö</p><ul><li>YurtHub ‰∏ç‰ªÖ‰ªÖÊòØËæπÁºòËäÇÁÇπ‰∏äÁöÑÂ∏¶ÊúâÊï∞ÊçÆÁºìÂ≠òËÉΩÂäõÁöÑÂèçÂêë‰ª£ÁêÜÔºåËÄå‰∏îÂØπ Kubernetes ËäÇÁÇπÂ∫îÁî®ÁîüÂëΩÂë®ÊúüÁÆ°ÁêÜÂä†‰∫Ü‰∏ÄÂ±ÇÊñ∞ÁöÑÂ∞ÅË£ÖÔºåÊèê‰æõËæπÁºòËÆ°ÁÆóÊâÄÈúÄË¶ÅÁöÑÊ†∏ÂøÉÁÆ°ÊéßËÉΩÂäõÔºõ</li></ul><ul><li>YurtHub ‰∏ç‰ªÖ‰ªÖÈÄÇÁî®‰∫éËæπÁºòËÆ°ÁÆóÂú∫ÊôØÔºåÂÖ∂ÂÆûËøòÂèØ‰ª•‰Ωú‰∏∫ËäÇÁÇπ‰æßÁöÑ‰∏Ä‰∏™Â∏∏Â§áÁªÑ‰ª∂ÔºåÈÄÇÁî®‰∫é‰ΩøÁî® Kubernetes ÁöÑ‰ªªÊÑèÂú∫ÊôØ„ÄÇÁõ∏‰ø°Ëøô‰πü‰ºöÈ©±Âä® YurtHub ÂêëÊõ¥È´òÊÄßËÉΩÔºåÊõ¥È´òÁ®≥ÂÆöÊÄßÂèëÂ±ï„ÄÇ</li></ul><p><a href="https://mp.weixin.qq.com/s/gYxK3GLhDRNkHibYgTchOg" target="_blank" rel="noopener noreferrer">ÂéüÊñáÈìæÊé•</a></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/blog/tags/yurthub">yurthub</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_d4p0" itemprop="headline"><a itemprop="url" href="/blog/YurtHub-design-detail">YurtHub Design Detail:edge autonomy of OpenYurt</a></h2><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2020-06-18T00:00:00.000Z" itemprop="datePublished">June 18, 2020</time> ¬∑ <!-- -->7 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://github.com/rambohe-ch" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://github.com/rambohe-ch.png" alt="rambohe"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/rambohe-ch" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">rambohe</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of OpenYurt</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><img alt="image" src="/assets/images/OpenYurt-de0f93f0c16ddb05b6782cbe66107b22.png"></p><p>ÂØºËØªÔºöOpenYurt ÂºÄÊ∫ê‰∏§Âë®‰ª•Êù•Ôºå‰ª•Èùû‰æµÂÖ•ÂºèÁöÑÊû∂ÊûÑËÆæËÆ°ËûçÂêà‰∫ëÂéüÁîüÂíåËæπÁºòËÆ°ÁÆó‰∏§Â§ßÈ¢ÜÂüüÔºåÂºïËµ∑‰∫Ü‰∏çÂ∞ëË°å‰∏öÂÜÖÂêåÂ≠¶ÁöÑÂÖ≥Ê≥®„ÄÇÈòøÈáå‰∫ëÊé®Âá∫ÂºÄÊ∫êÈ°πÁõÆ OpenYurtÔºå‰∏ÄÊñπÈù¢ÊòØÊääÈòøÈáå‰∫ëÂú®‰∫ëÂéüÁîüËæπÁºòËÆ°ÁÆóÈ¢ÜÂüüÁöÑÁªèÈ™åÂõûÈ¶àÁªôÂºÄÊ∫êÁ§æÂå∫ÔºåÂè¶‰∏ÄÊñπÈù¢‰πüÂ∏åÊúõÂä†ÈÄü‰∫ëËÆ°ÁÆóÂêëËæπÁºòÂª∂‰º∏ÁöÑËøõÁ®ãÔºåÂπ∂ÂíåÁ§æÂå∫ÂÖ±ÂêåÊé¢ËÆ®Êú™Êù•‰∫ëÂéüÁîüËæπÁºòËÆ°ÁÆóÊû∂ÊûÑÁöÑÁªü‰∏ÄÊ†áÂáÜ„ÄÇ
Êú¨ÊñáÂ∞ÜËØ¶ÁªÜ‰ªãÁªçOpenYurtÁöÑËæπÁºòËá™Ê≤ªËÉΩÂäõÁöÑËÆæËÆ°ÁªÜËäÇ„ÄÇ</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="ËæπÁºòËá™Ê≤ªÁâπÊÄß">ËæπÁºòËá™Ê≤ªÁâπÊÄß<a aria-hidden="true" class="hash-link" href="#ËæπÁºòËá™Ê≤ªÁâπÊÄß" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="1ÁâπÊÄß‰ªãÁªç">1ÔºâÁâπÊÄß‰ªãÁªç<a aria-hidden="true" class="hash-link" href="#1ÁâπÊÄß‰ªãÁªç" title="Direct link to heading">‚Äã</a></h3><p>Â∞Ü Kubernetes Á≥ªÁªüÂª∂Â±ïÂà∞ËæπÁºòËÆ°ÁÆóÂú∫ÊôØÔºåËæπÁºòËäÇÁÇπÂ∞ÜÈÄöËøáÂÖ¨ÁΩëÂíå‰∫ëÁ´ØËøûÊé•Ôºå‰ªéÂÖ¨ÁΩëÁöÑ‰∏çÁ®≥ÂÆöÊÄß‰ª•ÂèäÊàêÊú¨Á≠âÂõ†Á¥†ËÄÉËôëÔºåËæπÁºòË¶ÅÊ±ÇÊñ≠ÁΩëÁä∂ÊÄÅÊàñËÄÖÂº±ÁΩëÁä∂ÊÄÅ‰∏ãËæπÁºò‰∏öÂä°ÂèØ‰ª•ÊåÅÁª≠ËøêË°å„ÄÇÊàë‰ª¨‰ªé Gartner ÁöÑËæπÁºòËÆ°ÁÆóÊä•Âëä‰∏≠ÊèêÂà∞ÁöÑËæπÁºòËÆ°ÁÆóËØâÊ±Ç‰∏≠ÔºåËæπÁºòËá™Ê≤ª‰πüÊòØ‰∏ªË¶ÅËØâÊ±Ç‰πã‰∏ÄÔºö
<img alt="image" src="/assets/images/Gartner-191be30024185ef4f96cfa64c5018d75.png"></p><p>‰ªé Kubernetes Á≥ªÁªüÊû∂ÊûÑÊù•ÁúãÔºå‰∏ªË¶ÅÂõ†‰∏∫ Slave Agent(Kubelet) ‰∏≠ÁöÑÂÆπÂô®‰ø°ÊÅØ‰øùÂ≠òÂú®ÂÜÖÂ≠ò‰∏≠ÔºåÊñ≠ÁΩëÁä∂ÊÄÅ‰∏ãÂõ†‰∏∫Êó†Ê≥ï‰ªé‰∫ëÁ´ØËé∑Âèñ‰∏öÂä°Êï∞ÊçÆÔºåÂ¶ÇÊûúËäÇÁÇπÊàñËÄÖ Kubelet ÈáçÂêØÔºåÂ∞ÜÊó†Ê≥ïËøõË°å‰∏öÂä°ÂÆπÂô®ÊÅ¢Â§ç„ÄÇ
<img alt="image" src="/assets/images/slave_agent-78fcbd7915b7c27d65a0147c3283c27a.png"></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="2ËæπÁºòËá™Ê≤ªÈúÄË¶ÅËß£ÂÜ≥ÁöÑÈóÆÈ¢ò">2ÔºâËæπÁºòËá™Ê≤ªÈúÄË¶ÅËß£ÂÜ≥ÁöÑÈóÆÈ¢ò<a aria-hidden="true" class="hash-link" href="#2ËæπÁºòËá™Ê≤ªÈúÄË¶ÅËß£ÂÜ≥ÁöÑÈóÆÈ¢ò" title="Direct link to heading">‚Äã</a></h3><p>Âõ†Ê≠§ËæπÁºòËá™Ê≤ªÂú®KubernetesÁ≥ªÁªüÈáåÔºåÈúÄË¶ÅËß£ÂÜ≥‰∏ãÈù¢ÁöÑÈóÆÈ¢òÔºö</p><ul><li><p>ÈóÆÈ¢ò 1ÔºöËäÇÁÇπÂºÇÂ∏∏ÊàñÈáçÂêØÊó∂ÔºåÂÜÖÂ≠òÊï∞ÊçÆ‰∏¢Â§±ÔºåÁΩëÁªúÊñ≠ËøûÊó∂‰∏öÂä°ÂÆπÂô®Êó†Ê≥ïÊÅ¢Â§çÔºõ</p></li><li><p>ÈóÆÈ¢ò 2ÔºöÁΩëÁªúÈïøÊó∂Èó¥Êñ≠ËøûÔºå‰∫ëÁ´ØÊéßÂà∂Âô®ÂØπ‰∏öÂä°ÂÆπÂô®ËøõË°åÈ©±ÈÄêÔºõ</p></li><li><p>ÈóÆÈ¢ò 3ÔºöÈïøÊó∂Èó¥Êñ≠ËøûÂêéÁΩëÁªúÊÅ¢Â§çÊó∂ÔºåËæπÁºòÂíå‰∫ëÁ´ØÊï∞ÊçÆÁöÑ‰∏ÄËá¥ÊÄß‰øùÈöú„ÄÇ</p></li></ul><h4 class="anchor anchorWithStickyNavbar_y2LR" id="ÈóÆÈ¢ò1ÁöÑËß£ÂÜ≥ÊñπÊ°à1">ÈóÆÈ¢ò1ÁöÑËß£ÂÜ≥ÊñπÊ°à1<a aria-hidden="true" class="hash-link" href="#ÈóÆÈ¢ò1ÁöÑËß£ÂÜ≥ÊñπÊ°à1" title="Direct link to heading">‚Äã</a></h4><p>ÈáçÊûÑ kubelet ÁªÑ‰ª∂ÔºåÂ§çÁî®ÊàñËÄÖÂèÇËÄÉ kubelet ÁöÑ checkpoint ÂäüËÉΩÔºåÊåÅ‰πÖÂåñÂÆπÂô®‰∏öÂä°Êï∞ÊçÆÂà∞Êú¨Âú∞Á£ÅÁõòÔºåÁΩëÁªúÊñ≠ËøûÁä∂ÊÄÅ‰∏ãÂà©Áî®Êú¨Âú∞ÁºìÂ≠òÊï∞ÊçÆÂÆûÁé∞‰∏öÂä°ÊÅ¢Â§ç„ÄÇ
<img alt="image" src="/assets/images/checkpoint-7a1381e53605c36f128716d35475b6a5.png">
ËØ•ÊñπÊ°àÁªèËøáÈáçÊûÑ kubeletÔºåÊàêÂäüËß£ÂÜ≥ËæπÁºòËá™Ê≤ªÁöÑÈúÄÊ±ÇÔºåÂÖ∑Â§áÂ¶Ç‰∏ã‰ºòÁÇπÔºö</p><ul><li><p>ÈÄöËøáÈáçÊûÑ kubeletÔºåÊñπ‰æøÂú® kubelet ‰∏≠ÈõÜÊàêÂØπÁ´ØËÆæÂ§áÁöÑÁÆ°ÁêÜËÉΩÂäõÔºõ</p></li><li><p>ÈÄöËøáÈáçÊûÑ kubeletÔºåÂèØ‰ª•ÂØπ kubelet ËøõË°åËΩªÈáèÂåñÊîπÈÄ†„ÄÇÊ≠§‰ºòÁÇπ‰ΩÜÊòØ‰πüÊÑèÂë≥ÁùÄÂéüÁîü kubelet ÂäüËÉΩÁº∫Â§±ÁöÑÈóÆÈ¢ò„ÄÇ</p></li></ul><p>‰ΩÜÊòØ‰πüÊúâÂ¶Ç‰∏ã‰∏çË∂≥Ôºö</p><ul><li><p>ÂèØÁª¥Êä§ÊÄßÂ∑Æ: ‰æµÂÖ•Âºè‰øÆÊîπ kubelet coreÔºåË∑üÈöèÁ§æÂå∫ÁâàÊú¨ÂçáÁ∫ßÈùûÂ∏∏Âõ∞ÈöæÔºåÁÜüÊÇâkubeletÁöÑÂêåÂ≠¶ÈÉΩ‰ºöÊúâÂêåÊÑüÔºåkubelet ÁªÑ‰ª∂Áî±‰∫éÁõ¥Êé•Ë¥üË¥£ËÆ°ÁÆóÔºåÂ≠òÂÇ®ÔºåÁΩëÁªú‰∫§‰∫íÔºåÊâÄ‰ª•ÂÖ∂‰ª£Á†ÅÁªìÊûÑÂíåÈÄªËæëÂºÇÂ∏∏Â§çÊùÇ„ÄÇÂõ†Ê≠§ÊåÅÁª≠Áª¥Êä§‰∏Ä‰∏™Ê∑±Â∫¶‰øÆÊîπËøáÁöÑ kubelet ÁöÑÂ∑•‰ΩúÈáèÂèØÊÉ≥ËÄåÁü•Ôºõ</p></li><li><p>ÂèØÊâ©Â±ïÊÄßÂ∑Æ: Âõ†‰∏∫Ëá™Ê≤ªËÉΩÂäõÁõ¥Êé•ÂÅöÂà∞ÈáçÊûÑÁöÑ kubelet ÁªÑ‰ª∂‰∏≠ÔºåËøôÊ†∑ËæπÁºòËäÇÁÇπÂ¶ÇÊûúÂÖ∂‰ªñÁªÑ‰ª∂(Â¶ÇÁΩëÁªúÁªÑ‰ª∂)ÊÉ≥Â§çÁî®ËæπÁºòËá™Ê≤ªËÉΩÂäõÂ∞ÜÈù¢‰∏¥ÈáçÂ§çÈÄ†ËΩÆÂ≠êÁöÑÂ¢ÉÂú∞Ôºõ</p></li><li><p>Âú∫ÊôØËÄ¶ÂêàÊõ¥Ê∑±: ‰æãÂ¶ÇÂú® kubelet ÈáçÊûÑ‰∏≠Â¢ûÂä†‰∫Ü IOT ËÆæÂ§áÁÆ°ÁêÜÔºåÂ∞ÜÂèØËÉΩ‰Ωø kubelet Âíå IOT Âú∫ÊôØÊ∑±Â∫¶ËÄ¶Âêà„ÄÇ</p></li></ul><h4 class="anchor anchorWithStickyNavbar_y2LR" id="ÈóÆÈ¢ò1ÁöÑËß£ÂÜ≥ÊñπÊ°à2openyurt‰ΩøÁî®ÊñπÊ°à">ÈóÆÈ¢ò1ÁöÑËß£ÂÜ≥ÊñπÊ°à2ÔºàOpenYurt‰ΩøÁî®ÊñπÊ°àÔºâ<a aria-hidden="true" class="hash-link" href="#ÈóÆÈ¢ò1ÁöÑËß£ÂÜ≥ÊñπÊ°à2openyurt‰ΩøÁî®ÊñπÊ°à" title="Direct link to heading">‚Äã</a></h4><p>Âú®ËæπÁºòËäÇÁÇπ‰∏äÂ¢ûÂä† web ÁºìÂ≠òÂèäËØ∑Ê±Ç‰ª£ÁêÜ hub(ÂèñÂêç‰∏∫ YurtHubÔºåÂïÜ‰∏ö‰∫ßÂìÅ‰∏≠Âêç‰∏∫ edge-hub)ÔºåËæπÁºò‰æßÁªÑ‰ª∂(kubelet)Âíå‰∫ëÁ´ØÈÄö‰ø°Â∞ÜÁªèÁî±ËØ•ÁªÑ‰ª∂„ÄÇYurtHub Áõ∏ÂΩì‰∫éÂ∏¶ÊúâÊï∞ÊçÆÁºìÂ≠òÂäüËÉΩÁöÑ‚ÄùÈÄèÊòéÁΩëÂÖ≥‚ÄúÔºåÂíå‰∫ëÁ´ØÁΩëÁªúÊñ≠ËøûÁä∂ÊÄÅ‰∏ãÔºåÂ¶ÇÊûúËäÇÁÇπÊàñËÄÖ kubelet ÈáçÂêØÔºåÂ∞Ü‰ªé YurtHub ‰∏≠Ëé∑ÂèñÂà∞‰∏öÂä°ÂÆπÂô®Áõ∏ÂÖ≥Êï∞ÊçÆÔºåÊúâÊïàËß£ÂÜ≥ËæπÁºòËá™Ê≤ªÁöÑÈóÆÈ¢ò</p><p><img alt="image" src="/assets/images/edge_hub-08066dde85946999b57d59dac0a6cbe8.png"></p><p>Áõ∏ÊØîËß£ÂÜ≥ÊñπÊ°à1ÔºåÊúâÂ¶Ç‰∏ã‰ºòÂäøÔºö</p><ul><li><p>kubelet Èõ∂‰øÆÊîπÔºåÊÑèÂë≥ÂéüÁîü kubelet ËÉΩÂäõÂ§©ÁÑ∂ÂÖ∑Â§áÔºåÂêåÊó∂Ë∑üÈöè Kubernetes ÁâàÊú¨ÂçáÁ∫ßÈõ∂Ë¥üÊãÖÔºõ</p></li><li><p>ÂèØÊâ©Â±ïÊÄßÂº∫ÔºåËäÇÁÇπÂÖ∂‰ªñÁªÑ‰ª∂ËΩªÊùæÂ§çÁî® YurtHubÔºõ</p></li><li><p>‰∏é Kubernetes ËÆæËÆ°ÁêÜÂøµÂ•ëÂêàÔºåYurtHub ÈùûÂ∏∏ÂÆπÊòìÊâ©Â±ïÂá∫Êõ¥Â§öÁöÑËÉΩÂäõ„ÄÇ</p></li></ul><p>ÂΩìÁÑ∂ OpenYurt ÁöÑËß£ÂÜ≥ÊñπÊ°àÔºå‰πü‰ºöÈù¢‰∏¥Â¶Ç‰∏ãÁöÑÈóÆÈ¢òÔºöÂéüÁîü kubelet ÊØîËæÉ high-weightÔºåÂú®ËµÑÊ∫êÁ¥ßÂº†Âú∫ÊôØ‰∏ãÂ∫îÁî®‰ºöÊØîËæÉÊåëÊàò„ÄÇÁõÆÂâçÂïÜ‰∏ö‰∫ßÂìÅ‰∏≠ËäÇÁÇπËßÑÊ†ºÊé®Ëçê 2U4G Ëµ∑Ê≠•„ÄÇ</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="ÈóÆÈ¢ò2ÁöÑËß£ÂÜ≥ÊñπÊ°à">ÈóÆÈ¢ò2ÁöÑËß£ÂÜ≥ÊñπÊ°à<a aria-hidden="true" class="hash-link" href="#ÈóÆÈ¢ò2ÁöÑËß£ÂÜ≥ÊñπÊ°à" title="Direct link to heading">‚Äã</a></h4><p>ËØ•ÈóÆÈ¢òÊ≠£ÊòØÈÄöËøáÂºÄÊ∫êÁªÑ‰ª∂ yurt-controller-manager ‰∏≠ÁöÑ Node Controller Êù•Ëß£ÂÜ≥ÁöÑ„ÄÇÂ¶Ç github ‰∏ªÈ°µ‰ªãÁªçÊâÄÁ§∫Ôºö
<img alt="image" src="/assets/images/OpenYurt_arch-a3dcd2a758bb9c978f52c8a61c6a98f6.png"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="ÈóÆÈ¢ò3ÁöÑËß£ÂÜ≥ÊñπÊ°à">ÈóÆÈ¢ò3ÁöÑËß£ÂÜ≥ÊñπÊ°à<a aria-hidden="true" class="hash-link" href="#ÈóÆÈ¢ò3ÁöÑËß£ÂÜ≥ÊñπÊ°à" title="Direct link to heading">‚Äã</a></h4><p>Kubernetes Á≥ªÁªü‰∏≠ÔºåÁî®Êà∑ÊòØÈÄöËøá‰∫ëÁ´ØÂØπËæπÁºòËøõË°åÁÆ°ÊéßÁöÑ(Â¶ÇÂ∫îÁî®ÈÉ®ÁΩ≤ÔºåÂçáÁ∫ßÔºåÊâ©Áº©ÂÆπÁ≠â)ÔºåÂõ†Ê≠§ÂΩìËæπÁºòÂíå‰∫ëÁ´ØÁΩëÁªúÊñ≠ËÅîÊó∂ÔºåËæπÁºòËäÇÁÇπÂ∞Ü‰∏ç‰ºö‰ªé‰∫ëÁ´ØÂêåÊ≠•Áî®Êà∑ÂØπËäÇÁÇπÁöÑÁÆ°ÊéßÊìç‰ΩúÔºåÂõ†Ê≠§Êñ≠ÁΩëÊúüÈó¥ÔºåÂè™Ë¶Å YurtHub ‰øùÊåÅÊú¨Âú∞ÁºìÂ≠òÊï∞ÊçÆÂíåÊñ≠ÁΩëÊó∂Âàª‰∏ÄËá¥(Âç≥Êñ≠ÁΩëÊúüÈó¥ËæπÁºòÁºìÂ≠òÊï∞ÊçÆ‰∏çÊõ¥Êñ∞)ÔºåËÄåÁΩëÁªúÊÅ¢Â§çÊó∂ÔºåÂÜç‰ªé‰∫ëÁ´ØÂêåÊ≠•ÊúÄÊñ∞Êï∞ÊçÆÂç≥ÂèØ„ÄÇ</p><p><a href="https://mp.weixin.qq.com/s/4BLfvMJJA623ZwRSgUE69A" target="_blank" rel="noopener noreferrer">ÂéüÊñáÈìæÊé•</a></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/blog/tags/yurthub">yurthub</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_d4p0" itemprop="headline"><a itemprop="url" href="/blog/Use-of-yurtctl">Yurtctl:make the native k8s cluster achieve edge computing capabilities</a></h2><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2020-06-08T00:00:00.000Z" itemprop="datePublished">June 8, 2020</time> ¬∑ <!-- -->9 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://github.com/charleszheng44" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://github.com/charleszheng44.png" alt="Chao Zheng"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/charleszheng44" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Chao Zheng</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of OpenYurt</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><img alt="image" src="/assets/images/OpenYurt-de0f93f0c16ddb05b6782cbe66107b22.png"></p><p>ÈöèÁùÄÁâ©ËÅîÁΩëÊäÄÊúØ‰ª•Âèä 5G ÊäÄÊúØÁöÑÈ´òÈÄüÂèëÂ±ïÔºåÂ∞Ü‰∫ëËÆ°ÁÆóÁöÑËÉΩÂäõÂª∂‰º∏Ëá≥ËæπÁºòËÆæÂ§áÁ´ØÔºåÂπ∂ÈÄöËøá‰∏≠ÂøÉËøõË°åÁªü‰∏Ä‰∫§‰ªò„ÄÅÁÆ°ÊéßÔºåÂ∑≤Êàê‰∏∫‰∫ëËÆ°ÁÆóÁöÑÈáçË¶ÅÂèëÂ±ïË∂ãÂäø„ÄÇ‰∏∫ÊúçÂä°Êõ¥Â§öÂºÄÂèëËÄÖÊääÊè°Ëøô‰∏ÄË∂ãÂäøÔºå5Êúà29Êó•ÔºåÈòøÈáåÂ∑¥Â∑¥Ê≠£ÂºèÂØπÂ§ñÂºÄÊ∫ê‰∫ÜÂü∫‰∫é ACK@EdgeÔºàËæπÁºòÈõÜÁæ§ÊâòÁÆ°ÊúçÂä°ÔºâÁöÑ‰∫ëÂéüÁîüËæπÁºòËÆ°ÁÆóÊ°ÜÊû∂ ‚Äî‚Äî
<a href="https://github.com/openyurtio/openyurt" target="_blank" rel="noopener noreferrer">OpenYurt</a></p><p>Ëá™ OpenYurt ÂºÄÊ∫ê‰ª•Êù•ÂèóÂà∞‰∫ÜÂºÄÂèëËÄÖÁöÑÂÖ≥Ê≥®Ôºå‰ªäÂ§©ËøôÁØáÊñáÁ´†Â∞ÜÂ∏¶Â§ßÂÆ∂Âø´ÈÄü‰∏äÊâã OpenYurt Ôºå‰ªãÁªçÂ¶Ç‰Ωï‰ΩøÁî® OpenYurt Êèê‰æõÁöÑÂëΩ‰ª§Ë°åÁÆ°ÁêÜÂ∑•ÂÖ∑ YurtctlÔºå È´òÊïàÂø´ÈÄüÂú∞ÈÉ®ÁΩ≤ OpenYurt ÈõÜÁæ§„ÄÇ</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="openyurt‰ªãÁªç">OpenYurt‰ªãÁªç<a aria-hidden="true" class="hash-link" href="#openyurt‰ªãÁªç" title="Direct link to heading">‚Äã</a></h2><p>OpenYurt ‰∏ªÊâì‚Äú‰∫ëËæπ‰∏Ä‰ΩìÂåñ‚ÄùÊ¶ÇÂøµÔºå‰æùÊâò Kubernetes Âº∫Â§ßÁöÑÂÆπÂô®Â∫îÁî®ÁºñÊéíËÉΩÂäõÔºåÊª°Ë∂≥‰∫Ü‰∫ëËæπ‰∏Ä‰ΩìÂåñÁöÑÂ∫îÁî®ÂàÜÂèë„ÄÅ‰∫§‰ªò„ÄÅÂíåÁÆ°ÊéßÁöÑËØâÊ±Ç„ÄÇÁõ∏ËæÉ‰∫éÂÖ∂‰ªñÂü∫‰∫é Kubernetes ÁöÑËæπÁºòËÆ°ÁÆóÊ°ÜÊû∂ÔºåOpenYurt ÁßâÊåÅÁùÄ‚ÄúÊúÄÂ∞è‰øÆÊîπ‚ÄùÂéüÂàôÔºåÈÄöËøáÂú®ËæπÁºòËäÇÁÇπÂÆâË£Ö Yurthub ÁªÑ‰ª∂ÔºåÂíåÂú®‰∫ëÁ´ØÈÉ®ÁΩ≤ Yurt-controller-managerÔºå‰øùËØÅ‰∫ÜÂú®ÂØπ Kubernetes Èõ∂‰æµÂÖ•ÁöÑÊÉÖÂÜµ‰∏ãÔºåÊèê‰æõÁÆ°ÁêÜËæπÁºòËÆ°ÁÆóÂ∫îÁî®ÊâÄÈúÄÁöÑÁõ∏ÂÖ≥ËÉΩÂäõ„ÄÇ</p><p>OpenYurt ËÉΩÂ∏ÆÁî®Êà∑Ëß£ÂÜ≥Âú®Êµ∑ÈáèËæπ„ÄÅÁ´ØËµÑÊ∫ê‰∏äÂÆåÊàêÂ§ßËßÑÊ®°Â∫îÁî®‰∫§‰ªò„ÄÅËøêÁª¥„ÄÅÁÆ°ÊéßÁöÑÈóÆÈ¢òÔºåÂπ∂Êèê‰æõ‰∏≠ÂøÉÊúçÂä°‰∏ãÊ≤âÈÄöÈÅìÔºåÂÆûÁé∞ÂíåËæπÁºòËÆ°ÁÆóÂ∫îÁî®ÁöÑÊó†ÁºùÂØπÊé•„ÄÇÂú®ËÆæËÆ° OpenYurt ‰πãÂàùÔºåÊàë‰ª¨Â∞±ÈùûÂ∏∏Âº∫Ë∞É‰øùÊåÅÁî®Êà∑‰ΩìÈ™åÁöÑ‰∏ÄËá¥ÊÄßÔºå‰∏çÂ¢ûÂä†Áî®Êà∑ËøêÁª¥Ë¥üÊãÖÔºåËÆ©Áî®Êà∑ÁúüÊ≠£Êñπ‰æøÂú∞ ‚ÄúExtending your native kubernetes to edge‚Äù„ÄÇ</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="yurtctl‰∏ÄÈîÆËÆ©ÂéüÁîük8sÈõÜÁæ§ÂÖ∑Â§áËæπÁºòËÆ°ÁÆóËÉΩÂäõ">YurtctlÔºö‰∏ÄÈîÆËÆ©ÂéüÁîük8sÈõÜÁæ§ÂÖ∑Â§áËæπÁºòËÆ°ÁÆóËÉΩÂäõ<a aria-hidden="true" class="hash-link" href="#yurtctl‰∏ÄÈîÆËÆ©ÂéüÁîük8sÈõÜÁæ§ÂÖ∑Â§áËæπÁºòËÆ°ÁÆóËÉΩÂäõ" title="Direct link to heading">‚Äã</a></h2><p>‰∏∫‰∫ÜËÆ©ÂéüÁîü K8s ÈõÜÁæ§ÂÖ∑Â§áËæπÁºòËÆ°ÁÆóËÉΩÂäõÔºåOpenYurt ‰ª• addon ‰∏∫ËΩΩ‰ΩìÔºåÈùû‰æµÂÖ•ÂºèÁªôÂéüÁîü K8s Â¢ûÂº∫‰∫ÜÂ¶Ç‰∏ãËÉΩÂäõÔºö</p><ul><li>ËæπÁºòËá™Ê≤ªËÉΩÂäõÔºàYurtHubÔºöÂ∑≤ÂºÄÊ∫êÔºâÔºå‰øùËØÅÂú®Âº±ÁΩëÊàñËÄÖÈáçÂêØËäÇÁÇπÁöÑÊÉÖÂÜµ‰∏ãÔºåÈÉ®ÁΩ≤Âú®ËæπÁºòËäÇÁÇπ‰∏äÁöÑÂ∫îÁî®‰πüËÉΩÊ≠£Â∏∏ËøêË°åÔºõ</li><li>‰∫ëËæπÂçèÂêåËÉΩÂäõÔºàÂæÖÂºÄÊ∫êÔºâÔºåÈÄöËøá‰∫ëËæπËøêÁª¥ÈÄöÈÅìËß£ÂÜ≥ËæπÁºòÁöÑËøêÁª¥ÈúÄÊ±ÇÔºåÂêåÊó∂Êèê‰æõ‰∫ëËæπÂçèÂêåËÉΩÂäõÔºõ</li><li>ÂçïÂÖÉÂåñÁÆ°ÁêÜËÉΩÂäõÔºàÂæÖÂºÄÊ∫êÔºâÔºå‰∏∫ÂàÜÊï£ÁöÑËæπÁºòËäÇÁÇπÔºåËæπÁºòÂ∫îÁî®ÔºåÂ∫îÁî®Èó¥ÊµÅÈáèÊèê‰æõÂçïÂÖÉÂåñÈó≠ÁéØÁÆ°ÁêÜËÉΩÂäõÔºõ</li></ul><p>Âü∫‰∫éËøáÂæÄACK@EdgeÁöÑÁ∫ø‰∏äËøêÁª¥ÁªèÈ™åÔºåÊàë‰ª¨ÂºÄÊ∫ê‰∫ÜYurtctlÂëΩ‰ª§Ë°åÂ∑•ÂÖ∑ÔºåÂ∏ÆÂä©ÂÆûÁé∞‰∫ÜÂéüÁîüKubernetesÂíåOpenYurt‰πãÈó¥ÁöÑÊó†ÁºùËΩ¨Êç¢‰ª•ÂèäÂØπOpenYurtÁõ∏ÂÖ≥ÁªÑ‰ª∂ÁöÑÈ´òÊïàËøêÁª¥„ÄÇ</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="yurtctlÁöÑÂ∑•‰ΩúÂéüÁêÜ">YurtctlÁöÑÂ∑•‰ΩúÂéüÁêÜ<a aria-hidden="true" class="hash-link" href="#yurtctlÁöÑÂ∑•‰ΩúÂéüÁêÜ" title="Direct link to heading">‚Äã</a></h3><p><img alt="image" src="/assets/images/Yurtctl_convert-a9c53e14e22eb124ca818cd77d382cd8.png"></p><p>YurtctlÊòØ‰∏Ä‰∏™‰∏≠ÂøÉÂåñÁöÑÁÆ°ÊéßÂ∑•ÂÖ∑„ÄÇÂú® OpenYurt‰∫ëËæπ‰∏Ä‰ΩìÁöÑÊû∂ÊûÑÈáåÔºåYurtctl Â∞ÜÁõ¥Êé•‰∏é APIServer ËøõË°å‰∫§‰∫í„ÄÇÂÆÉÂÄüÂä©ÂéüÁîü KubernetesÁöÑJob workloadÂØπÊØè‰∏™nodeËøõË°åËøêÁª¥Êìç‰Ωú„ÄÇÂ¶Ç‰∏äÂõæÊâÄÁ§∫ÔºåÂú®ÊâßË°åËΩ¨Êç¢ÔºàconvertÔºâÊìç‰ΩúÊó∂ÔºåYurtctl ‰ºöÈÄöËøá Job Â∞Ü‰∏Ä‰∏™ servant Pod ÈÉ®ÁΩ≤Âà∞Áî®Êà∑ÊåáÂÆöÁöÑËæπÁºòËäÇÁÇπ‰∏ä„ÄÇ</p><p>servant Pod ÈáåÁöÑÂÆπÂô®ÊâßË°åÁöÑÂÖ∑‰ΩìÊìç‰ΩúËØ∑ÂèÇËÄÉÔºöÔºàOpenYurt:release-v0.1-beta.1ÔΩûv0.3Ôºâ
<a href="https://github.com/openyurtio/openyurt/blob/release-v0.1-beta.1/config/yurtctl-servant/setup_edgenode" target="_blank" rel="noopener noreferrer">https://github.com/openyurtio/openyurt/blob/release-v0.1-beta.1/config/yurtctl-servant/setup_edgenode</a></p><p>Áî±‰∫é servant Pod ÈúÄË¶ÅÁõ¥Êé•Êìç‰ΩúËäÇÁÇπ root Áî®Êà∑ÁöÑÊñá‰ª∂Á≥ªÁªüÔºà‰æãÂ¶ÇÂ∞Ü yurthub ÈÖçÁΩÆÊñá‰ª∂ÊîæÁΩÆ‰∫é /etc/kubernetes/manifests ÁõÆÂΩï‰∏ãÔºâÔºåÂπ∂‰∏îÈúÄË¶ÅÈáçÁΩÆÁ≥ªÁªüÁÆ°ÁêÜÁ®ãÂ∫èÔºàkubelet.serviceÔºâÔºåservant Pod ‰∏≠ÁöÑ container Â∞ÜË¢´Ëµã‰∫à privileged ÊùÉÈôêÔºåÂÖÅËÆ∏ÂÖ∂‰∏éËäÇÁÇπÂÖ±‰∫´ pid namespaceÔºåÂπ∂Â∞ÜÂÄüÁî± nsenter ÂëΩ‰ª§ËøõÂÖ•ËäÇÁÇπ‰∏ªÂëΩÂêçÁ©∫Èó¥ÂÆåÊàêÁõ∏ÂÖ≥Êìç‰Ωú„ÄÇÂΩì servant Job ÊàêÂäüÊâßË°åÂêéÔºåJob ‰ºöËá™Âä®Âà†Èô§„ÄÇÂ¶ÇÊûúÂ§±Ë¥•ÔºåJob Âàô‰ºöË¢´‰øùÁïôÔºåÊñπ‰æøËøêÁª¥‰∫∫ÂëòÊéíÊü•ÈîôËØØÂéüÂõ†„ÄÇÂÄüÁî±ËØ•Êú∫Âà∂ÔºåYurtctl ËøòÂèØÂØπ Yurthub ËøõË°åÊõ¥Êñ∞ÊàñËÄÖÂà†Èô§„ÄÇ</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="Ê°à‰æã‰∏ÄÈîÆËΩ¨Êç¢openyurtÈõÜÁæ§">Ê°à‰æãÔºö‰∏ÄÈîÆËΩ¨Êç¢OpenYurtÈõÜÁæ§<a aria-hidden="true" class="hash-link" href="#Ê°à‰æã‰∏ÄÈîÆËΩ¨Êç¢openyurtÈõÜÁæ§" title="Direct link to heading">‚Äã</a></h2><p>###1ÔºâËé∑Âèñyurtctl
OpenYurt github ‰ªìÂ∫ìÂåÖÊã¨‰∫Ü yurtctl ÁöÑÊ∫êÁ†ÅÔºå‰∏ãËΩΩ OpenYurt ‰ªìÂ∫ì‰πãÂêéÔºåÂç≥ÂèØÈÄöËøáÁºñËØëËé∑Âæó yurtctlÔºåÂÖ∑‰ΩìÂëΩ‰ª§Â¶Ç‰∏ãÔºö</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ make build WHAT=cmd/yurtctl</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">hack/make-rules/build.sh cmd/yurtctl</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Building cmd/yurtctl</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ÁºñËØëÊàêÂäü‰πãÂêéÔºåyurtctl ÂèØÊâßË°åÊñá‰ª∂Â∞±ÂèØ‰ª•Âú® _output/bin/ ÁõÆÂΩï‰∏ãÊâæÂà∞„ÄÇ </p><p>###2ÔºâÂ∞ÜKubernetesËΩ¨Êç¢‰∏∫OpenYurt
Â¶ÇÊûúÊàë‰ª¨ÊÉ≥Â∞Ü‰∏Ä‰∏™ÂèåËäÇÁÇπÔºànode1 Âíå node2ÔºâÁöÑ Kubernetes ÈõÜÁæ§ËΩ¨Êç¢Êàê OpenYurt ÈõÜÁæ§ÔºåÂπ∂‰∏îÂè™ÊÉ≥ËÆ© node2 Êàê‰∏∫Ëá™Ê≤ªËæπÁºòËäÇÁÇπÔºåÈÇ£‰πàÂèØ‰ª•ÈÄöËøáÊâßË°å yurtctl convert Êù•ÂÆûÁé∞ÔºåÂÖ∑‰ΩìÂëΩ‰ª§Â¶Ç‰∏ãÔºö</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ yurtctl convert --cloud-nodes node1 --provider ack</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0603 14:34:33.714304   40825 convert.go:164] mark node1 as the cloud-node</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0603 14:34:33.719816   40825 convert.go:172] mark node2 as the edge-node</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0603 14:34:33.736609   40825 convert.go:198] deploy the yurt controller manager</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0603 14:34:33.742272   40825 convert.go:210] deploying the yurt-hub and resetting the kubelet service...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0603 14:34:53.810165   40825 util.go:168] servant job(yurtctl-servant-convert-node2) has succeeded</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ÊàêÂäüÈÖçÁΩÆËäÇÁÇπ‰πãÂêéÔºåÊàë‰ª¨ÈúÄË¶ÅÂ∞ÜËæπÁºòËäÇÁÇπÊ†áËÆ∞‰∏∫Ëá™Ê≤ªÁä∂ÊÄÅÔºåÂÖ∑‰ΩìÂëΩ‰ª§Â¶Ç‰∏ãÔºö</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ yurtctl markautonomous # Â¶ÇÊûúÁî®Êà∑Âè™ÊÉ≥Ê†áËÆ∞ÈÉ®ÂàÜËæπÁºòËäÇÁÇπÔºåÂàôÂèØ‰ª•‰ΩøÁî® --autonomous-nodes ÈÄâÈ°πÊåáÂÆö</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0602 11:22:05.610222   89160 markautonomous.go:149] mark node2 as autonomous</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Êé•ÁùÄÊàë‰ª¨Â∞±ÂèØ‰ª•ÊµãËØï node2 Âú®Êñ≠ÁΩëÁéØÂ¢É‰∏ãÊòØÂê¶ËÉΩÂÆûÁé∞ËäÇÁÇπËá™Ê≤ª„ÄÇÈ¶ñÂÖàÔºåÂú® node2 ‰∏äÈÉ®ÁΩ≤‰∏Ä‰∏™ÊµãËØï podÔºö</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl apply -f-&lt;&lt;EOF</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kind: Pod</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  name: bbox</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  nodeName: node2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  containers:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - image: busybox</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    command:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    - top</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    name: bbox</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pod/bbox created</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ÁôªÈôÜÂà∞ node2 ‰∏äÔºåÂ∞Ü Yurthub ÁöÑ --server-addr ÂèÇÊï∞ËÆæÁΩÆ‰∏∫‰∏Ä‰∏™‰∏çÂèØËÆøÈóÆÁöÑÂú∞ÂùÄÔºö</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo sed -i &#x27;s|--server-addr=.*|--server-addr=https://1.1.1.1:1111|&#x27; /etc/kubernetes/manifests/yurt-hub.yaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ËÄêÂøÉÁ≠âÂæÖ 40 ÁßíÔºåÊàë‰ª¨Â∞ÜËßÇÂØüÂà∞ÔºåÂç≥‰Ωø node2 Â∑≤ÁªèÂ§Ñ‰∫é NotReady Áä∂ÊÄÅÔºåpod1 ‰ªçÁÑ∂Â§Ñ‰∫é Running Áä∂ÊÄÅ„ÄÇËøôËØ¥ÊòéÂΩìËæπÁºòËäÇÁÇπÂ§Ñ‰∫éËá™Ê≤ªÁä∂ÊÄÅÊó∂ÔºåÂç≥‰Ωø node ‰∏çÂú®Á∫øÔºåPod ‰πü‰∏ç‰ºöË¢´‰∫ëÁ´Ø node controller È©±ÈÄê„ÄÇ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl get node </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME           STATUS     ROLES    AGE   VERSION</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">node1          Ready      master   14m   v1.14.8</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">node2          NotReady   &lt;none&gt;   12m   v1.14.8</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl get pod</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME   READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">bbox   1/1     Running   0          5m12s</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ËøôÊó∂Â¶ÇÊûúÂ∞Ü node2 ÈáçÂêØÔºåÊàë‰ª¨ÂèØ‰ª•Áî® docker ps ÔºàÂÅáËÆæËäÇÁÇπ‰ΩøÁî® docker ‰Ωú‰∏∫ container runtimeÔºâÂëΩ‰ª§Êù•È™åËØÅ bbox Pod ‰ºöË¢´ÈáçÊñ∞ÊãâËµ∑„ÄÇ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ docker ps --format &#x27;table {{.ID}}\t{{.Image}}\t{{.RunningFor}}&#x27; | grep busybox</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">d0c8134fddc1        busybox          About a minutes ago</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ËøôÊòØÂõ†‰∏∫ Kubelet ‰ºö‰ªé Yurthub ËØªÂèñÁºìÂ≠òÁöÑÊï∞ÊçÆÔºåÊÅ¢Â§çÈáçÂêØÂâçÁöÑPodÁä∂ÊÄÅ„ÄÇËøôÈÉ®ÂàÜÊäÄÊúØÁªÜËäÇÊàë‰ª¨‰ºöÂú®ÂêéÁª≠ÁöÑÊñáÁ´†ÈáåËØ¶ÁªÜ‰ªãÁªç„ÄÇ</p><p>###3ÔºâÂ∞ÜOpenYurtËΩ¨Êç¢ÂõûKubernetes
Áõ∏ÂØπÁöÑÔºåÈÄöËøáËøêË°å yurtctl revert ÂëΩ‰ª§ÔºåÁî®Êà∑ÂèØ‰ª•Â∞Ü‰∏Ä‰∏™ OpenYurt ÈõÜÁæ§ËΩ¨Êç¢Âõû Kubernetes ÈõÜÁæ§„ÄÇÂÅáËÆæÊàë‰ª¨ÊÉ≥Â∞Ü‰∏äËø∞ÂèåËäÇÁÇπ Kubernetes ÈõÜÁæ§ËΩ¨Êç¢Âõû Kubernetes Ê®°ÂºèÔºåÈÇ£‰πàÂè™ÈúÄËøêË°å‰ª•‰∏ãÂëΩ‰ª§Âç≥ÂèØÔºàËøêË°åËØ•ÂëΩ‰ª§ÂâçÔºåËØ∑ÂÖàÂ∞Ü node2 ‰∏äÁöÑ yurthub ÈáçÊñ∞Ëøû‰∏ä apiserverÔºâÔºö</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ yurtctl revert</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0603 14:38:55.522376   41016 revert.go:106] label alibabacloud.com/is-edge-worker is removed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0603 14:38:55.527998   41016 revert.go:116] yurt controller manager is removed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0603 14:38:55.548354   41016 revert.go:130] ServiceAccount node-controller is created</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0603 14:39:05.572686   41016 util.go:168] servant job(yurtctl-servant-revert-node2) has succeeded</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I0603 14:39:05.572718   41016 revert.go:142] yurt-hub is removed, kubelet service is reset</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Â¶ÇÊûúËøòÊÉ≥‰∫ÜËß£Êõ¥Â§ö yurtctl ÁöÑ‰ΩøÁî®ÊñπÊ≥ïÔºåËØ∑ÂèÇËÄÉ OpenYurt github ‰ªìÂ∫ì‰∏ãÁöÑyurtctlÁöÑÊïôÁ®ãÔºö<a href="https://github.com/alibaba/openyurt/tree/master/docs/tutorial%E3%80%82" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/openyurt/tree/master/docs/tutorial„ÄÇ</a></p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="whats-next">what&#x27;s Next<a aria-hidden="true" class="hash-link" href="#whats-next" title="Direct link to heading">‚Äã</a></h2><p>Yurtctl ÁõÆÊ†áÊòØÊàê‰∏∫ËøêÁª¥‰∫∫ÂëòÁÆ°ÁêÜ OpenYurt ÈõÜÁæ§ÁöÑÊúâÂäõÂ∑•ÂÖ∑„ÄÇÂõ†Ê≠§Êàë‰ª¨‰ºöÊåÅÁª≠ÊºîËøõ Yurtctl ‰ª•ÊîØÊåÅ OpenYurt ÁöÑÊñ∞ÂäüËÉΩÂíåÊñ∞Â¢ûÁöÑËøêÁª¥ÊµÅÁ®ãÊàñÂú∫ÊôØ„ÄÇ‰æãÂ¶ÇÔºå‰∏ç‰πÖ‰πãÂêé OpenYurt ËøòÂ∞ÜÂºÄÊ∫ê YurttunnelÔºåYurtunit Á≠âÁªÑ‰ª∂ÔºåYurtctl ‰πüÂ∞ÜÂØπËøô‰∫õÁªÑ‰ª∂Êèê‰æõÊîØÊåÅ„ÄÇÊàë‰ª¨ÂêåÊó∂Ê¨¢ËøéÂ§ßÂÆ∂ÊèêÂá∫ÂØπ Yurtctl ÁöÑÈúÄÊ±ÇÔºå‰∏ÄËµ∑Âä™Âäõ‰ΩøÂÖ∂Êõ¥Âä†ÂÆåÂñÑ„ÄÇ</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="Á§æÂå∫Âª∫ËÆæ">Á§æÂå∫Âª∫ËÆæ<a aria-hidden="true" class="hash-link" href="#Á§æÂå∫Âª∫ËÆæ" title="Direct link to heading">‚Äã</a></h2><p>OpenYurt Á§æÂå∫Ê¨¢ËøéÊñ∞Áî®Êà∑Âä†ÂÖ•ÂíåÂèÇ‰∏éÂÖ±Âª∫„ÄÇÁî®Êà∑ÂèØ‰ª•ÈÄöËøá Github issue Ëé∑ÂèñÊäÄÊúØÊîØÊåÅ„ÄÅÊä•Âëä bug„ÄÅÊèêÂá∫ÈúÄÊ±ÇÊÑèËßÅÁ≠âÔºåÊàñËÄÖÈÄöËøá OpenYurt Áî®Êà∑ÈíâÈíâÁæ§Áõ¥Êé•Âíå core ÂºÄÂèë‰∫∫ÂëòÂèñÂæóËÅîÁ≥ª„ÄÇ
<a href="https://mp.weixin.qq.com/s/tQIIfwClRRmEYO9dE3znhw" target="_blank" rel="noopener noreferrer">ÂéüÊñáÈìæÊé•</a></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/blog/tags/yurtctl">yurtctl</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_d4p0" itemprop="headline"><a itemprop="url" href="/blog/Introduce-of-OpenYurt">OpenYurt:edge computing cloud native project</a></h2><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2020-05-29T00:00:00.000Z" itemprop="datePublished">May 29, 2020</time> ¬∑ <!-- -->9 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://github.com/Fei-Guo" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://github.com/Fei-Guo.png" alt="Fei Guo"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/Fei-Guo" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Fei Guo</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of OpenYurt</small></div></div></div><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://github.com/huangyuqi" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://github.com/huangyuqi.png" alt="frank-huangyuqi"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/huangyuqi" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">frank-huangyuqi</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of OpenYurt</small></div></div></div><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://github.com/rambohe-ch" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://github.com/rambohe-ch.png" alt="rambohe"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/rambohe-ch" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">rambohe</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of OpenYurt</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><img alt="image" src="/assets/images/OpenYurt-de0f93f0c16ddb05b6782cbe66107b22.png"></p><p>ÂØºËØªÔºöÂåó‰∫¨Êó∂Èó¥ 5 Êúà 29 Êó•ÔºåÂú®ÈòøÈáå‰∫ëÂÆπÂô®ÊúçÂä° ACK@EdgeÔºàËæπÁºòÈõÜÁæ§ÊâòÁÆ°ÊúçÂä°Ôºâ ‰∏äÁ∫ø‰∏ÄÂë®Âπ¥‰πãÈôÖÔºåÈòøÈáåÂ∑¥Â∑¥Ê≠£ÂºèÂÆ£Â∏ÉÂ∞ÜÂÖ∂Ê†∏ÂøÉËÉΩÂäõÂºÄÊ∫êÔºåÂπ∂ÂêëÁ§æÂå∫Ë¥°ÁåÆÂÆåÊï¥ÁöÑËæπÁºòËÆ°ÁÆó‰∫ëÂéüÁîüÈ°πÁõÆ -- OpenYurt„ÄÇ</p><p>ËæπÁºò‰∫ëËÆ°ÁÆóÊòØÂü∫‰∫é‰∫ëËÆ°ÁÆóÊäÄÊúØÁöÑÊ†∏ÂøÉÂíåËæπÁºòËÆ°ÁÆóÁöÑËÉΩÂäõÔºåÊûÑÁ≠ëÂú®ËæπÁºòÂü∫Á°ÄËÆæÊñΩ‰πã‰∏äÁöÑÊñ∞ÂûãËÆ°ÁÆóÂπ≥Âè∞ÔºåÂπ∂Ê≠£Âú®Êàê‰∏∫Ë°å‰∏öÁöÑÊñ∞ÁÑ¶ÁÇπ„ÄÇOpenYurt ‰Ωú‰∏∫ÈòøÈáåÂ∑¥Â∑¥È¶ñ‰∏™ËæπÁºòËÆ°ÁÆó‰∫ëÂéüÁîüÂºÄÊ∫êÈ°πÁõÆÔºåÊ±áËÅö‰∫ÜÈòøÈáåÂ∑¥Â∑¥‰ºóÂ§öËæπÁºòËÆ°ÁÆó‰∏öÂä°Âõ¢ÈòüÁöÑÊ∑±ÂéöÊäÄÊúØÁßØÁ¥ØÔºåÊ∑±Â∫¶ÊåñÊéò‰∫ÜËæπÁºòËÆ°ÁÆó + ‰∫ëÂéüÁîüËêΩÂú∞ÂÆûÊñΩËØâÊ±Ç„ÄÇ</p><p>‰∏§Âπ¥ÂâçÔºåOpenYurt ‰Ωú‰∏∫ÂÖ¨ÂÖ±‰∫ëÊúçÂä° ACK@Edge ÁöÑÊ†∏ÂøÉÊ°ÜÊû∂ÔºåÂ∞±Â∑≤ÁªèÂ∫îÁî®‰∫é CDN„ÄÅÈü≥ËßÜÈ¢ëÁõ¥Êí≠„ÄÅÁâ©ËÅîÁΩë„ÄÅÁâ©ÊµÅ„ÄÅÂ∑•‰∏öÂ§ßËÑë„ÄÅÂüéÂ∏ÇÂ§ßËÑëÁ≠âÂÆûÈôÖÂ∫îÁî®Âú∫ÊôØ‰∏≠ÔºåÂπ∂ÊúçÂä°‰∫éÈòøÈáå‰∫ë LinkEdge„ÄÅÁõíÈ©¨„ÄÅ‰ºòÈÖ∑„ÄÅËßÜÈ¢ë‰∫ëÔºàËßÜÈ¢ëÁÇπÊí≠„ÄÅËßÜÈ¢ëÁõ¥Êí≠„ÄÅÂÆûÊó∂ÈÄö‰ø°„ÄÅËßÜÈ¢ëÁõëÊéß„ÄÅÊô∫ËÉΩËßÜËßâÔºâÁ≠âÂ§ö‰∏™‰∏öÂä°ÊàñÈ°πÁõÆ‰∏≠„ÄÇ</p><p>ÈòøÈáåÂ∑¥Â∑¥‰∫ëÂéüÁîüÂºÄÊ∫êË¥üË¥£‰∫∫„ÄÅ‰∫ëÂéüÁîüÂ∫îÁî®Âπ≥Âè∞ËµÑÊ∑±ÊäÄÊúØ‰∏ìÂÆ∂ÊùéÂìçË°®Á§∫Ôºö‚ÄúÈöèÁùÄËæπÁºòËÆ°ÁÆóÁöÑÂú∫ÊôØÂíåÈúÄÊ±Ç‰∏çÊñ≠Â¢ûÂä†Ôºå‚Äò‰∫ëËæπÂçèÂêå‚Äô„ÄÅ‚ÄòËæπÁºò‰∫ëÂéüÁîü‚ÄôÊ≠£Âú®ÈÄêÊ∏êÊàê‰∏∫Êñ∞ÁöÑÊäÄÊúØÁÑ¶ÁÇπ„ÄÇOpenYurt ÂºÄÊ∫êÈ°πÁõÆÂÆûË∑µ‚Äò‰∫ëËæπ‰∏Ä‰ΩìÂåñ‚ÄôÊ¶ÇÂøµÔºå‰æùÊâòÂéüÁîü Kubernetes Âº∫Â§ßÁöÑÂÆπÂô®ÁºñÊéí„ÄÅË∞ÉÂ∫¶ËÉΩÂäõÔºåÂÆûÁé∞ÂÆåÂÖ®ËæπÁºòËÆ°ÁÆó‰∫ëÂéüÁîüÂü∫Á°ÄËÆæÊñΩÊû∂ÊûÑÔºåÂ∏ÆÂä©ÂºÄÂèëËÄÖËΩªÊùæÂÆåÊàêÂú®Êµ∑ÈáèËæπ„ÄÅÁ´ØËµÑÊ∫ê‰∏äÁöÑÂ§ßËßÑÊ®°Â∫îÁî®ÁöÑ‰∫§‰ªò„ÄÅËøêÁª¥„ÄÅÁÆ°Êéß„ÄÇÊàë‰ª¨Â∏åÊúõ OpenYurt ÂºÄÊ∫êËÉΩÊé®Âä®Á§æÂå∫Âú®‰∫ëÂéüÁîüÂíåËæπÁºòËÆ°ÁÆó‰∫§ÂèâÈ¢ÜÂüüÁöÑÂçèÂêåÂèëÂ±ï„ÄÇ‚Äù</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="‰ªÄ‰πàÊòØopenyurt">‰ªÄ‰πàÊòØOpenYurt<a aria-hidden="true" class="hash-link" href="#‰ªÄ‰πàÊòØopenyurt" title="Direct link to heading">‚Äã</a></h2><p><img alt="image" src="/assets/images/OpenYurt-01-b706847ee60a69ed405be1564734ed6e.png"></p><p>‰ΩøÁî® OpenYurtÔºàYurtÔºå/j…úÀêrt/ÔºåËíôÂè§ÂåÖÔºâ‰Ωú‰∏∫Êú¨Ê¨°ÂºÄÊ∫êÈ°πÁõÆÂêçÁß∞ÔºåÊúüÊúõ‰ª•ÂÖ∂‚ÄúÂΩ¢‚ÄùÊù•Ë°®Á§∫ËæπÁºòËÆ°ÁÆó‰æßÈáç‰∫éÂàõÂª∫‰∏Ä‰∏™ÈõÜ‰∏≠ÁÆ°ÁêÜ‰ΩÜÁâ©ÁêÜÂàÜÂ∏ÉÁöÑÂü∫Á°ÄËÆæÊñΩÔºåÂπ∂ÊîØÊåÅËá™Âä®/Ëá™Ê≤ªËøêË°åÊìç‰ΩúÁöÑÂê´‰πâ„ÄÇ</p><p>OpenYurt ‰∏ªÊâì‚Äú‰∫ëËæπ‰∏Ä‰ΩìÂåñ‚ÄùÊ¶ÇÂøµÔºå‰æùÊâòÂéüÁîü Kubernetes Âº∫Â§ßÁöÑÂÆπÂô®ÁºñÊéí„ÄÅË∞ÉÂ∫¶ËÉΩÂäõÔºåÈÄöËøá‰ºóÂ§öËæπÁºòËÆ°ÁÆóÂ∫îÁî®Âú∫ÊôØÈî§ÁÇºÔºåÂÆûÁé∞‰∫Ü‰∏ÄÊï¥Â•óÂØπÂéüÁîü Kubernetes‚ÄúÈõ∂‚Äù‰æµÂÖ•ÁöÑËæπÁºò‰∫ëÂéüÁîüÊñπÊ°àÔºåÊèê‰æõËØ∏Â¶ÇËæπÁºòËá™Ê≤ª„ÄÅÈ´òÊïàËøêÁª¥ÈÄöÈÅì„ÄÅËæπÁºòÂçïÂÖÉÂåñÁÆ°ÁêÜ„ÄÅËæπÁºòÊµÅÈáèÊãìÊâëÁÆ°ÁêÜÔºåÂÆâÂÖ®ÂÆπÂô®„ÄÅËæπÁºò Serverless/FaaS„ÄÅÂºÇÊûÑËµÑÊ∫êÊîØÊåÅÁ≠âËÉΩÂäõ„ÄÇOpenYurt ËÉΩÂ∏ÆÁî®Êà∑Ëß£ÂÜ≥Âú®Êµ∑ÈáèËæπ„ÄÅÁ´ØËµÑÊ∫ê‰∏äÂÆåÊàêÂ§ßËßÑÊ®°Â∫îÁî®‰∫§‰ªò„ÄÅËøêÁª¥„ÄÅÁÆ°ÊéßÁöÑÈóÆÈ¢òÔºåÂπ∂Êèê‰æõ‰∏≠ÂøÉÊúçÂä°‰∏ãÊ≤âÈÄöÈÅìÔºåÂÆûÁé∞ÂíåËæπÁºòËÆ°ÁÆóÂ∫îÁî®ÁöÑÊó†ÁºùÂØπÊé•„ÄÇ</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="1openyurtËØûÁîüËÉåÊôØ">1ÔºâOpenYurtËØûÁîüËÉåÊôØ<a aria-hidden="true" class="hash-link" href="#1openyurtËØûÁîüËÉåÊôØ" title="Direct link to heading">‚Äã</a></h3><p><img alt="image" src="/assets/images/OpenYurt-02-f917b1d6fc1c832f325baa2a27be7ed3.png">
‰ªé 2017 Âπ¥Â∫ïÂºÄÂßãÔºåÈòøÈáå‰∫ëÁâ©ËÅîÁΩëÔºàIoTÔºâÂíå CDN (ÂÜÖÂÆπÂàÜÂèëÁΩëÁªú)ÊúçÂä°‰Ωú‰∏∫ÂÖ∏ÂûãÁöÑËæπÁºòËÆ°ÁÆó‰∏öÂä°Ê≠£Èù¢‰∏¥ÁùÄ‰∫ßÂìÅËßÑÊ®°ÁöÑÁàÜÂèëÂºèÂ¢ûÈïø„ÄÅËøêÁª¥Â§çÊùÇÂ∫¶ÊÄ•ÂâßÊîÄÂçá„ÄÅËøêÁª¥ÊïàÁéá‰∏çÈ´òÁöÑ‚Äú‰∏âÈöæ‚ÄùÂ¢ÉÂú∞ÔºåÂõ†Ê≠§ÂºïÂÖ•‰∫ëÂéüÁîüÁêÜÂøµ„ÄÅÂÖ®Èù¢ËΩ¨ÂûãËæπÁºòÂ∫îÁî®ÁöÑËøêÁª¥ÁÆ°ÁêÜÊ®°ÂºèÊàê‰∏∫‰∫üÈúÄËß£ÂÜ≥ÁöÑÈóÆÈ¢ò„ÄÇ</p><p>Ê≠£ÊòØÂú®ËøôÊ†∑ÁöÑËÉåÊôØ‰∏ãÔºåOpenYurt ËØûÁîü‰∫éÈòøÈáå‰∫ëÂÆπÂô®ÊúçÂä°Âõ¢ÈòüÔºåÂπ∂Âú®Êé•‰∏ãÊù•ÁöÑ‰∏§Âπ¥Â§öÊó∂Èó¥ÂÜÖÔºå‰Ωú‰∏∫ÂÖ¨ÂÖ±‰∫ëÊúçÂä° ACK@Edge ÁöÑÊ†∏ÂøÉÊ°ÜÊû∂Ë¢´ÂπøÊ≥õÂ∫îÁî®‰∫é CDN„ÄÅÈü≥ËßÜÈ¢ëÁõ¥Êí≠„ÄÅÁâ©ËÅîÁΩë„ÄÅÁâ©ÊµÅ„ÄÅÂ∑•‰∏öÂ§ßËÑë„ÄÅÂüéÂ∏ÇÂ§ßËÑëÁ≠âÂÆûÈôÖÂ∫îÁî®Âú∫ÊôØ‰∏≠ÔºåÂπ∂Ê≠£Âú®ÊúçÂä°‰∫éÈòøÈáå‰∫ë LinkEdge„ÄÅÁõíÈ©¨„ÄÅ‰ºòÈÖ∑„ÄÅËßÜÈ¢ë‰∫ëÔºàËßÜÈ¢ëÁÇπÊí≠ÔºåËßÜÈ¢ëÁõ¥Êí≠ÔºåÂÆûÊó∂ÈÄö‰ø°ÔºåËßÜÈ¢ëÁõëÊéßÔºåÊô∫ËÉΩËßÜËßâÔºâÁ≠âÂ§ö‰∏™‰∏öÂä°ÊàñÈ°πÁõÆ‰∏≠„ÄÇ</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="2openyurtÊäÄÊúØÁâπÁÇπ">2ÔºâOpenYurtÊäÄÊúØÁâπÁÇπ<a aria-hidden="true" class="hash-link" href="#2openyurtÊäÄÊúØÁâπÁÇπ" title="Direct link to heading">‚Äã</a></h3><p>OpenYurtÊ≤øÁî®‰∫ÜÁõÆÂâç‰∏öÁïåÊµÅË°åÁöÑ‚Äú‰∏≠ÂøÉÁÆ°Êéß„ÄÅËæπÁºòËá™Ê≤ª‚ÄùÁöÑËæπÁºòÂ∫îÁî®ÁÆ°ÁêÜÊû∂ÊûÑÔºåÂ∞Ü‚Äú‰∫ëËæπÁ´Ø‰∏Ä‰ΩìÂåñÂçèÂêå‚Äù‰Ωú‰∏∫ÁõÆÊ†áÔºåËµãËÉΩ‰∫ëÂéüÁîüËÉΩÂäõÂêëËæπÁºòÁ´ØÊãìÂ±ï„ÄÇÂú®ÊäÄÊúØÂÆûÁé∞‰∏äÔºåOpenYurtË¥ØÂΩª‰∫Ü‚ÄúExtending your native Kubernetes to Edge‚ÄùÁöÑÊ†∏ÂøÉËÆæËÆ°ÁêÜÂøµÔºåÂÖ∂ÊäÄÊúØÊñπÊ°àÊúâÂ¶Ç‰∏ãÁâπÁÇπÔºö</p><ul><li>ÂØπÂéüÁîüKubernetes‚ÄúÈõ∂‚Äù‰æµÂÖ•Ôºå‰øùËØÅÂØπÂéüÁîük8s APIÁöÑÂÆåÂÖ®ÂÖºÂÆπ„ÄÇ</li></ul><p>OpenYurtÈÄöËøáproxy node network trafficÔºåÂØπ Kubernetes ËäÇÁÇπÂ∫îÁî®ÁîüÂëΩÂë®ÊúüÁÆ°ÁêÜÂä†‰∫Ü‰∏ÄÂ±ÇÊñ∞ÁöÑÂ∞ÅË£ÖÔºåÊèê‰æõËæπÁºòËÆ°ÁÆóÊâÄÈúÄË¶ÅÁöÑÊ†∏ÂøÉÁÆ°ÊéßËÉΩÂäõÔºõ</p><ul><li><p>Êó†ÁºùËΩ¨Êç¢ÔºåOpenYurtÊèê‰æõ‰∫ÜÂ∑•ÂÖ∑Â∞ÜÂéüÁîüKubernetes‚Äú‰∏ÄÈîÆÂºè‚ÄùËΩ¨Êç¢ÊàêÊîØÊåÅËæπÁºòËÆ°ÁÆóËÉΩÂäõÁöÑ Kubernetes ÈõÜÁæ§Ôºõ</p></li><li><p>‰ΩéOverheadÔºåOpenYurtÂèÇËÄÉ‰∫ÜÂ§ßÈáèËæπÁºòËÆ°ÁÆóÂú∫ÊôØÁöÑÂÆûÈôÖÈúÄÊ±ÇÔºåÂú®‰øùËØÅÂäüËÉΩÂíåÂèØÈù†ÊÄßÁöÑÂü∫Á°Ä‰∏äÔºåÊú¨ÁùÄÊúÄÂ∞èÂåñÔºåÊúÄÁÆÄÂåñÁöÑËÆæËÆ°ÁêÜÂøµÔºå‰∏•Ê†ºÈôêÂà∂Êñ∞Â¢ûÁªÑ‰ª∂ÁöÑËµÑÊ∫êËØâÊ±Ç„ÄÇ  </p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="3openyurtÊ†∏ÂøÉËÉΩÂäõ">3ÔºâOpenYurtÊ†∏ÂøÉËÉΩÂäõ<a aria-hidden="true" class="hash-link" href="#3openyurtÊ†∏ÂøÉËÉΩÂäõ" title="Direct link to heading">‚Äã</a></h3><p><img alt="image" src="/assets/images/OpenYurt_arch-a3dcd2a758bb9c978f52c8a61c6a98f6.png"></p><ul><li>ËæπÁºòËá™Ê≤ªËÉΩÂäõÔºö </li></ul><p>YurtHub‰Ωú‰∏∫ËäÇÁÇπ‰∏äÁöÑ‰∏¥Êó∂ÈÖçÁΩÆ‰∏≠ÂøÉÔºåÂú®ÁΩëÁªúËøûÊé•‰∏≠Êñ≠ÁöÑÊÉÖÂÜµ‰∏ãÔºåÊåÅÁª≠‰∏∫ËäÇÁÇπ‰∏äÊâÄÊúâËÆæÂ§áÂíåÂÆ¢Êà∑‰∏öÂä°Êèê‰æõÊï∞ÊçÆÈÖçÁΩÆÊúçÂä°„ÄÇYurtHub Êèê‰æõ‰∫ÜÂØπÂ§ßÈáèÂéüÁîü Kubernetes APIÁöÑÊîØÊåÅÔºåÂèØ‰ª•Âú®ËäÇÁÇπÂíåËæπÁºòÂçïÂÖÉÁª¥Â∫¶Êèê‰æõ‚ÄúShadowApiserver‚ÄùÁöÑËÉΩÂäõÔºåÂú®ËæπÁºòËÆ°ÁÆóÂº±ÁΩëÁªúÈìæÊé•Âú∫ÊôØÁöÑ‰ª∑ÂÄºÂ∞§‰∏∫Á™ÅÂá∫Ôºõ</p><ul><li>ËæπÁºòËøêÁª¥ÈÄöÈÅì</li></ul><p>Âú®ËæπÁºòÂú∫ÊôØÔºåÁî±‰∫éÂ§ßÂ§öÊï∞ËæπÁºòËäÇÁÇπÊ≤°ÊúâÊö¥Èú≤Âú®ÂÖ¨ÁΩë‰πã‰∏äÔºå‰∏≠ÂøÉÁÆ°ÊéßÊó†ÁºùÂíåËæπÁºòËäÇÁÇπ‰∏ªÂä®Âª∫Á´ãÁΩëÁªúÈìæÊé•ÔºåÊâÄÊúâÁöÑKubernetesÂéüÁîüÂ∫îÁî®ËøêÁª¥APIsÔºàlogs/exec/metricsÔºâ‰ºöÂ§±ÂéªÊïàÂäõÔºõ
YurtTunnel ÈÄöËøáÂú®ÁÆ°Êéß‰∏éËæπÁºòËäÇÁÇπ‰πãÈó¥Âª∫Á´ãÂèçÂêëÈÄöÈÅìÔºåÂπ∂ÂíåËäÇÁÇπÁöÑÁîüÂëΩÂë®ÊúüÂÆåÊï¥ËÅîÂä®ÔºåÊâøËΩΩÂéüÁîüËøêÁª¥ APIs ÁöÑÊµÅÈáèÔºõ</p><ul><li>ÈõÜÁæ§ËΩ¨Êç¢ËÉΩÂäõ
Yurtctl‰Ωú‰∏∫OpenYurtÂÆòÊñπÂëΩ‰ª§Ë°åÂ∑•ÂÖ∑ÔºåÊèê‰æõÂéüÁîüKubernetesÈõÜÁæ§ÊîØÊåÅËæπÁºòËÆ°ÁÆóinfrastructureÁöÑ‰∏ÄÈîÆÂºèÂàáÊç¢„ÄÇ</li></ul><p>ÂÖ∂‰ªñÊõ¥È´òÁ∫ßÁöÑÂäüËÉΩÊØîÂ¶ÇËæπÁºòÊµÅÈáèÁÆ°ÁêÜ„ÄÅÂçïÂÖÉÂåñÁÆ°ÁêÜÔºåÈÉ®ÁΩ≤„ÄÅÂå∫ÂüüËá™Ê≤ªÁ≠âÂ∞Ü‰ºöÈÄêÊ≠•ÂºÄÊ∫ê„ÄÇ</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="4openyurt-roadmap">4ÔºâOpenYurt Roadmap<a aria-hidden="true" class="hash-link" href="#4openyurt-roadmap" title="Direct link to heading">‚Äã</a></h3><p>‰Ωú‰∏∫ÈòøÈáå‰∫ëÂÆπÂô®ÊúçÂä° ACK@Edge ÁöÑÂºÄÊ∫êÁâàÊú¨ÔºåOpenYurt Â∞ÜÈááÁî®ÂÖ®ÂºÄÊ∫êÁ§æÂå∫ÂºÄÂèëÊ®°ÂºèÔºåÊØèÂ≠£Â∫¶ÂèëÂ∏ÉÊñ∞ÁâàÊú¨Êõ¥Êñ∞ÔºåÂåÖÂê´Á§æÂå∫‰∏äÊ∏∏ÂÆâÂÖ®/ÂÖ≥ÈîÆ bug ‰øÆÂ§çÂíåÊñ∞ÁâπÊÄß„ÄÅÊñ∞ËÉΩÂäõÔºåÂπ∂ÈÄêÊ≠•Â∞Ü‰∫ßÂìÅÂÆåÊï¥ËÉΩÂäõÂºÄÊ∫ê„ÄÇ</p><p>‰∏ªÂØºËøôÊ¨°ÂºÄÊ∫êÁöÑÈòøÈáåÂ∑¥Â∑¥‰∫ëÂéüÁîüÂ∫îÁî®Âπ≥Âè∞Âõ¢ÈòüÔºåÁõÆÂâçÂ∑≤ÁªèÂºÄÊ∫ê OAM„ÄÅOpenKruise„ÄÅDragonfly„ÄÅApache RocketMQ„ÄÅApache Dubbo Á≠â‰ºóÂ§öÊòéÊòüÈ°πÁõÆÔºåÊòØÂõΩÂÜÖÊúÄËµÑÊ∑±ÁöÑ‰∫ëÂéüÁîüÂºÄÊ∫êË¥°ÁåÆÂõ¢Èòü„ÄÇOpenYurt È°πÁõÆÁöÑÂºÄÊ∫êÔºåÊú¨ÁùÄ‚ÄúExtending your native Kubernetes to Edge‚ÄùÁöÑËÆæËÆ°ÁêÜÂøµÔºåËÆ©‰∫ëÂéüÁîüÊäÄÊúØÂú®ËæπÁºòËÆ°ÁÆóÈ¢ÜÂüüÁöÑÁîüÊÄÅÂª∫ËÆæ‰∏éÊôÆÂèäÂâçËøõ‰∫Ü‰∏ÄÂ§ßÊ≠•Ôºå‰πü‰∏∫ÂÖ®ÁêÉÂºÄÂèëËÄÖÊãìÂ±ï‰∫ëÂéüÁîüËæπÁïåË¥°ÁåÆ‰∫Ü‰∏Ä‰ªΩÂäõÈáè„ÄÇ</p><p><a href="https://mp.weixin.qq.com/s/0LwCE4CpVdttmvx4FAMArg" target="_blank" rel="noopener noreferrer">ÂéüÊñáÈìæÊé•</a></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/blog/tags/openyurt">openyurt</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></main></div></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/manually-setup">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://join.slack.com/t/openyurt/shared_invite/zt-rc5ecz4h-sEWU1vYx5gzc3_zx3En0jg" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>CNCF Slack ( #openyurt channel )<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a class="footer__link-item" href="/">DingTalk (31993519)</a></li><li class="footer__item"><a href="https://shimo.im/docs/rGK3cXYWYkPrvWp8" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Bi-week Meeting (APAC, Chinese)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/openyurtio/openyurt" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/openyurtio/community/blob/main/community-membership.md" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Community Membership<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
        <br>
        <strong>Copyright ¬© 2021 The OpenYurt Authors. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage/"> Trademark Usage</a> page.</strong></div></div></div></footer></div>
<script src="/assets/js/runtime~main.c932ca61.js"></script>
<script src="/assets/js/main.ef1da988.js"></script>
</body>
</html>