<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-v1.2 docs-doc-page docs-doc-id-test-report/pod-recover-efficiency-test" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Optimize the pods recovery efficiency when edge nodes restart | OpenYurt</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://openyurt.io/docs/v1.2/test-report/pod-recover-efficiency-test"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="v1.2"><meta data-rh="true" name="docusaurus_tag" content="docs-default-v1.2"><meta data-rh="true" name="docsearch:version" content="v1.2"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-v1.2"><meta data-rh="true" property="og:title" content="Optimize the pods recovery efficiency when edge nodes restart | OpenYurt"><meta data-rh="true" name="description" content="1. Requirement Analysis"><meta data-rh="true" property="og:description" content="1. Requirement Analysis"><link data-rh="true" rel="icon" href="/img/openyurt.ico"><link data-rh="true" rel="canonical" href="https://openyurt.io/docs/v1.2/test-report/pod-recover-efficiency-test"><link data-rh="true" rel="alternate" href="https://openyurt.io/docs/v1.2/test-report/pod-recover-efficiency-test" hreflang="en"><link data-rh="true" rel="alternate" href="https://openyurt.io/zh/docs/v1.2/test-report/pod-recover-efficiency-test" hreflang="zh"><link data-rh="true" rel="alternate" href="https://openyurt.io/docs/v1.2/test-report/pod-recover-efficiency-test" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://&lt;NEW_APP_ID&gt;-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="OpenYurt RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="OpenYurt Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="OpenYurt" href="/opensearch.xml">


<link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
<link rel="icon" type="image/svg+xml" href="/favicons/favicon.svg">
<link rel="icon" type="image/png" href="/favicons/favicon.png">
<link rel="shortcut icon" type="image/x-icon" href="/favicons/favicon.ico">
<link rel="manifest" href="/favicons/site.webmanifest">
<link rel="mask-icon" color="#ffffff" href="/favicons/safari-pinned-tab.svg">
<meta name="theme-color" content="#ffffff">
<meta name="msapplication-config" content="/favicons/browserconfig.xml"><link rel="stylesheet" href="/assets/css/styles.b92cb5b2.css">
<script src="/assets/js/runtime~main.d8c02244.js" defer="defer"></script>
<script src="/assets/js/main.aeb46b72.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/openyurt.ico"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">⭐️ If you like OpenYurt, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/openyurtio/openyurt">GitHub</a>! ⭐️</div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/openyurt.ico" alt="OpenYurt" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/openyurt.ico" alt="OpenYurt" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">OpenYurt</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Documentation</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/team">Team</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/v1.2/test-report/pod-recover-efficiency-test">v1.2</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/test-report/pod-recover-efficiency-test">Next</a></li><li><a class="dropdown__link" href="/docs/test-report/pod-recover-efficiency-test">v1.4</a></li><li><a class="dropdown__link" href="/docs/v1.3/test-report/pod-recover-efficiency-test">v1.3</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/v1.2/test-report/pod-recover-efficiency-test">v1.2</a></li><li><a class="dropdown__link" href="/docs/v1.1/test-report/pod-recover-efficiency-test">v1.1</a></li><li><a class="dropdown__link" href="/docs/v1.0/test-report/pod-recover-efficiency-test">v1.0</a></li><li><a class="dropdown__link" href="/docs/v0.7.0/">v0.7.0</a></li><li><a class="dropdown__link" href="/docs/v0.6.0/">v0.6.0</a></li><li><a class="dropdown__link" href="/docs/v0.5.0/">v0.5.0</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/docs/v1.2/test-report/pod-recover-efficiency-test" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/zh/docs/v1.2/test-report/pod-recover-efficiency-test" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh">简体中文</a></li></ul></div><a href="https://github.com/openyurtio/openyurt" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/docs/v1.2/">Getting Started</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v1.2/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/v1.2/usage-conditions/resource-and-system-requirements">Usage Conditions</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/v1.2/installation/summary">Installation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/v1.2/installation/openyurt-experience-center/overview">OpenYurt Experience Center</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/docs/v1.2/core-concepts/architecture">Core Concepts</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v1.2/core-concepts/architecture">Architecture</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/v1.2/core-concepts/raven">Components</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/v1.2/user-manuals/autonomy/selfhealing-during-network-disconnection">User Manuals</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/v1.2/test-report/yurthub-performance-test">Test Report</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v1.2/test-report/yurthub-performance-test">YurtHub Performance Test</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v1.2/test-report/pool-coordinator-test">Pool Coordinator Performance Test</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/v1.2/test-report/pod-recover-efficiency-test">Optimize the pods recovery efficiency when edge nodes restart</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/v1.2/best-practices/practices-1">Best Practices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/v1.2/developer-manuals/how-to-build-and-test">Developer Manuals</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/v1.2/reference/api_reference">Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/v1.2/faq/yurthub">FAQ</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->OpenYurt<!-- --> <b>v1.2</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/test-report/pod-recover-efficiency-test">latest version</a></b> (<!-- -->v1.4<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Test Report</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Optimize the pods recovery efficiency when edge nodes restart</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: v1.2</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Optimize the pods recovery efficiency when edge nodes restart</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-requirement-analysis">1. Requirement Analysis<a href="#1-requirement-analysis" class="hash-link" aria-label="Direct link to 1. Requirement Analysis" title="Direct link to 1. Requirement Analysis">​</a></h2>
<p>OpenYurt extend the cloud native ability to edge computing and IoT scenarios. The cloud nodes provide the ability to deploy the services on the edge nodes and realize the whole life-cycle management of the applications. However, edge node network is in the weak connection status.</p>
<p>Thereby, the frequent restart of the edge nodes involves the OS restart, Kubernetes components restart and OpenYurt components restart. The recovery of service applications costs almost 1 minute. To recover the edge nodes faster, we should optimize the pods recovery efficiency when edge nodes restart.</p>
<p>The specific requirements of the optimization are summarized as follows:</p>
<ul>
<li>The restart process will not be blocked, and all the components will be restarted successfully</li>
<li>All the pods can restart successfully and satisfy the stable status of the applications</li>
<li>Promote the restart efficiency and make the cost time less than 30s</li>
<li>The solutions can be used in most hardwares</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-question-analysis">2. Question Analysis<a href="#2-question-analysis" class="hash-link" aria-label="Direct link to 2. Question Analysis" title="Direct link to 2. Question Analysis">​</a></h2>
<p>Kubelet is the controller of the Kubernetes work node. It is responsible for the creation and management of Pods on the work node. For an OpenYurt cluster, the components are the pods deployed on the Kubernetes cluster. When the work node restarts, Kubelet will recover the pods (Openyurt components) and the service pods. Therefore, detect the time delay of the Kubelet operations should be the focus.</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="957" height="73" class="img_ev3q"></p>
<p>The operations of Kubelet component when the work node restart are shown in Figure X. After the work node restart, Kubelet will initialize first. Then, Kubelet will start the static pods, for instance, YurtHub, etc. After that, YurtHub start-up and load the local cache. In the weak connection condition of the network, the Kubelet list/watch the pods from the YurtHub cache. Lastly, the Kubelet will recover the other pods according to the cache.</p>
<p>According to the analysis above, YurtHub is the important component for the work node restart. The YurtHub recovery cost a period of time. Moreover, Kubelet will recover the service pods according to the local cache. The process depends on the CacheManager and StorageManager of YurtHub.</p>
<p><img decoding="async" loading="lazy" src="/assets/images/yurthub-start-process-en-8181fe74d6f46cb0e8c0ce6fde4f48b6.png" width="1184" height="202" class="img_ev3q"></p>
<p>Figure X shows the YurtHub init progress. According to the investigation of YurtHub source code, the start-up process are serialized. Each component part will start one by one. The time delay can be evaluated by setting logs.</p>
<p>From the above, the optimization will focus on the YurtHub start-up and Kubelet recover the service pods based on YurtHub local cache .</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-experiments">3. Experiments<a href="#3-experiments" class="hash-link" aria-label="Direct link to 3. Experiments" title="Direct link to 3. Experiments">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="30-experiment-environment">3.0 Experiment Environment<a href="#30-experiment-environment" class="hash-link" aria-label="Direct link to 3.0 Experiment Environment" title="Direct link to 3.0 Experiment Environment">​</a></h3>
<p><strong>Test Environment:</strong></p>
<p>1 master node, 1 work node</p>
<ul>
<li>Alibaba ECS 4C8G</li>
<li>OS: CentOS 8</li>
<li>K8s Version: v1.19.4</li>
</ul>
<blockquote>
<p><strong>Instructions:</strong></p>
<p>*The 10 service pods are created by nginx-latest image</p>
<p>*The table records the <strong>time-delay</strong> from the time point entering <code>reboot</code> order and the unit is ms</p>
<p>*The image pull strategy is <strong>IfNotPresent</strong></p>
<p>*First Service Pod Recovery means the time point when the first nginx pod recover.</p>
<p>*Last Service Pod Recovery means the time point when the first nginx pod recover.</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-native-kubernetes-start-up-time-test">3.1 Native Kubernetes Start-up Time Test<a href="#31-native-kubernetes-start-up-time-test" class="hash-link" aria-label="Direct link to 3.1 Native Kubernetes Start-up Time Test" title="Direct link to 3.1 Native Kubernetes Start-up Time Test">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="311-static-pods-and-10-service-pods">3.1.1 Static pods and 10 service pods<a href="#311-static-pods-and-10-service-pods" class="hash-link" aria-label="Direct link to 3.1.1 Static pods and 10 service pods" title="Direct link to 3.1.1 Static pods and 10 service pods">​</a></h4>
<table><thead><tr><th style="text-align:center">Test Index</th><th style="text-align:center">Entering <code>reboot</code> order</th><th style="text-align:center">Kubelet Start</th><th style="text-align:center">Static Pod (YurtHub) Start</th><th style="text-align:center">First Service Pod Recovery</th><th style="text-align:center">Last Service Pod Recovery</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:center">0</td><td style="text-align:center">20000</td><td style="text-align:center">29021</td><td style="text-align:center">35627</td><td style="text-align:center">36401</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">0</td><td style="text-align:center">21000</td><td style="text-align:center">30922</td><td style="text-align:center">37712</td><td style="text-align:center">38521</td></tr><tr><td style="text-align:center">3</td><td style="text-align:center">0</td><td style="text-align:center">24000*</td><td style="text-align:center">34010</td><td style="text-align:center">40109</td><td style="text-align:center">40821</td></tr><tr><td style="text-align:center">Avg</td><td style="text-align:center">0</td><td style="text-align:center">21667</td><td style="text-align:center">31318</td><td style="text-align:center">37816</td><td style="text-align:center">38581</td></tr><tr><td style="text-align:center">Diff</td><td style="text-align:center">-</td><td style="text-align:center">21667</td><td style="text-align:center">9651</td><td style="text-align:center">6498</td><td style="text-align:center">765</td></tr></tbody></table>
<p>*the system restart time is not stable, and the time ranges from 19s to 24s.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-openyurt-start-up-time-test">3.2 OpenYurt Start-up Time Test<a href="#32-openyurt-start-up-time-test" class="hash-link" aria-label="Direct link to 3.2 OpenYurt Start-up Time Test" title="Direct link to 3.2 OpenYurt Start-up Time Test">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="321-edge-network-connected-10-service-pods">3.2.1 Edge Network Connected, 10 service pods<a href="#321-edge-network-connected-10-service-pods" class="hash-link" aria-label="Direct link to 3.2.1 Edge Network Connected, 10 service pods" title="Direct link to 3.2.1 Edge Network Connected, 10 service pods">​</a></h4>
<table><thead><tr><th style="text-align:center">Test Index</th><th style="text-align:center">Entering <code>reboot</code> order</th><th style="text-align:center">Kubelet Start</th><th style="text-align:center">Static Pod (YurtHub) Start</th><th style="text-align:center">First Service Pod Recovery</th><th style="text-align:center">Last Service Pod Recovery</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:center">0</td><td style="text-align:center">26000</td><td style="text-align:center">35012</td><td style="text-align:center">47030</td><td style="text-align:center">47890</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">0</td><td style="text-align:center">25000</td><td style="text-align:center">34921</td><td style="text-align:center">48041</td><td style="text-align:center">48892</td></tr><tr><td style="text-align:center">3</td><td style="text-align:center">0</td><td style="text-align:center">25000</td><td style="text-align:center">34829</td><td style="text-align:center">47843</td><td style="text-align:center">48602</td></tr><tr><td style="text-align:center">Avg</td><td style="text-align:center">0</td><td style="text-align:center">25333</td><td style="text-align:center">34921</td><td style="text-align:center">47638</td><td style="text-align:center">48461</td></tr><tr><td style="text-align:center">Diff</td><td style="text-align:center">-</td><td style="text-align:center">25333</td><td style="text-align:center">9588</td><td style="text-align:center">12717</td><td style="text-align:center">823</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="322-edge-network-disconnected-10-service-pods-openyurt-edge">3.2.2 Edge Network Disconnected, 10 service pods, OpenYurt Edge<a href="#322-edge-network-disconnected-10-service-pods-openyurt-edge" class="hash-link" aria-label="Direct link to 3.2.2 Edge Network Disconnected, 10 service pods, OpenYurt Edge" title="Direct link to 3.2.2 Edge Network Disconnected, 10 service pods, OpenYurt Edge">​</a></h4>
<table><thead><tr><th style="text-align:center">Test Index</th><th style="text-align:center">Entering <code>reboot</code> order</th><th style="text-align:center">Kubelet Start</th><th style="text-align:center">Static Pod (YurtHub) Start</th><th style="text-align:center">First Service Pod Recovery</th><th style="text-align:center">Last Service Pod Recovery</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:center">0</td><td style="text-align:center">26000</td><td style="text-align:center">35219</td><td style="text-align:center">48203</td><td style="text-align:center">49260</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">0</td><td style="text-align:center">25000</td><td style="text-align:center">35621</td><td style="text-align:center">48721</td><td style="text-align:center">49422</td></tr><tr><td style="text-align:center">3</td><td style="text-align:center">0</td><td style="text-align:center">27000</td><td style="text-align:center">37015</td><td style="text-align:center">50126</td><td style="text-align:center">50921</td></tr><tr><td style="text-align:center">Avg</td><td style="text-align:center">0</td><td style="text-align:center">26000</td><td style="text-align:center">35952</td><td style="text-align:center">49016</td><td style="text-align:center">49867</td></tr><tr><td style="text-align:center">Diff</td><td style="text-align:center">-</td><td style="text-align:center">26000</td><td style="text-align:center">9951</td><td style="text-align:center">13064</td><td style="text-align:center">852</td></tr></tbody></table>
<p>*According to the experiment, the time between Kubelet Start to work and First Service Pod Recovery is varied.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-time-delay-comparison-between-openyurt-and-native-kubernetes">4. Time Delay Comparison between OpenYurt and Native Kubernetes<a href="#4-time-delay-comparison-between-openyurt-and-native-kubernetes" class="hash-link" aria-label="Direct link to 4. Time Delay Comparison between OpenYurt and Native Kubernetes" title="Direct link to 4. Time Delay Comparison between OpenYurt and Native Kubernetes">​</a></h2>
<p>In this section, the time delay comparison between the OpenYurt Cluster (Network Connected and DIsconnected) and native Kubernetes are shown in the Table below.</p>
<p>Four time periods re defined for comparison.</p>
<p><strong>Period 1</strong>: From OS restart begin to Kubelet start to work.</p>
<p><strong>Period 2</strong>: From Kubelet start to Static Pod (YurtHub) start.</p>
<p><strong>Period 3</strong>: From Static Pod (YurtHub) start first service pod recovery.</p>
<p><strong>Period 4</strong>: From first service pod recovery to last service pod recovery.</p>
<p><strong>Whole Recovery Period</strong>: From OS restart begin to last service pod recovery.</p>
<table><thead><tr><th style="text-align:center"></th><th style="text-align:center">Native Kubernetes</th><th style="text-align:center">OpenYurt Cluster (Network Connected)</th><th style="text-align:center">OpenYurt Cluster (Network Disconnected)</th></tr></thead><tbody><tr><td style="text-align:center"><strong>Period 1</strong></td><td style="text-align:center">21.67s</td><td style="text-align:center">25.33s</td><td style="text-align:center">26.00s</td></tr><tr><td style="text-align:center"><strong>Period 2</strong></td><td style="text-align:center">9.65s</td><td style="text-align:center">9.58s</td><td style="text-align:center">9.95s</td></tr><tr><td style="text-align:center"><strong>Period 3</strong></td><td style="text-align:center">6.50s</td><td style="text-align:center">12.71s</td><td style="text-align:center">13.06s</td></tr><tr><td style="text-align:center"><strong>Period 4</strong></td><td style="text-align:center">0.76s</td><td style="text-align:center">0.82s</td><td style="text-align:center">0.85s</td></tr><tr><td style="text-align:center"><strong>Whole Recovery Period</strong></td><td style="text-align:center">38.58s</td><td style="text-align:center">48.46s</td><td style="text-align:center">49.86s</td></tr></tbody></table>
<p>According to the comparison table, OpenYurt Cluster spent 4-5s more than the time Native Kubernetes from OS restart begin to Kubelet start to work (Period 1). And the OS restart time to the Kubelet start time is varying. Additionally, OpenYurt Cluster spent almost 9.7s from Kubelet start to work to static pod (YurtHub) start (Period 2), which is the same as the native kubernetes cluster. In period 3, OpenYurt cluster costs 6s more than the native kubernetes cluster.</p>
<p>Generally, when openyurt edge node restart, the overall pods restart time are 11.28s longer than native Kubernetes node restart.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-detailed-analysis-and-optimization">5. Detailed Analysis and Optimization<a href="#5-detailed-analysis-and-optimization" class="hash-link" aria-label="Direct link to 5. Detailed Analysis and Optimization" title="Direct link to 5. Detailed Analysis and Optimization">​</a></h2>
<p>Based on the detailed test on openyurt edge node, the period from Kubelet start to YurtHub start and the period from YurtHub server work to first service pod recovery will be analyzed in detail.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="51-detailed-analysis-of-the-period-from-kubelet-start-to-static-pod-yurthub-start">5.1 Detailed analysis of the period from Kubelet start to static pod (YurtHub) Start<a href="#51-detailed-analysis-of-the-period-from-kubelet-start-to-static-pod-yurthub-start" class="hash-link" aria-label="Direct link to 5.1 Detailed analysis of the period from Kubelet start to static pod (YurtHub) Start" title="Direct link to 5.1 Detailed analysis of the period from Kubelet start to static pod (YurtHub) Start">​</a></h3>
<p>From Kubelet start to first static pod YurtHub start, this period costs almost 9.5s among three experiment scenarios. Kubelet start process invocation chain can be summarized in the following graph.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">main                                                                             // cmd/kubelet/kubelet.go</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> |--NewKubeletCommand                                                            // cmd/kubelet/app/server.go</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   |--Run                                                                        // cmd/kubelet/app/server.go</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      |--initForOS                                                               // cmd/kubelet/app/server.go</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      |--run                                                                     // cmd/kubelet/app/server.go</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        |--initConfigz                                                           // cmd/kubelet/app/server.go</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        |--BuildAuth</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        |--cm.NodeAllocatableRoot</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        |--cadvisor.NewImageFsInfoProvider</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        |--NewContainerManager</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        |--ApplyOOMScoreAdj</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        |--PreInitRuntimeService</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        |--RunKubelet                                                            // cmd/kubelet/app/server.go</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        | |--k = createAndInitKubelet                                            // cmd/kubelet/app/server.go</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        | |  |--NewMainKubelet</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        | |  |  |--watch k8s Service</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        | |  |  |--watch k8s Node</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        | |  |  |--klet := &amp;Kubelet{}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        | |  |  |--init klet fields</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        | |  |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        | |  |--k.BirthCry()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        | |  |--k.StartGarbageCollection()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        | |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        | |--startKubelet(k)                                                     // cmd/kubelet/app/server.go</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        |    |--go k.Run()                                                       // -&gt; pkg/kubelet/kubelet.go</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        |    |  |--go cloudResourceSyncManager.Run()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        |    |  |--initializeModules</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        |    |  |--go volumeManager.Run()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        |    |  |--go nodeLeaseController.Run()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        |    |  |--initNetworkUtil() // setup iptables</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        |    |  |--go Until(PerformPodKillingWork, 1*time.Second, neverStop)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        |    |  |--statusManager.Start()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        |    |  |--runtimeClassManager.Start</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        |    |  |--pleg.Start()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        |    |  |--syncLoop(updates, kl)                                         // pkg/kubelet/kubelet.go</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        |    |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        |    |--k.ListenAndServe</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        |--go http.ListenAndServe(healthz)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>According to the Kubelet running logs, from <code>systemd started Kubelet</code> to <code>Run()</code> function, it costs almost 2.5s. After that, between <code>Run()</code> to <code>watch k8s Service</code> in<code>NewMainKubelet()</code> , it costs 0.5s. From <code>watching API Server</code> to <code>startKubelet()</code> function executed finished, it costs 6.5s.</p>
<p>The total time cost is stable 9.5s to 10s among native Kubernetes cluster and openyurt network connected and disconnected cluster.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="52-detailed-analysis-of-the-period-from-yurthub-server-work-to-first-service-pod-recovery">5.2 Detailed analysis of the period from YurtHub server work to first service pod recovery<a href="#52-detailed-analysis-of-the-period-from-yurthub-server-work-to-first-service-pod-recovery" class="hash-link" aria-label="Direct link to 5.2 Detailed analysis of the period from YurtHub server work to first service pod recovery" title="Direct link to 5.2 Detailed analysis of the period from YurtHub server work to first service pod recovery">​</a></h3>
<p>After Kubelet start to work (<code>startKubelet()</code>finished and listen to 10250 port), the static pods and service pods will be start one by one.  Kubelet start pods process <code>syncLoop</code>  invocation chain can be summarized in the following graph.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubelet.syncLoop	/pkg/kubelet/kubelet.go</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|--kl.syncLoopIteration(updates, handler, syncTicker.C, housekeepingTicker.C, plegCh)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	|--u, open := &lt;-configCh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	|--handler.HandlePodAdditions(u.Pods) //Kubelet.HandlePodAdditions</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		|--sort.Sort(sliceutils.PodsByCreationTime(pods))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		|--kl.handleMirrorPod(pod, start)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">			|--kl.dispatchWork</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		|--kl.dispatchWork(pod, kubetypes.SyncPodCreate, mirrorPod, start)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">			|--kl.podWorkers.UpdatePod //podWorkers.UpdatePod	/pkg/kubelet/pod_worker.go</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">				|--p.managePodLoop</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">					|--p.syncPodFn</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In Kubelet <code>syncLoop()</code> function, <code>syncTicker</code> is assigned 1s for check the pod workers which is needed for sync. After that, <code>housekeepingTicker</code> is assigned 2s for test the pods whether need for cleaning. <code>plegCh</code> is set for test pods lifecycle.</p>
<p>In the <code>HandlePodAdditions(u.Pods)</code> function, the pods will be sorted by the create time stamp. The static pods will be first be executed and the other service pods will be filtered (to test whether it is terminated pods and whether it can be admit). Then, <code>kl.dispatchWork()</code> will be executed. <code>kl.podWorkers.UpdatePod</code> will <strong>concurrently</strong> invoke <code>p.managePodLoop</code> . <code>p.syncPodFn</code> is executed for establishing the pods.</p>
<p>The execution steps of <code>syncPod</code> method are summarized as follows <code>Kubelet.syncPod</code>:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Step 1: Record pod worker start latency if being created</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Step 2: Create v1.PodStatus object</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Step 3: Generate PodStatus</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Step 4: Executing the admission handlers and make pods having privalage</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Step 5: Create cgroups of the pod</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Step 6: Make data dictionaries of the pod</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Step 7: Wait for the volume attached</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Step 8: Fetch the ImagePullSecrets</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Step 9: Call the container runtime kl.containerRuntime.SyncPod(pod, podStatus, pullSecrets, kl.backOff)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The steps of creating the container runtime are summarized as follows <code>kubeGenericRuntimeManager.SyncPod</code>:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Step 1: Compute sandbox and container changes.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Step 2: Kill the pod if the sandbox has changed.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Step 3: kill any running containers in this pod which are not to keep.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Step 4: Create a sandbox for the pod if necessary.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Step 5: start ephemeral containers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Step 6: start the init container.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Step 7: start containers in podContainerChanges.ContainersToStart.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Step 4 and Step 7 will be detailed discussed as follows:</p>
<p>The detailed steps of Creating the sandbox for the pod can be listed as follows: <code>RunPodSandbox()</code></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Step 1: Pull the image for the sandbox.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Step 2: Create the sandbox container.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Step 3: Create Sandbox Checkpoint.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Step 4: Start the sandbox container.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Step 5: Setup networking for the sandbox.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Also, the detailed steps of starting the container are listed as follows: <code>startContainer()</code></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Step 1: pull the image.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Step 2: create the container.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Step 3: start the container.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Step 4: execute the post start hook.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>On the basis of the pod start procedure by Kubelet, when the edge nodes restart and Kubelet initialized and start, YurtHub will start to work first. According to YurtHub relys on host network, it can be started without CNI start. There will be 1s between Kubelet started and YurtHub started. Also, there are 1.5s between YurtHub started and YurtHub server work. After YurtHub server work, it plays the role of apiserver  in the weak network condition.</p>
<p>The recovery of nginx pods are blocked in <code>createSandBox</code> because they relys on CNI, and flannel as the CNI plugin is not ready.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Aug 26 16:04:28 openyurt-node-02 kubelet[1193]: E0826 16:04:28.209598    1193 pod_workers.go:191] Error syncing pod 464fc7d4-2a53-4a20-abc3-c51a919f1b1a (&quot;nginx-06-78df84cfc7-b8fc2_default(464fc7d4-2a53-4a20-abc3-c51a919f1b1a)&quot;), skipping: failed to &quot;CreatePodSandbox&quot; for &quot;nginx-06-78df84cfc7-b8fc2_default(464fc7d4-2a53-4a20-abc3-c51a919f1b1a)&quot; with CreatePodSandboxError: &quot;CreatePodSandbox for pod \&quot;nginx-06-78df84cfc7-b8fc2_default(464fc7d4-2a53-4a20-abc3-c51a919f1b1a)\&quot; failed: rpc error: code = Unknown desc = failed to set up sandbox container \&quot;ec15044992d3d0df0185a41d00adaca0fa7895f8ac717399b00f24a68ae3fa3e\&quot; network for pod \&quot;nginx-06-78df84cfc7-b8fc2\&quot;: networkPlugin cni failed to set up pod \&quot;nginx-06-78df84cfc7-b8fc2_default\&quot; network: open /run/flannel/subnet.env: no such file or directory&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The time between YurtHub start to work and flannel start is 9s, however, in the native Kubernetes cluster, there only needs 3s. The openYurt cluster costs 6s more than native cluster in this period. According to the Kubelet logs, 6 seconds are blocked in the following procedure.</p>
<p>The time cost may because the first attempt to start flannel-cni plugin failed 3s after the YurtHub server works. The third attempt (after 9s) will be successful.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Aug 28 23:57:12 openyurt-node-02 kubelet[1185]: E0828 23:57:12.447073    1185 kuberuntime_manager.go:815] init container &amp;Container{Name:install-cni-plugin,Image:docker.io/rancher/mirrored-flannelcni-flannel-cni-plugin:v1.1.0,Command:[cp],Args:[-f /flannel /opt/cni/bin/flannel],WorkingDir:,Ports:[]ContainerPort{},Env:[]EnvVar{},Resources:ResourceRequirements{Limits:ResourceList{},Requests:ResourceList{},},VolumeMounts:[]VolumeMount{VolumeMount{Name:cni-plugin,ReadOnly:false,MountPath:/opt/cni/bin,SubPath:,MountPropagation:nil,SubPathExpr:,},VolumeMount{Name:flannel-token-2m92x,ReadOnly:true,MountPath:/var/run/secrets/kubernetes.io/serviceaccount,SubPath:,MountPropagation:nil,SubPathExpr:,},},LivenessProbe:nil,ReadinessProbe:nil,Lifecycle:nil,TerminationMessagePath:/dev/termination-log,ImagePullPolicy:IfNotPresent,SecurityContext:nil,Stdin:false,StdinOnce:false,TTY:false,EnvFrom:[]EnvFromSource{},TerminationMessagePolicy:File,VolumeDevices:[]VolumeDevice{},StartupProbe:nil,} start failed in pod kube-flannel-ds-dskwd_kube-flannel(9f07d412-f6f4-40f6-a6b2-01d013004dd1): CreateContainerConfigError: services have not yet been read at least once, cannot construct envvars</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>According to the experiment, Flannel start will cost 2.5s. After that, nginx pods will restart in 1s. The whole period will cost almost 12-13s in the disconnected network of openyurt cluster.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-optimization-strategy">6. Optimization Strategy<a href="#6-optimization-strategy" class="hash-link" aria-label="Direct link to 6. Optimization Strategy" title="Direct link to 6. Optimization Strategy">​</a></h2>
<ul>
<li>Make the edge node service pods networking strategy from CNI to <strong>Host</strong>.<!-- -->
<ul>
<li>It will save 8-9s because the host network service pods will not wait for CNI plugin flannel ready.</li>
</ul>
</li>
<li>Claim the image pulling strategy to <strong>IfNotPresent</strong>.<!-- -->
<ul>
<li>According to the docker images have been pulled by edge node before. <strong>IfNotPresent</strong> strategy make the docker only find the image from local node and it will not sync from the registry again. This period may save 10s-20s.</li>
</ul>
</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/openyurtio/openyurt.io/edit/master/docs/test-report/pod-recover-efficiency-test.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-02-26T22:04:25.000Z" itemprop="dateModified">Feb 26, 2025</time></b> by <b>Ihor Sychevskyi</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/v1.2/test-report/pool-coordinator-test"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Pool Coordinator Performance Test</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/v1.2/best-practices/practices-1"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Cloud-Edge-Device DevOps Collaboration</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-requirement-analysis" class="table-of-contents__link toc-highlight">1. Requirement Analysis</a></li><li><a href="#2-question-analysis" class="table-of-contents__link toc-highlight">2. Question Analysis</a></li><li><a href="#3-experiments" class="table-of-contents__link toc-highlight">3. Experiments</a><ul><li><a href="#30-experiment-environment" class="table-of-contents__link toc-highlight">3.0 Experiment Environment</a></li><li><a href="#31-native-kubernetes-start-up-time-test" class="table-of-contents__link toc-highlight">3.1 Native Kubernetes Start-up Time Test</a></li><li><a href="#32-openyurt-start-up-time-test" class="table-of-contents__link toc-highlight">3.2 OpenYurt Start-up Time Test</a></li></ul></li><li><a href="#4-time-delay-comparison-between-openyurt-and-native-kubernetes" class="table-of-contents__link toc-highlight">4. Time Delay Comparison between OpenYurt and Native Kubernetes</a></li><li><a href="#5-detailed-analysis-and-optimization" class="table-of-contents__link toc-highlight">5. Detailed Analysis and Optimization</a><ul><li><a href="#51-detailed-analysis-of-the-period-from-kubelet-start-to-static-pod-yurthub-start" class="table-of-contents__link toc-highlight">5.1 Detailed analysis of the period from Kubelet start to static pod (YurtHub) Start</a></li><li><a href="#52-detailed-analysis-of-the-period-from-yurthub-server-work-to-first-service-pod-recovery" class="table-of-contents__link toc-highlight">5.2 Detailed analysis of the period from YurtHub server work to first service pod recovery</a></li></ul></li><li><a href="#6-optimization-strategy" class="table-of-contents__link toc-highlight">6. Optimization Strategy</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/installation/summary">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://join.slack.com/t/openyurt/shared_invite/zt-rc5ecz4h-sEWU1vYx5gzc3_zx3En0jg" target="_blank" rel="noopener noreferrer" class="footer__link-item">CNCF Slack ( #openyurt channel )<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/v1.2/test-report/">DingTalk (31993519)</a></li><li class="footer__item"><a href="https://shimo.im/docs/rGK3cXYWYkPrvWp8" target="_blank" rel="noopener noreferrer" class="footer__link-item">Bi-week Meeting (APAC, Chinese)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/openyurtio/openyurt" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/openyurtio/community/blob/main/community-membership.md" target="_blank" rel="noopener noreferrer" class="footer__link-item">Community Membership<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
        <br>
        <strong>Copyright © 2025 The OpenYurt Authors. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage/"> Trademark Usage</a> page.</strong></div></div></div></footer></div>
</body>
</html>