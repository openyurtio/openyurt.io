"use strict";(self.webpackChunkopenyurt_io=self.webpackChunkopenyurt_io||[]).push([[64563],{89651:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>u,frontMatter:()=>s,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"user-manuals/node-management/configure-node-autonomy","title":"Configure node autonomy","description":"In a cloud-edge environment, network disconnections between the cloud and edge are common. OpenYurt provides multiple levels of node autonomy capabilities to ensure that edge services remain stable and operational during such disconnections.","source":"@site/docs/user-manuals/node-management/configure-node-autonomy.md","sourceDirName":"user-manuals/node-management","slug":"/user-manuals/node-management/configure-node-autonomy","permalink":"/docs/next/user-manuals/node-management/configure-node-autonomy","draft":false,"unlisted":false,"editUrl":"https://github.com/openyurtio/openyurt.io/edit/master/docs/user-manuals/node-management/configure-node-autonomy.md","tags":[],"version":"current","lastUpdatedBy":"Ihor Sychevskyi","lastUpdatedAt":1769121164000,"frontMatter":{"title":"Configure node autonomy"},"sidebar":"docs","previous":{"title":"Remove a node","permalink":"/docs/next/user-manuals/node-management/remove-a-node"},"next":{"title":"Workload management overview","permalink":"/docs/next/user-manuals/workload/workload-management-overview"}}');var i=o(74848),r=o(28453);const s={title:"Configure node autonomy"},a=void 0,d={},c=[{value:"1. Self-Healing from Restarts During Disconnection",id:"1-self-healing-from-restarts-during-disconnection",level:2},{value:"2. Preventing Pod Eviction During Disconnection",id:"2-preventing-pod-eviction-during-disconnection",level:2},{value:"2.1 Per-Node Autonomy Duration",id:"21-per-node-autonomy-duration",level:3},{value:"2.2 Heartbeat Delegation (via Yurt-Coordinator)",id:"22-heartbeat-delegation-via-yurt-coordinator",level:3}];function l(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"In a cloud-edge environment, network disconnections between the cloud and edge are common. OpenYurt provides multiple levels of node autonomy capabilities to ensure that edge services remain stable and operational during such disconnections."}),"\n",(0,i.jsx)(n.p,{children:"This document describes three key autonomy features:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#1-self-healing-from-restarts-during-disconnection",children:"1. Self-Healing from Restarts During Disconnection"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"#2-preventing-pod-eviction-during-disconnection",children:"2. Preventing Pod Eviction During Disconnection"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#21-per-node-autonomy-duration",children:"2.1 Per-Node Autonomy Duration"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#22-heartbeat-delegation-via-yurt-coordinator",children:"2.2 Heartbeat Delegation (via Yurt-Coordinator)"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"1-self-healing-from-restarts-during-disconnection",children:"1. Self-Healing from Restarts During Disconnection"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Background:"})," In native Kubernetes, if an edge node or its ",(0,i.jsx)(n.code,{children:"kubelet"})," component restarts while disconnected from the cloud, it cannot recover the running pods because their definitions are stored in memory and cannot be fetched from the API server."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"OpenYurt's Solution:"})," OpenYurt's core edge component, ",(0,i.jsx)(n.strong,{children:"YurtHub"}),", solves this problem. YurtHub acts as a local proxy and cache for all API server requests on the node. When the node is online, it caches necessary data (like Pod specs). If the node or ",(0,i.jsx)(n.code,{children:"kubelet"})," restarts during a network disconnection, ",(0,i.jsx)(n.code,{children:"kubelet"})," can retrieve the required data from YurtHub's local cache, enabling it to successfully recover and restart the business containers."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"How to Use:"}),"\nThis self-healing capability is enabled by default on any edge node where YurtHub is running. Nodes joined to the cluster using ",(0,i.jsx)(n.code,{children:"yurtadm join"})," will have YurtHub installed automatically."]}),"\n",(0,i.jsx)(n.h2,{id:"2-preventing-pod-eviction-during-disconnection",children:"2. Preventing Pod Eviction During Disconnection"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Background:"})," Native Kubernetes will evict (delete and reschedule) pods from a node if the ",(0,i.jsx)(n.code,{children:"kubelet"})," fails to report its heartbeat for a certain period (e.g., 5 minutes). In edge scenarios, this is undesirable as network disconnections are common and do not necessarily mean the node is faulty."]}),"\n",(0,i.jsx)(n.p,{children:"OpenYurt provides two mechanisms to prevent unwanted pod evictions."}),"\n",(0,i.jsx)(n.h3,{id:"21-per-node-autonomy-duration",children:"2.1 Per-Node Autonomy Duration"}),"\n",(0,i.jsx)(n.p,{children:"This is the recommended approach for most edge nodes. It allows you to configure a specific eviction timeout for each edge node, overriding the cluster's global timeout."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"How to Use:"}),"\nTo enable this feature, add the ",(0,i.jsx)(n.code,{children:"node.openyurt.io/autonomy-duration"})," annotation to your edge node."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# First, ensure the node is labeled as an edge node\nkubectl label node my-edge-node openyurt.io/is-edge-worker=true\n\n# Recommended: Set a 24-hour autonomy duration\n# This means the control plane will wait 24 hours before evicting pods from this node.\nkubectl annotate node my-edge-node node.openyurt.io/autonomy-duration="24h"\n\n# To achieve indefinite autonomy (pods will never be evicted due to heartbeat loss)\nkubectl annotate node my-edge-node node.openyurt.io/autonomy-duration="0"\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The duration format can be found ",(0,i.jsx)(n.a,{href:"https://pkg.go.dev/maze.io/x/duration#ParseDuration",children:"here"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"22-heartbeat-delegation-via-yurt-coordinator",children:"2.2 Heartbeat Delegation (via Yurt-Coordinator)"}),"\n",(0,i.jsxs)(n.p,{children:["For more advanced scenarios, OpenYurt provides a heartbeat delegation mechanism using the ",(0,i.jsx)(n.code,{children:"Yurt-Coordinator"})," component. When an edge node's connection to the cloud is lost but its local network (within the same NodePool) is stable, another node (the leader YurtHub) can send heartbeat signals to the cloud on its behalf."]}),"\n",(0,i.jsxs)(n.p,{children:["This keeps the node in a ",(0,i.jsx)(n.code,{children:"Ready"})," state in the cloud, thus preventing pod evictions and stopping the scheduler from assigning new pods to this disconnected node by adding a special taint."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"How to Use:"}),"\nThis is an advanced feature that requires careful setup:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Ensure your OpenYurt version is 1.2.0 or newer."}),"\n",(0,i.jsxs)(n.li,{children:["Ensure a ",(0,i.jsx)(n.code,{children:"Yurt-Coordinator"})," instance is running in each NodePool."]}),"\n",(0,i.jsxs)(n.li,{children:["Start the YurtHub component with the ",(0,i.jsx)(n.code,{children:"--enable-coordinator=true"})," flag."]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},28453:(e,n,o)=>{o.d(n,{R:()=>s,x:()=>a});var t=o(96540);const i={},r=t.createContext(i);function s(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);