"use strict";(self.webpackChunkopenyurt_io=self.webpackChunkopenyurt_io||[]).push([[1477],{10:function(e){e.exports=JSON.parse('{"blogPosts":[{"id":"Enable-MetalLB-in-OpenYurt","metadata":{"permalink":"/blog/Enable-MetalLB-in-OpenYurt","editUrl":"https://github.com/openyurtio/openyurt.io/tree/master/blog/blog/2022-06-28-Enable-Edge-LoadBalancer-Service-based-on-MetalLB.md","source":"@site/blog/2022-06-28-Enable-Edge-LoadBalancer-Service-based-on-MetalLB.md","title":"Edge LoadBalancer service support based on MetalLB","description":"\u80cc\u666f\u4ecb\u7ecd","date":"2022-06-28T00:00:00.000Z","formattedDate":"June 28, 2022","tags":[{"label":"openyurt","permalink":"/blog/tags/openyurt"}],"readingTime":10.7,"truncated":true,"authors":[{"name":"zzguang","title":"Reviewer of OpenYurt","url":"https://github.com/zzguang","imageURL":"https://github.com/zzguang.png","key":"zzguang"}],"frontMatter":{"slug":"Enable-MetalLB-in-OpenYurt","title":"Edge LoadBalancer service support based on MetalLB","authors":["zzguang"],"tags":["openyurt"]},"nextItem":{"title":"Seamless conversion between Kubernetes and OpenYurt","permalink":"/blog/How-to-use-yurtctl-convert-revert"}},"content":"##  \u80cc\u666f\u4ecb\u7ecd\\n\u5728\u4e91\u8fb9\u534f\u540c\u573a\u666f\u4e0b\uff0c\u867d\u7136\u4e91\u7aef\u5df2\u7ecf\u5177\u5907\u4e86\u8f83\u4e3a\u5168\u9762\u7684\u4e91\u539f\u751f\u80fd\u529b\uff0c\u4f46\u8fb9\u7f18\u4fa7\u7531\u4e8e\u7279\u5b9a\u7684\u7f51\u7edc\u73af\u5883\u53ca\u5e94\u7528\u573a\u666f\u7684\u9650\u5236\uff0c\u5f80\u5f80\u65e0\u6cd5\u63d0\u4f9b\u50cf\u4e91\u7aef\u4e00\u6837\u4e30\u5bcc\u7684\u80fd\u529b\uff0c\u800c\u5b9e\u9645\u4e0a\u7528\u6237\u4e1a\u52a1\u5e94\u7528\u7684\u4e3b\u6218\u573a\u5374\u5728\u8fb9\u7f18\u4fa7\uff0c\\n\u8fd9\u5c31\u5bfc\u81f4\u8fb9\u7f18\u4fa7\u5728\u4f7f\u7528\u4e91\u539f\u751f\u80fd\u529b\u7684\u65f6\u5019\u6216\u591a\u6216\u5c11\u5b58\u5728\u4e00\u4e9bgaps\uff0c\u800c\u5982\u4f55\u89e3\u51b3\u8fd9\u4e9bgaps\u4e5f\u6210\u4e3a\u4e91\u8fb9\u534f\u540c\u57fa\u7840\u8bbe\u65bd\u8f6f\u4ef6\u529b\u6c42\u89e3\u51b3\u7684\u5173\u952e\u95ee\u9898\u3002\u672c\u6587\u9488\u5bf9\u8fb9\u7f18\u4fa7\u670d\u52a1\u66b4\u9732\u7ed9\u96c6\u7fa4\u5916\u8bbf\u95ee\u7684\u573a\u666f\uff0c\u6765\u63a2\u8ba8\u4e00\u4e0b\u5728\\nOpenYurt\u8fb9\u7f18\u4fa7\u89e3\u51b3\u4e0a\u8ff0\u95ee\u9898\u7684\u65b9\u6cd5\uff0c\u5e0c\u671b\u80fd\u8d77\u5230\u629b\u7816\u5f15\u7389\u7684\u6548\u679c\u3002\\n\\n\u5728\u539f\u751fKubernetes\u96c6\u7fa4\u4e2d\uff0c\u5982\u679c\u60f3\u5c06\u670d\u52a1\u66b4\u9732\u51fa\u6765\u4f9b\u96c6\u7fa4\u5916\u90e8\u8bbf\u95ee\uff0c\u901a\u5e38\u53ef\u4ee5\u8003\u8651\u4ee5\u4e0b\u51e0\u79cd\u65b9\u5f0f\uff1a\\n- HostNetwork\\n- ExternalIPs\\n- NodePort\\n- LoadBalancer\\n- Ingress  \\n\\n\u5176\u4e2d\u524d\u4e09\u79cd\u65b9\u5f0f\uff0c\u7531\u4e8e\u81ea\u8eab\u5b58\u5728\u4e00\u5b9a\u7684\u5c40\u9650\u6027\uff0c\u5728\u6761\u4ef6\u5141\u8bb8\u7684\u60c5\u51b5\u4e0b\uff0c\u901a\u5e38\u7528\u6237\u66f4\u503e\u5411\u4e8e\u9009\u62e9\u540e\u4e24\u79cd\u65b9\u5f0f\u3002\u800c\u5bf9Ingress\u65b9\u5f0f\u800c\u8a00\uff0c\u4e91\u7aefIngress\u529f\u80fd\u901a\u5e38\u4f1a\u642d\u914d\u4e91\u7aefSLB\u670d\u52a1\u4e00\u8d77\u4f7f\u7528\uff0c\\nSLB\u8d1f\u8d23\u4ece\u7528\u6237\u8bf7\u6c42\u5230\u8282\u70b9\u7ef4\u5ea6\u7684\u8d1f\u8f7d\u5747\u8861\uff0c\u800cIngress\u8d1f\u8d23\u4ece\u8282\u70b9\u5230pod\u7ef4\u5ea6\u7684\u8d1f\u8f7d\u5747\u8861\uff0c\u8fd9\u6837\u5c31\u5b9e\u73b0\u4e86\u4ece\u7528\u6237\u8bf7\u6c42\u5230\u5e94\u7528pod\u7684\u5168\u94fe\u8def\u7684\u8d1f\u8f7d\u5747\u8861\u529f\u80fd\u3002\u7136\u800c\u5728\u4e91\u8fb9\u534f\u540c\u573a\u666f\u4e0b\uff0c\u7531\u4e8e\u8fb9\u7f18\u4fa7\u5e76\u4e0d\u5177\u5907\u4e91\u7aefSLB\u670d\u52a1\u7684\u80fd\u529b\uff0c\u8fb9\u7f18Ingress\u6216\u8fb9\u7f18\u5e94\u7528\u65e0\u6cd5\u66b4\u9732LoadBalancer\u7c7b\u578b\u7684\u670d\u52a1\u4f9b\u96c6\u7fa4\u5916\u8bbf\u95ee\uff0c\u8fd9\u4e5f\u6210\u4e3a\u4e86\u8fb9\u7f18\u4fa7\u5bf9\u5916\u66b4\u9732\u670d\u52a1\u7684\u4e00\u5927\u75db\u70b9\u3002\\n\\n\u4e3a\u4e86\u89e3\u51b3\u4e0a\u8ff0\u75db\u70b9\uff0c\u76ee\u524d\u5728\u5f00\u6e90\u793e\u533a\uff0c\u6709\u51e0\u4e2a\u65b9\u6848\u53ef\u4f9b\u9009\u62e9\uff1aMetalLB, PureLB\u548cOpenELB\u3002  \\n- MetalLB:  https://github.com/metallb\\n- PureLB:   https://github.com/purelb\\n- OpenELB:  https://github.com/openelb\\n\\n\u5173\u4e8e\u4e09\u4e2a\u9879\u76ee\u4e4b\u95f4\u7684\u6bd4\u8f83\uff0c\u53ef\u4ee5\u4ece\u7f51\u4e0a\u67e5\u5230\u4e00\u4e9b\u76f8\u5173\u4ecb\u7ecd\uff0c\u6574\u4f53\u6765\u8bf4\uff0c\u5b83\u4eec\u5b9e\u73b0\u7684\u529f\u80fd\u5927\u540c\u5c0f\u5f02\uff0c\u4ece\u9879\u76ee\u6210\u719f\u5ea6\u53ca\u6d41\u884c\u5ea6\u7684\u89d2\u5ea6\u8003\u8651\uff0c\u6211\u4eec\u9009\u62e9\u4ee5MetalLB\u4e3a\u4f8b\uff0c\u63a2\u8ba8\u4e00\u4e0b\u5982\u4f55\u901a\u8fc7MetalLB\u5728OpenYurt\\n\u8fb9\u7f18\u4fa7\u5b9e\u73b0\u5bf9LoadBalancer\u7c7b\u578bservice\u7684\u652f\u6301\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n##  \u521d\u8bc6MetalLB\\n###  \u4e24\u4e2a\u4efb\u52a1\\nMetalLB\u7684\u5de5\u4f5c\u539f\u7406\u53ef\u4ee5\u603b\u4f53\u5f52\u7eb3\u4e3a\u5b8c\u6210\u4e24\u4e2a\u4efb\u52a1\uff1a\\n```\\n1\uff09. \u4e3aLoadBalancer\u7c7b\u578b\u7684service\u5206\u914d\u5916\u7f51\u53ef\u8bbf\u95ee\u7684IP\u5730\u5740\\n2\uff09. \u5206\u914dIP\u5730\u5740\u540e\uff0c\u8ba9\u96c6\u7fa4\u5916\u90e8\u77e5\u6653\u8be5IP\u5730\u5740\u5b58\u5728\u4e8e\u96c6\u7fa4\u4e2d\\n```\\n###  \u4e24\u7c7b\u7ec4\u4ef6\\nMetalLB\u901a\u8fc7\u4e24\u7c7b\u7ec4\u4ef6\u5b9e\u73b0\u4e0a\u8ff0\u4efb\u52a1\uff1aController\u548cSpeaker\\n```\\nController\u8d1f\u8d23\u76d1\u542cservice\u7684\u53d8\u5316\uff0c\u4e3aLoadBalancer\u7c7b\u578b\u7684service\u5206\u914dIP\u5730\u5740\u5e76\u8fdb\u884cIP\u7684\u751f\u547d\u5468\u671f\u7ba1\u7406\u3002\\nSpeaker\u5219\u4f9d\u636eservice\u7684\u53d8\u5316\uff0c\u6309\u5177\u4f53\u7684\u534f\u8bae\u53d1\u8d77\u76f8\u5e94\u7684\u5e7f\u64ad\u6216\u5e94\u7b54\uff0c\u6839\u636e\u5de5\u4f5c\u6a21\u5f0f\uff08Layer2/BGP\uff09\u7684\u4e0d\u540c\uff0c\u53ef\u91c7\u7528Leader\u8282\u70b9\u6216\u8d1f\u8f7d\u5747\u8861\u7684\u65b9\u5f0f\u6765\u54cd\u5e94\u8bf7\u6c42\uff0c\\n\u4ece\u800c\u5b9e\u73b0\u4e86\u5c06\u5206\u914d\u7684IP\u5730\u5740\u8ba9\u96c6\u7fa4\u5916\u77e5\u6653\u7684\u76ee\u7684\u3002\u5176\u4e2dController\u662f\u4ee5Deployment\u7684\u65b9\u5f0f\u90e8\u7f72\uff0c\u800cSpeaker\u5219\u662f\u4ee5Daemonset\u7684\u65b9\u5f0f\u90e8\u7f72\u5728\u96c6\u7fa4\u4e2d\u5404\u4e2a\u8282\u70b9\u4e0a\u3002\\n```\\n###  \u4e24\u79cd\u6a21\u5f0f\\nMetalLB\u6709\u4e24\u79cd\u5de5\u4f5c\u6a21\u5f0f\uff1aLayer2\u548cBGP\\n```\\nLayer2\u6a21\u5f0f\u6307\u7684\u662f\u9009\u53d6\u96c6\u7fa4\u4e2d\u67d0\u4e2a\u8282\u70b9\u4f5c\u4e3aLeader\u6765\u63a5\u6536\u6240\u6709\u5bf9LoadBalancer service\u7684\u8bbf\u95ee\u6d41\u91cf\uff0c\u5b83\u4f7f\u7528\u6807\u51c6\u7684\u5730\u5740\u53d1\u73b0\u534f\u8bae\u5b9e\u73b0\u670d\u52a1IP\u5bf9\u96c6\u7fa4\u5916\u53ef\u8fbe\u3002\\nBGP\u6a21\u5f0f\u6307\u7684\u662f\u5728\u96c6\u7fa4\u4e2d\u7684\u6240\u6709\u8282\u70b9\u4e0e\u5468\u8fb9\u8fde\u63a5\u7684\u8def\u7531\u5668\u5efa\u7acbBGP\u4f1a\u8bdd\uff0c\u5e76\u544a\u77e5\u8def\u7531\u5668\u5982\u4f55\u8f6c\u53d1\u6d41\u91cf\u5230LoadBalancer service\u5bf9\u5e94\u7684IP\u5730\u5740\u3002\\n\\nLayer2\u6a21\u5f0f\u548cBGP\u6a21\u5f0f\u5404\u6709\u4f18\u7f3a\u70b9\uff1a\\nLayer2\u6a21\u5f0f\u7684\u4f18\u70b9\u5728\u4e8e\u5176\u666e\u9002\u6027\uff0c\u5b83\u53ef\u4ee5\u5728\u4efb\u610f\u4ee5\u592a\u7f51\u73af\u5883\u4e0b\u5de5\u4f5c\uff0c\u4e0d\u4f9d\u8d56\u7279\u5b9a\u7684\u786c\u4ef6\uff0c\u751a\u81f3\u4e0d\u9700\u8981\u8def\u7531\u5668\u3002\\n\u7f3a\u70b9\u662f\u5b83\u5e76\u672a\u5b9e\u73b0\u771f\u6b63\u610f\u4e49\u4e0a\u7684\u8d1f\u8f7d\u5747\u8861\uff0c\u6240\u6709\u5bf9service\u7684\u8bbf\u95ee\u6d41\u91cf\u90fd\u5c06\u8def\u7531\u5230Leader\u8282\u70b9\u4e0a\uff0c\u518d\u7531\u8be5\u8282\u70b9\u4e0a\u7684kube-prox\u5c06\u6d41\u91cf\u5206\u53d1\u5230\u5bf9\u5e94\u7684\u540e\u7aefpod\u4e0a\uff0c\\n\u800c\u5f53Leader\u8282\u70b9\u51fa\u73b0\u6545\u969c\u65f6\uff0c\u4f1a\u5207\u6362\u5230\u5176\u4ed6\u8282\u70b9\u63a5\u7ba1\u670d\u52a1\uff0c\u56e0\u6b64Layer2\u6a21\u5f0f\u5b58\u5728\u5355\u8282\u70b9\u6d41\u91cf\u74f6\u9888\u53ca\u8282\u70b9\u6545\u969c\u5207\u6362\u4e0d\u53ca\u65f6\u7684\u5c40\u9650\u6027\u3002\\nBGP\u6a21\u5f0f\u7684\u4f18\u52bf\u5728\u4e8e\u5b83\u5b9e\u73b0\u4e86\u771f\u6b63\u610f\u4e49\u4e0a\u7684\u8d1f\u8f7d\u5747\u8861\uff0c\u6d41\u91cf\u4e0d\u518d\u50cfLayer2\u6a21\u5f0f\u4e00\u6837\u53ea\u80fd\u8def\u7531\u5230Leader\u8282\u70b9\uff0c\u800c\u662f\u96c6\u7fa4\u4e2d\u6240\u6709\u8282\u70b9\u90fd\u6709\u673a\u4f1a\u53c2\u4e0e\u6d41\u91cf\u8f6c\u53d1\u3002\\n\u5176\u7f3a\u70b9\u4e00\u662f\u4f9d\u8d56\u786c\u4ef6\u8def\u7531\u5668\u8bbe\u5907\uff0c\u4e8c\u662f\u65e0\u6cd5\u4f18\u96c5\u7684\u5e94\u5bf9\u8282\u70b9IP\u5730\u5740\u540e\u7aef\u96c6\u7684\u53d8\u5316\uff0c\u5f53\u96c6\u7fa4\u6709\u8282\u70b9\u5b95\u673a\u65f6\uff0c\u4e0eLoadBalancer service\u5173\u8054\u7684\u6240\u6709\u8fde\u63a5\u90fd\u5c06\u4e2d\u65ad\u3002\\n```\\n###  \u4e24\u4e2a\u914d\u7f6e\\n\u901a\u8fc7\u4ee5\u4e0a\u4ecb\u7ecd\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u4f7f\u7528MetalLB\u7684\u65f6\u5019\uff0c\u7528\u6237\u9700\u8981\u8fdb\u884c\u4ee5\u4e0b\u4e24\u4e2a\u914d\u7f6e\uff1a\\n```\\n1\uff09. \u914d\u7f6eIP\u5730\u5740\u6c60\uff0c\u4f9bMetalLB\u7ed9LoadBalancer service\u5206\u914dIP\u5730\u5740\u65f6\u4f7f\u7528\\n2\uff09. \u914d\u7f6eMetalLB\u7684\u5de5\u4f5c\u6a21\u5f0f\uff0c\u9009\u62e9\u91c7\u7528Layer2\u6216\u8005BGP\u6a21\u5f0f\\n```\\n\\n##  \u90e8\u7f72MetalLB\\n\u8fd0\u884cMetalLB\u73af\u5883\u8981\u6c42\uff1a\\n```\\n1). \u8fd0\u884cKubernetes 1.13.0\u6216\u66f4\u9ad8\u7248\u672c\u7684\u96c6\u7fa4\\n2). \u96c6\u7fa4\u7f51\u7edc\u914d\u7f6e\uff0cMetalLB\u517c\u5bb9\u5927\u90e8\u5206\u7f51\u7edcCNI\u65b9\u6848\uff0c\u4f46\u5bf9\u6709\u4e9bCNI\u7684\u517c\u5bb9\u53ef\u80fd\u5b58\u5728\u4e2a\u522b\u95ee\u9898\uff0c\u5177\u4f53\u53ef\u4ee5\u53c2\u8003\u4ee5\u4e0b\u94fe\u63a5\uff1a\\n    https://metallb.universe.tf/installation/network-addons/\\n3). \u4f9bMetalLB\u4f7f\u7528\u7684\u4e00\u7ec4IP\u5730\u5740\\n4). \u5982\u679c\u4f7f\u7528BGP\u6a21\u5f0f\uff0c\u60a8\u8fd8\u9700\u8981\u4e00\u4e2a\u6216\u591a\u4e2a\u80fd\u591f\u652f\u6301BGP\u534f\u8bae\u7684\u8def\u7531\u5668\\n```\\n\u4e0b\u9762\u6211\u4eec\u4ee5k8s 1.18.20\uff0c MetalLB 0.11.0\u4e3a\u4f8b\u6765\u5177\u4f53\u770b\u4e00\u4e0bMetalLB\u5728OpenYurt\u73af\u5883\u4e0b\u7684\u90e8\u7f72\u548c\u7528\u6cd5\u3002  \\n\u8981\u90e8\u7f72MetalLB\u5230OpenYurt\u96c6\u7fa4\u7684\u8fb9\u7f18\u4fa7\uff0c\u6709\u591a\u79cd\u65b9\u5f0f\u53ef\u4f9b\u9009\u62e9\uff0c\u65e0\u8bba\u9009\u62e9\u4f55\u79cd\u65b9\u5f0f\uff0c\u90e8\u7f72MetalLB\u610f\u5473\u7740\u90e8\u7f72\u4ee5\u4e0b\u8d44\u6e90\u5230\u96c6\u7fa4\u4e2d\uff1a\\n```\\n1\uff09. \u521b\u5efametallb-system namespace\\n2\uff09. \u90e8\u7f72MetalLb Controller Deployment\uff0c\u5b83\u4f5c\u7528\u4e8e\u96c6\u7fa4\u8303\u56f4\uff0c\u8d1f\u8d23\u4e3a\u76f8\u5173service\u5206\u914dIP\u5730\u5740\\n3) . \u90e8\u7f72MetalLb Speaker Daemonset\u5230\u5404\u4e2a\u8282\u70b9\u4e0a\uff0c\u5b83\u8d1f\u8d23\u6839\u636e\u7528\u6237\u9009\u62e9\u7684\u5de5\u4f5c\u6a21\u5f0f\u4f7f\u7528\u5bf9\u5e94\u7684\u534f\u8bae\u8ba9service\u5bf9\u5916\u53ef\u8fbe\\n4) . \u90e8\u7f72Controller\u548cSpeaker\u5bf9\u5e94\u7684service account\u4ee5\u53ca\u7ec4\u4ef6\u8fd0\u884c\u6240\u9700\u7684RBAC\u6743\u9650\\n```\\n\u7531\u4e8e\u6211\u4eec\u4e0d\u9700\u8981\u5728\u4e91\u7aef\u90e8\u7f72\uff0c\u6211\u4eec\u9700\u8981\u9488\u5bf9\u539f\u751f\u7684MetalLB\u7a0d\u4f5c\u8c03\u6574\uff0c\u786e\u4fdd\u76f8\u5173\u8d44\u6e90\u53ea\u4f1a\u90e8\u7f72\u5230\u8fb9\u7f18\u4fa7\u3002\\n\\n\u4e0b\u9762\u5c31\u4ee5Manifest\u90e8\u7f72\u65b9\u5f0f\u4e3a\u4f8b\uff0c\u770b\u4e00\u4e0b\u5982\u4f55\u90e8\u7f72MetalLB\u5230OpenYurt\u96c6\u7fa4\u4e2d\uff1a\\n```\\n\u521b\u5efametallb-system namespace:\\n    kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.11.0/manifests/namespace.yaml\\n\\n\u62c9\u53d6metallb yaml\uff1a\\n    wget https://raw.githubusercontent.com/metallb/metallb/v0.11.0/manifests/metallb.yaml\\n\\n\u4fee\u6539metallb.yaml, Controller\u548cSpeaker\u7684nodeSelector\u4e2d\u6dfb\u52a0\u53ea\u90e8\u7f72\u5230\u8fb9\u7f18\u8282\u70b9\u7684\u9650\u5236\uff1a\\n    nodeSelector:\\n      openyurt.io/is-edge-worker\uff1a\'true\'\\n\\n\u90e8\u7f72metallb\u76f8\u5173\u8d44\u6e90\uff1a\\n    kubectl apply -f metallb.yaml\\n```\\n\u6b64\u65f6MetalLB\u76f8\u5173\u7684\u7ec4\u4ef6\u5df2\u7ecf\u90e8\u7f72\u5b8c\u6bd5\u5e76\u5f00\u59cb\u8fd0\u884c\uff0c\u4f46\u7531\u4e8e\u6211\u4eec\u5e76\u6ca1\u6709\u8fdb\u884c\u4e0a\u8ff0\u4e24\u4e2a\u914d\u7f6e\uff08IP\u5730\u5740\u6c60\u3001MetalLB\u5de5\u4f5c\u6a21\u5f0f\uff09\uff0cController\u548cSpeaker\u4e00\u76f4\u5904\u4e8eidle\u72b6\u6001\u3002\\n\u56e0\u6b64\u8981\u4f7fMetalLB\u6b63\u5e38\u5de5\u4f5c\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u6839\u636e\u672c\u5730\u7f51\u7edc\u60c5\u51b5\u90e8\u7f72\u4e00\u4e2a\u76f8\u5e94\u7684configmap\uff08\u4ee5Layer2\u6a21\u5f0f\u4e3a\u4f8b\uff09\uff1a\\n\\n```\\ncat <<EOF | kubectl apply -f -\\n\\napiVersion: v1\\nkind: ConfigMap\\nmetadata:\\n  namespace: metallb-system\\n  name: config\\ndata:\\n  config: |\\n    address-pools:\\n    - name: default\\n      protocol: layer2\\n      addresses:\\n      - 192.168.122.90-192.168.122.100\\n\\nEOF\\n```\\n\u81f3\u6b64\uff0cMetalLB\u7684Controller\u548cSpeaker\u771f\u6b63\u8fdb\u5165\u4e86\u5de5\u4f5c\u5c31\u7eea\u72b6\u6001\u3002\\n\\n\\n##  \u4f7f\u7528MetalLB\\nMetalLB\u90e8\u7f72\u6210\u529f\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u8fb9\u7f18\u4fa7\u521b\u5efaLoadBalancer\u7c7b\u578b\u7684service\u4e86\uff0c\u4e3e\u4f8b\u8bf4\u660e\u5982\u4e0b\uff1a  \\n\u521b\u5efa\u4e00\u4e2a\u5e94\u7528Deployment\uff1a\\n```\\ncat <<EOF | kubectl apply -f -\\n\\napiVersion: apps/v1\\nkind: Deployment\\nmetadata:\\n  name: edgeapp-deployment\\n  labels:\\n    app: edgeapp\\nspec:\\n  selector:\\n    matchLabels:\\n      app: edgeapp\\n  template:\\n    metadata:\\n      labels:\\n        app: edgeapp\\n    spec:\\n      containers:\\n      - name: nginx\\n        image: nginx:1.19.4\\n        ports:\\n        - containerPort: 80\\n      nodeSelector:\\n        openyurt.io/is-edge-worker: \'true\'\\n\\nEOF\\n```\\n\u521b\u5efa\u4e00\u4e2a\u4e0e\u8be5Deployment\u5bf9\u5e94\u7684LoadBalancer service\uff1a\\n```\\ncat <<EOF | kubectl apply -f -\\n\\napiVersion: v1\\nkind: Service\\nmetadata:\\n  name: edgeapp-svc\\nspec:\\n  selector:\\n    app: edgeapp\\n  ports:\\n    - protocol: TCP\\n      port: 80\\n      targetPort: 80\\n  type: LoadBalancer\\n\\nEOF\\n```\\n\u9a8c\u8bc1LoadBalancer service\u662f\u5426\u521b\u5efa\u6210\u529f\uff1a\\n```\\n#kubectl get service\\nNAMESPACE     NAME              TYPE           CLUSTER-IP        EXTERNAL-IP        PORT(S)           AGE\\ndefault       kubernetes        ClusterIP      192.167.0.1       <none>             443/TCP           10d\\ndefault       edgeapp-svc       LoadBalancer   192.167.188.185   192.168.122.90     80:31378/TCP      9s\\n```\\n\u4eceEXTERNAL-IP\u4e2d\uff0c\u53ef\u4ee5\u770b\u5230LoadBalancer service\u5df2\u7ecf\u4eceIP\u5730\u5740\u6c60\u4e2d\u83b7\u53d6\u4e86IP\u5730\u5740\u3002\\n\\n\u9a8c\u8bc1LoadBalancer service\u662f\u5426\u53ef\u4ee5\u8bbf\u95ee\uff1a\\n```\\n#curl 192.168.122.90\\n<!DOCTYPE html>\\n<html>\\n<head>\\n<title>Welcome to nginx!</title>\\n<style>\\n    body {\\n        width: 35em;\\n        margin: 0 auto;\\n        font-family: Tahoma, Verdana, Arial, sans-serif;\\n    }\\n</style>\\n```\\n\\n\\n##  \u6ce8\u610f\u4e8b\u9879\\n1). \u4eceKubernetes v1.14.2\u5f00\u59cb\uff0c\u5982\u679ckube-proxy\u91c7\u7528IPVS\u6a21\u5f0f\uff0c\u5fc5\u987b\u6253\u5f00strict ARP\u6a21\u5f0f\\n\\n```\\n    kubectl edit configmap -n kube-system kube-proxy\\n\\n    apiVersion: kubeproxy.config.k8s.io/v1alpha1\\n    kind: KubeProxyConfiguration\\n    mode: \\"ipvs\\"\\n    ipvs:\\n      strictARP: true\\n```\\n2). \u7528\u6237\u53ef\u4ee5\u914d\u7f6e\u591a\u4e2aIP\u5730\u5740\u6c60\uff0c\u521b\u5efaLoadBalancer service\u7684\u65f6\u5019\u53ef\u4ee5\u901a\u8fc7annotations\u9009\u62e9\u4f7f\u7528\u54ea\u4e2a\u5730\u5740\u6c60  \\n3). \u914d\u7f6eIP\u5730\u5740\u6c60\u65f6\uff0c\u901a\u5e38IP\u5730\u5740\u662f\u516c\u7f51IP\u4ee5\u4fbf\u96c6\u7fa4\u5916\u53ef\u4ee5\u8bbf\u95ee\uff0c\u5982\u679c\u914d\u6210\u96c6\u7fa4\u5185\u79c1\u7f51IP\uff0c\u90a3\u8be5\u670d\u52a1\u53ea\u80fd\u5728\u96c6\u7fa4\u5185\u88ab\u8bbf\u95ee\\n\\n\\n##  \u53c2\u8003\u94fe\u63a5\\nhttps://metallb.universe.tf/  \\nhttps://www.51cto.com/article/707574.html  \\nhttps://blog.csdn.net/shigiaz/article/details/118390917"},{"id":"How-to-use-yurtctl-convert-revert","metadata":{"permalink":"/blog/How-to-use-yurtctl-convert-revert","editUrl":"https://github.com/openyurtio/openyurt.io/tree/master/blog/blog/2021-12-03-Conversion-between-kubernetes-and-openyurt.md","source":"@site/blog/2021-12-03-Conversion-between-kubernetes-and-openyurt.md","title":"Seamless conversion between Kubernetes and OpenYurt","description":"\u6253\u5f00openYurt\u7684README.md\uff0c\u5728\u7b80\u5355\u4ecb\u7ecd\u4e4b\u540e\u5c31\u662fGetting started:","date":"2021-12-03T00:00:00.000Z","formattedDate":"December 3, 2021","tags":[{"label":"openyurt","permalink":"/blog/tags/openyurt"}],"readingTime":8.61,"truncated":true,"authors":[{"name":"adamzhoul","title":"Member of OpenYurt","url":"https://github.com/adamzhoul","imageURL":"https://github.com/adamzhoul.png","key":"adamzhoul"}],"frontMatter":{"slug":"How-to-use-yurtctl-convert-revert","title":"Seamless conversion between Kubernetes and OpenYurt","authors":["adamzhoul"],"tags":["openyurt"]},"prevItem":{"title":"Edge LoadBalancer service support based on MetalLB","permalink":"/blog/Enable-MetalLB-in-OpenYurt"},"nextItem":{"title":"Use service topology to realize topology-aware traffic routing","permalink":"/blog/How-to-use-service-topology"}},"content":"\u6253\u5f00openYurt\u7684README.md\uff0c\u5728\u7b80\u5355\u4ecb\u7ecd\u4e4b\u540e\u5c31\u662fGetting started:\\n\\n```\\n yurtctl convert --provider [minikube|kubeadm|kind] // To convert an existing Kubernetes cluster to an OpenYurt cluster\\n yurtctl revert // To uninstall and revert back to the original cluster settings\\n```\\n\\n\u7b80\u5355\u4e00\u884c\u547d\u4ee4\u5c31\u53ef\u4f53\u9a8cOpenYurt\u4e86\uff0c\u611f\u89c9\u975e\u5e38\u65b9\u4fbf\u3002\\n\\n\u7a0d\u7b49\uff01\u4e3a\u4ec0\u4e48\u662f convert/revert \u800c\u4e0d\u662f install/uninstall ?\\n\\n\u8fd9\u4e2a\u547d\u4ee4\u5bf9\u96c6\u7fa4\u505a\u4e86\u4ec0\u4e48\uff1f\\n\\n\u770b\u6765\uff0c\u5728\u6267\u884c\u5b83\u4e4b\u524d\u6709\u5fc5\u8981\u641e\u6e05\u695a\u5b83\u5230\u5e95\u505a\u4e86\u4ec0\u4e48\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## yurtctl convert \u5230\u5e95\u505a\u4e86\u4e9b\u4ec0\u4e48\uff1f\\n\\n### \u6838\u5fc3\u6d41\u7a0b\\n\\n\u8ddf\u968fopenYurt[\u6e90\u4ee3\u7801](https://github.com/openyurtio/openyurt/blob/5063752a9f6645270e3177e39a46df8c23145af2/pkg/yurtctl/cmd/convert/convert.go#L300)\uff0c\u68b3\u7406\u4e86convert\u7684\u6838\u5fc3\u6d41\u7a0b\uff1a\\n\\n\\n```\\n1. \u68c0\u67e5\\n   1.1 \u68c0\u67e5\u6240\u6709node\u8282\u70b9\u72b6\u6001\u4e3aready\\n2. \u7ec4\u4ef6\u90e8\u7f72\\n  2.1 \u7ed9node\u8282\u70b9\u6253\u4e0a\u76f8\u5e94\u7684label\u3002\\n  2.2 \u4f7f\u7528deployment\u90e8\u7f72yurt-controller-manager\u3002\\n  2.3 \u4f7f\u7528deployment\u90e8\u7f72yurt-tunnel-server\u3002\\n  2.4 \u4f7f\u7528daemonset\u90e8\u7f72yurt-tunnel-agent\uff0c\u90e8\u7f72\u5728\u8fb9\u7f18\u8282\u70b9\u4e0a\u3002\\n  2.5 \u4f7f\u7528deployment\u90e8\u7f72yurt-app-manager\u3002\\n3. k8s\u7ec4\u4ef6\u4fee\u6539\\n  3.1 \u4fee\u6539kube-controller-manager.yaml\uff0c\u7528\u6765disable nodelifecycle controller\\n4. \u8282\u70b9\u8f6c\u6362\\n   4.1 \u5199\u5165yurthub.yaml\u5230/etc/kubernetes/manifests\uff0c\u542f\u52a8\u9759\u6001pod\\n   4.2 \u4fee\u6539kubelet\u914d\u7f6e\uff0c\u4f7f\u5f97kubelet\u8bbf\u95eeyurthub\u800c\u4e0d\u662f\u76f4\u8fdeapiServer\\n```\\n\\n\u53ef\u89c11\u30012\u5e76\u6ca1\u6709\u4ec0\u4e48\u7279\u522b\uff0c\u53ea\u662f\u5e38\u89c4\u7684\u670d\u52a1\u90e8\u7f72\\n\\n3\uff0c\u5219\u662f\u5bf9\u539f\u6709k8s\u7cfb\u7edf\u7ec4\u4ef6\u7684\u64cd\u4f5c\uff0c\u9700\u8981\u7279\u522b\u6ce8\u610f\\n\\n4-\u8282\u70b9\u8f6c\u6362\u770b\u7740\u4e5f\u5e76\u4e0d\u590d\u6742\uff0c\u5374\u5bf9\u8fb9\u7f18\u81f3\u5173\u91cd\u8981\u3002\\n\\n\\n\\n### disable nodelifecycle controller \u505a\u4e86\u4ec0\u4e48\uff1f\\n\\n\u5de5\u4f5c\u5185\u5bb9\uff1a\\n\\n    1. \u67e5\u8be2\u63a7\u5236\u9762\u8282\u70b9\\n    2. \u521b\u5efajob\uff0c\u901a\u8fc7` nodeName: {{.nodeName}}` \u786e\u4fddjob\u7684pod\u8c03\u5ea6\u5230\u5bf9\u5e94node\u4e0a\u6267\u884c(\u901a\u8fc7nsenter\u7684\u65b9\u5f0f\u6267\u884c\uff0c\u4fee\u6539\u5bbf\u4e3b\u673a\u4e0a\u6587\u4ef6)\u3002\\n    3. sed -i \'s/--controllers=/--controllers=-nodelifecycle,/g\' /etc/kubernetes/manifests/kube-controller-manager.yaml\\n\\n\u67e5\u770bkube-controller-manager.yaml\\n\\n```\\n...\\ncontainers:\\n- command:\\n- kube-controller-manager\\n- --allocate-node-cidrs=true\\n    ...\\n- --controllers=-nodelifecycle,*,bootstrapsigner,tokencleaner\\n...\\n```\\n\u53ef\u89c1\uff0c\u4e0a\u9762\u7684\u4e00\u7cfb\u5217\u64cd\u4f5c\u6700\u7ec8\u5c31\u662f\u4fee\u6539\u4e86kube-controller-manager\u7684\u542f\u52a8\u547d\u4ee4\u3002\\n\\n\u67e5\u770bkube-controller-manager\u542f\u52a8\u53c2\u6570\u8bf4\u660e\uff1a\\n\\n    --controllers \u4ee3\u8868\u9700\u8981\u5f00\u542f\u7684controller\u5217\u8868\\n\\n\u53ef\u89c1\uff0csed\u547d\u4ee4\u5c31\u662f\u53bb\u6389\u4e86nodelifecycle\u8fd9\u4e2acontroller\u3002\\n\\n\\n\u90a3\uff0cnodelifecycle controller\u662f\u505a\u4ec0\u4e48\u7684\uff1f\\n\\n\u7b80\u5355\u6765\u8bf4\uff1a\\n\\n    1. \u4e0d\u65ad\u76d1\u542c\uff0ckubelet\u4e0a\u62a5\u4e0a\u6765\u7684node\u4fe1\u606f\\n    2. \u5982\u679c\u67d0\u4e2anode\u72b6\u6001\u5f02\u5e38\uff0c\u6216\u8005\u8bf4\u957f\u65f6\u95f4\u6ca1\u6709\u4e0a\u62a5\u7b49\\n      2.1 \u9a71\u9010\u8fd9\u4e2anode\u8282\u70b9\u6216\u8005\u5176\u4ed6 ---\x3e \u5bfc\u81f4\u4e0a\u9762\u7684pod\u88ab\u91cd\u65b0\u8c03\u5ea6\\n\\n\u53ef\u89c1\uff0c\u5bf9\u4e8e\u5904\u4e8e\u5f31\u7f51\u73af\u5883\u7684\u8fb9\u7f18\u8282\u70b9\uff0c\u5f88\u5bb9\u6613\u5c31\u547d\u4e2d\u5f02\u5e38\u72b6\u6001\uff0c\u5bfc\u81f4node\u88ab\u9a71\u9010\uff0cpod\u88ab\u91cd\u65b0\u8c03\u5ea6\u3002\\n\\n\u6240\u4ee5\u8fd9\u91cc\u628a\u5b83\u53bb\u6389\u4e86\u3002\u4f7f\u7528yurt-controller-manager\u6765\u4ee3\u66ff\u5b83\u3002\\n\\n\u5373\u4f7f\u8282\u70b9\u5fc3\u8df3\u4e22\u5931\uff0c\u5904\u4e8e\u81ea\u6cbb\u6a21\u5f0f\u7684\u8282\u70b9\u4e2d\u7684pod\u4e5f\u4e0d\u4f1a\u4eceAPIServer\u4e2d\u9a71\u9010\u3002\\n\\n\u6ce8\uff1a\u8fd9\u91cc\u81ea\u6cbb\u6a21\u5f0f\u7684\u8282\u70b9\uff0c\u6307\u7684\u5c31\u662f\u8fb9\u7f18\u8282\u70b9\u3002\u6211\u4eec\u901a\u5e38\u4f1a\u901a\u8fc7\u52a0annotation\u7684\u65b9\u5f0f\u628a\u8282\u70b9\u6807\u8bb0\u4e3a\u81ea\u6cbb\u8282\u70b9\u3002\\n\\n\\n\\n### \u8282\u70b9\u8f6c\u6362\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff0c\u4e91\u7aef\u8282\u70b9\u548c\u8fb9\u7f18\u8282\u70b9\u6709\u4ec0\u4e48\u5dee\u5f02?\\n\\n\u540c\u6837\uff0c\u662f\u901a\u8fc7\u8dd1job\u7684\u65b9\u5f0f\uff0c\u5728\u76ee\u6807\u5bbf\u4e3b\u673a\u4e0a\u4e0b\u6587\u4e2d\u6267\u884c\u76f8\u5173\u64cd\u4f5c\u3002\\n\\n\u4e0d\u8fc7\uff0c\u76f8\u6bd4\u4e8e\u66b4\u529b\u4f7f\u7528nsenter\uff0c\u8fd9\u91cc\u7528\u4e86\u66f4\u52a0\u4f18\u96c5\u7684\u65b9\u5f0f\u3002\u901a\u8fc7\u5c06\u5bbf\u4e3b\u673a\u6839\u8def\u5f84 volume\u6302\u8f7d\u5230\u5bb9\u5668\u91cc\u7684\u65b9\u5f0f\u3002\\n\\n\\n\\n##### kubelet\u7684\u4fee\u6539\\n\\n\u5728\u6587\u4ef6/var/lib/kubelet/kubeadm-flags.env \u4e2d\u4e3aKUBELET_KUBEADM_ARGS\u6dfb\u52a0\u914d\u7f6e\uff1a\\n\\n` --kubeconfig=/var/lib/openyurt/kubelet.conf --bootstrap-kubeconfig= `\\n\\n\u4f5c\u7528\uff1a\\n\\n    1. \u53c2\u6570\uff1a--kubeconfig \uff0c \u7ed9kubelet\u6307\u5b9a\u4e86\u8bbf\u95eeapiServer\u7684\u914d\u7f6e\u6587\u4ef6\u3002\\n    2. \u5f53--kubeconfig \u6587\u4ef6\u5b58\u5728\uff0c--bootstrap-kubeconfig\u4e3a\u7a7a\u65f6\uff0c\\n       kubelet\u542f\u52a8\u5c31\u4e0d\u9700\u8981\u901a\u8fc7bootstrap-token\u7f6e\u6362\u6587\u4ef6\u8bc1\u4e66\u7b49\u8fc7\u7a0b\uff0c\u76f4\u63a5\u8bfb\u53d6kubeconfig\u6587\u4ef6\u8bbf\u95eeapiServer\u3002\\n    3. \u7531\u4e8eKUBELET_KUBEADM_ARGS \u662fkubelet\u542f\u52a8\u53c2\u6570\u7684\u6700\u540e\u4e00\u90e8\u5206\uff0c\u6240\u4ee5\u53ef\u4ee5\u8d77\u5230\u8986\u76d6\u524d\u9762\u53c2\u6570\u7684\u4f5c\u7528\u3002\\n\\n\u5176\u4e2d`/var/lib/openyurt/kubelet.conf`\u5185\u5bb9\u5982\u4e0b\uff0c\u76f4\u63a5\u5c06\u6d41\u91cf\u6307\u5b9a\u5230yurthub\uff1a\\n\\n```\\napiVersion: v1\\nclusters:\\n- cluster:\\nserver: http://127.0.0.1:10261\\nname: default-cluster\\ncontexts:\\n- context:\\ncluster: default-cluster\\nnamespace: default\\nuser: default-auth\\nname: default-context\\ncurrent-context: default-context\\nkind: Config\\npreferences: {}\\n```\\n\\n\\n\\n##### yurthub\u7684\u542f\u52a8\u7ec6\u8282\\n\\nyurthub\u5bb9\u5668\u542f\u52a8\u53c2\u6570\u5982\u4e0b\uff1a\\n\\n```\\ncommand:\\n- yurthub\\n- --v=2\\n- --server-addr=__kubernetes_service_addr__\\n- --node-name=$(NODE_NAME)\\n- --join-token=__join_token__\\n- --working-mode=__working_mode__\\n```\\n\\n\u901a\u8fc7\u53c2\u6570\u6211\u4eec\u53ef\u770b\u51fa\uff1a\\n\\n    1. server-addr \u6307\u5b9a\u4e86\u4e91\u7aefapiServer\u5730\u5740\u3002\u6ce8\u610f\u8fd9\u91cc\u7684\u5730\u5740\u4e00\u5b9a\u662f\u516c\u7f51\u53ef\u8bbf\u95ee\u5730\u5740\uff0c\u5426\u5219\u5f02\u6784\u7f51\u7edc\u4e0b\u4f1a\u6709\u95ee\u9898\u3002\\n    2. join-token \u5c31\u662f\u52a0\u5165\u8282\u70b9\u7684token\uff0c\u53ef\u4f7f\u7528`kubeadm token create`\u6765\u521b\u5efa\u3002k8s\u63d0\u4f9b\u673a\u5236\uff0c\u901a\u8fc7token\u7f6e\u6362\u51fa\u6b63\u5e38\u8bbf\u95ee\u7684kubeconf\u6587\u4ef6\u3002\\n    3. working-mode\uff1a cloud/edge\u3002\u8fd9\u5c31\u662f\u8fb9\u7f18\u8282\u70b9\u548c\u4e91\u7aef\u8282\u70b9\u7684\u5dee\u5f02\u3002\\n\\n\\n\\n\u6211\u4eec\u90fd\u77e5\u9053yurthub\u53ef\u4ee5\u7528\u6765\u505a\u7f13\u5b58\uff0c\u662f\u89e3\u51b3\u8fb9\u7f18\u81ea\u6cbb\u7684\u91cd\u8981\u73af\u8282\u3002\u90a3\u4e48\u4e91\u7aef\u4e3a\u4ec0\u4e48\u4e5f\u9700\u8981\u90e8\u7f72\uff1f\u4e3a\u4ec0\u4e48\u8fd8\u8981\u533a\u5206edge\u6216\u8005cloud\u5de5\u4f5c\u6a21\u5f0f\uff1f\\n\\n\u7b80\u5355\u67e5\u770byurthub\u6e90\u4ee3\u7801 cmd/yurthub/app/start.go:\\n\\n``` golang\\nif cfg.WorkingMode == util.WorkingModeEdge {\\n    cacheMgr, err = cachemanager.NewCacheManager(cfg.StorageWrapper, cfg.SerializerManager, cfg.RESTMapperManager, cfg.SharedFactory)\\n    ...\\n} else {\\n    klog.Infof(\\"%d. disable cache manager for node %s because it is a cloud node\\", trace, cfg.NodeName)\\n}\\nif cfg.WorkingMode == util.WorkingModeEdge {\\n    ...\\n    gcMgr, err := gc.NewGCManager(cfg, restConfigMgr, stopCh)\\n} else {\\n    klog.Infof(\\"%d. disable gc manager for node %s because it is a cloud node\\", trace, cfg.NodeName)\\n}\\n```\\n\\n\u53ef\u89c1\uff0c\u4e91\u7aefyurthub\uff0c\u5c11\u505a\u4e86 cache\u3001GC\u7684\u5de5\u4f5c\u3002\\n\\n\u67e5\u770b[issue](https://github.com/openyurtio/openyurt/issues/450) \u53ef\u4e86\u89e3\uff1a\u4e91\u7aef\u4e5f\u53ef\u4ee5\u5229\u7528yurthub\u63d0\u4f9b\u7684data-filtering\u80fd\u529b\u6765\u63a7\u5236service\u7684\u6d41\u91cf\\n\\n\u5f53\u7136\uff0c\u4e91\u7aef\u4e5f\u4e0d\u9700\u8981\u505acache\u7b49\u5de5\u4f5c\u3002\\n\\n\\n\\n### \u547d\u4ee4\u884c\u53c2\u6570\\n\\n\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u6709\u51e0\u4e2a\u53c2\u6570\u6bd4\u8f83\u91cd\u8981\uff1a\\n\\n--cloud-nodes \u7528\u4e8e\u6807\u8bc6\u54ea\u4e9b\u662f\u4e91\u7aef\u8282\u70b9\uff0c\u591a\u4e2a\u8282\u70b9\u7528\u9017\u53f7\u5206\u9694\uff1anode1,node2\\n\\n--deploy-yurttunnel \u6807\u8bb0\u662f\u5426\u8981\u90e8\u7f72yurttunnel\\n\\n--kubeadm-conf-path \u6807\u8bb0\u8282\u70b9\u673a\u5668\u4e0akubeadm\u914d\u7f6e\u6587\u4ef6\u8def\u5f84\u3002\u9ed8\u8ba4\uff1a/etc/systemd/system/kubelet.service.d/10-kubeadm.conf\\n\\n\u66f4\u591a\u53c2\u6570\uff0c\u53ef\u4f7f\u7528 yurtctl convert --help \u6765\u67e5\u770b\u3002\\n\\n\\n\\n### \u603b\u7ed3\\n\\n\u7b80\u5355\u6765\u8bf4\uff0cconvert\u6838\u5fc3\u505a\u4e86\u51e0\u4e2a\u4e8b\u60c5\uff1a\\n\\n    1. disable k8s \u7684nodelifecontroller\uff0c\u7528\u81ea\u5df1\u7684yurtcontrollermanager\u6765\u66ff\u6362\u5b83\u7684\u804c\u8d23\u3002\\n    2. \u5b89\u88c5\u81ea\u5df1\u7684\u5404\u7c7b\u7ec4\u4ef6\uff0cdeployment\u3001damenonset \u7b49\u6a21\u5f0f\u90e8\u7f72\u3002\uff08\u8fd9\u7c7b\u8d44\u6e90\u90e8\u7f72\u65e0\u9700\u4efb\u4f55\u62c5\u5fc3\uff0c\u56e0\u4e3a\u641e\u4e0d\u574f\u96c6\u7fa4\uff0c\u4e5f\u4e0d\u592a\u4f1a\u51fa\u73b0\u95ee\u9898\u3002\uff09\\n    3. \u8fb9\u7f18\u8282\u70b9\uff1a\u542f\u52a8yurthub\u9759\u6001pod;\u5c06kubelet\u6d41\u91cf\u8f6c\u53d1\u5230yurthub\u3002\\n\\n\u53ef\u89c1\uff0cconvert\u7684\u4e8b\u60c5\u8fd8\u662f\u6bd4\u8f83\u53ef\u63a7\u7684\u3002\u6267\u884cyurtctl convert \u4e5f\u4e0d\u7528\u592a\u62c5\u5fc3\u3002\\n\\n\u5f53\u7136\uff0c\u6700\u540e\u7684\u62c5\u5fc3\u4e5f\u5e94\u8be5\u7531 yurtctl revert \u6765\u5f7b\u5e95\u6d88\u9664\uff01\\n\\n\\n\\n## yurtctl revert \u53c8\u5e72\u4e86\u4e9b\u4ec0\u4e48\uff1f\\n\\n### \u6838\u5fc3\u6d41\u7a0b\\n\\n    1. \u68c0\u67e5\\n      1.1 \u786e\u4fdd\u6240\u6709node\u90fd\u5df2\u7ecfready\\n    2. \u5220\u9664\u81ea\u8eab\u90e8\u7f72\u7ec4\u4ef6\\n      2.1 \u5220\u9664 yurt-controller-manager deployment\u4ee5\u53ca\u76f8\u5173\u8d44\u6e90 \\n      2.2 \u5220\u9664yurt-tunnel-agent\u4ee5\u53ca\u76f8\u5173\u8d44\u6e90\\n      2.2 \u5220\u9664yurt-tunnel-server\u4ee5\u53ca\u76f8\u5173\u8d44\u6e90  \\n      2.3 \u5220\u9664yurt-app-manager\u4ee5\u53ca\u76f8\u5173\u8d44\u6e90\\n    3. k8s\u7ec4\u4ef6\u4fee\u6539\\n      3.1 \u5f00\u542fnodelifecontroller, \u8fd9\u4e2a\u5f88\u597d\u7406\u89e3\uff0c\u5c31\u662f\u628a\u4fee\u6539\u7684\u547d\u4ee4\u901a\u8fc7sed\u547d\u4ee4\u6539\u56de\u6765\u3002\\n    4. \u4e91\u7aef\u3001\u8fb9\u7f18\u8282\u70b9\u8f6c\u6362\u4e3a\u539f\u751f\u8282\u70b9\\n      4.1 \u4fee\u6539kubelet\u914d\u7f6e\uff0c\u76f4\u8fdeapiServer\\n      4.2 \u5220\u9664yurthub\u76f8\u5173\u914d\u7f6e\u3001\u76ee\u5f55\\n\\n\u6574\u4e2arevert\u7684\u8fc7\u7a0b\u5c31\u662fconvert\u7684\u53cd\u5411\u64cd\u4f5c\uff0c\u8fd8\u6bd4\u8f83\u597d\u7406\u89e3\u3002\\n\\n\u9700\u8981\u6ce8\u610f\u7684\u662f\u3002\u5982\u679cconvert\u5931\u8d25\uff0c\u6bd4\u5982job\u6267\u884c\u8d85\u65f6\u6216\u8005\u5931\u8d25\u3002job\u662f\u4e0d\u4f1a\u88ab\u5220\u9664\u7684\u3002\\n\\n\u5373\u4f7fyurtctl revert \u4e5f\u4e0d\u4f1a\u5220\u9664\u3002\u76ee\u7684\u662f\u4e3a\u4e86\u4fdd\u7559\u73b0\u573a\u65b9\u4fbf\u5b9a\u4f4d\u95ee\u9898\u3002\\n\\n\u5982\u679c\u9700\u8981\u91cd\u65b0\u6267\u884cyurtctl convert\uff0c \u9700\u8981\u624b\u52a8\u5220\u9664job\u3002\\n\\n```\\nkubectl get job -n kube-system -A |grep convert\\nkubectl delete job -n kube-system < job-name>\\n```\\n\\n\\n\\n\\n\\n## \u603b\u7ed3\\n\\nyurtctl convert/revert \u547d\u4ee4\u662f\u6700\u5feb\u6377\u4f53\u9a8copenYurt\u529f\u80fd\u7684\u65b9\u6cd5\u4e4b\u4e00\u3002\\n\\n\u5728\u4e86\u89e3\u4e86\u8fd9\u4e24\u4e2a\u547d\u4ee4\u7684\u5b9e\u73b0\u539f\u7406\uff0c\u4e5f\u5c31\u5bf9openYurt\u7684\u6280\u672f\u65b9\u6848\u4e86\u89e3\u5927\u534a\u4e86\u3002\\n\\n\u6267\u884c\u547d\u4ee4\u4e5f\u4e0d\u62c5\u5fc3\u4e86\uff0cso easy\uff01"},{"id":"How-to-use-service-topology","metadata":{"permalink":"/blog/How-to-use-service-topology","editUrl":"https://github.com/openyurtio/openyurt.io/tree/master/blog/blog/2021-11-24-How-to-use-service-topology.md","source":"@site/blog/2021-11-24-How-to-use-service-topology.md","title":"Use service topology to realize topology-aware traffic routing","description":"Service Topology enables a service to route traffic based on the Node topology of the cluster. For example, a service can specify that traffic be preferentially routed to endpoints that are on the same Node as the client, or in the same available NodePool.","date":"2021-11-24T00:00:00.000Z","formattedDate":"November 24, 2021","tags":[{"label":"openyurt","permalink":"/blog/tags/openyurt"}],"readingTime":5.41,"truncated":true,"authors":[{"name":"Feng Zeng","title":"Zhejiang University student, Member of OpenYurt","url":"https://github.com/windydayc","imageURL":"https://github.com/windydayc.png","key":"windydayc"}],"frontMatter":{"slug":"How-to-use-service-topology","title":"Use service topology to realize topology-aware traffic routing","authors":["windydayc"],"tags":["openyurt"]},"prevItem":{"title":"Seamless conversion between Kubernetes and OpenYurt","permalink":"/blog/How-to-use-yurtctl-convert-revert"},"nextItem":{"title":"How Openyurt runs the business pod in edge scenarios","permalink":"/blog/How-run-business-pod-in-edge-scenarios"}},"content":"*Service Topology* enables a service to route traffic based on the Node topology of the cluster. For example, a service can specify that traffic be preferentially routed to endpoints that are on the same Node as the client, or in the same available NodePool. \\n\\nThe following picture shows the general function of the *service topology*.\\n\\n![service-topology](../static/img/blog/service-topology-example.png)\\n\\nTo use *service topology*, the `EndpointSliceProxying` [feature gate](https://kubernetes.io/docs/reference/command-line-tools-reference/feature-gates/) must be enabled, and kube-proxy needs to be configured to connect to Yurthub instead of the API server.\\n\\nYou can set the `topologyKeys` values of a service to direct traffic as follows. If `topologyKeys` is not specified or empty, no topology constraints will be applied.\\n\\n|    **annotation Key**    |                  **annotation Value**                  |               **explain**               |\\n| :----------------------: | :----------------------------------------------------: | :-------------------------------------: |\\n| openyurt.io/topologyKeys |                 kubernetes.io/hostname                 |   Only to endpoints on the same node.   |\\n| openyurt.io/topologyKeys | kubernetes.io/zone<br /> or <br />openyurt.io/nodepool | Only to endpoints on the same nodepool. |\\n\\n\x3c!--truncate--\x3e\\n\\n## Prerequisites\\n\\n1. Kubernetes v1.18 or above, since EndpointSlice resource needs to be supported.\\n2. Yurt-app-manager is deployed in the cluster.\\n\\n## How to use\\n\\nEnsure that kubernetes version is v1.18+.\\n\\n```bash\\n$ kubectl get node\\nNAME                 STATUS   ROLES    AGE     VERSION\\nkind-control-plane   Ready    master   6m21s   v1.18.19\\nkind-worker          Ready    <none>   5m42s   v1.18.19\\nkind-worker2         Ready    <none>   5m42s   v1.18.19\\n```\\n\\nEnsure that yurt-app-manager is deployed in the cluster.\\n\\n```BASH\\n$ kubectl get pod -n kube-system \\nNAME                                         READY   STATUS    RESTARTS   AGE\\ncoredns-66bff467f8-jxvnw                     1/1     Running   0          7m28s\\ncoredns-66bff467f8-lk8v5                     1/1     Running   0          7m28s\\netcd-kind-control-plane                      1/1     Running   0          7m39s\\nkindnet-5dpxt                                1/1     Running   0          7m28s\\nkindnet-ckz88                                1/1     Running   0          7m10s\\nkindnet-sqxs7                                1/1     Running   0          7m10s\\nkube-apiserver-kind-control-plane            1/1     Running   0          7m39s\\nkube-controller-manager-kind-control-plane   1/1     Running   0          5m38s\\nkube-proxy-ddgjt                             1/1     Running   0          7m28s\\nkube-proxy-j25kr                             1/1     Running   0          7m10s\\nkube-proxy-jt9cw                             1/1     Running   0          7m10s\\nkube-scheduler-kind-control-plane            1/1     Running   0          7m39s\\nyurt-app-manager-699ffdcb78-8m9sf            1/1     Running   0          37s\\nyurt-app-manager-699ffdcb78-fdqmq            1/1     Running   0          37s\\nyurt-controller-manager-6c95788bf-jrqts      1/1     Running   0          6m17s\\nyurt-hub-kind-control-plane                  1/1     Running   0          3m36s\\nyurt-hub-kind-worker                         1/1     Running   0          4m50s\\nyurt-hub-kind-worker2                        1/1     Running   0          4m50s\\n```\\n\\n### Configure kube-proxy\\n\\nTo use *service topology*, the `EndpointSliceProxying` [feature gate](https://kubernetes.io/docs/reference/command-line-tools-reference/feature-gates/) must be enabled, and kube-proxy needs to be configured to connect to Yurthub instead of the API server.\\n\\n```bash\\n$ kubectl edit cm -n kube-system kube-proxy\\napiVersion: v1\\ndata:\\n  config.conf: |-\\n    apiVersion: kubeproxy.config.k8s.io/v1alpha1\\n    bindAddress: 0.0.0.0\\n    featureGates: # 1. enable EndpointSliceProxying feature gate.\\n      EndpointSliceProxying: true\\n    clientConnection:\\n      acceptContentTypes: \\"\\"\\n      burst: 0\\n      contentType: \\"\\"\\n      #kubeconfig: /var/lib/kube-proxy/kubeconfig.conf # 2. comment this line.\\n      qps: 0\\n    clusterCIDR: 10.244.0.0/16\\n    configSyncPeriod: 0s\\n```\\n\\nRestart kube-proxy.\\n\\n```bash\\n$ kubectl delete pod --selector k8s-app=kube-proxy -n kube-system\\npod \\"kube-proxy-cbsmj\\" deleted\\npod \\"kube-proxy-cqwcs\\" deleted\\npod \\"kube-proxy-m9dgk\\" deleted\\n```\\n\\n### Create NodePools\\n\\n- Create test nodepools.\\n\\n```bash\\n$ cat << EOF | kubectl apply -f -\\napiVersion: apps.openyurt.io/v1alpha1\\nkind: NodePool\\nmetadata:\\n  name: beijing\\nspec:\\n  type: Cloud\\n\\n---\\n\\napiVersion: apps.openyurt.io/v1alpha1\\nkind: NodePool\\nmetadata:\\n  name: hangzhou\\nspec:\\n  type: Edge\\n  annotations:\\n    apps.openyurt.io/example: test-hangzhou\\n  labels:\\n    apps.openyurt.io/example: test-hangzhou\\n\\n---\\n\\napiVersion: apps.openyurt.io/v1alpha1\\nkind: NodePool\\nmetadata:\\n  name: shanghai\\nspec:\\n  type: Edge\\n  annotations:\\n    apps.openyurt.io/example: test-shanghai\\n  labels:\\n    apps.openyurt.io/example: test-shanghai\\nEOF\\n```\\n\\n- Add nodes to the nodepool.\\n\\n```bash\\n$ kubectl label node kind-control-plane apps.openyurt.io/desired-nodepool=beijing\\nnode/kind-control-plane labeled\\n\\n$ kubectl label node kind-worker apps.openyurt.io/desired-nodepool=hangzhou\\nnode/kind-worker labeled\\n\\n$ kubectl label node kind-worker2 apps.openyurt.io/desired-nodepool=shanghai\\nnode/kind-worker2 labeled\\n```\\n\\n- Get NodePool.\\n\\n```bash\\n$ kubectl get np\\nNAME       TYPE    READYNODES   NOTREADYNODES   AGE\\nbeijing    Cloud   1            0               63s\\nhangzhou   Edge    1            0               63s\\nshanghai   Edge    1            0               63s\\n```\\n\\n### Create UnitedDeployment\\n\\n- Create test united-deployment1. To facilitate testing, we use a `serve_hostname` image. Each time port 9376 is accessed, the hostname container returns its own hostname.\\n\\n```bash\\n$ cat << EOF | kubectl apply -f -\\napiVersion: apps.openyurt.io/v1alpha1\\nkind: UnitedDeployment\\nmetadata:\\n  labels:\\n    controller-tools.k8s.io: \\"1.0\\"\\n  name: united-deployment1\\nspec:\\n  selector:\\n    matchLabels:\\n      app: united-deployment1\\n  workloadTemplate:\\n    deploymentTemplate:\\n      metadata:\\n        labels:\\n          app: united-deployment1\\n      spec:\\n        template:\\n          metadata:\\n            labels:\\n              app: united-deployment1\\n          spec:\\n            containers:\\n              - name: hostname\\n                image: mirrorgooglecontainers/serve_hostname\\n                ports:\\n                - containerPort: 9376\\n                  protocol: TCP\\n  topology:\\n    pools:\\n    - name: hangzhou\\n      nodeSelectorTerm:\\n        matchExpressions:\\n        - key: apps.openyurt.io/nodepool\\n          operator: In\\n          values:\\n          - hangzhou\\n      replicas: 2\\n    - name: shanghai\\n      nodeSelectorTerm:\\n        matchExpressions:\\n        - key: apps.openyurt.io/nodepool\\n          operator: In\\n          values:\\n          - shanghai\\n      replicas: 2\\n  revisionHistoryLimit: 5\\nEOF\\n```\\n\\n- Create test united-deployment2. Here we use `nginx` image, in order to access the `hostname` pod that created by united-deployment1 above.\\n\\n```bash\\n$ cat << EOF | kubectl apply -f -\\napiVersion: apps.openyurt.io/v1alpha1\\nkind: UnitedDeployment\\nmetadata:\\n  labels:\\n    controller-tools.k8s.io: \\"1.0\\"\\n  name: united-deployment2\\nspec:\\n  selector:\\n    matchLabels:\\n      app: united-deployment2\\n  workloadTemplate:\\n    deploymentTemplate:\\n      metadata:\\n        labels:\\n          app: united-deployment2\\n      spec:\\n        template:\\n          metadata:\\n            labels:\\n              app: united-deployment2\\n          spec:\\n            containers:\\n              - name: nginx\\n                image: nginx:1.19.3\\n                ports:\\n                - containerPort: 80\\n                  protocol: TCP\\n  topology:\\n    pools:\\n    - name: hangzhou\\n      nodeSelectorTerm:\\n        matchExpressions:\\n        - key: apps.openyurt.io/nodepool\\n          operator: In\\n          values:\\n          - hangzhou\\n      replicas: 2\\n    - name: shanghai\\n      nodeSelectorTerm:\\n        matchExpressions:\\n        - key: apps.openyurt.io/nodepool\\n          operator: In\\n          values:\\n          - shanghai\\n      replicas: 2\\n  revisionHistoryLimit: 5\\nEOF\\n```\\n\\n- Get pods that created by the unitedDeployment.\\n\\n```bash\\n$ kubectl get pod -l \\"app in (united-deployment1,united-deployment2)\\" -owide\\nNAME                                                 READY   STATUS    RESTARTS   AGE   IP           NODE           NOMINATED NODE   READINESS GATES\\nunited-deployment1-hangzhou-fv6th-66ff6fd958-f2694   1/1     Running   0          18m   10.244.2.3   kind-worker    <none>           <none>\\nunited-deployment1-hangzhou-fv6th-66ff6fd958-twf95   1/1     Running   0          18m   10.244.2.2   kind-worker    <none>           <none>\\nunited-deployment1-shanghai-5p8zk-84bdd476b6-hr6xt   1/1     Running   0          18m   10.244.1.3   kind-worker2   <none>           <none>\\nunited-deployment1-shanghai-5p8zk-84bdd476b6-wjck2   1/1     Running   0          18m   10.244.1.2   kind-worker2   <none>           <none>\\nunited-deployment2-hangzhou-lpkzg-6d958b67b6-gf847   1/1     Running   0          15m   10.244.2.4   kind-worker    <none>           <none>\\nunited-deployment2-hangzhou-lpkzg-6d958b67b6-lbnwl   1/1     Running   0          15m   10.244.2.5   kind-worker    <none>           <none>\\nunited-deployment2-shanghai-tqgd4-57f7555494-9jvjb   1/1     Running   0          15m   10.244.1.5   kind-worker2   <none>           <none>\\nunited-deployment2-shanghai-tqgd4-57f7555494-rn8n8   1/1     Running   0          15m   10.244.1.4   kind-worker2   <none>           <none>\\n```\\n\\n### Create Service with TopologyKeys\\n\\n```bash\\n$ cat << EOF | kubectl apply -f -\\napiVersion: v1\\nkind: Service\\nmetadata:\\n  name: svc-ud1\\n  annotations:\\n    openyurt.io/topologyKeys: openyurt.io/nodepool\\nspec:\\n  selector:\\n    app: united-deployment1\\n  type: ClusterIP\\n  ports:\\n  - port: 80\\n    targetPort: 9376\\nEOF\\n```\\n\\n### Create Service without TopologyKeys\\n\\n```bash\\n$ cat << EOF | kubectl apply -f -\\napiVersion: v1\\nkind: Service\\nmetadata:\\n  name: svc-ud1-without-topology\\nspec:\\n  selector:\\n    app: united-deployment1\\n  type: ClusterIP\\n  ports:\\n  - port: 80\\n    targetPort: 9376\\nEOF\\n```\\n\\n### Test Service Topology\\n\\nWe use the `nginx` pod in the shanghai nodepool to test *service topology*. Therefore, its traffic can only be routed to the nodes that in shanghai nodepool when it accesses a service with the `openyurt.io/topologyKeys: openyurt.io/nodepool` annotation.\\n\\nFor comparison, we first test the service without serviceTopology annotation. As we can see, its traffic can be routed to any nodes.\\n\\n```bash\\n$ kubectl exec -it united-deployment2-shanghai-tqgd4-57f7555494-9jvjb bash\\nroot@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/# curl svc-ud1-without-topology:80\\nunited-deployment1-hangzhou-fv6th-66ff6fd958-twf95\\nroot@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/# \\nroot@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/# curl svc-ud1-without-topology:80\\nunited-deployment1-shanghai-5p8zk-84bdd476b6-hr6xt\\nroot@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/# \\nroot@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/# curl svc-ud1-without-topology:80\\nunited-deployment1-hangzhou-fv6th-66ff6fd958-twf95\\nroot@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/# \\nroot@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/# curl svc-ud1-without-topology:80\\nunited-deployment1-hangzhou-fv6th-66ff6fd958-f2694\\n\\n```\\n\\nThen we test the service with serviceTopology annotation. As expected, its traffic can only be routed to the nodes in shanghai nodepool.\\n\\n```bash\\n$ kubectl exec -it united-deployment2-shanghai-tqgd4-57f7555494-9jvjb bash\\nroot@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/# curl svc-ud1:80\\nunited-deployment1-shanghai-5p8zk-84bdd476b6-wjck2\\nroot@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/# \\nroot@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/# curl svc-ud1:80\\nunited-deployment1-shanghai-5p8zk-84bdd476b6-hr6xt\\nroot@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/# \\nroot@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/# curl svc-ud1:80\\nunited-deployment1-shanghai-5p8zk-84bdd476b6-wjck2\\nroot@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/# \\nroot@united-deployment2-shanghai-tqgd4-57f7555494-9jvjb:/# curl svc-ud1:80\\nunited-deployment1-shanghai-5p8zk-84bdd476b6-hr6xt\\n```"},{"id":"How-run-business-pod-in-edge-scenarios","metadata":{"permalink":"/blog/How-run-business-pod-in-edge-scenarios","editUrl":"https://github.com/openyurtio/openyurt.io/tree/master/blog/blog/2021-10-15-How-run-business-pod-in-edge-scenarios.md","source":"@site/blog/2021-10-15-How-run-business-pod-in-edge-scenarios.md","title":"How Openyurt runs the business pod in edge scenarios","description":"1.\u80cc\u666f\u4ecb\u7ecd","date":"2021-10-15T00:00:00.000Z","formattedDate":"October 15, 2021","tags":[{"label":"openyurt","permalink":"/blog/tags/openyurt"}],"readingTime":6.49,"truncated":true,"authors":[{"name":"rambohe","title":"Maintainer of OpenYurt","url":"https://github.com/rambohe-ch","imageURL":"https://github.com/rambohe-ch.png","key":"rambohe-ch"}],"frontMatter":{"slug":"How-run-business-pod-in-edge-scenarios","title":"How Openyurt runs the business pod in edge scenarios","authors":["rambohe-ch"],"tags":["openyurt"]},"prevItem":{"title":"Use service topology to realize topology-aware traffic routing","permalink":"/blog/How-to-use-service-topology"},"nextItem":{"title":"Elegant realization of edge gateway caching capabilities","permalink":"/blog/Edge-gateway-caching-capabilities"}},"content":"### 1.\u80cc\u666f\u4ecb\u7ecd\\n\\nOpenYurt\u662f\u4e1a\u754c\u9996\u4e2a\u975e\u4fb5\u5165\u7684\u8fb9\u7f18\u8ba1\u7b97\u4e91\u539f\u751f\u5f00\u6e90\u9879\u76ee\uff0c\u901a\u8fc7\u8fb9\u7f18\u81ea\u6cbb\uff0c\u4e91\u8fb9\u534f\u540c\uff0c\u8fb9\u7f18\u5355\u5143\u5316\uff0c\u8fb9\u7f18\u6d41\u91cf\u95ed\u73af\u7b49\u80fd\u529b\u4e3a\u7528\u6237\u63d0\u4f9b\u4e91\u8fb9\u4e00\u4f53\u5316\u7684\u4f7f\u7528\u4f53\u9a8c\u3002\u4e0d\u5c11\u7528\u6237\u5728\u4f7f\u7528OpenYurt\u7684\u65f6\u5019\uff0c\u7ecf\u5e38\u9700\u8981\u628a\u5b58\u91cf\u7684\u4f7f\u7528InClusterConfig\u8bbf\u95eekube-apiserver\u7684Pod\u901a\u8fc7OpenYurt\u8fc1\u79fb\u5230\u8fb9\u7f18\u73af\u5883\u4e2d\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff1a\\n\\n![](../static/img/blog/InCluster1.png)\\n\\n\u5728OpenYurt\u96c6\u7fa4\u4e2d\uff0c\u63d0\u4f9b\u4e86\u4f7f\u7528InClusterConfig\u7684\u4e1a\u52a1Pod\u96f6\u4fee\u6539\u5c31\u53ef\u4ee5\u8fd0\u884c\u5728\u8fb9\u7f18\u73af\u5883\u7684\u80fd\u529b\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n### 2.\u9762\u4e34\u6311\u6218\\n\\n\u4f7f\u7528InClusterConfig\u7684\u4e1a\u52a1Pod\u5728\u8fb9\u7f18\u73af\u5883\u4e2d\u8fd0\u884c\uff0c\u9700\u8981\u89e3\u51b3\u5982\u4e0b\u95ee\u9898\uff1a\\n\\n- \u95ee\u9898\u4e00\uff1aPod\u901a\u8fc7InClusterConfig\u5730\u5740\u8bbf\u95eekube-apiserver\uff0c\u8282\u70b9\u4e0a\u9ed8\u8ba4\u7f51\u7edc\u89c4\u5219\uff08iptables/ipvs\uff09\u5c06\u4f1a\u628a\u8bf7\u6c42\u8f6c\u53d1\u5230kube-apiserver\u7684PodIP\uff0c\u540c\u65f6\u4e91\u7aef\u4e0e\u8fb9\u7f18\u4f4d\u4e8e\u4e0d\u540c\u7f51\u7edc\u5e73\u9762\uff0c\u8fb9\u7f18\u662f\u65e0\u6cd5\u8bbf\u95ee\u5230\u4e91\u7aef\u7684PodIP\u3002\u6240\u4ee5\u8fb9\u7f18\u4e1a\u52a1Pod\u65e0\u6cd5\u901a\u8fc7InClusterConfig\u8bbf\u95ee\u5230kube-apiserver\u3002\\n\\n  ![Incluster2](../static/img/blog/Incluster2.png)\\n\\n- \u95ee\u9898\u4e8c\uff1a\u5728\u89e3\u51b3\u95ee\u9898\u4e00\u540e\uff0c\u5982\u679c\u4e91\u8fb9\u7f51\u7edc\u65ad\u5f00\u65f6\u4e1a\u52a1Pod\u5bb9\u5668\u51fa\u73b0\u91cd\u542f\u7b49\u72b6\u51b5\uff0c\u8fb9\u7f18Pod\u5c06\u65e0\u6cd5\u4ecekube-apiserver\u83b7\u53d6\u5230\u4e1a\u52a1\u914d\u7f6e\uff0c\u8fd9\u4f1a\u5f71\u54cd\u5230\u4e1a\u52a1Pod\u7684\u91cd\u542f\u8fd0\u884c\u3002\\n\\n\\n\\n### 3.\u89e3\u51b3\u65b9\u6848\\n\\n\u4ece\u4e0a\u8ff0\u95ee\u9898\u53ef\u4ee5\u770b\u51fa\uff0c\u6211\u4eec\u9700\u8981\u65e0\u611f\u77e5\u7684\u8c03\u6574\u8fb9\u7f18pod\u7684\u8bbf\u95ee\u5730\u5740\uff0c\u540c\u65f6\u9700\u8981\u5728\u8fb9\u7f18\u73af\u5883\u4e2d\u7f13\u5b58\u4e1a\u52a1\u914d\u7f6e\uff0c\u4fdd\u8bc1\u4e91\u8fb9\u65ad\u7f51\u65f6\u4e5f\u53ef\u4ee5\u5229\u7528\u8fb9\u7f18\u7f13\u5b58\u4e1a\u52a1\u914d\u7f6e\uff0c\u4fdd\u8bc1\u4e91\u8fb9\u65ad\u7f51\u65f6\u4e5f\u53ef\u4ee5\u5229\u7528\u8fb9\u7f18\u7f13\u5b58\u6765\u83b7\u53d6\u4e1a\u52a1Pod\u7684\u914d\u7f6e\u4fe1\u606f\u3002\u5177\u4f53\u89e3\u51b3\u65b9\u6848\u5982\u4e0b\uff1b\\n\\n##### 3.1\u8fb9\u7f18Pod\u8bbf\u95ee\u7684\u4e91\u7aefendpoint\u4f18\u5316\\n\\n- Pod\u901a\u8fc7InClusterConfig\u8bbf\u95eekube-apiserver\uff0c\u6e90\u7801\u5982\u4e0b\uff1a\\n\\n  ```go\\n  func InClusterConfig() (*Config, error) {\\n  const (\\n      tokenFile  = \\"/var/run/secrets/kubernetes.io/serviceaccount/token\\"\\n      rootCAFile = \\"/var/run/secrets/kubernetes.io/serviceaccount/ca.crt\\"\\n  // \u901a\u8fc7Kuberentes service\u5bf9\u5e94\u7684\u73af\u5883\u53d8\u91cf\u6765\u83b7\u53d6\u8bbf\u95ee\u5730\u5740\\n  host, port := os.Getenv(\\"KUBERNETES_SERVICE_HOST\\"), os.Getenv(\\"KUBERNETES_SERVICE_PORT\\")\\n  if len(host) == 0 || len(port) == 0 {\\n      return nil, ErrNotInCluster\\n  }\\n  \\n  // skip some code...\\n  \\n  return &Config{\\n      Host:            \\"https://\\" + net.JoinHostPort(host, port),\\n      TLSClientConfig: tlsClientConfig,\\n      BearerToken:     string(token),\\n      BearerTokenFile: tokenFile,\\n  }, nil\\n  }\\n  ```\\n  \\n  \\n\\n- \u56e0\u6b64\u60f3\u65e0\u611f\u77e5\u8c03\u6574\u8fb9\u7f18Pod\u8bbf\u95ee\u7684\u4e91\u7aefendpoint\uff0c\u53ea\u9700\u8981\u65e0\u4fb5\u5165\u4fee\u6539Pod\u7684KUBERNETES_SERVICE_HOST\u548cKUBERNETE_SERVICE_PORT\u4e24\u4e2a\u73af\u5883\u53d8\u91cf\u6216\u8005\u4fee\u6539kubernetes service\u5730\u5740\u3002\u89e3\u51b3\u65b9\u6848\u5982\u4e0b\uff1a\\n\\n  - \u89e3\u51b3\u65b9\u6848\u4e00\uff1a\u589e\u52a0\u4e00\u4e2aadmission controller\u5728\u8fb9\u7f18Pod\u521b\u5efa\u65f6\u628akube-apiserver\u7684\u516c\u7f51\u5730\u5740\u81ea\u52a8\u6ce8\u5165\u5230Pod\u7684\u73af\u5883\u53d8\u91cfKUBERNETES_SERVICE_HOST\u548cKUBERNETE_SERVICE_PORT\\n\\n  - \u89e3\u51b3\u65b9\u6848\u4e8c\uff1a\u8fb9\u7f18\u6570\u636e\u8fc7\u6ee4\u6846\u67b6\u4e2d\u589e\u52a0\u4e00\u4e2afillter yurthub\u7684\u8fb9\u7f18\u6570\u636e\u8fc7\u6ee4\u6846\u67b6\u7c7b\u4f3c\u4e8eadmission controller ,\u4e13\u95e8\u7528\u4e8e\u8fb9\u7f18\u573a\u666f\u4e0b\u5728\u8fb9\u7f18\u5e94\u7528\u65e0\u611f\u77e5\u7684\u72b6\u6001\u4e0b\uff0c\u65e0\u4fb5\u5165\u7684\u4fee\u6539\u6216\u8005\u8fc7\u6ee4\u4e91\u7aef\u8fd4\u56de\u7684\u6570\u636e\u3002\u76ee\u524d\u652f\u6301\u7684\u8fc7\u6ee4\u5668\u6709\uff1aMasterservice\uff0cservicetopology\uff0cdiscardcloudservice\u7b49\\n\\n  - \u89e3\u51b3\u65b9\u6848\u5bf9\u6bd4\uff1a\\n\\n    |              |             \u89e3\u51b3\u65b9\u6848\u4e00              |            \u89e3\u51b3\u65b9\u6848\u4e8c            |\\n    | :----------: | :---------------------------------: | :------------------------------: |\\n    |   \u5b9e\u73b0\u65b9\u6848   |    \u589e\u52a0\u4e00\u4e2aadmission controller     | \u8fb9\u7f18\u6570\u636e\u8fc7\u6ee4\u6846\u67b6\u4e2d\u589e\u52a0\u4e00\u4e2afilter |\\n    |    \u590d\u6742\u5ea6    | \u9ad8\uff08\u9700\u8981\u533a\u522bPod\u8fd0\u884c\u5728\u8fb9\u7f18\u8fd8\u662f\u4e91\u7aef\uff09 |                \u4f4e                |\\n    | \u663e\u793a\u4fee\u6539\u6570\u636e |        Pod\u4e2d\u589e\u52a0\u73af\u5883\u53d8\u91cf\u914d\u7f6e        |                \u65e0                |\\n\\n\u7efc\u5408\u5b9e\u73b0\u590d\u6742\u5ea6\uff0c\u975e\u4fb5\u5165\u7b49\u8bbe\u8ba1\u7406\u5ff5\uff0c\u5728OpenYurt\u4e2d\u6211\u4eec\u9009\u62e9\u4e86\u89e3\u51b3\u65b9\u6848\u4e8c\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff1a\\n\\n![](../static/img/blog/InCluster3.png)\\n\\n##### 3.2\u4e1a\u52a1Pod\u7684\u8fb9\u7f18\u81ea\u6cbb\\n\\n\u5728\u4e91\u8fb9\u7f51\u7edc\u65ad\u5f00\u72b6\u6001\u4e0b\uff0c\u4e1a\u52a1Pod\u91cd\u542f\u65f6\uff0c\u5c06\u65e0\u6cd5\u4ece\u4e91\u7aefkube-apiserver\u83b7\u53d6\u5230\u4e1a\u52a1\u914d\u7f6e\u4fe1\u606f\uff0c\u56e0\u6b64\u9700\u8981\u5728\u8fb9\u7f18\u672c\u5730\u7f13\u5b58Pod\u7684\u4e1a\u52a1\u6570\u636e\u3002\\n\\n![](../static/img/blog/InCluster4.png)\\n\\n\u8bf4\u660e1\uff1a\u4e1a\u52a1Pod\u901a\u8fc7yurthub\u8bbf\u95eekube-apiserver\uff0c\u4e5f\u610f\u5473\u7740[3.1 \u8fb9\u7f18Pod\u8bbf\u95ee\u7684\u4e91\u7aefendpoint\u4f18\u5316]\u7ae0\u8282\u4e2d\u63d0\u5230\u7684KUBERNETES_SERVICE_HOST\u548cKUBERNETE_SERVICE_PORT\u73af\u5883\u53d8\u91cf\u88ab\u4fee\u6539\u4e3ayurthub https endpoint(169.254.2.1:10268)\u3002\\n\\n\u8bf4\u660e2\uff1a\u5982\u679c\u4e1a\u52a1Pod\u7684\u5927\u91cflist/watch\u64cd\u4f5c\u5bfc\u81f4\u5927\u91cf\u672c\u5730cache\uff0c\u53ef\u80fd\u4f1a\u9020\u6210\u672c\u5730\u78c1\u76d8\u538b\u529b\uff0c\u56e0\u6b64yurthub\u5bf9\u4e1a\u52a1Pod\u7684\u7f13\u5b58\u80fd\u529b\u9ed8\u8ba4\u662f\u5173\u95ed\u7684\uff0c\u7528\u6237\u53ef\u4ee5\u901a\u8fc7yurt-hub-cfg configmap\u7684cache_agents\u5b57\u6bb5\u4e2d\u589e\u52a0User-Agent\u4fe1\u606f\u6765\u6253\u5f00\u5bf9\u5e94Pod\u7684\u6570\u636e\u7f13\u5b58\u3002\u4f8b\u5982\uff1a\\n\\n```go\\napiVersion: v1\\nkind: ConfigMap\\nmetadata:\\n  name: yurt-hub-cfg\\n  namespace: kube-system\\ndata:\\n  # \u7f13\u5b58\u8fb9\u7f18ingress-controller pod\u8bbf\u95eekube-apiserver\u7684\u6570\u636e\\n  cache_agents: \\"ingress-controller\\"\\n```\\n\\n\\n\\n### 4.\u603b\u7ed3\\n\\n- \u5982\u679c\u5b58\u91cfPod\u65e0\u9700\u8bbf\u95eekube-apiserver\u6216\u8005InClusterConfig\u8bbf\u95eekube-apiserver\uff0c\u8fd9\u4e9b\u7c7b\u578bPod\u53ef\u4ee5\u96f6\u4fee\u6539\u8fd0\u884c\u5230OpenYurt\u96c6\u7fa4\u7684\u8fb9\u7f18\u73af\u5883\u4e0a\u3002\u901a\u8fc7\u5176\u4ed6\u65b9\u5f0f\u8bbf\u95eekube-apiserver\u7684\u4e1a\u52a1Pod\u76ee\u524d\u65e0\u6cd5\u4fdd\u8bc1\u96f6\u4fee\u6539\u8fd0\u884c\u5230\u8fb9\u7f18\u73af\u5883\u3002\\n\\n- \u8fb9\u7f18\u4e1a\u52a1Pod\u662f\u5426\u6b63\u5e38\u8bbf\u95eekube-apiserver\uff0c\u9996\u5148\u53ef\u4ee5\u67e5\u770b\u4e1a\u52a1pod\u7684\u73af\u5883\u53d8\u91cf\u662f\u5426\u6b63\u5e38\uff1a\\n\\n  KUBERNETES_SERVICE_HOST=127.0.0.1\u6216\u8005169.254.2.1\uff0cKUBERNETES_SERVICE_PORT=10268\u3002\u7136\u540e\u53ef\u4ee5\u67e5\u770byurthub\u7ec4\u4ef6\u7684\u65e5\u5fd7\u662f\u5426\u6709\u4e1a\u52a1Pod\u76f8\u5173\u7684\u8bf7\u6c42\u65e5\u5fd7\u3002\u5f53\u7136\u4e5f\u53ef\u4ee5\u67e5\u8be2\u4e1a\u52a1Pod\u7684\u65e5\u5fd7\u662f\u5426\u6b63\u5e38\u3002\u6700\u540e\u53ef\u4ee5\u786e\u8ba4/etc/kubernetes/cache\u76ee\u5f55\u662f\u5426\u6709\u76f8\u5173\u7ec4\u4ef6\u7684\u7f13\u5b58\u6570\u636e\uff0c\u5982\u679c\u6ca1\u6709\u53ef\u4ee5\u518d\u786e\u8ba4kube-system/yurt-hub-cfg configmap\u662f\u5426\u5df2\u7ecf\u914d\u7f6e\u3002\\n\\n- \u4f7f\u7528InClusterConfig\u7684Pod\u96f6\u4fee\u6539\u8fd0\u884c\u5230\u8fb9\u7f18\u73af\u5883\u7684\u80fd\u529b\uff0c\u6574\u4f53\u5b9e\u73b0\u7531yurthub\u7ec4\u4ef6\u627f\u8f7d\uff0c\u6ca1\u6709\u7ed9OpenYurt\u67b6\u6784\u589e\u52a0\u989d\u5916\u7684\u8d1f\u62c5\uff0c\u540c\u65f6\u7528\u6237\u5728\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u5bf9\u8be5\u80fd\u529b\u4e5f\u57fa\u672c\u65e0\u611f\u77e5\uff0c\u5bf9\u539f\u751f\u4e1a\u52a1Pod\u65e0\u4fb5\u5165\u3002\\n\\n\\n\\n\\n\\n### \u53c2\u8003\u94fe\u63a5\uff1a\\n\\n1.[Accessing the API from a Pod](https://kubernetes.io/docs/tasks/access-application-cluster/access-cluster/#accessing-the-api-from-a-pod)\\n\\n2.[data filtering framework on the edge](https://github.com/openyurtio/openyurt/blob/master/docs/proposals/20210720-data-filtering-framework.md)\\n\\n3.[\u6df1\u5ea6\u89e3\u8bfbOpenYurt\uff1a\u8fb9\u7f18\u81ea\u6cbb\u80fd\u529b\u8bbe\u8ba1\u89e3\u6790](https://mp.weixin.qq.com/s/4BLfvMJJA623ZwRSgUE69A)"},{"id":"Edge-gateway-caching-capabilities","metadata":{"permalink":"/blog/Edge-gateway-caching-capabilities","editUrl":"https://github.com/openyurtio/openyurt.io/tree/master/blog/blog/2021-03-29-Edge-gateway-caching-capabilities.md","source":"@site/blog/2021-03-29-Edge-gateway-caching-capabilities.md","title":"Elegant realization of edge gateway caching capabilities","description":"image","date":"2021-03-29T00:00:00.000Z","formattedDate":"March 29, 2021","tags":[{"label":"yurthub","permalink":"/blog/tags/yurthub"}],"readingTime":6.935,"truncated":true,"authors":[{"name":"rambohe","title":"Maintainer of OpenYurt","url":"https://github.com/rambohe-ch","imageURL":"https://github.com/rambohe-ch.png","key":"rambohe-ch"}],"frontMatter":{"slug":"Edge-gateway-caching-capabilities","title":"Elegant realization of edge gateway caching capabilities","authors":["rambohe-ch"],"tags":["yurthub"]},"prevItem":{"title":"How Openyurt runs the business pod in edge scenarios","permalink":"/blog/How-run-business-pod-in-edge-scenarios"},"nextItem":{"title":"Getting Started with OpenYurt:play with OpenYurt on Raspberry Pi","permalink":"/blog/Play-with-OpenYurt-on-Raspberry-Pi"}},"content":"![image](../static/img/blog/OpenYurt.png)\\n\\n\\n## OpenYurt\u5982\u4f55\u89e3\u51b3\u8fb9\u7f18\u81ea\u6cbb\u95ee\u9898\\n\\n\u60f3\u8981\u5b9e\u73b0\u5c06 Kubernetes \u7cfb\u7edf\u5ef6\u5c55\u5230\u8fb9\u7f18\u8ba1\u7b97\u573a\u666f\uff0c\u90a3\u4e48\u8fb9\u7f18\u8282\u70b9\u5c06\u901a\u8fc7\u516c\u7f51\u548c\u4e91\u7aef\u8fde\u63a5\uff0c\u7f51\u7edc\u8fde\u63a5\u6709\u5f88\u5927\u4e0d\u53ef\u63a7\u56e0\u7d20\uff0c\u53ef\u80fd\u5e26\u6765\u8fb9\u7f18\u4e1a\u52a1\u8fd0\u884c\u7684\u4e0d\u7a33\u5b9a\u56e0\u7d20\uff0c\u8fd9\u662f\u4e91\u539f\u751f\u548c\u8fb9\u7f18\u8ba1\u7b97\u878d\u5408\u7684\u4e3b\u8981\u96be\u70b9\u4e4b\u4e00\u3002\\n\\n\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u9700\u8981\u4f7f\u8fb9\u7f18\u4fa7\u5177\u6709\u81ea\u6cbb\u80fd\u529b\uff0c\u5373\u5f53\u4e91\u8fb9\u7f51\u7edc\u65ad\u5f00\u6216\u8005\u8fde\u63a5\u4e0d\u7a33\u5b9a\u65f6\uff0c\u786e\u4fdd\u8fb9\u7f18\u4e1a\u52a1\u53ef\u4ee5\u6301\u7eed\u8fd0\u884c\u3002\u5728 OpenYurt \u4e2d\uff0c\u8be5\u80fd\u529b\u7531 yurt-controller-manager \u548c YurtHub \u7ec4\u4ef6\u63d0\u4f9b\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n### 1\uff09Yurthub\u67b6\u6784\\n\u5728\u4e4b\u524d\u7684\u6587\u7ae0\u4e2d\uff0c\u6211\u4eec\u8be6\u7ec6\u4ecb\u7ecd\u4e86YurtHub \u7ec4\u4ef6\u7684\u80fd\u529b\u3002\u5176\u67b6\u6784\u56fe\u5982\u4e0b\uff1a\\n\\n![image](../static/img/blog/yurthub.png)\\nYurtHub\u662f\u4e00\u4e2a\u5e26\u6709\u6570\u636e\u7f13\u5b58\u529f\u80fd\u7684\u201c\u900f\u660e\u7f51\u5173\u201d\uff0c\u548c\u4e91\u7aef\u7f51\u7edc\u65ad\u8fde\u72b6\u6001\u4e0b\uff0c\u5982\u679c\u8282\u70b9\u6216\u8005\u7ec4\u4ef6\u91cd\u542f\uff0c\u5404\u4e2a\u7ec4\u4ef6\uff08kubelet/kube-proxy \u7b49)\u5c06\u4ece YurtHub \u4e2d\u83b7\u53d6\u5230\u4e1a\u52a1\u5bb9\u5668\u76f8\u5173\u6570\u636e\uff0c\u6709\u6548\u89e3\u51b3\u8fb9\u7f18\u81ea\u6cbb\u7684\u95ee\u9898\u3002\u8fd9\u4e5f\u610f\u5473\u7740\u6211\u4eec\u9700\u8981\u5b9e\u73b0\u4e00\u4e2a\u8f7b\u91cf\u7684\u5e26\u6570\u636e\u7f13\u5b58\u80fd\u529b\u7684\u53cd\u5411\u4ee3\u7406\u3002\\n\\n\\n\\n### 2\uff09\u7b2c\u4e00\u60f3\u6cd5\\n\u5b9e\u73b0\u4e00\u4e2a\u7f13\u5b58\u6570\u636e\u7684\u53cd\u5411\u4ee3\u7406\uff0c\u7b2c\u4e00\u60f3\u6cd5\u5c31\u662f\u4ece response.Body \u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u7136\u540e\u5206\u522b\u8fd4\u56de\u7ed9\u8bf7\u6c42 client \u548c\u672c\u5730\u7684 Cache \u6a21\u5757\u3002\u4f2a\u4ee3\u7801\u5982\u4e0b:\\n```\\nfunc HandleResponse(rw http.ResponseWriter, resp *http.Response) {\\n        bodyBytes, _ := ioutil.ReadAll(resp.Body)\\n        go func() {\\n                // cache response on local disk\\n                cacher.Write(bodyBytes)\\n        }\\n\\n        // client reads data from response\\n        rw.Write(bodyBytes)\\n}\\n```\\n\\n\u5f53\u6df1\u5165\u601d\u8003\u540e\uff0c\u5728 Kubernetes \u7cfb\u7edf\u4e2d\uff0c\u4e0a\u8ff0\u5b9e\u73b0\u4f1a\u5f15\u53d1\u4e0b\u9762\u7684\u95ee\u9898\uff1a\\n\\n- \u95ee\u9898 1\uff1a\u6d41\u5f0f\u6570\u636e\u9700\u8981\u5982\u4f55\u5904\u7406(\u5982: K8s \u4e2d\u7684 watch \u8bf7\u6c42)\uff0c\u610f\u5473 ioutil.ReadAll() \u4e00\u6b21\u8c03\u7528\u65e0\u6cd5\u8fd4\u56de\u6240\u6709\u6570\u636e\u3002\u5373\u5982\u4f55\u53ef\u4ee5\u8fd4\u56de\u6d41\u6570\u636e\u540c\u65f6\u53c8\u7f13\u5b58\u6d41\u6570\u636e\u3002\\n\\n- \u95ee\u9898 2\uff1a\u540c\u65f6\u5728\u672c\u5730\u7f13\u5b58\u6570\u636e\u524d\uff0c\u6709\u53ef\u80fd\u9700\u8981\u5bf9\u4f20\u5165\u7684 byte slice \u6570\u636e\u5148\u8fdb\u884c\u6e05\u6d17\u5904\u7406\u3002\u8fd9\u610f\u5473\u7740\u9700\u8981\u4fee\u6539 byte slice\uff0c\u6216\u8005\u5148\u5907\u4efd byte slice \u518d\u5904\u7406\u3002\u8fd9\u6837\u4f1a\u9020\u6210\u5185\u5b58\u7684\u5927\u91cf\u6d88\u8017\uff0c\u540c\u65f6\u9488\u5bf9\u6d41\u5f0f\u6570\u636e\uff0c\u5230\u5e95\u7533\u8bf7\u591a\u5927\u7684 slice \u4e5f\u4e0d\u597d\u5904\u7406\u3002\\n\\n\\n### 3) \u4f18\u96c5\u5b9e\u73b0\u63a2\u8ba8\\n\\n\\n\u9488\u5bf9\u4e0a\u9762\u7684\u95ee\u9898\uff0c\u6211\u4eec\u5c06\u95ee\u9898\u9010\u4e2a\u62bd\u8c61\uff0c\u53ef\u4ee5\u53d1\u73b0\u66f4\u4f18\u96c5\u7684\u5b9e\u73b0\u65b9\u6cd5\u3002\\n\\n- \u95ee\u9898 1\uff1a\u5982\u4f55\u5bf9\u6d41\u6570\u636e\u540c\u65f6\u8fdb\u884c\u8bfb\u5199\\n\\n\u9488\u5bf9\u6d41\u5f0f\u6570\u636e\u7684\u8bfb\u5199(\u4e00\u8fb9\u8fd4\u56de\u4e00\u8fb9\u7f13\u5b58)\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u5176\u5b9e\u9700\u8981\u7684\u4e0d\u8fc7\u662f\u628a response.Body(io.Reader) \u8f6c\u6362\u6210\u4e00\u4e2a io.Reader \u548c\u4e00\u4e2a io.Writer\u3002\u6216\u8005\u8bf4\u662f\u4e00\u4e2a io.Reader \u548c io.Writer \u5408\u6210\u4e00\u4e2a io.Reader\u3002\u8fd9\u5f88\u5bb9\u6613\u5c31\u8054\u60f3\u5230 Linux \u91cc\u9762\u7684 Tee \u547d\u4ee4\u3002\\n\\n![image](../static/img/blog/responsebody_write.png)\\n\\n\\n\u800c\u5728 Golang \u4e2d Tee \u547d\u4ee4\u662f\u5b9e\u73b0\u5c31\u662f io.TeeReader\uff0c\u90a3\u95ee\u9898 1 \u7684\u4f2a\u4ee3\u7801\u5982\u4e0b:\\n``` \\nfunc HandleResponse(rw http.ResponseWriter, resp *http.Response) {\\n        // create TeeReader with response.Body and cacher\\n        newRespBody := io.TeeReader(resp.Body, cacher)\\n\\n        // client reads data from response\\n        io.Copy(rw, newRespBody)\\n}\\n```\\n\\n\u901a\u8fc7 TeeReader \u7684\u5bf9 Response.Body \u548c Cacher \u7684\u6574\u5408\uff0c\u5f53\u8bf7\u6c42 client \u7aef\u4ece response.Body \u4e2d\u8bfb\u53d6\u6570\u636e\u65f6\uff0c\u5c06\u540c\u65f6\u5411 Cache \u4e2d\u5199\u5165\u8fd4\u56de\u6570\u636e\uff0c\u4f18\u96c5\u7684\u89e3\u51b3\u4e86\u6d41\u5f0f\u6570\u636e\u7684\u5904\u7406\u3002\\n\\n- \u95ee\u9898 2\uff1a\u5982\u4f55\u5728\u7f13\u5b58\u524d\u5148\u6e05\u6d17\u6d41\u6570\u636e\\n\\n\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u7f13\u5b58\u524d\u5148\u6e05\u6d17\u6d41\u6570\u636e\uff0c\u8bf7\u6c42\u7aef\u548c\u8fc7\u6ee4\u7aef\u9700\u8981\u540c\u65f6\u8bfb\u53d6 response.Body\uff082 \u6b21\u8bfb\u53d6\u95ee\u9898\uff09\u3002\u4e5f\u5c31\u662f\u9700\u8981\u5c06 response.Body(io.Reader) \u8f6c\u6362\u6210\u4e24\u4e2a io.Reader\u3002\\n\\n![image](../static/img/blog/responseread.png)\\n\\n\\n\\n\u4e5f\u610f\u5473\u7740\u95ee\u9898 2 \u8f6c\u5316\u6210\uff1a\u95ee\u9898 1 \u4e2d\u7f13\u5b58\u7aef\u7684 io.Writer \u8f6c\u6362\u6210 Data Filter \u7684 io.Reader\u3002\u5176\u5b9e\u5728 Linux \u547d\u4ee4\u4e2d\u4e5f\u80fd\u627e\u5230\u7c7b\u4f3c\u547d\u4ee4\uff0c\u5c31\u662f\u7ba1\u9053\u3002\u56e0\u6b64\u95ee\u9898 2 \u7684\u4f2a\u4ee3\u7801\u5982\u4e0b\uff1a\\n``` \\nfunc HandleResponse(rw http.ResponseWriter, resp *http.Response) {\\n        pr, pw := io.Pipe()\\n        // create TeeReader with response.Body and Pipe writer\\n        newRespBody := io.TeeReader(resp.Body, pw)\\n        go func() {\\n                // filter reads data from response \\n                io.Copy(dataFilter, pr)\\n        }\\n\\n        // client reads data from response\\n        io.Copy(rw, newRespBody)\\n}\\n```\\n\u901a\u8fc7 io.TeeReader \u548c io.PiPe\uff0c\u5f53\u8bf7\u6c42 client \u7aef\u4ece response.Body \u4e2d\u8bfb\u53d6\u6570\u636e\u65f6\uff0cFilter \u5c06\u540c\u65f6\u4ece Response \u8bfb\u53d6\u5230\u6570\u636e\uff0c\u4f18\u96c5\u7684\u89e3\u51b3\u4e86\u6d41\u5f0f\u6570\u636e\u7684 2 \u6b21\u8bfb\u53d6\u95ee\u9898\u3002\\n\\n## YurtHub\u5b9e\u73b0\\n\u6700\u540e\u770b\u4e00\u4e0b YurtHub \u4e2d\u76f8\u5173\u5b9e\u73b0\uff0c\u7531\u4e8e Response.Body \u4e3a io.ReadCloser\uff0c\u6240\u4ee5\u5b9e\u73b0\u4e86 dualReadCloser\u3002\u540c\u65f6 YurtHub \u53ef\u80fd\u4e5f\u9762\u4e34\u5bf9 http.Request \u7684\u7f13\u5b58\uff0c\u6240\u4ee5\u589e\u52a0\u4e86 isRespBody \u53c2\u6570\u7528\u4e8e\u5224\u5b9a\u662f\u5426\u9700\u8981\u8d1f\u8d23\u5173\u95ed response.Body\u3002\\n``` \\n// https://github.com/openyurtio/openyurt/blob/master/pkg/yurthub/util/util.go#L156\\n// NewDualReadCloser create an dualReadCloser object\\nfunc NewDualReadCloser(rc io.ReadCloser, isRespBody bool) (io.ReadCloser, io.ReadCloser) {\\n    pr, pw := io.Pipe()\\n    dr := &dualReadCloser{\\n        rc:         rc,\\n        pw:         pw,\\n        isRespBody: isRespBody,\\n    }\\n\\n    return dr, pr\\n}\\n\\ntype dualReadCloser struct {\\n    rc io.ReadCloser\\n    pw *io.PipeWriter\\n    // isRespBody shows rc(is.ReadCloser) is a response.Body\\n    // or not(maybe a request.Body). if it is true(it\'s a response.Body),\\n    // we should close the response body in Close func, else not,\\n    // it(request body) will be closed by http request caller\\n    isRespBody bool\\n}\\n\\n// Read read data into p and write into pipe\\nfunc (dr *dualReadCloser) Read(p []byte) (n int, err error) {\\n    n, err = dr.rc.Read(p)\\n    if n > 0 {\\n        if n, err := dr.pw.Write(p[:n]); err != nil {\\n            klog.Errorf(\\"dualReader: failed to write %v\\", err)\\n            return n, err\\n        }\\n    }\\n\\n    return\\n}\\n\\n// Close close two readers\\nfunc (dr *dualReadCloser) Close() error {\\n    errs := make([]error, 0)\\n    if dr.isRespBody {\\n        if err := dr.rc.Close(); err != nil {\\n            errs = append(errs, err)\\n        }\\n    }\\n\\n    if err := dr.pw.Close(); err != nil {\\n        errs = append(errs, err)\\n    }\\n\\n    if len(errs) != 0 {\\n        return fmt.Errorf(\\"failed to close dualReader, %v\\", errs)\\n    }\\n\\n    return nil\\n}\\n```\\n\\n\u5728\u4f7f\u7528 dualReadCloser \u65f6\uff0c\u53ef\u4ee5\u5728 httputil.NewSingleHostReverseProxy \u7684 modifyResponse() \u65b9\u6cd5\u4e2d\u770b\u5230\u3002\u4ee3\u7801\u5982\u4e0b\uff1a\\n``` \\n// https://github.com/openyurtio/openyurt/blob/master/pkg/yurthub/proxy/remote/remote.go#L85\\nfunc (rp *RemoteProxy) modifyResponse(resp *http.Response) error {rambohe-ch, 10 months ago: \u2022 hello openyurt\\n            // \u7701\u7565\u90e8\u5206\u524d\u7f6e\u68c0\u67e5                                                          \\n            rc, prc := util.NewDualReadCloser(resp.Body, true)\\n            go func(ctx context.Context, prc io.ReadCloser, stopCh <-chan struct{}) {\\n                err := rp.cacheMgr.CacheResponse(ctx, prc, stopCh)\\n                if err != nil && err != io.EOF && err != context.Canceled {\\n                    klog.Errorf(\\"%s response cache ended with error, %v\\", util.ReqString(req), err)\\n                }\\n            }(ctx, prc, rp.stopCh)\\n\\n            resp.Body = rc\\n}\\n```\\n\\n## \u603b\u7ed3\\nOpenYurt \u4e8e 2020 \u5e74 9 \u6708\u8fdb\u5165 CNCF \u6c99\u7bb1\u540e\uff0c\u6301\u7eed\u4fdd\u6301\u4e86\u5feb\u901f\u53d1\u5c55\u548c\u8fed\u4ee3\uff0c\u5728\u793e\u533a\u540c\u5b66\u4e00\u8d77\u52aa\u529b\u4e0b\uff0c\u76ee\u524d\u5df2\u7ecf\u5f00\u6e90\u7684\u80fd\u529b\u6709\uff1a\\n\\n- \u8fb9\u7f18\u81ea\u6cbb\\n- \u8fb9\u7f18\u5355\u5143\u5316\u7ba1\u7406\\n- \u4e91\u8fb9\u534f\u540c\u8fd0\u7ef4\\n- \u4e00\u952e\u5f0f\u65e0\u7f1d\u8f6c\u6362\u80fd\u529b\\n\\n[\u539f\u6587\u94fe\u63a5](https://mp.weixin.qq.com/s/vdFrCDiIhPLVbOnf6vRxEw)"},{"id":"Play-with-OpenYurt-on-Raspberry-Pi","metadata":{"permalink":"/blog/Play-with-OpenYurt-on-Raspberry-Pi","editUrl":"https://github.com/openyurtio/openyurt.io/tree/master/blog/blog/2021-01-05-Play-with-OpenYurt-on-Raspberry-Pi.md","source":"@site/blog/2021-01-05-Play-with-OpenYurt-on-Raspberry-Pi.md","title":"Getting Started with OpenYurt:play with OpenYurt on Raspberry Pi","description":"image","date":"2021-01-05T00:00:00.000Z","formattedDate":"January 5, 2021","tags":[{"label":"openyurt","permalink":"/blog/tags/openyurt"}],"readingTime":17.82,"truncated":true,"authors":[{"name":"zyjhtangtang","title":"Member of OpenYurt","url":"https://github.com/zyjhtangtang","imageURL":"https://github.com/zyjhtangtang.png","key":"zyjhtangtang"}],"frontMatter":{"slug":"Play-with-OpenYurt-on-Raspberry-Pi","title":"Getting Started with OpenYurt:play with OpenYurt on Raspberry Pi","authors":["zyjhtangtang"],"tags":["openyurt"]},"prevItem":{"title":"Elegant realization of edge gateway caching capabilities","permalink":"/blog/Edge-gateway-caching-capabilities"},"nextItem":{"title":"How to build Kubernetes Native Cloud side efficient collaborative network","permalink":"/blog/Build-side-efficient-collaborative-network"}},"content":"![image](../static/img/blog/Raspberry_Pi.png)\\n\\n\\n\u968f\u7740\u8fb9\u7f18\u8ba1\u7b97\u7684\u5feb\u901f\u53d1\u5c55\uff0c\u8d8a\u6765\u8d8a\u591a\u7684\u6570\u636e\u9700\u8981\u5230\u7f51\u7edc\u7684\u8fb9\u7f18\u4fa7\u8fdb\u884c\u5b58\u50a8\u3001\u5904\u7406\u548c\u5206\u6790\uff0c\u8fb9\u7f18\u7684\u8bbe\u5907\u548c\u5e94\u7528\u5448\u7206\u53d1\u5f0f\u589e\u957f\u3002\u5982\u4f55\u9ad8\u6548\u7684\u7ba1\u7406\u8fb9\u7f18\u4fa7\u7684\u8d44\u6e90\u548c\u5e94\u7528\u662f\u4e1a\u754c\u9762\u4e34\u7684\u4e00\u4e2a\u4e3b\u8981\u95ee\u9898\u3002\u5f53\u524d\uff0c\u91c7\u7528\u4e91\u539f\u751f\u7684\u65b9\u6cd5\uff0c\u5c06\u4e91\u8ba1\u7b97\u7684\u80fd\u529b\u4e0b\u6c89\u5230\u8fb9\u7f18\u5e76\u5728\u4e91\u7aef\u505a\u7edf\u4e00\u8c03\u5ea6\u3001\u7ba1\u63a7\u7684\u4e91\u8fb9\u7aef\u4e00\u4f53\u5316\u67b6\u6784\u5f97\u5230\u4e86\u4e1a\u754c\u7684\u5e7f\u6cdb\u8ba4\u53ef\u3002\\n\\n\\n\\n2020 \u5e74 5 \u6708\uff0c\u963f\u91cc\u5df4\u5df4\u5f00\u6e90\u9996\u4e2a Kubernetes \u65e0\u4fb5\u5165\u7684\u8fb9\u7f18\u8ba1\u7b97\u4e91\u539f\u751f\u9879\u76ee OpenYurt\uff0c\u5e76\u4e8e\u540c\u5e74 9 \u6708\u4efd\u8fdb\u5165 CNCF SandBox\u3002OpenYurt \u9488\u5bf9\u8fb9\u7f18\u573a\u666f\u4e2d\u7f51\u7edc\u4e0d\u7a33\u5b9a\u3001\u4e91\u8fb9\u8fd0\u7ef4\u56f0\u96be\u7b49\u95ee\u9898\uff0c\u5bf9\u539f\u751f Kubernetes \u65e0\u4fb5\u5165\u5730\u589e\u5f3a\uff0c\u91cd\u70b9\u63d0\u4f9b\u4e86\u8fb9\u7f18\u8282\u70b9\u81ea\u6cbb\u3001\u4e91\u8fb9\u8fd0\u7ef4\u901a\u9053\u3001\u8fb9\u7f18\u5355\u5143\u5316\u7684\u80fd\u529b\u3002\\n\\n\\n\u5982\u56fe\u4e0b\u6240\u793a\uff0c\\n![image](../static/img/blog/kubernetes.png)\\n\\n\\n\\n\\n\u672c\u6587\u901a\u8fc7\u5728\u4e91\u7aef\u90e8\u7f72 Kubernetes \u96c6\u7fa4\u7684\u63a7\u5236\u9762\uff0c\u5e76\u5c06\u6811\u8393\u6d3e\u63a5\u5165\u96c6\u7fa4\u6765\u642d\u5efa\u4e91\u7ba1\u8fb9\u573a\u666f\u3002\u57fa\u4e8e\u8fd9\u4e2a\u73af\u5883\u6f14\u793a OpenYurt \u7684\u6838\u5fc3\u80fd\u529b\uff0c\u5e26\u5927\u5bb6\u5feb\u901f\u4e0a\u624b OpenYurt\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u73af\u5883\u51c6\u5907\\n\\n### 1\uff09\u57fa\u7840\u73af\u5883\u4ecb\u7ecd\\n\\n\u5728\u4e91\u7aef\uff0c\u8d2d\u4e70 ENS \u8282\u70b9\uff08ENS \u8282\u70b9\u5177\u6709\u516c\u7f51 IP\uff0c\u65b9\u4fbf\u901a\u8fc7\u516c\u7f51\u5bf9\u5916\u66b4\u9732\u670d\u52a1\uff09\u6765\u90e8\u7f72\u539f\u751f K8s \u96c6\u7fa4\u7684\u7ba1\u63a7\u7ec4\u4ef6\u3002\u5176\u4e2d\u7cfb\u7edf\u91c7\u7528 ubuntu18.04\u3001hostname \u4e3a master-node\u3001docker \u7248\u672c\u4e3a 19.03.5\u3002\\n\\n\u5728\u8fb9\u7f18\uff0c\u5c06\u6811\u8393\u6d3e 4 \u4e0e\u672c\u5730\u7684\u8def\u7531\u5668\u8fde\u63a5\uff0c\u7ec4\u6210\u8fb9\u7f18\u79c1\u7f51\u73af\u5883\uff0c\u8def\u7531\u5668\u901a\u8fc7 4G \u7f51\u5361\u8bbf\u95ee\u4e92\u8054\u7f51\u3002\u5176\u4e2d\u6811\u8393\u6d3e 4 \u9884\u88c5\u7cfb\u7edf\u4e3a ubuntu18.04\u3001hostname\u4e3a edge-node\u3001docker \u7248\u672c\u4e3a 19.03.5\u3002\\n![image](../static/img/blog/edge_raspberry_pi.png)\\n\\n### 2)\u539f\u751fK8s\u96c6\u7fa4\u642d\u5efa\\n\u672c\u6587\u6f14\u793a\u73af\u5883\u57fa\u4e8e\u793e\u533a1.16.6\u7248\u672c\u7684K8s\u96c6\u7fa4\uff0c\u5e76\u91c7\u7528\u793e\u533a\u63d0\u4f9b\u7684kubeadm\u5de5\u5177\u6765\u642d\u5efa\u96c6\u7fa4\uff0c\u5177\u4f53\u64cd\u4f5c\u5982\u4e0b\uff1a\\n\\n- \u5728\u4e91\u7aef\u8282\u70b9\u548c\u6811\u8393\u6d3e\u4e0a\u5206\u522b\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5b89\u88c5 Kubernetes \u7ec4\u4ef6\u3002\\n\\n```\\ncurl -s https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | sudo apt-key add -\\necho \\"deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main\\" > /etc/apt/sources.list.d/kubernetes.list\\nsudo apt-get update\\nsudo apt install -y kubelet=1.16.6-00 kubeadm=1.16.6-00 kubectl=1.16.6-00\\n```\\n\\n- \u4f7f\u7528kubeadm \u521d\u59cb\u5316\u4e91\u7aef\u8282\u70b9\uff08\u5728\u4e91\u7aef\u8282\u70b9\u4e0a\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff09\uff0c\u90e8\u7f72\u8fc7\u7a0b\u4e2d\u91c7\u7528\u963f\u91cc\u4e91\u7684\u955c\u50cf\u4ed3\u5e93\uff0c\u4e3a\u4e86\u652f\u6301\u6811\u8393\u6d3e\u7684\u63a5\u5165\uff0c\u8be5\u4ed3\u5e93\u7684\u955c\u50cf\u505a\u4e86 manifest \u5217\u8868\uff0c\u80fd\u591f\u652f\u6301 amd64/arm64 \u4e24\u79cd\u4e0d\u540c\u7684 CPU \u67b6\u6784\u3002\\n\\n```\\n# master-node\\nkubeadm init --image-repository=registry.cn-hangzhou.aliyuncs.com/edge-kubernetes --kubernetes-version=v1.16.6 --pod-network-cidr=10.244.0.0/16\\n```\\n\\n- \u4f9d\u636e\u521d\u59cb\u5316\u5b8c\u6210\u4e4b\u540e\u7684\u63d0\u793a\uff0c\u62f7\u8d1d config \u6587\u4ef6\u5230 $HOME/.kube \u4e2d\uff1a\\n\\n```\\nmkdir -p $HOME/.kube\\n sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\\n```\\n\\n- \u6811\u8393\u6d3e\u63a5\u5165\u4e91\u7aef\u96c6\u7fa4\u4f9d\u636e\u7b2c\u4e8c\u6b65\u4e2d\u521d\u59cb\u5316\u5b8c\u6210\u4ee5\u540e\u8f93\u51fa\u7684\u8282\u70b9\u63a5\u5165\u4fe1\u606f\uff0c\u5728\u6811\u8393\u6d3e\u4e0a\u6267\u884c\u63a5\u5165\u547d\u4ee4\u3002\\n\\n```\\nkubeadm join 183.195.233.42:6443 --token XXXX \\\\\\n --discovery-token-ca-cert-hash XXXX\\n```\\n\\n- \u6dfb\u52a0 cni \u914d\u7f6e\uff08\u4e91\u7aef\u7ba1\u63a7\u8282\u70b9\u548c\u6811\u8393\u6d3e\u90fd\u9700\u8981\u914d\u7f6e\uff09\uff0c\u672c\u6587\u642d\u5efa\u7684\u96c6\u7fa4\u4f7f\u7528\u4e3b\u673a\u7f51\u7edc\u3002\u521b\u5efa cni \u914d\u7f6e\u6587\u4ef6 /etc/cni/net.d/0-loopback.conf\uff0c\u5e76\u5c06\u5982\u4e0b\u5185\u5bb9\u62f7\u8d1d\u5230\u8be5\u6587\u4ef6\u4e2d\u3002\\n```\\n{\\n \\"cniVersion\\": \\"0.3.0\\",\\n \\"name\\": \\"lo\\",\\n \\"type\\": \\"loopback\\"\\n}\\n```\\n\\n- \u5728 master \u8282\u70b9\u4e0a\u67e5\u770b\u90e8\u7f72\u6548\u679c\u3002\\n```\\nNAME STATUS ROLES AGE VERSION INTERNAL-IP EXTERNAL-IP OS-IMAGE KERNEL-VERSION CONTAINER-RUNTIME\\nedge-node Ready <none>   74s    v1.16.6   192.168.0.100    <none>        Ubuntu 18.04.4 LTS   4.19.105-v8-28      docker://19.3.5\\nmaster-node   Ready    master   2m5s   v1.16.6   183.195.233.42   <none>        Ubuntu 18.04.2 LTS   4.15.0-52-generic   docker://19.3.5\\n```\\n\\n- \u5220\u9664 CoreDNS\uff08\u672c\u6587 Demo \u4e2d CoreDNS \u4e0d\u9700\u8981\u4f7f\u7528\uff09\uff0c\u5e76\u5c06 master \u8282\u70b9\u7684 taints \u53bb\u6389\uff08\u65b9\u4fbf\u540e\u7eed\u90e8\u7f72 OpenYurt \u7ec4\u4ef6\uff09\u3002\\n```\\nkubectl delete deployment coredns -n kube-system\\nkubectl taint node master-node node-role.kubernetes.io/master-\\n```\\n\\n\\n## \u539f\u751f K8s \u96c6\u7fa4\u5728\u8fb9\u7f18\u573a\u666f\u4e2d\u7684\u95ee\u9898\\n\\n\\n\u57fa\u4e8e\u4e0a\u8ff0\u73af\u5883\uff0c\u6211\u4eec\u6765\u6d4b\u8bd5\u4e00\u4e0b\u539f\u751f K8s \u5728\u4e91\u7ba1\u8fb9\u67b6\u6784\u4e2d\u5bf9\u4e91\u8fb9\u8fd0\u7ef4\u7684\u652f\u6301\u548c\u5bf9\u4e91\u8fb9\u7f51\u7edc\u65ad\u5f00\u65f6\u7684\u53cd\u5e94\u3002\u9996\u5148\uff0c\u6211\u4eec\u4ece\u4e91\u7aef\u90e8\u7f72\u4e00\u4e2a\u6d4b\u8bd5\u5e94\u7528 nginx\uff0c\u5728 master \u8282\u70b9\u4e0a\u6267\u884c kubectl apply -f nginx.yaml\uff0c\u5177\u4f53\u7684\u90e8\u7f72 yaml \u5982\u4e0b\u3002\\n\\n\u6ce8\u610f\uff1anodeSelector \u9009\u62e9 edge-node \u8282\u70b9\uff0c\u4e3b\u673a\u7f51\u7edc\u914d\u7f6e\u4e3a true\uff0c\u5e76\u914d\u7f6e pod \u7684\u5bb9\u5fcd\u65f6\u95f4\u4e3a 5s\uff08\u9ed8\u8ba4 5min, \u6b64\u5904\u914d\u7f6e\u4fbf\u4e8e\u6f14\u793a pod \u9a71\u9010\uff09\u3002\\n\\n```\\napiVersion: v1\\nkind: Pod\\nmetadata:\\n name: nginx\\nspec:\\n tolerations:\\n - key: \\"node.kubernetes.io/unreachable\\"\\n operator: \\"Exists\\"\\n effect: \\"NoExecute\\"\\n tolerationSeconds: 5\\n - key: \\"node.kubernetes.io/not-ready\\"\\n operator: \\"Exists\\"\\n effect: \\"NoExecute\\"\\n tolerationSeconds: 5\\n nodeSelector:\\n kubernetes.io/hostname: edge-node\\n containers:\\n - name: nginx\\n image: nginx\\n hostNetwork: true\\n```\\n\\n\\n\u67e5\u770b\u90e8\u7f72\u7ed3\u679c\uff1a\\n```\\n\\nroot@master-node:~# kubectl get pods -owide\\nNAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES\\nnginx 1/1 Running 0 11s 192.168.0.100 edge-node <none> \\n```\\n\\n### 1\uff09\u6d4b\u8bd5\u5e38\u7528\u7684\u96c6\u7fa4\u8fd0\u7ef4\u6307\u4ee4\uff0c\u5305\u62ec logs\u3001exec\u3001port-forward\\n\\n\u5728 master \u8282\u70b9\u4e0a\u8fd0\u7ef4\u8fb9\u7f18\u8282\u70b9\u5e94\u7528\uff0c\u6267\u884c logs/exec/port-forward \u7b49\u6307\u4ee4\uff0c\u67e5\u770b\u7ed3\u679c\u3002\\n\\n\\n```\\nroot@master-node:~# kubectl logs nginx\\nError from server: Get https://192.168.0.100:10250/containerLogs/default/nginx/nginx: dial tcp 192.168.0.100:10250: connect: connection refused\\n\\nroot@master-node:~# kubectl exec -it nginx sh\\nkubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl exec [POD] -- [COMMAND] instead.\\nError from server: error dialing backend: dial tcp 192.168.0.100:10250: connect: connection refused\\n\\nroot@master-node:~# kubectl port-forward pod/nginx 8888:80\\nerror: error upgrading connection: error dialing backend: dial tcp 192.168.0.100:10250: connect: connection refused\\n```\\n\u4ece\u6267\u884c\u7ed3\u679c\u770b\uff0c\u539f\u751f\u7684k8s\u5728\u4e91\u7ba1\u8fb9\u7684\u573a\u666f\u4e2d\uff0c\u65e0\u6cd5\u63d0\u4f9b\u4ece\u4e91\u7aef\u8fd0\u7ef4\u8fb9\u7f18\u5e94\u7528\u7684\u80fd\u529b\u3002\u8fd9\u662f\u56e0\u4e3a\u8fb9\u7f18\u8282\u70b9\u90e8\u7f72\u5728\u7528\u6237\u7684\u79c1\u7f51\u73af\u5883\uff0c\u4ece\u4e91\u7aef\u65e0\u6cd5\u901a\u8fc7\u8fb9\u7f18\u8282\u70b9\u7684 IP \u5730\u5740\u76f4\u63a5\u8bbf\u95ee\u8fb9\u7f18\u8282\u70b9\u3002\\n\\n\\n### 2\uff09\u6d4b\u8bd5\u8fb9\u7f18\u65ad\u7f51\u65f6\u5bf9\u4e1a\u52a1\u7684\u5f71\u54cd\\n\\n\u8fb9\u7f18\u8282\u70b9\u4e0e\u4e91\u7aef\u7ba1\u63a7\u901a\u8fc7\u516c\u7f51\u8fde\u63a5\uff0c\u7ecf\u5e38\u4f1a\u51fa\u73b0\u7f51\u7edc\u4e0d\u7a33\u5b9a\uff0c\u4e91\u7aef\u65ad\u8fde\u7684\u60c5\u51b5\u3002\u8fd9\u91cc\u6211\u4eec\u5c06\u505a\u4e24\u4e2a\u65ad\u7f51\u76f8\u5173\u7684\u6d4b\u8bd5\uff1a\\n\\n- \u65ad\u7f51 1 \u5206\u949f->\u6062\u590d\u7f51\u7edc\\n\\n- \u65ad\u7f51 1 \u5206\u949f->\u91cd\u542f\u8fb9\u7f18\u8282\u70b9->\u6062\u590d\u7f51\u7edc\\n\\n\\n\u89c2\u5bdf\u4e24\u4e2a\u6d4b\u8bd5\u8fc7\u7a0b\u4e2d\u8282\u70b9\u548c Pod \u7684\u72b6\u6001\u53d8\u5316\u3002\u672c\u6587 Demo \u4e2d\u7684\u65ad\u7f51\u65b9\u5f0f\u662f\u5c06\u8def\u7531\u5668\u7684\u516c\u7f51\u8fde\u63a5\u65ad\u5f00\u3002\\n\\n#### 1.\u65ad\u7f511\u5206\u949f->\u6062\u590d\u7f51\u7edc\\n\u65ad\u5f00\u7f51\u7edc\uff0c\u5927\u7ea6 40s \u540e\uff0c\u8282\u70b9\u53d8\u6210 NotReady\uff08\u6b63\u5e38\u8282\u70b9 10s \u949f\u4e0a\u62a5\u4e00\u6b21\u5fc3\u8df3\uff0c\u5f53 4 \u6b21\u6ca1\u6709\u4e0a\u62a5\u5fc3\u8df3\u65f6\uff0c\u7ba1\u63a7\u7ec4\u4ef6\u8ba4\u4e3a\u8282\u70b9\u5f02\u5e38\uff09\u3002\\n\\n```\\n\\nroot@master-node:~# kubectl get nodes\\nNAME STATUS ROLES AGE VERSION\\nedge-node NotReady <none>   5m13s   v1.16.6\\nmaster-node   Ready      master   6m4s    v1.16.6\\n```\\n\\n\u7ee7\u7eed\u7b49\u5f85 5s \u4e4b\u540e\uff08\u6b63\u5e38\u8282\u70b9\u53d8\u4e3a NotReady \u4e4b\u540e\uff0c5m \u624d\u5f00\u59cb\u9a71\u9010 pod\uff0c\u6b64\u5904\u4e3a\u4e86\u6d4b\u8bd5\u6548\u679c\uff0c\u5c06 pod \u7684\u5bb9\u5fcd\u65f6\u95f4\u914d\u6210\u4e86 5s\uff09\uff0c\u5e94\u7528 pod \u88ab\u9a71\u9010\uff0c\u72b6\u6001\u53d8\u4e3a Terminating\u3002\\n\\n```\\nroot@master-node:~# kubectl get pods\\nNAME READY STATUS RESTARTS AGE\\nnginx 1/1 Terminating 0 3m45s\\n```\\n\\n\\n\u5c06\u7f51\u7edc\u6062\u590d\uff0c\u89c2\u5bdf\u8282\u70b9\u53ca pod \u53d8\u5316\u3002\\n```\\nroot@master-node:~# kubectl get pods\\nNo resources found in default namespace.\\n```\\n\\n\u7f51\u7edc\u6062\u590d\u540e\uff0c\u8282\u70b9\u72b6\u6001\u53d8\u6210 ready\uff0c\u4e1a\u52a1 pod \u88ab\u6e05\u9664\uff0c\u8fd9\u662f\u56e0\u4e3a\u8fb9\u7f18\u8282\u70b9\u7684 Kubelet \u83b7\u53d6\u5230\u4e1a\u52a1 Pod \u7684 Terminating \u72b6\u6001\uff0c\u5bf9\u4e1a\u52a1 Pod \u505a\u5220\u9664\u64cd\u4f5c\uff0c\u5e76\u8fd4\u56de\u5220\u9664\u6210\u529f\uff0c\u4e91\u7aef\u4e5f\u505a\u4e86\u76f8\u5e94\u7684\u6e05\u7406\u3002\u81f3\u6b64\uff0c\u4e1a\u52a1 Pod \u7531\u4e8e\u4e91\u8fb9\u7f51\u7edc\u7684\u4e0d\u7a33\u5b9a\u800c\u88ab\u9a71\u9010\uff0c\u7136\u800c\u5728\u65ad\u7f51\u671f\u95f4\uff0c\u8fb9\u7f18\u8282\u70b9\u5176\u5b9e\u662f\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\u7684\u3002\\n\\n\u91cd\u65b0\u521b\u5efa\u5e94\u7528 nginx\uff0c\u7528\u4e8e\u4e0b\u9762\u6d4b\u8bd5\u3002\\n\\n```\\nroot@master-node:~# kubectl get pods -owide\\nNAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES\\nnginx 1/1 Running 0 4s 192.168.0.100 edge-node <none>           <none>\\n```\\n#### 2.\u65ad\u7f511\u5206\u949f->\u91cd\u542f\u8fb9\u7f18\u8282\u70b9->\u6062\u590d\u7f51\u7edc\\n\\n\\n\\n\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u6d4b\u8bd5\u5728\u65ad\u7f51\u7684\u60c5\u51b5\u4e0b\uff0c\u8fb9\u7f18\u8282\u70b9\u7684\u91cd\u542f\u5bf9\u4e1a\u52a1\u7684\u5f71\u54cd\u3002\u65ad\u7f51 1 \u5206\u949f\u4e4b\u540e\uff0cNode \u548c Pod \u72b6\u6001\u540c\u4e0a\u9762\u6d4b\u8bd5\u7ed3\u679c\uff0cNode \u53d8\u4e3a NotReady\uff0cPod \u7684\u72b6\u6001\u53d8\u4e3a Terminating\u3002\u6b64\u65f6\uff0c\u5207\u6362\u5230\u79c1\u6709\u7f51\u7edc\u73af\u5883\uff0c\u767b\u5f55\u5230\u6811\u8393\u6d3e\u4e0a\uff0c\u5c06\u6811\u8393\u6d3e\u91cd\u542f\uff0c\u91cd\u542f\u5b8c\u6210\u540e\u7b49\u5f85\u5927\u7ea6 1 \u5206\u949f\uff0c\u89c2\u5bdf\u91cd\u542f\u524d\u540e\u8282\u70b9\u4e0a\u7684\u5bb9\u5668\u5217\u8868\u3002\\n\\n\u91cd\u542f\u524d\u8fb9\u7f18\u8282\u70b9\u5bb9\u5668\u5217\u8868\uff08\u6b64\u65f6\u4e91\u8fb9\u7aef\u5f00\uff0c\u867d\u7136\u5728\u4e91\u7aef\u83b7\u53d6\u7684 pod \u662f Terminating \u72b6\u6001\uff0c\u4f46\u662f\u8fb9\u7f18\u5e76\u672a Watch \u5230 Terminating \u7684\u64cd\u4f5c\uff0c\u6240\u4ee5\u8fb9\u7f18\u7684\u5e94\u7528\u8fd8\u6b63\u5e38\u8fd0\u884c\uff09\u3002\\n\\n\\n```\\nroot@edge-node:~# docker ps\\nCONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES\\n9671cbf28ca6 e86f991e5d10 \\"/docker-entrypoint.\u2026\\" About a minute ago Up About a minute k8s_nginx_nginx_default_efdf11c6-a41c-4b95-8ac8-45e02c9e1f4d_0\\n6272a46f93ef registry.cn-hangzhou.aliyuncs.com/edge-kubernetes/pause:3.1 \\"/pause\\" 2 minutes ago Up About a minute k8s_POD_nginx_default_efdf11c6-a41c-4b95-8ac8-45e02c9e1f4d_0\\n698bb024c3db f9ea384ddb34 \\"/usr/local/bin/kube\u2026\\" 8 minutes ago Up 8 minutes k8s_kube-proxy_kube-proxy-rjws7_kube-system_51576be4-2b6d-434d-b50b-b88e2d436fef_0\\n31952700c95b registry.cn-hangzhou.aliyuncs.com/edge-kubernetes/pause:3.1 \\"/pause\\" 8 minutes ago Up 8 minutes k8s_POD_kube-proxy-rjws7_kube-system_51576be4-2b6d-434d-b50b-b88e2d436fef_0\\n```\\n\\n\\n\u91cd\u542f\u540e\u8282\u70b9\u5bb9\u5668\u5217\u8868\uff0c\u65ad\u7f51\u91cd\u542f\u540e\uff0ckubelet \u65e0\u6cd5\u4ece\u4e91\u7aef\u83b7\u53d6 Pod \u4fe1\u606f\uff0c\u4e0d\u4f1a\u91cd\u5efa Pod\u3002\\n\\n\\n\\n```\\nroot@edge-node:~# docker ps\\nCONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES\\nroot@edge-node:~#\\n```\\n\u4ece\u91cd\u542f\u524d\u540e\u7684\u5bf9\u6bd4\u770b\uff0c\u8fb9\u7f18\u8282\u70b9\u5728\u65ad\u7f51\u91cd\u542f\u4e4b\u540e\uff0c\u8282\u70b9\u4e0a\u7684 Pod \u5168\u90e8\u65e0\u6cd5\u6062\u590d\u3002\u8fd9\u5c31\u4f1a\u5bfc\u81f4\u5728\u4e91\u8fb9\u65ad\u7f51\u65f6\uff0c\u4e00\u65e6\u8282\u70b9\u91cd\u542f\uff0c\u5e94\u7528\u5c06\u65e0\u6cd5\u5de5\u4f5c\u3002\\n\\n\u5c06\u7f51\u7edc\u6062\u590d\uff0c\u89c2\u5bdf\u8282\u70b9\u53ca pod \u53d8\u5316\uff0c\u540c\u4e0a\u9762\u6d4b\u8bd5\u7ed3\u679c\uff0c\u7f51\u7edc\u6062\u590d\u540e\uff0c\u8282\u70b9\u53d8\u4e3a Ready\uff0c\u4e1a\u52a1 Pod \u88ab\u6e05\u9664\u3002\\n\\n```\\nroot@master-node:~# kubectl get nodes\\nNAME STATUS ROLES AGE VERSION\\nedge-node Ready <none>   11m   v1.16.6\\nmaster-node   Ready    master   12m   v1.16.6\\nroot@master-node:~# kubectl get pods\\nNo resources found in default namespace.\\n```\\n\\n\u63a5\u4e0b\u6765\uff0c\u518d\u6b21\u90e8\u7f72\u4e1a\u52a1 nginx\uff0c\u6d4b\u8bd5 OpenYurt \u96c6\u7fa4\u5bf9\u4e91\u8fb9\u8fd0\u7ef4\u7684\u652f\u6301\u548c\u5bf9\u4e91\u8fb9\u65ad\u7f51\u65f6\u7684\u53cd\u5e94\u3002\\n\\n```\\n\\nroot@master-node:~# kubectl get pods -owide\\nNAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES\\nnginx 1/1 Running 0 12s 192.168.0.100 edge-node <none>           <none>\\n```\\n\\n## \u539f\u751f K8s \u96c6\u7fa4\u4e00\u952e\u8f6c\u6362\u4e3a OpenYurt \u96c6\u7fa4\\n\\n\u63a2\u7a76\u4e86\u539f\u751f Kubernetes \u5728\u4e91\u8fb9\u4e00\u4f53\u5316\u67b6\u6784\u4e2d\u7684\u4e0d\u8db3\u4e4b\u540e\uff0c\u6211\u4eec\u6765\u770b\u4e0b OpenYurt \u96c6\u7fa4\u662f\u5426\u80fd\u6ee1\u8db3\u8fd9\u79cd\u573a\u666f\u3002\u73b0\u5728\uff0c\u6211\u4eec\u5229\u7528 OpenYurt \u793e\u533a\u63d0\u4f9b\u7684\u96c6\u7fa4\u8f6c\u6362\u5de5\u5177 yurtctl\uff0c\u6765\u5c06\u539f\u751f K8s \u96c6\u7fa4\u8f6c\u6362\u6210 OpenYurt \u96c6\u7fa4\u3002\u5728 master \u8282\u70b9\u4e0a\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff0c \u8be5\u547d\u4ee4\u6307\u5b9a\u4e86\u7ec4\u4ef6\u7684\u955c\u50cf\u4ee5\u53ca\u4e91\u7aef\u8282\u70b9\uff0c\u5e76\u6307\u5b9a\u5b89\u88c5\u4e91\u8fb9\u8fd0\u7ef4\u901a\u9053 yurt-tunnel\u3002\\n\\n\\n\\n```\\nyurtctl convert --yurt-controller-manager-image=registry.cn-hangzhou.aliyuncs.com/openyurt/yurt-controller-manager:v0.2.1 --yurt-tunnel-agent-image=registry.cn-hangzhou.aliyuncs.com/openyurt/yurt-tunnel-agent:v0.2.1 --yurt-tunnel-server-image=registry.cn-hangzhou.aliyuncs.com/openyurt/yurt-tunnel-server:v0.2.1 --yurtctl-servant-image=registry.cn-hangzhou.aliyuncs.com/openyurt/yurtctl-servant:v0.2.1 --yurthub-image=registry.cn-hangzhou.aliyuncs.com/openyurt/yurthub:v0.2.1 --cloud-nodes=master-node --deploy-yurttunnel\\n```\\n\\n\u8f6c\u6362\u5927\u6982\u9700\u8981 2min\uff0c\u8f6c\u6362\u5b8c\u6210\u4e4b\u540e\uff0c\u89c2\u5bdf\u4e1a\u52a1 pod \u7684\u72b6\u6001\uff0c\u53ef\u4ee5\u770b\u5230\u8f6c\u6362\u8fc7\u7a0b\u4e2d\u5bf9\u4e1a\u52a1 pod \u65e0\u5f71\u54cd\uff08\u4e5f\u53ef\u4ee5\u5728\u8f6c\u6362\u8fc7\u7a0b\u4e2d\u5728\u65b0\u7684\u7ec8\u7aef\u4f7f\u7528 kubectl get pod -w \u89c2\u5bdf\u4e1a\u52a1 pod \u7684\u72b6\u6001\uff09\u3002\\n\\n\\n```\\nroot@master-node:~# kubectl get pods -owide\\nNAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES\\nnginx 1/1 Running 0 2m4s 192.168.0.100 edge-node <none>           <none>\\n```\\n\\n\u6267\u884c\u5b8c\u6210\u4e4b\u540e\u7684\u7ec4\u4ef6\u5206\u5e03\u5982\u4e0b\u56fe \u6240\u793a\uff0c\u5176\u4e2d\u6a59\u8272\u90e8\u5206\u662f OpenYurt \u76f8\u5173\u7684\u7ec4\u4ef6\uff0c\u84dd\u8272\u90e8\u5206\u662f\u539f\u751f K8s \u7ec4\u4ef6\u3002\u76f8\u5e94\u5730\uff0c\u6211\u4eec\u89c2\u5bdf\u4e91\u7aef\u8282\u70b9\u548c\u8fb9\u7f18\u8282\u70b9\u7684 pod\u3002\\n\\n![image](../static/img/blog/OpenYurt_Cluster.png)\\n\\n\\n\\n\u4e91\u7aef\u8282\u70b9 yurt \u76f8\u5173\u7684 pod\uff1ayurt-controller-manager \u548c yurt-tunnel-server\u3002\\n\\n```\\nroot@master-node:~# kubectl get pods --all-namespaces -owide | grep master | grep yurt\\nkube-system yurt-controller-manager-7d9db5bf85-6542h 1/1 Running 0 103s 183.195.233.42 master-node <none>           <none>\\nkube-system   yurt-tunnel-server-65784dfdf-pl5bn         1/1     Running   0          103s    183.195.233.42   master-node   <none>           <none>\\n```\\n\\n\\n\u8fb9\u7f18\u8282\u70b9\u65b0\u589e yurt \u76f8\u5173\u7684 pod: yurt-hub\uff08static pod\uff09\u548c yurt-tunnel-agent\u3002\\n\\n```\\nroot@master-node:~# kubectl get pods --all-namespaces -owide | grep edge | grep yurt\\nkube-system yurt-hub-edge-node 1/1 Running 0 117s 192.168.0.100 edge-node <none>           <none>\\nkube-system   yurt-tunnel-agent-7l8nv                    1/1     Running   0          2m      192.168.0.100    edge-node     <none>           <none>\\n```\\n\\n## \u6d4b\u8bd5 OpenYurt \u96c6\u7fa4\u5728\u8fb9\u7f18\u573a\u666f\u4e2d\u7684\u80fd\u529b\\n\\n### 1. \u6d4b\u8bd5 logs/exec/port-forward \u7b49\u8fd0\u7ef4\u6307\u4ee4\uff0c\u67e5\u770b\u7ed3\u679c\\n```\\nroot@master-node:~# kubectl logs nginx\\n/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration\\n/docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/\\n/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh\\n10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf\\n10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 in /etc/nginx/conf.d/default.conf\\n/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh\\n/docker-entrypoint.sh: Configuration complete; ready for start up\\n\\n\\nroot@master-node:~# kubectl exec -it nginx sh\\nkubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl exec [POD] -- [COMMAND] instead.\\n# ls\\nbin dev docker-entrypoint.sh home media opt root sbin sys usr\\nboot docker-entrypoint.d etc lib mnt proc run srv tmp var\\n# exit\\n\\n\\nroot@master-node:~# kubectl port-forward pod/nginx 8888:80\\nForwarding from 127.0.0.1:8888 -> 80\\nHandling connection for 8888\\n```\\n\\n\\n\u6d4b\u8bd5 port-forward \u65f6\uff0c\u5728 master \u8282\u70b9\u4e0a\u6267\u884c curl 127.0.0.1:8888\uff0c\u53ef\u4ee5\u8bbf\u95ee nginx \u670d\u52a1\u3002\\n\\n\u4ece\u6f14\u793a\u7ed3\u679c\u770b\uff0cOpenYurt \u80fd\u591f\u5f88\u597d\u5730\u652f\u6301\u5e38\u7528\u7684\u4e91\u8fb9\u8fd0\u7ef4\u6307\u4ee4\u3002\\n\\n\\n### 2. \u6d4b\u8bd5\u8fb9\u7f18\u65ad\u7f51\u65f6\u5bf9\u4e1a\u52a1\u7684\u5f71\u54cd\\n\\n\u540c\u6837\u6211\u4eec\u91cd\u590d\u539f\u751f K8s \u4e2d\u65ad\u7f51\u7684\u4e24\u4e2a\u6d4b\u8bd5\uff0c\u5728\u6d4b\u8bd5\u4e4b\u524d\u6211\u4eec\u5148\u4e3a\u8fb9\u7f18\u8282\u70b9 edge-node \u5f00\u542f\u81ea\u6cbb\u3002\u5728 OpenYurt \u96c6\u7fa4\u4e2d\uff0c\u8fb9\u7f18\u8282\u70b9\u7684\u81ea\u6cbb\u662f\u901a\u8fc7\u4e00\u4e2a annotation \u6765\u6807\u8bc6\u7684\u3002\\n\\n```\\nroot@master-node:~# kubectl annotate node edge-node node.beta.alibabacloud.com/autonomy=true\\nnode/edge-node annotated\\n```\\n\\n####  1\uff09\u65ad\u7f51 1 \u5206\u949f->\u7f51\u7edc\u6062\u590d\\n\u540c\u6837\uff0c\u5c06\u8def\u7531\u5668\u516c\u7f51\u65ad\u5f00\uff0c\u89c2\u5bdf Node \u548c Pod \u7684\u72b6\u6001\u3002\u5927\u7ea6\u8fc7\u4e86 40s\uff0c\u8282\u70b9\u7684\u72b6\u6001\u53d8\u6210 NotReady\uff0c\u800c\u5927\u7ea6\u8fc7 1min \u4ee5\u540e\uff0cPod \u7684\u72b6\u6001\u4e00\u76f4\u662f Running\uff0c\u5e76\u4e0d\u4f1a\u88ab\u9a71\u9010\u3002\\n\\n```\\nroot@master-node:~# kubectl get nodes\\nNAME STATUS ROLES AGE VERSION\\nedge-node NotReady <none>   24m   v1.16.6\\nmaster-node   Ready      master   25m   v1.16.6\\nroot@master-node:~# kubectl get pods\\nNAME    READY   STATUS    RESTARTS   AGE\\nnginx   1/1     Running   0          5m7s\\n```\\n\\n\u6062\u590d\u7f51\u7edc\uff0c\u89c2\u5bdf Node \u548c Pod \u7684\u72b6\u6001\uff0cNode \u72b6\u6001\u53d8\u4e3a Ready\uff0cPod \u4fdd\u6301 Running\u3002\u53ef\u89c1\u4e91\u8fb9\u7f51\u7edc\u4e0d\u7a33\u5b9a\u65f6\uff0c\u5bf9\u8fb9\u7f18\u8282\u70b9\u7684\u4e1a\u52a1 Pod \u65e0\u5f71\u54cd\u3002\\n\\n```\\nroot@master-node:~# kubectl get nodes\\nNAME STATUS ROLES AGE VERSION\\nedge-node Ready <none>   25m   v1.16.6\\nmaster-node   Ready    master   26m   v1.16.6\\nroot@master-node:~# kubectl get pods\\nNAME    READY   STATUS    RESTARTS   AGE\\nnginx   1/1     Running   0          6m30s\\n```\\n\\n#### 2\uff09\u65ad\u7f51 1 \u5206\u949f->\u91cd\u542f\u8fb9\u7f18\u8282\u70b9->\u6062\u590d\u7f51\u7edc\\n\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u6d4b\u8bd5\u5728\u65ad\u7f51\u7684\u60c5\u51b5\u4e0b\uff0c\u8fb9\u7f18\u8282\u70b9\u7684\u91cd\u542f\u5bf9\u4e1a\u52a1\u7684\u5f71\u54cd\u3002\u65ad\u7f51 1 \u5206\u949f\u4e4b\u540e\uff0cNode \u548c Pod \u72b6\u6001\u540c\u4e0a\u9762\u6d4b\u8bd5\u7ed3\u679c\uff0cNode \u53d8\u4e3a NotReady\uff0cPod \u4fdd\u6301 Running\u3002\u540c\u6837\uff0c\u6211\u4eec\u767b\u5f55\u5230\u6811\u8393\u6d3e\u4e0a\uff0c\u5c06\u6811\u8393\u6d3e\u91cd\u542f\uff0c\u89c2\u5bdf\u91cd\u542f\u524d\u540e\u8282\u70b9\u4e0a\u7684\u5bb9\u5668\u5217\u8868\u3002\\n\\n\u91cd\u542f\u524d\u8fb9\u7f18\u8282\u70b9\u5bb9\u5668\u5217\u8868\uff1a\\n```\\nroot@edge-node:~# docker ps\\nCONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES\\n38727ec9270c 70bf6668c7eb \\"yurthub --v=2 --ser\u2026\\" 7 minutes ago Up 7 minutes k8s_yurt-hub_yurt-hub-edge-node_kube-system_d75d122e752b90d436a71af44c0a53be_0\\nc403ace1d4ff registry.cn-hangzhou.aliyuncs.com/edge-kubernetes/pause:3.1 \\"/pause\\" 7 minutes ago Up 7 minutes k8s_POD_yurt-hub-edge-node_kube-system_d75d122e752b90d436a71af44c0a53be_0\\nde0d693e9e74 473ae979be68 \\"yurt-tunnel-agent -\u2026\\" 7 minutes ago Up 7 minutes k8s_yurt-tunnel-agent_yurt-tunnel-agent-7l8nv_kube-system_75d28494-f577-43fa-9cac-6681a1215498_0\\na0763f143f74 registry.cn-hangzhou.aliyuncs.com/edge-kubernetes/pause:3.1 \\"/pause\\" 7 minutes ago Up 7 minutes k8s_POD_yurt-tunnel-agent-7l8nv_kube-system_75d28494-f577-43fa-9cac-6681a1215498_0\\n80c247714402 e86f991e5d10 \\"/docker-entrypoint.\u2026\\" 7 minutes ago Up 7 minutes k8s_nginx_nginx_default_b45baaac-eebc-466b-9199-2ca5c1ede9fd_0\\n01f7770cb0f7 registry.cn-hangzhou.aliyuncs.com/edge-kubernetes/pause:3.1 \\"/pause\\" 7 minutes ago Up 7 minutes k8s_POD_nginx_default_b45baaac-eebc-466b-9199-2ca5c1ede9fd_0\\n7e65f83090f6 f9ea384ddb34 \\"/usr/local/bin/kube\u2026\\" 17 minutes ago Up 17 minutes k8s_kube-proxy_kube-proxy-rjws7_kube-system_51576be4-2b6d-434d-b50b-b88e2d436fef_1\\nc1ed142fc75b registry.cn-hangzhou.aliyuncs.com/edge-kubernetes/pause:3.1 \\"/pause\\" 17 minutes ago Up 17 minutes k8s_POD_kube-proxy-rjws7_kube-system_51576be4-2b6d-434d-b50b-b88e2d436fef_1\\n```\\n\\n\\n\u91cd\u542f\u540e\u8fb9\u7f18\u8282\u70b9\u5bb9\u5668\u5217\u8868\uff1a\\n```\\nroot@edge-node:~# docker ps\\nCONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES\\n0c66b87066a0 473ae979be68 \\"yurt-tunnel-agent -\u2026\\" 12 seconds ago Up 11 seconds k8s_yurt-tunnel-agent_yurt-tunnel-agent-7l8nv_kube-system_75d28494-f577-43fa-9cac-6681a1215498_2\\na4fb3e4e8c8f e86f991e5d10 \\"/docker-entrypoint.\u2026\\" 58 seconds ago Up 56 seconds k8s_nginx_nginx_default_b45baaac-eebc-466b-9199-2ca5c1ede9fd_1\\nfce730d64b32 f9ea384ddb34 \\"/usr/local/bin/kube\u2026\\" 58 seconds ago Up 57 seconds k8s_kube-proxy_kube-proxy-rjws7_kube-system_51576be4-2b6d-434d-b50b-b88e2d436fef_2\\nc78166ea563f registry.cn-hangzhou.aliyuncs.com/edge-kubernetes/pause:3.1 \\"/pause\\" 59 seconds ago Up 57 seconds k8s_POD_yurt-tunnel-agent-7l8nv_kube-system_75d28494-f577-43fa-9cac-6681a1215498_1\\n799ad14bcd3b registry.cn-hangzhou.aliyuncs.com/edge-kubernetes/pause:3.1 \\"/pause\\" 59 seconds ago Up 57 seconds k8s_POD_nginx_default_b45baaac-eebc-466b-9199-2ca5c1ede9fd_1\\n627673da6a85 registry.cn-hangzhou.aliyuncs.com/edge-kubernetes/pause:3.1 \\"/pause\\" 59 seconds ago Up 58 seconds k8s_POD_kube-proxy-rjws7_kube-system_51576be4-2b6d-434d-b50b-b88e2d436fef_2\\n04da705e4120 70bf6668c7eb \\"yurthub --v=2 --ser\u2026\\" About a minute ago Up About a minute k8s_yurt-hub_yurt-hub-edge-node_kube-system_d75d122e752b90d436a71af44c0a53be_1\\n260057d935ee registry.cn-hangzhou.aliyuncs.com/edge-kubernetes/pause:3.1 \\"/pause\\" About a minute ago Up About a minute k8s_POD_yurt-hub-edge-node_kube-system_d75d122e752b90d436a71af44c0a53be_1\\n```\\n\\n\\n\u4ece\u91cd\u542f\u524d\u540e\u7684\u5bf9\u6bd4\u770b\uff0c\u8fb9\u7f18\u8282\u70b9\u5728\u65ad\u7f51\u91cd\u542f\u4e4b\u540e\uff0c\u8282\u70b9\u4e0a\u7684 pod \u80fd\u6b63\u5e38\u62c9\u8d77\uff0cOpenYurt \u7684\u8282\u70b9\u81ea\u6cbb\u80fd\u529b\u53ef\u4ee5\u5728\u65ad\u7f51\u4e0b\u4fdd\u8bc1\u4e1a\u52a1\u7684\u7a33\u5b9a\u8fd0\u884c\u3002\\n\\n\u6062\u590d\u7f51\u7edc\uff0c\u8282\u70b9 Ready\uff0c\u89c2\u5bdf\u4e1a\u52a1 pod \u7684\u72b6\u6001\uff0c\u7f51\u7edc\u6062\u590d\u540e\uff0c\u4e1a\u52a1 pod \u72b6\u6001\u4fdd\u6301 running\uff0c\u6709\u4e00\u6b21\u91cd\u542f\u8bb0\u5f55\uff0c\u7b26\u5408\u9884\u671f\u3002\\n\\n\\n```\\nroot@master-node:~# kubectl get pods -owide\\nNAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES\\nnginx 1/1 Running 1 11m 192.168.0.100 edge-node <none>           <none>\\n```\\n\\n\u6700\u540e\uff0c\u6211\u4eec\u4eceyurtctl\u7684\u80fd\u529b\u5c06OpenYurt\u96c6\u7fa4\uff0c\u8f6c\u6362\u4e3a\u539f\u751fK8s\u96c6\u7fa4\u3002\u540c\u6837\uff0c\u53ef\u4ee5\u89c2\u5bdf\u8f6c\u6362\u8fc7\u7a0b\u4e2d\u5bf9\u73b0\u6709\u4e1a\u52a1\u4e0d\u4f1a\u6709\u5f71\u54cd\u3002\\n\\n```\\nyurtctl revert --yurtctl-servant-image=registry.cn-hangzhou.aliyuncs.com/openyurt/yurtctl-servant:v0.2.1\\n```\\n\\nOpenYurt \u4f5c\u4e3a\u963f\u91cc\u9996\u4e2a\u8fb9\u7f18\u4e91\u539f\u751f\u5f00\u6e90\u9879\u76ee\uff0c\u57fa\u4e8e\u5546\u4e1a\u5316\u4ea7\u54c1 ACK@Edge\uff0c\u5728\u96c6\u56e2\u5185\u90e8\u7ecf\u5386\u4e86\u957f\u65f6\u95f4\u7684\u6253\u78e8\u3002\u5df2\u7ecf\u5e94\u7528\u5728 CDN\u3001IoT\u3001\u76d2\u9a6c\u3001ENS\u3001\u83dc\u9e1f\u7269\u6d41\u7b49\u4f17\u591a\u573a\u666f\u3002\u9488\u5bf9\u8fb9\u7f18\u573a\u666f\uff0c\u8be5\u9879\u76ee\u575a\u6301\u4fdd\u6301\u539f\u751f K8s \u7684\u7279\u6027\uff0c\u4ee5 Addon \u7684\u5f62\u5f0f\u63d0\u4f9b\u4e86\u8fb9\u7f18\u8282\u70b9\u81ea\u6cbb\u3001\u4e91\u8fb9\u7aef\u4e00\u4f53\u5316\u8fd0\u7ef4\u901a\u9053\u7b49\u80fd\u529b\u3002\u6700\u8fd1\u5728\u793e\u533a\u540c\u5b66\u7684\u4e00\u8d77\u52aa\u529b\u4e0b\u53c8\u5f00\u6e90\u4e86\u8fb9\u7f18\u5355\u5143\u5316\u7ba1\u7406\u80fd\u529b\uff0c\u540c\u65f6\u540e\u7eed\u8fd8\u4f1a\u7ee7\u7eed\u5f00\u6e90\u66f4\u591a\u7684\u8fb9\u7f18\u7ba1\u7406\u80fd\u529b\uff0c\u6b22\u8fce\u5927\u5bb6\u79ef\u6781\u53c2\u4e0e\u8d21\u732e\u3002\\n\\n[\u539f\u6587\u94fe\u63a5](https://mp.weixin.qq.com/s/Anr8UhTaNe3FCnKKfKoXNQ)"},{"id":"Build-side-efficient-collaborative-network","metadata":{"permalink":"/blog/Build-side-efficient-collaborative-network","editUrl":"https://github.com/openyurtio/openyurt.io/tree/master/blog/blog/2020-11-06-Build-side-efficient-collaborative-network.md","source":"@site/blog/2020-11-06-Build-side-efficient-collaborative-network.md","title":"How to build Kubernetes Native Cloud side efficient collaborative network","description":"\u5bfc\u8bfb\uff1aOpenYurt\u662f\u963f\u91cc\u5df4\u5df4\u5f00\u6e90\u7684\u4e91\u8fb9\u534f\u540c\u4e00\u4f53\u5316\u67b6\u6784\uff0c\u4e0e\u540c\u7c7b\u5f00\u6e90\u65b9\u6848\u76f8\u6bd4\uff0cOpenYurt\u62e5\u6709\u53ef\u5b9e\u73b0\u8fb9\u7f18\u8ba1\u7b97\u5168\u573a\u666f\u8986\u76d6\u7684\u80fd\u529b\u3002","date":"2020-11-06T00:00:00.000Z","formattedDate":"November 6, 2020","tags":[{"label":"yurttunnel","permalink":"/blog/tags/yurttunnel"}],"readingTime":20.1,"truncated":true,"authors":[{"name":"Chao Zheng","title":"Maintainer of OpenYurt","url":"https://github.com/charleszheng44","imageURL":"https://github.com/charleszheng44.png","key":"charleszheng44"}],"frontMatter":{"slug":"Build-side-efficient-collaborative-network","title":"How to build Kubernetes Native Cloud side efficient collaborative network","authors":["charleszheng44"],"tags":["yurttunnel"]},"prevItem":{"title":"Getting Started with OpenYurt:play with OpenYurt on Raspberry Pi","permalink":"/blog/Play-with-OpenYurt-on-Raspberry-Pi"},"nextItem":{"title":"Viewing Expansion Ability of YurtHub from Edge Autonomy","permalink":"/blog/Expansion-capability-of-Yurthub"}},"content":"\u5bfc\u8bfb\uff1aOpenYurt\u662f\u963f\u91cc\u5df4\u5df4\u5f00\u6e90\u7684\u4e91\u8fb9\u534f\u540c\u4e00\u4f53\u5316\u67b6\u6784\uff0c\u4e0e\u540c\u7c7b\u5f00\u6e90\u65b9\u6848\u76f8\u6bd4\uff0cOpenYurt\u62e5\u6709\u53ef\u5b9e\u73b0\u8fb9\u7f18\u8ba1\u7b97\u5168\u573a\u666f\u8986\u76d6\u7684\u80fd\u529b\u3002\\n- OpenYurt\u662f\u5982\u4f55\u5728\u5f31\u7f51\u548c\u65ad\u7f51\u73af\u5883\u4e0b\u5b9e\u73b0\u8fb9\u7f18\u81ea\u6cbb\u7684\u2014\u2014[YurtHub](./2021-03-29-Edge-gateway-caching-capabilities.md)\\n- OpenYurt\u53e6\u4e00\u4e2a\u6838\u5fc3\u80fd\u529b\u2014\u2014\u4e91\u8fb9\u901a\u4fe1\uff0c\u4ee5\u53ca\u76f8\u5173\u7ec4\u4ef6Yurttunnel\\n\\n\x3c!--truncate--\x3e\\n\\n## Yurttunnel\u4f7f\u7528\u573a\u666f\\n\\n\u5728\u5e94\u7528\u7684\u90e8\u7f72\u548c\u8fd0\u7ef4\u8fc7\u7a0b\u4e2d\uff0c\u7528\u6237\u5e38\u5e38\u9700\u8981\u83b7\u53d6\u5e94\u7528\u7684\u65e5\u5fd7\uff0c\u6216\u76f4\u63a5\u767b\u5f55\u5230\u5e94\u7528\u7684\u8fd0\u884c\u73af\u5883\u4e2d\u8fdb\u884c\u8c03\u8bd5\u3002\u5728 Kubernetes \u73af\u5883\u4e2d\uff0c\u6211\u4eec\u901a\u5e38\u4f7f\u7528 kubectl log\uff0ckubectl exec \u7b49\u6307\u4ee4\u6765\u5b9e\u73b0\u8fd9\u4e9b\u9700\u6c42\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u5728 kubectl \u8bf7\u6c42\u94fe\u8def\u4e0a\uff0c kubelet \u5c06\u626e\u6f14\u670d\u52a1\u5668\u7aef\uff0c\u8d1f\u8d23\u5904\u7406\u7531 kube-apiserver(KAS) \u8f6c\u53d1\u6765\u7684\u8bf7\u6c42\uff0c\u8fd9\u5c31\u8981\u6c42 KAS \u548c kubelet \u4e4b\u95f4\u9700\u8981\u5b58\u5728\u4e00\u6761\u7f51\u7edc\u901a\u8def\uff0c\u5141\u8bb8 KAS \u4e3b\u52a8\u8bbf\u95ee kubelet\u3002\\n![image](../static/img/blog/kubectl.png)\\n\u7136\u800c\uff0c\u5728\u8fb9\u7f18\u8ba1\u7b97\u573a\u666f\u4e2d\uff0c\u8fb9\u7f18\u8282\u70b9\u5e38\u4f4d\u4e8e\u672c\u5730\u4e13\u6709\u7f51\u7edc\u4e2d\uff0c\u8fd9\u867d\u7136\u4fdd\u8bc1\u4e86\u8fb9\u7f18\u8282\u70b9\u7684\u5b89\u5168\uff0c\u4f46\u4e5f\u9020\u6210\u4f4d\u4e8e\u4e91\u7aef\u7ba1\u63a7\u8282\u70b9\u7684KAS\u65e0\u6cd5\u76f4\u63a5\u8bbf\u95ee\u4f4d\u4e8e\u8fb9\u7f18\u8282\u70b9\u7684kubelet\u3002\u56e0\u6b64\uff0c\u4e3a\u4e86\u652f\u6301\u901a\u8fc7\u4e91\u7aef\u8282\u70b9\u5bf9\u8fb9\u7f18\u7aef\u5e94\u7528\u8fdb\u884c\u8fd0\u7ef4\u64cd\u4f5c\uff0c\u6211\u4eec\u5fc5\u987b\u5728\u4e91\u3001\u8fb9\u4e4b\u95f4\u5efa\u7acb\u53cd\u5411\u8fd0\u7ef4\u901a\u9053\u3002\\n\\n\\n\\n\\n## \u53cd\u5411\u901a\u9053\\nYurttunnel\u662fOpenYurt\u8fd1\u671f\u5f00\u6e90\u7684\u4e00\u4e2a\u91cd\u8981\u7ec4\u4ef6\uff0c\u7528\u6765\u89e3\u51b3\u4e91\u8fb9\u901a\u4fe1\u95ee\u9898\u3002\u53cd\u5411\u901a\u9053\u662f\u89e3\u51b3\u8de8\u7f51\u7edc\u901a\u4fe1\u7684\u4e00\u79cd\u5e38\u89c1\u65b9\u5f0f\uff0c\u800c Yurttunnel \u7684\u672c\u8d28\u5c31\u662f\u4e00\u4e2a\u53cd\u5411\u901a\u9053\u3002\u4e00\u4e2a\u8fb9\u7f18\u96c6\u7fa4\u4e0b\u5c5e\u7684\u8282\u70b9\u5e38\u4f4d\u4e8e\u4e0d\u540c\u7684 network region \u4e2d\uff0c\u800c\u4f4d\u4e8e\u540c\u4e00\u4e2a region \u5185\u7684\u8282\u70b9\u4e4b\u95f4\u662f\u53ef\u4ee5\u76f8\u4e92\u901a\u4fe1\u7684\uff0c\u56e0\u6b64\u5728\u8bbe\u7f6e\u53cd\u5411\u901a\u9053\u65f6\uff0c\u6211\u4eec\u53ea\u9700\u4fdd\u8bc1\u5728\u6bcf\u4e2a region \u5185\u8bbe\u7f6e\u4e00\u4e2a\u4e0e proxy server \u76f8\u8fde\u7684 agent \u5373\u53ef\u3002\u5177\u4f53\u5305\u62ec\u4ee5\u4e0b\u51e0\u4e2a\u6b65\u9aa4\uff1a\\n\\n- \u5728\u7ba1\u63a7\u7ec4\u4ef6\u6240\u5728\u7f51\u7edc\u5185\uff0c\u90e8\u7f72 proxy server\u3002\\n\\n- proxy server \u5bf9\u5916\u5f00\u653e\u4e00\u4e2a\u516c\u7f51\u53ef\u4ee5\u8bbf\u95ee\u7684 IP\u3002\\n\\n- \u5728\u6bcf\u4e2a region \u90e8\u7f72\u4e2a agent\uff0c\u5e76\u901a\u8fc7 server \u7684\u516c\u7f51 IP \u4e0e server \u5efa\u7acb\u957f\u8fde\u63a5\u3002\\n\\n- \u7ba1\u63a7\u7ec4\u4ef6\u5bf9\u8fb9\u7f18\u8282\u70b9\u7684\u8bbf\u95ee\u8bf7\u6c42\u90fd\u5c06\u8f6c\u53d1\u81f4 proxy server\u3002\\n\\n- proxy server \u518d\u5c06\u8bf7\u6c42\u901a\u8fc7\u5bf9\u5e94\u7684\u957f\u8fde\u63a5\u53d1\u5f80\u76ee\u6807\u8282\u70b9\u3002\\n\\n![image](../static/img/blog/proxy_server_agent.png)\\n\u5728 Yurttunnel \u4e2d\uff0c\u6211\u4eec\u9009\u62e9\u4f7f\u7528\u4e0a\u6e38[\u9879\u76eeapiserver-network-proxy(ANP)](https://github.com/kubernetes-sigs/apiserver-network-proxy) \u6765\u5b9e\u73b0server \u548c agent \u95f4\u7684\u901a\u4fe1\u3002ANP \u662f\u57fa\u4e8e kubernetes 1.16 Alpha \u65b0\u529f\u80fd[EgressSelector](https://github.com/kubernetes/kubernetes/blob/master/staging/src/k8s.io/apiserver/pkg/server/egressselector/egress_selector.go) \u5f00\u53d1\uff0c\u610f\u5728\u5b9e\u73b0 Kubernetes \u96c6\u7fa4\u7ec4\u4ef6\u7684\u8de8 intranet \u901a\u4fe1\uff08\u4f8b\u5982\uff0cmaster \u4f4d\u4e8e\u7ba1\u63a7 VPC\uff0c\u800c kubelet \u7b49\u5176\u4ed6\u7ec4\u4ef6\u4f4d\u4e8e\u7528\u6237 VPC\uff09\u3002\\n\\n\\n\u8bfb\u8005\u53ef\u80fd\u4f1a\u597d\u5947\uff0c\u65e2\u7136 OpenYurt \u662f\u57fa\u4e8e ACK@Edge \u5f00\u6e90\u7684\uff0c\u800c\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c ACK@Edge \u7684\u4e91\u8fb9\u8fd0\u7ef4\u901a\u9053\u4f7f\u7528\u7684\u662f\u81ea\u7814\u7ec4\u4ef6 tunnellib\uff0c\u90a3\u4e3a\u4ec0\u4e48\u5728\u5f00\u6e90\u7248\u672c\u91cc\u6211\u4eec\u8981\u9009\u7528\u4e00\u4e2a\u65b0\u7684\u7ec4\u4ef6\u5462\uff1f\u8fd9\u91cc\u4e0d\u5f97\u4e0d\u518d\u6b21\u63d0\u5230 OpenYurt \u7684\u6838\u5fc3\u8bbe\u8ba1\u7406\u5ff5 \u201cExtend upstream Kubernetes to Edge\u201d\u3002\\n\\n\\n\u8bda\u7136\uff0ctunnellib \u7ecf\u8fc7\u4e86\u590d\u6742\u7ebf\u4e0a\u73af\u5883\u7684\u8003\u9a8c\uff0c\u7ec4\u4ef6\u6027\u80fd\u7a33\u5b9a\uff0c\u4f46\u6211\u4eec\u66f4\u5e0c\u671b\u80fd\u4e0e\u4e0a\u6e38\u4fdd\u6301\u6700\u5927\u7684\u6280\u672f\u516c\u7ea6\u6570\uff0c\u8ba9 OpenYurt \u7684\u7528\u6237\u4f53\u9a8c\u66f4\u63a5\u8fd1\u539f\u751f Kubernetes \uff1b\u540c\u65f6\uff0c\u5728 ACK@Edge \u7684\u5f00\u53d1\u548c\u8fd0\u7ef4\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u53d1\u73b0\uff0c\u8fb9\u7f18\u96c6\u7fa4\u7684\u8bb8\u591a\u9700\u6c42\u4e5f\u540c\u6837\u5b58\u5728\u4e8e\u5176\u4ed6\u573a\u666f\u4e2d\uff08\u4f8b\u5982\uff0c\u5927\u591a\u6570\u4e91\u5382\u5546\u4e5f\u9700\u8981\u5b9e\u73b0\u8282\u70b9\u8de8\u7f51\u7edc\u901a\u4fe1\uff09\uff0c\u5e76\u4e14\u8fd0\u7ef4\u901a\u9053\u7684\u4f20\u8f93\u6548\u7387\u4e5f\u80fd\u8fdb\u4e00\u6b65\u4f18\u5316\uff084.5\u7ae0\u5c06\u8be6\u8ff0\u4f18\u5316\u8fc7\u7a0b\uff09\u3002\u56e0\u6b64\uff0c\u79c9\u627f\u5f00\u653e\u5206\u4eab\u3001\u5e73\u7b49\u666e\u60e0\u7684\u5f00\u6e90\u7cbe\u795e\uff0c\u6211\u4eec\u5e0c\u671b\u80fd\u5c06\u5f00\u53d1\u548c\u8fd0\u7ef4\u8fc7\u7a0b\u4e2d\u79ef\u7d2f\u7684\u7684\u5b9d\u8d35\u7ecf\u9a8c\u5728\u4e0a\u6e38\u793e\u533a\u4e0e\u66f4\u591a\u7684\u5f00\u53d1\u8005\u5206\u4eab\u3002\\n\\n\\n## ANP\u5e76\u975e\u5f00\u7bb1\u5373\u7528\\n\\n\u7136\u800c ANP \u9879\u76ee\u4ecd\u5904\u4e8e\u8d77\u6b65\u9636\u6bb5\uff0c\u529f\u80fd\u5c1a\u672a\u5b8c\u5584\uff0c\u8bb8\u591a\u95ee\u9898\u4ecd\u6709\u5f85\u89e3\u51b3\u3002\u6211\u4eec\u4ece\u5b9e\u8df5\u4e2d\u53d1\u73b0\u7684\u4e3b\u8981\u95ee\u9898\u5305\u62ec\uff1a\\n\\n- \u5982\u4f55\u8f6c\u53d1\u4e91\u7aef\u8282\u70b9\u7684\u8bf7\u6c42 -- \u53cd\u5411\u901a\u9053\u6b63\u5e38\u5de5\u4f5c\u7684\u4e00\u4e2a\u524d\u63d0\u662f\uff0c\u7ba1\u63a7\u8282\u70b9\u53d1\u5f80\u8fb9\u7f18\u8282\u70b9\u7684\u8bf7\u6c42\u5fc5\u987b\u5148\u7ecf\u8fc7 proxy server\u3002\u5bf9\u4e8e Kubernetes 1.16 + \u7248\u672c\uff0cKAS \u80fd\u501f\u7531 EgressSelector \u5c06\u53d1\u5f80\u8282\u70b9\u7684\u8bf7\u6c42\u5148\u53d1\u5f80\u6307\u5b9a\u7684 proxy server\u3002\u4f46\u5bf9\u4e8e 1.16 \u4ee5\u524d\u7684\u7248\u672c\uff0cKAS \u53ca\u5176\u4ed6\u7ba1\u63a7\u7ec4\u4ef6\uff08Prometheus \u548c metrics server\uff09\u53ea\u80fd\u76f4\u63a5\u8bbf\u95ee\u8282\u70b9\uff0c\u800c\u4e0d\u80fd\u7ed5\u9053 proxy server\u3002\u53ef\u4ee5\u9884\u89c1\u7684\u662f\uff0c\u90e8\u5206\u7528\u6237\u5728\u77ed\u671f\u5185\uff0c\u4ecd\u5c06\u4f7f\u7528 1.16 \u4ee5\u524d\u7684\u7248\u672c\uff0c\u5e76\u4e14 Prometheus \u548c metrics server \u7b49\u7ba1\u63a7\u7ec4\u4ef6\u5728\u77ed\u671f\u5185\u4e5f\u6ca1\u6709\u652f\u6301 EgressSelector \u7684\u8ba1\u5212\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u8981\u89e3\u51b3\u7684\u7b2c\u4e00\u4e2a\u95ee\u9898\u662f\uff0c\u5982\u4f55\u5c06\u7ba1\u63a7\u7ec4\u4ef6\u53d1\u5f80\u8282\u70b9\u7684\u8bf7\u6c42\u8f6c\u53d1\u81f4 proxy server\u3002\\n\\n- \u5982\u4f55\u786e\u4fdd server \u526f\u672c\u8986\u76d6\u6240\u6709\u7684 region -- \u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u4e00\u4e2a\u8fb9\u7f18\u96c6\u7fa4\u5e38\u5e38\u5305\u542b\u4e0a\u4e07\u4e2a\u8282\u70b9\uff0c\u5e76\u540c\u65f6\u670d\u52a1\u4e0a\u767e\u540d\u7528\u6237\uff0c\u5982\u679c\u4e00\u4e2a\u96c6\u7fa4\u53ea\u6709\u4e00\u4e2a proxy server\uff0c \u90a3\u4e48\uff0c\u4e00\u65e6 proxy server \u51fa\u73b0\u6545\u969c\uff0c\u6240\u6709\u7528\u6237\u90fd\u5c06\u65e0\u6cd5\u5bf9\u4f4d\u4e8e\u8fb9\u7f18\u8282\u70b9\u4e0a\u7684 pod \u8fdb\u884c\u64cd\u4f5c\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u5fc5\u987b\u540c\u65f6\u90e8\u7f72\u591a\u4e2a proxy server \u526f\u672c\u4ee5\u4fdd\u8bc1\u96c6\u7fa4\u9ad8\u53ef\u7528\u3002\u540c\u65f6\uff0cproxy server \u7684\u5de5\u4f5c\u8d1f\u8377\u5c06\u968f\u7740\u8bbf\u95ee\u6d41\u91cf\u7684\u589e\u5927\u800c\u589e\u5927\uff0c\u7528\u6237\u7684\u8bbf\u95ee\u5ef6\u65f6\u4e5f\u52bf\u5fc5\u589e\u52a0\u3002\u56e0\u6b64\u5728\u90e8\u7f72 proxy server \u65f6\uff0c\u6211\u4eec\u8fd8\u9700\u8003\u8651\u5982\u4f55\u5bf9 proxy server \u8fdb\u884c\u6c34\u5e73\u62d3\u5c55\uff0c\u4ee5\u5e94\u5bf9\u9ad8\u5e76\u53d1\u573a\u666f\u3002\u4e00\u4e2a\u5e94\u5bf9\u5355\u70b9\u6545\u969c\u548c\u9ad8\u5e76\u53d1\u573a\u666f\u7684\u7ecf\u5178\u89e3\u51b3\u65b9\u6848\u662f\uff0c\u90e8\u7f72\u591a\u4e2a proxy server \u526f\u672c\uff0c\u5e76\u4f7f\u7528\u8d1f\u8f7d\u5747\u8861\u8fdb\u884c\u6d41\u91cf\u5206\u53d1\u3002\u7136\u800c\u5728 OpenYurt \u573a\u666f\u4e0b\uff0c\u5bf9\u4e8e KAS \u53d1\u6765\u7684\u4efb\u610f\u8bf7\u6c42\uff0cLoadBalancer (LB) \u4f1a\u8f6c\u53d1\u7ed9\u54ea\u4e2a server \u526f\u672c\u662f\u4e0d\u53ef\u63a7\u7684\uff0c\u56e0\u6b64\uff0c\u9700\u8981\u89e3\u51b3\u7684\u7b2c\u4e8c\u4e2a\u95ee\u9898\u662f\uff0c\u5982\u4f55\u4fdd\u8bc1\u6bcf\u4e2a server \u526f\u672c\u90fd\u80fd\u4e0e\u6240\u6709\u7684 agent \u5efa\u7acb\u8fde\u63a5\u3002\\n\\n- \u5982\u4f55\u5c06\u8bf7\u6c42\u8f6c\u53d1\u7ed9\u6b63\u786e\u7684 agent -- \u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\uff0cproxy server \u5728\u6536\u5230\u8bf7\u6c42\u540e\uff0c\u9700\u6839\u636e\u8bf7\u6c42\u7684 destination IP\uff0c\u5c06\u8bf7\u6c42\u8f6c\u53d1\u81f3\u4f4d\u4e8e\u5bf9\u5e94 network region \u5185\u7684 agent\u3002\u7136\u800c\uff0cANP\u76ee\u524d\u7684\u5b9e\u73b0\uff0c\u5047\u8bbe\u6240\u6709\u7684\u8282\u70b9\u90fd\u4f4d\u4e8e\u4e00\u4e2a\u7f51\u7edc\u7a7a\u95f4\u5185\uff0c server \u4f1a\u968f\u673a\u6311\u9009\u4e00\u4e2a agent \u8f6c\u53d1\u8bf7\u6c42\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u9700\u8981\u89e3\u51b3\u7684\u7b2c\u4e09\u4e2a\u95ee\u9898\u662f\uff0c\u5982\u4f55\u5c06\u8bf7\u6c42\u6b63\u786e\u5730\u8f6c\u53d1\u7ed9\u6307\u5b9a\u7684 agent\u3002 \\n\\n- \u5982\u4f55\u89e3\u9664\u7ec4\u4ef6\u5bf9\u8282\u70b9\u8bc1\u4e66\u7684\u4f9d\u8d56 -- \u5728\u8fd0\u884c\u65f6\uff0c\u6211\u4eec\u9700\u8981\u4e3a server \u63d0\u4f9b\u4e00\u5957 TLS \u8bc1\u4e66\uff0c\u4ee5\u5b9e\u73b0 server \u4e0e KAS\uff0cserver \u4e0e agent \u95f4\u7684\u5b89\u5168\u901a\u4fe1\u3002\u540c\u65f6\uff0c\u6211\u4eec\u4e5f\u9700\u8981\u4e3a agent \u51c6\u5907\u4e00\u5957 TLS client \u8bc1\u4e66\uff0c\u7528\u4ee5\u5efa\u7acb agent \u548c server \u95f4\u7684 gRPC \u4fe1\u9053\u3002ANP \u76ee\u524d\u7684\u5b9e\u73b0\uff0c\u8981\u6c42 server \u5fc5\u987b\u548c KAS \u90e8\u7f72\u5728\u540c\u4e00\u4e2a\u8282\u70b9\u4e0a\uff0c\u5e76\u4e14\u5728\u542f\u52a8\u65f6\u6302\u8f7d\u8282\u70b9 volume \u5171\u4eab KAS tls \u8bc1\u4e66\u3002\u540c\u6837\uff0cagent \u4e5f\u9700\u8981\u5728\u542f\u52a8\u65f6\u6302\u8f7d volume \u5171\u4eab kubelet tls \u8bc1\u4e66\u3002\u8fd9\u65e0\u5f62\u4e2d\u964d\u4f4e\u4e86\u90e8\u7f72\u7684\u7075\u6d3b\u6027\uff0c\u9020\u6210\u4e86\u7ec4\u4ef6\u5bf9\u8282\u70b9\u8bc1\u4e66\u7684\u5f3a\u4f9d\u8d56\uff0c\u5728\u6709\u4e9b\u60c5\u51b5\u4e0b\uff0c\u7528\u6237\u53ef\u80fd\u5e0c\u671b\u5c06 server \u90e8\u7f72\u5728\u975e KAS \u6240\u5728\u8282\u70b9\u4e0a\u3002\u56e0\u6b64\uff0c\u53e6\u4e00\u4e2a\u9700\u8981\u5173\u6ce8\u7684\u95ee\u9898\u662f\uff0c\u5982\u4f55\u89e3\u9664\u7ec4\u4ef6\u5bf9\u8282\u70b9\u8bc1\u4e66\u7684\u4f9d\u8d56\u3002\\n\\n\\n- \u5982\u4f55\u7f29\u5c0f Tunnel \u5e26\u5bbd -- ANP \u7684\u4e00\u4e2a\u6838\u5fc3\u8bbe\u8ba1\u601d\u60f3\uff0c\u662f\u4f7f\u7528 gRPC \u5c01\u88c5 KAS \u6240\u6709\u5bf9\u5916 HTTP \u8bf7\u6c42\u3002\u8fd9\u91cc\u9009\u62e9 gRPC\uff0c\u4e3b\u8981\u662f\u770b\u91cd\u5176\u5bf9\u6d41\uff08stream\uff09\u7684\u652f\u6301\u548c\u6e05\u6670\u7684\u63a5\u53e3\u89c4\u8303\uff0c\u6b64\u5916\uff0c\u5f3a\u7c7b\u578b\u7684\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u53ef\u4ee5\u6709\u6548\u51cf\u5c11\u8fd0\u884c\u65f6\u9519\u8bef\uff0c\u63d0\u9ad8\u7cfb\u7edf\u7a33\u5b9a\u6027\u3002\u7136\u800c\uff0c\u6211\u4eec\u4e5f\u53d1\u73b0\uff0c\u76f8\u8f83\u4e8e\u76f4\u63a5\u4f7f\u7528 TCP \u534f\u8bae\uff0c\u91c7\u7528 ANP \u4e5f\u4f1a\u5e26\u6765\u989d\u5916\u7684\u5f00\u9500\u589e\u52a0\u5e26\u5bbd\u3002\u4ece\u4ea7\u54c1\u5c42\u9762\u8003\u8651\uff0cTunnel \u6d41\u91cf\u8d70\u7684\u662f\u516c\u7f51\uff0c\u5e26\u5bbd\u7684\u589e\u52a0\u4e5f\u610f\u5473\u7740\u7528\u6237\u6210\u672c\u7684\u589e\u52a0\u3002\u56e0\u6b64\uff0c\u4e00\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u95ee\u9898\u662f\uff0c\u5728\u63d0\u9ad8\u7cfb\u7edf\u7a33\u5b9a\u6027\u7684\u540c\u65f6\uff0c\u6211\u4eec\u662f\u5426\u4e5f\u80fd\u7f29\u5c0f\u5e26\u5bbd\uff1f \\n\\n\\n## Yurttunnel\u8bbe\u8ba1\u89e3\u6790\\n### 1.\u5236\u5b9aDNAT\u89c4\u5219\u8f6c\u53d1\u4e91\u7aef\u8282\u70b9\u7684\u8bf7\u6c42\\n\\n\u5982\u524d\u6587\u6240\u8ff0\uff0cANP \u662f\u57fa\u4e8e\u4e0a\u6e38\u65b0\u529f\u80fd EgressSelector \u5f00\u53d1\u7684\uff0c\u8be5\u529f\u80fd\u5141\u8bb8\u7528\u6237\u5728\u542f\u52a8 KAS \u65f6\u901a\u8fc7\u4f20\u5165 egress configuration \u6765\u8981\u6c42 KAS \u5c06 egress \u8bf7\u6c42\u8f6c\u53d1\u5230\u6307\u5b9a\u7684 proxy server\u3002\u4f46\u7531\u4e8e\u6211\u4eec\u9700\u8981\u517c\u987e\u65b0\u8001\u7248\u672c\u7684 Kubernetes \u96c6\u7fa4\uff0c\u5e76\u4e14\u8003\u8651\u5230\uff0c\u5176\u4ed6\u7ba1\u63a7\u7ec4\u4ef6\uff08Prometheus \u548c metric server\uff09\u5e76\u4e0d\u652f\u6301 EgressSelector \u7279\u6027\uff0c\u6211\u4eec\u9700\u8981\u4fdd\u8bc1\u5728\u65e0\u6cd5\u4f7f\u7528 EgressSelector \u7684\u60c5\u51b5\u4e0b\u4e5f\u80fd\u5c06 KAS egress \u8bf7\u6c42\u8f6c\u53d1\u81f4 proxy server\u3002\u4e3a\u6b64\uff0c\u6211\u4eec\u5728\u6bcf\u4e00\u4e2a\u4e91\u7aef\u7ba1\u63a7\u8282\u70b9\u4e0a\u90fd\u90e8\u7f72\u4e00\u4e2a Yurttunnel Server \u526f\u672c\uff0c\u5e76\u5728 Server \u4e2d\u5185\u5d4c\u4e00\u4e2a\u65b0\u7ec4\u4ef6 Iptabel Manager\u3002Iptable Manager \u4f1a\u901a\u8fc7\u5728\u5bbf\u4e3b\u673a\u7684 Iptable \u4e2d\u7684 OUTPUT \u94fe\u4e2d\u6dfb\u52a0 DNAT \u89c4\u5219\uff0c\u5c06\u7ba1\u63a7\u7ec4\u4ef6\u5bf9\u8282\u70b9\u7684\u8bf7\u6c42\u8f6c\u53d1\u81f4 Yurttunnel Server\u3002\\n\\n\u540c\u65f6\uff0c\u5f53\u542f\u7528 EgressSelector \u540e\uff0cKAS \u5bf9\u5916\u8bf7\u6c42\u90fd\u9075\u5faa\u4e00\u4e2a\u7edf\u4e00\u7684\u683c\u5f0f\uff0c\u56e0\u6b64\u6211\u4eec\u65b0\u589e\u4e00\u4e2a\u7ec4\u4ef6\uff0c ANP interceptor\u3002ANP interceptor \u4f1a\u8d1f\u8d23\u622a\u53d6\u4ece master \u53d1\u6765\u7684 http \u8bf7\u6c42\uff0c\u5e76\u5c06\u5176\u5c01\u88c5\u6210 EgressSelector \u683c\u5f0f\u3002Yurttunnel \u8bf7\u6c42\u8f6c\u53d1\u7684\u5177\u4f53\u6d41\u7a0b\u89c1\u56fe\u4e09\u3002\\n![image](../static/img/blog/yurttunnel.png)\\n\\n\\n### 2.\u52a8\u6001\u83b7\u53d6Server\u526f\u672c\u6570\\n\u5728\u4e0a\u4e00\u8282\u4e2d\uff0c\u6211\u4eec\u63d0\u5230\uff0c\u6211\u4eec\u5c06\u91c7\u7528\u8d1f\u8f7d\u5747\u8861\u7684\u65b9\u5f0f\u6765\u7ba1\u7406yurttunnel server\uff0c\u6240\u6709\u7684ingress\u8bf7\u6c42\u90fd\u4f1a\u901a\u8fc7LB\u5206\u53d1\u7ed9\u4e00\u4e2aserver\u526f\u672c\u3002\u7531\u4e8e\u6211\u4eec\u65e0\u6cd5\u9884\u6d4bLB\u4f1a\u6311\u9009\u54ea\u4e2aserver\u526f\u672c\uff0c\u6211\u4eec\u5fc5\u987b\u4fdd\u8bc1\u6bcf\u4e2a server \u526f\u672c\u90fd\u8981\u4e0e\u6240\u6709\u7684 agent \u5efa\u7acb\u8fde\u63a5\u3002\u8fd9\u91cc\uff0c\u6211\u4eec\u5c06\u4f7f\u7528 ANP \u81ea\u5e26\u7684\u529f\u80fd\u5b9e\u73b0\u8fd9\u4e00\u9700\u6c42\uff0c\u5177\u4f53\u6d41\u7a0b\u5982\u4e0b\uff1a\\n\\n- \u5728\u542f\u52a8 yurttunnel server \u65f6\uff0c\u6211\u4eec\u4f1a\u5c06\u526f\u672c\u6570\uff08serverCount\uff09\u4f20\u5165\u6bcf\u4e2a server \u526f\u672c\u4e2d\uff0c\u5e76\u4e14\u4e3a\u6bcf\u4e2a\u526f\u672c\u6307\u5b9a\u4e00\u4e2a server ID\uff1b\\n\\n- agent \u8fde\u63a5 LB \u540e\uff0cLB\u4f1a\u968f\u673a\u9009\u62e9\u4e00\u4e2a server \u526f\u672c\u5e76\u8ba9\u5176\u4e0e agent \u5efa\u7acb\u957f\u8fde\u63a5\uff1b\\n\\n- \u4e0e\u6b64\u540c\u65f6\uff0cserver \u4f1a\u901a\u8fc7\u8be5\u901a\u9053\u5411 agent \u8fd4\u56de\u4e00\u4e2a ACK package\uff0c\u8fd9\u4e2a package \u4e2d\u5c06\u5305\u542b serverCount \u548c serverID\uff1b\\n\\n- agent \u901a\u8fc7\u89e3\u6790 ACK package\uff0c\u53ef\u4ee5\u83b7\u6089 server \u526f\u672c\u7684\u4e2a\u6570\uff0c\u5e76\u5728\u672c\u5730\u8bb0\u5f55\u5df2\u8fde\u63a5\u7684 serverID\uff1b\\n\\n- \u5982\u679c agent \u53d1\u73b0\uff0c\u672c\u5730\u8fde\u63a5\u7684 server \u526f\u672c\u6570\u5c0f\u4e8e serverCount\uff0c\u5219\u4f1a\u518d\u6b21\u5411 LB \u53d1\u9001\u8fde\u63a5\u8bf7\u6c42\uff0c\u76f4\u81f3\u672c\u5730\u8bb0\u5f55\u7684 serverID \u6570\u4e0e server Count \u6570\u4e00\u81f4\u4e3a\u6b62\u3002\\n\\n\u8be5\u673a\u5236\u867d\u7136\u5e2e\u52a9\u6211\u4eec\u5b9e\u73b0\u4e86server\u526f\u672c\u7684\u5168\u7f51\u6bb5\u8986\u76d6\u3002\u4f46\u540c\u65f6\uff0c\u4e5f\u5b58\u5728\u4e0d\u53ef\u5ffd\u89c6\u7684\u7f3a\u70b9\uff0c\u7531\u4e8e agent \u65e0\u6cd5\u9009\u62e9\u4e0e\u54ea\u4e2a server \u526f\u672c\u5efa\u7acb\u8fde\u63a5\uff0c\u56e0\u6b64\uff0c\u4e3a\u4e86\u8fde\u63a5\u6240\u6709\u7684 server \u526f\u672c\uff0cagent \u5fc5\u987b\u53cd\u590d\u8bbf\u95ee LB\u3002\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0cserver \u7531\u4e8e\u8fd8\u6ca1\u6709\u4e0e\u6240\u6709\u7684 agent \u5efa\u7acb\u8fde\u63a5\uff0cKAS \u53d1\u6765\u7684\u8bf7\u6c42\u53ef\u80fd\u65e0\u6cd5\u8f6c\u53d1\u81f3\u5bf9\u5e94\u7684\u8282\u70b9\u3002\u4e00\u4e2a\u6f5c\u5728\u7684\u89e3\u51b3\u65b9\u6848\u662f\uff0c\u4e3a\u6bcf\u4e2a server\u526f\u672c\u521b\u5efa\u4e00\u4e2a\u72ec\u7acb\u7684 LB\uff0c\u8d1f\u8d23\u4e0e agent \u4e4b\u95f4\u7684\u8fde\u63a5\uff0c\u540c\u65f6\u5728agent\u7aef\u8bb0\u5f55\u6240\u6709 server\u526f\u672c\u5bf9\u5e94 LB \u7684\u4fe1\u606f\uff0c\u8fd9\u4e00\u65b9\u6848\u80fd\u5e2e\u52a9 agent \u5feb\u901f\u5730\u4e0e\u6240\u6709\u7684 server \u526f\u672c\u5efa\u7acb\u8fde\u63a5\u3002\u8be5\u65b9\u6848\u7684\u5177\u4f53\u5b9e\u73b0\u7ec6\u8282\uff0c\u76ee\u524d\u4ecd\u5728\u4e0e\u4e0a\u6e38\u793e\u533a\u7684\u5f00\u53d1\u8005\u8ba8\u8bba\u4e2d\u3002\\n\\n### 3.\u4e3aANP\u6dfb\u52a0\u4ee3\u7406\u7b56\u7565\\n\\n\u5728OpenYurt\u7684\u7f51\u7edc\u6a21\u578b\u4e0b\uff0c\u8fb9\u7f18\u8282\u70b9\u5206\u5e03\u5728\u4e0d\u540c\u7684network region\u4e2d\uff0c\u968f\u673a\u9009\u62e9\u7684 agent \u53ef\u80fd\u65e0\u6cd5\u5c06\u8bf7\u6c42\u8f6c\u53d1\u81f3\u4f4d\u4e8e\u5176\u4ed6 region \u5185\u7684\u8282\u70b9\u4e0a\u3002\u56e0\u6b64\u6211\u4eec\u4e0d\u5f97\u4e0d\u4fee\u6539 ANP server \u5e95\u5c42\u4ee3\u7406\u8f6c\u53d1\u7684\u903b\u8f91\u3002\u7136\u800c\uff0c\u6839\u636e\u957f\u671f\u7684\u7ecf\u9a8c\uff0c\u6211\u4eec\u76f8\u4fe1\uff0cproxy server \u652f\u6301\u4e0d\u540c\u7684\u4ee3\u7406\u7b56\u7565\uff0c\u4f8b\u5982\uff0c\u5c06\u8bf7\u6c42\u8f6c\u53d1\u81f3\u6307\u5b9a\u6570\u636e\u4e2d\u5fc3\uff0cregion\uff0c\u6216\u8005\u6307\u5b9a\u4e3b\u673a\uff0c\u662f\u4e00\u4e2a\u8f83\u4e3a\u901a\u7528\u7684\u9700\u6c42\u3002\u7ecf\u8fc7\u548c ANP \u793e\u533a\u5f00\u53d1\u8005\u8ba8\u8bba\uff0c\u6211\u4eec\u51b3\u5b9a\u91cd\u6784 ANP \u7ba1\u7406 agent \u8fde\u63a5\u7684\u63a5\u53e3\uff0c\u5141\u8bb8\u7528\u6237\u6839\u636e\u9700\u6c42\u5b9e\u73b0\u65b0\u7684\u4ee3\u7406\u7b56\u7565\uff0c\u5e76\u8ba1\u5212\u5c06\u8be5 feature \u6700\u7ec8\u5408\u5165\u4e0a\u6e38\u4ee3\u7801\u5e93\u3002\u76ee\u524d\u91cd\u6784\u5de5\u4f5c\u4ecd\u5728\u8fdb\u884c\u4e2d\uff0c\u5728 Yurttunnel \u7b2c\u4e00\u4e2a\u5f00\u6e90\u7248\u672c\u4e2d\uff0c\u6211\u4eec\u6682\u65f6\u91c7\u7528\u4ee5\u4e0b\u914d\u7f6e\uff1a\\n\\n- \u5728\u6bcf\u4e2a\u8fb9\u7f18\u8282\u70b9\u4e0a\u90e8\u7f72\u4e00\u4e2a agent\u3002\\n\\n- agent \u5728 server \u5904\u767b\u8bb0\u65f6\uff0c\u4f7f\u7528 agent \u6240\u5728\u8282\u70b9\u7684 IP \u4f5c\u4e3a agentID\u3002\\n\\n- server \u5728\u8f6c\u53d1\u8bf7\u6c42\u65f6\uff0c\u901a\u8fc7\u5339\u914d\u8bf7\u6c42\u76ee\u6807 IP \u548c agentID\uff0c\u5c06\u8bf7\u6c42\u8f6c\u53d1\u81f3\u5bf9\u5e94\u7684 agent\u3002\\n\\n\\n\u6211\u4eec\u8ba1\u5212\u5728OpenYurt\u540e\u7eed\u53d1\u5e03Yurt Unit\uff08\u8fb9\u7f18\u8282\u70b9\u5206\u533a\u7ba1\u63a7\uff09\u4e4b\u540e\uff0c\u914d\u5408\u65b0\u589e\u7684ANP\u4ee3\u7406\u8f6c\u53d1\u7b56\u7565\uff0c\u5b9e\u73b0agent\u7684\u5206\u533a\u90e8\u7f72\uff0c\u548c\u8bf7\u6c42\u7684\u5206\u533a\u8f6c\u53d1\u3002\\n\\n\\n### 4.\u52a8\u6001\u7533\u8bf7\u5b89\u5168\u8bc1\u4e66\\n\u4e3a\u4e86\u89e3\u9664yurttunnel\u7ec4\u4ef6\u5bf9\u8282\u70b9\u8bc1\u4e66\u7684\u4f9d\u8d56\uff0c\u6211\u4eec\u5728yurttunnel\u4e2d\u65b0\u589ecert manager\u7ec4\u4ef6\uff0ccert manager\u4f1a\u5728server\u548cagent\u8fd0\u884c\u540e\uff0c\u5411KAS\u63d0\u4ea4certificate signning request(CSR)\u3002server \u5c06\u4f7f\u7528\u7533\u8bf7\u5230\u7684\u8bc1\u4e66\u6765\u786e\u4fdd\u5176\u4e0e KAS \u548c agent \u95f4\u7684\u5b89\u5168\u901a\u4fe1\uff0cagent \u4f1a\u4f7f\u7528\u7533\u8bf7\u5230\u7684\u8bc1\u4e66\u786e\u4fdd\u5176\u4e0e server \u95f4 gRPC \u4fe1\u9053\u7684\u5b89\u5168\u3002\u7531\u4e8e agent \u548c kubelet \u95f4\u662f\u901a\u8fc7 tcp \u534f\u8bae\u8fde\u63a5\uff0c\u56e0\u6b64\uff0c\u6211\u4eec\u65e0\u9700\u4e3a agent \u548c kubelet \u95f4\u7684\u8fde\u63a5\u51c6\u5907\u8bc1\u4e66\u3002\\n\\n### 5.\u538b\u7f29Tunnel\u5e26\u5bbd\uff0c\u8282\u7ea6\u6210\u672c\\n\u5728\u4e0a\u6587\uff0c\u6211\u4eec\u63d0\u5230\uff0c\u4f7f\u7528gRPC\u5c01\u88c5Tunnel\u867d\u7136\u53ef\u4ee5\u63d0\u9ad8\u4f20\u8f93\u7a33\u5b9a\u6027\uff0c\u4f46\u540c\u65f6\u4e5f\u4f1a\u589e\u52a0\u516c\u7f51\u6d41\u91cf\u3002\u8fd9\u662f\u5426\u610f\u5473\u7740\u7a33\u5b9a\u6027\u548c\u6027\u80fd\uff0c\u6211\u4eec\u53ea\u80fd\u4e8c\u9009\u4e00\uff1f\u901a\u8fc7\u5bf9\u4e0d\u540c\u7528\u6237\u573a\u666f\u7684\u5206\u6790\uff0c\u6211\u4eec\u53d1\u73b0\uff0c\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u7528\u6237\u4f7f\u7528\u8fd0\u7ef4\u901a\u9053\u662f\u4e3a\u4e86\u83b7\u53d6\u5bb9\u5668\u65e5\u5fd7\uff08\u5373 kubectl log\uff09\uff0c\u800c\u4f20\u7edf\u65e5\u5fd7\u6587\u4ef6\uff0c\u5b58\u5728\u8bb8\u591a\u76f8\u540c\u7684\u6587\u672c\u4fe1\u606f\uff0c\u56e0\u6b64\u6211\u4eec\u63a8\u65ad\u4f7f\u7528 gzip \u7b49\u538b\u7f29\u7b97\u6cd5\u80fd\u6709\u6548\u7f29\u5c0f\u5e26\u5bbd\u3002\u4e3a\u4e86\u9a8c\u8bc1\u8fd9\u4e00\u5047\u8bbe\uff0c\u6211\u4eec\u5728 ANP \u5e95\u5c42\u7684 gRPC \u5e93\u4e2d\u6dfb\u52a0\u4e86 gzip compressor\uff0c\u5e76\u4e14\u5bf9\u6bd4\u4e86\u4e0e\u4f7f\u7528\u539f\u751f TCP \u8fde\u63a5\u573a\u666f\u4e0b\u7684\u6570\u636e\u4f20\u8f93\u91cf\u3002\\n\\n\u6211\u4eec\u8003\u8651\u7684\u7b2c\u4e00\u4e2a\u5b9e\u9a8c\u573a\u666f\u662f\uff0c\u5206\u522b\u901a\u8fc7 TCP \u8fde\u63a5\u548c ANP \u83b7\u53d6\u540c\u4e00 kubeproxy \u5bb9\u5668\u7684\u65e5\u5fd7\uff0c\u6211\u4eec\u622a\u53d6\u4e86\u8fd9\u4e00\u8fc7\u7a0b\u4e2d Tunnel \u4e0a\u53cc\u5411 package \u548c bytes \u603b\u91cf\u3002\\n\\n![image](../static/img/blog/kube_proxy.png)\\n\\n\u5982\u4e0a\u8868\u6240\u793a\uff0c\u901a\u8fc7\u4f7f\u7528 ANP\uff0c \u603b\u4f20\u8f93\u6570\u636e\u91cf\u4e0b\u964d\u4e86 29.93%\u3002\\n\\n\u7ecf\u8fc7\u957f\u65f6\u95f4\u8fd0\u884c\uff0c\u5bb9\u5668\u7684\u65e5\u5fd7\u6587\u672c\u5e38\u5e38\u53ef\u4ee5\u8fbe\u5230\u5341\u51e0\u5146\uff0c\u4e3a\u4e86\u6a21\u62df\u83b7\u53d6\u5927\u6587\u672c\u65e5\u5fd7\u7684\u573a\u666f\u3002\u6211\u4eec\u521b\u5efa\u4e86\u4e00\u5305\u542b 10.5M systemd log\uff08\u5373 journalctl\uff09\u7684 ubuntu \u5bb9\u5668\uff0c\u540c\u6837\u6211\u4eec\u5206\u522b\u4f7f\u7528\u539f\u751f TCP \u8fde\u63a5\u548c ANP \u4f20\u8f93\u8be5\u65e5\u5fd7\u6587\u4ef6\uff0c\u5e76\u6d4b\u91cf\u4e86 Tunnel \u4e0a\u7684\u6570\u636e\u603b\u91cf\\n![image](../static/img/blog/large_log.png)\\n\\n\u5982\u4e0a\u8868\u6240\u793a\uff0c\u5728\u65e5\u5fd7\u6587\u672c\u8f83\u5927\u7684\u60c5\u51b5\u4e0b\uff0c\u901a\u8fc7\u4f7f\u7528 ANP\uff0c \u603b\u4f20\u8f93\u6570\u636e\u91cf\u4e0b\u964d\u4e86 40.85%\u3002\\n\\n\u7531\u6b64\u53ef\u89c1\uff0c\u76f8\u8f83\u4e8e\u539f\u751f TCP \u8fde\u63a5\uff0cANP \u4e0d\u4ec5\u80fd\u63d0\u4f9b\u66f4\u9ad8\u7684\u4f20\u8f93\u7a33\u5b9a\u6027\uff0c\u8fd8\u53ef\u4ee5\u5927\u5e45\u964d\u4f4e\u516c\u7f51\u6d41\u91cf\u3002\u8003\u8651\u5230\u8fb9\u7f18\u96c6\u7fa4\u52a8\u8f84\u4e0a\u4e07\u7684\u8282\u70b9\u89c4\u6a21\uff0c\u65b0\u7684\u89e3\u51b3\u65b9\u6848\u5c06\u5e2e\u52a9\u7528\u6237\u5728\u516c\u7f51\u6d41\u91cf\u65b9\u9762\u8282\u7ea6\u5927\u91cf\u5f00\u9500\u3002\\n\\n##Yurttunnel\u7cfb\u7edf\u67b6\u6784\\n![image](../static/img/blog/Yurttunnel_arch.png)\\n\\n\u7efc\u4e0a\uff0cYurttunnel \u4e3b\u8981\u5305\u542b\u4ee5\u4e0b\u7ec4\u4ef6\uff1a\\n\\n- Yurttunnel Server - \u8d1f\u8d23\u5c06 apiserver\uff0cprometheus\uff0cmetrics server \u7b49\u7ba1\u63a7\u7ec4\u4ef6\u53d1\u5f80\u8282\u70b9\u7684\u8bf7\u6c42\uff0c\u8f6c\u53d1\u81f3\u5bf9\u5e94\u7684 agent\u3002\u5177\u4f53\u5305\u62ec\u4ee5\u4e0b\u5b50\u7ec4\u4ef6\uff1a\\n\\n  - ANP Proxy Server - \u5bf9 ANP gRPC server \u7684\u5c01\u88c5\uff0c\u8d1f\u8d23\u7ba1\u7406\u4e0e Yurttunnel Agent \u4e4b\u95f4\u7684\u957f\u8fde\u63a5\uff0c\u5e76\u8f6c\u53d1\u8bf7\u6c42\u3002\\n  - Iptable Manager - \u4fee\u6539\u7ba1\u63a7\u8282\u70b9\u7684 DNAT \u89c4\u5219\uff0c\u4ee5\u786e\u4fdd\u7ba1\u63a7\u7ec4\u4ef6\u7684\u8bf7\u6c42\u80fd\u88ab\u8f6c\u53d1\u81f3 Yurttunnel Server\u3002\\n  - Cert Manager - \u4e3a Yurttunnel Server \u751f\u6210 TLS \u8bc1\u4e66\u3002\\n  - Request Interceptor - \u5c06 KAS \u5bf9\u8282\u70b9\u7684 HTTP \u8bf7\u6c42\u5c01\u88c5\u5230\u7b26\u5408 ANP \u89c4\u5219\u7684 gRPC \u5305\u91cc\u3002\\n\\n- Yurttunnel Agent - \u4e0e Yurttunnel Server \u4e3b\u52a8\u5efa\u7acb\u8fde\u63a5\uff0c\u5e76\u5c06 Yurttunnel Server \u53d1\u6765\u7684\u8bf7\u6c42\u8f6c\u53d1\u7ed9 Kubelet\u3002\u5177\u4f53\u5305\u62ec\u4e24\u4e2a\u5b50\u7ec4\u4ef6\uff1a\\n  - ANP Proxy Agent - \u5bf9 ANP gRPC agent \u7684\u5c01\u88c5\uff0c\u76f8\u8f83\u4e8e\u4e0a\u6e38\uff0c\u6211\u4eec\u989d\u5916\u52a0\u5165\u4e86 gzip compressor \u4ee5\u538b\u7f29\u6570\u636e\u3002\\n  - Cert Manager - \u4e3a Yurttunnel Agent \u751f\u6210 TLS \u8bc1\u4e66\u3002\\n\\n- Yurttunnel Server Service - \u901a\u5e38\u662f\u4e00\u4e2a SLB\uff0c\u8d1f\u8d23\u5c06\u7ba1\u63a7\u7ec4\u4ef6\u53d1\u6765\u7684\u8bf7\u6c42\u5206\u53d1\u7ed9\u5408\u9002\u7684 Yurttunnel Server \u526f\u672c\uff0c\u4fdd\u8bc1 Yurttunnel \u7684\u9ad8\u53ef\u7528\u548c\u8d1f\u8f7d\u5747\u8861\u3002\\n\\n\\n## \u603b\u7ed3\u548c\u5c55\u671b\\nYurttunnel \u4f5c\u4e3a OpenYurt \u8fd1\u671f\u5f00\u6e90\u7684\u91cd\u8981\u7ec4\u4ef6\uff0c\u6253\u901a\u4e86 OpenYurt \u96c6\u7fa4\u7684\u4e91\u8fb9\u901a\u9053\uff0c\u4e3a\u8fb9\u7f18\u96c6\u7fa4\u4e0a\u7684\u5bb9\u5668\u8fd0\u7ef4\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7edf\u4e00\u7684\u5165\u53e3\u3002\u901a\u8fc7\u5bf9\u4e0a\u6e38\u89e3\u51b3\u65b9\u6848\u8fdb\u884c\u6539\u9020\uff0cYurttunnel \u4e0d\u4ec5\u63d0\u4f9b\u4e86\u66f4\u9ad8\u7684\u4f20\u8f93\u7a33\u5b9a\u6027\uff0c\u4e5f\u5927\u5e45\u964d\u4f4e\u4e86\u6570\u636e\u4f20\u8f93\u91cf\u3002\\n\\n[\u539f\u6587\u94fe\u63a5](https://mp.weixin.qq.com/s/nRUv4u9JbiIdrUPB_cZOBg)"},{"id":"Expansion-capability-of-Yurthub","metadata":{"permalink":"/blog/Expansion-capability-of-Yurthub","editUrl":"https://github.com/openyurtio/openyurt.io/tree/master/blog/blog/2020-06-29-Expansion-capability-of-Yurthub.md","source":"@site/blog/2020-06-29-Expansion-capability-of-Yurthub.md","title":"Viewing Expansion Ability of YurtHub from Edge Autonomy","description":"\u5bfc\u8bfb\uff1aOpenYurt \u81ea\u5f00\u6e90\u4ee5\u6765\uff0c\u4ee5\u975e\u4fb5\u5165\u5f0f\u7684\u67b6\u6784\u8bbe\u8ba1\u878d\u5408\u4e91\u539f\u751f\u548c\u8fb9\u7f18\u8ba1\u7b97\u4e24\u5927\u9886\u57df\uff0c\u5f15\u8d77\u4e86\u4e0d\u5c11\u884c\u4e1a\u5185\u540c\u5b66\u7684\u5173\u6ce8\u3002\u963f\u91cc\u4e91\u63a8\u51fa\u5f00\u6e90\u9879\u76ee OpenYurt\uff0c\u4e00\u65b9\u9762\u662f\u628a\u963f\u91cc\u4e91\u5728\u4e91\u539f\u751f\u8fb9\u7f18\u8ba1\u7b97\u9886\u57df\u7684\u7ecf\u9a8c\u56de\u9988\u7ed9\u5f00\u6e90\u793e\u533a\uff0c\u53e6\u4e00\u65b9\u9762\u4e5f\u5e0c\u671b\u52a0\u901f\u4e91\u8ba1\u7b97\u5411\u8fb9\u7f18\u5ef6\u4f38\u7684\u8fdb\u7a0b\uff0c\u5e76\u548c\u793e\u533a\u5171\u540c\u63a2\u8ba8\u672a\u6765\u4e91\u539f\u751f\u8fb9\u7f18\u8ba1\u7b97\u67b6\u6784\u7684\u7edf\u4e00\u6807\u51c6\u3002","date":"2020-06-29T00:00:00.000Z","formattedDate":"June 29, 2020","tags":[{"label":"yurthub","permalink":"/blog/tags/yurthub"}],"readingTime":9.945,"truncated":true,"authors":[{"name":"rambohe","title":"Maintainer of OpenYurt","url":"https://github.com/rambohe-ch","imageURL":"https://github.com/rambohe-ch.png","key":"rambohe-ch"}],"frontMatter":{"slug":"Expansion-capability-of-Yurthub","title":"Viewing Expansion Ability of YurtHub from Edge Autonomy","authors":["rambohe-ch"],"tags":["yurthub"]},"prevItem":{"title":"How to build Kubernetes Native Cloud side efficient collaborative network","permalink":"/blog/Build-side-efficient-collaborative-network"},"nextItem":{"title":"YurtHub Design Detail:edge autonomy of OpenYurt","permalink":"/blog/YurtHub-design-detail"}},"content":"\u5bfc\u8bfb\uff1aOpenYurt \u81ea\u5f00\u6e90\u4ee5\u6765\uff0c\u4ee5\u975e\u4fb5\u5165\u5f0f\u7684\u67b6\u6784\u8bbe\u8ba1\u878d\u5408\u4e91\u539f\u751f\u548c\u8fb9\u7f18\u8ba1\u7b97\u4e24\u5927\u9886\u57df\uff0c\u5f15\u8d77\u4e86\u4e0d\u5c11\u884c\u4e1a\u5185\u540c\u5b66\u7684\u5173\u6ce8\u3002\u963f\u91cc\u4e91\u63a8\u51fa\u5f00\u6e90\u9879\u76ee OpenYurt\uff0c\u4e00\u65b9\u9762\u662f\u628a\u963f\u91cc\u4e91\u5728\u4e91\u539f\u751f\u8fb9\u7f18\u8ba1\u7b97\u9886\u57df\u7684\u7ecf\u9a8c\u56de\u9988\u7ed9\u5f00\u6e90\u793e\u533a\uff0c\u53e6\u4e00\u65b9\u9762\u4e5f\u5e0c\u671b\u52a0\u901f\u4e91\u8ba1\u7b97\u5411\u8fb9\u7f18\u5ef6\u4f38\u7684\u8fdb\u7a0b\uff0c\u5e76\u548c\u793e\u533a\u5171\u540c\u63a2\u8ba8\u672a\u6765\u4e91\u539f\u751f\u8fb9\u7f18\u8ba1\u7b97\u67b6\u6784\u7684\u7edf\u4e00\u6807\u51c6\u3002\\n\u672c\u6587\u4e3b\u8981\u4ecb\u7ecd\u4e86 OpenYurt \u4e2d\u7ec4\u4ef6 YurtHub \u7684\u6269\u5c55\u80fd\u529b\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## OpenYurt\u4ecb\u7ecd\\n\u963f\u91cc\u4e91\u8fb9\u7f18\u5bb9\u5668\u670d\u52a1\u4e0a\u7ebf 1 \u5e74\u540e\uff0c\u6b63\u5f0f\u5f00\u6e90\u4e86\u4e91\u539f\u751f\u8fb9\u7f18\u8ba1\u7b97\u89e3\u51b3\u65b9\u6848 OpenYurt\uff0c\u8ddf\u5176\u4ed6\u5f00\u6e90\u7684\u5bb9\u5668\u5316\u8fb9\u7f18\u8ba1\u7b97\u65b9\u6848\u7684\u533a\u522b\u5728\u4e8e\uff1aOpenYurt \u79c9\u6301 Extending your native Kubernetes to edge \u7684\u7406\u5ff5\uff0c\u5bf9 Kubernetes \u7cfb\u7edf\u96f6\u4fee\u6539\uff0c\u5e76\u63d0\u4f9b\u4e00\u952e\u5f0f\u8f6c\u6362\u539f\u751f Kubernetes \u4e3a openyurt\uff0c\u8ba9\u539f\u751f K8s \u96c6\u7fa4\u5177\u5907\u8fb9\u7f18\u96c6\u7fa4\u80fd\u529b\u3002\\n\\n\\n\\n\u540c\u65f6\u968f\u7740 OpenYurt \u7684\u6301\u7eed\u6f14\u8fdb\uff0c\u4e5f\u4e00\u5b9a\u4f1a\u7ee7\u7eed\u4fdd\u6301\u5982\u4e0b\u53d1\u5c55\u7406\u5ff5\uff1a\\n\\n\\n\\n- \u975e\u4fb5\u5165\u5f0f\u589e\u5f3a K8s\\n\\n- \u4fdd\u6301\u548c\u4e91\u539f\u751f\u793e\u533a\u4e3b\u6d41\u6280\u672f\u540c\u6b65\u6f14\u8fdb\\n\\n\\n## YurtHub\u67b6\u6784\u8bf4\u660e\\n\u5728[\u524d\u9762\u7684\u6587\u7ae0](./2020-06-18-YurtHub-design-detail.md)\u4e2d\uff0c\u6211\u4eec\u4ecb\u7ecd\u4e86 OpenYurt \u7684\u8fb9\u7f18\u81ea\u6cbb\u80fd\u529b\uff0c\u91cd\u70b9\u89e3\u8bfb\u4e86\u5176\u4e2d\u7684\u7ec4\u4ef6 YurtHub\u3002\u5176\u67b6\u6784\u56fe\u5982\u4e0b\uff1a\\nOpenYurt\u7ec4\u4ef6YurtHub\u6784\u67b6\u56fe\uff1a\\n\\n![image](../static/img/blog/yurthub.png)\\n\\n\\n\u4e0eKubernetes\u8bbe\u8ba1\u7406\u5ff5\u5951\u5408\uff0cYurtHub\u7684\u4f18\u52bf\u4e4b\u4e00\u662f\uff0c\u975e\u5e38\u5bb9\u6613\u6269\u5c55\u51fa\u66f4\u591a\u7684\u80fd\u529b\u3002\\n\\n\\n## YurtHub\u7684\u62d3\u5c55\u80fd\u529b\\n\\n### 1\uff09\u8fb9\u7f18\u7f51\u7edc\u81ea\u6cbb\\n\u9996\u5148\u4ecb\u7ecd\u4e00\u4e0b\u4f55\u8c13\u8fb9\u7f18\u7f51\u7edc\u81ea\u6cbb\uff1a\u5373\u5728\u8fb9\u7f18\u548c\u4e91\u7aef\u7f51\u7edc\u65ad\u8fde\u65f6\uff0c\u4e0d\u7ba1\u662f\u4e1a\u52a1\u5bb9\u5668\u91cd\u542f\uff0c\u6216\u662f\u8fb9\u7f18\u8282\u70b9\u91cd\u542f\u7b49\uff0c\u8fb9\u7f18\u4e1a\u52a1\u7684\u8de8\u8282\u70b9\u901a\u4fe1\u53ef\u4ee5\u6301\u7eed\u5de5\u4f5c\u6216\u662f\u81ea\u52a8\u6062\u590d\u3002\\n\\n\u5728OpenYurt\u4e2d\uff0c\u5b9e\u73b0\u8fb9\u7f18\u81ea\u6cbb\u9700\u8981\u89e3\u51b3\u5982\u4e0b\u7684\u95ee\u9898\uff08\u4ee5flannel vxlan overlay\u7f51\u7edc\u4e3a\u4f8b\uff09\uff1a\\n- \u95ee\u9898 1: \u8282\u70b9\u4e0a\u7684\u7f51\u7edc\u914d\u7f6e\u53ef\u4ee5\u81ea\u6cbb\uff0ckube-proxy \u7684 iptables / ipvs \u89c4\u5219\uff0cflannel \u7684 fdb / arp / route \u914d\u7f6e\uff0ccoredns \u7684\u57df\u540d\u89e3\u6790\u7b49\u7f51\u7edc\u914d\u7f6e\uff0c\u5728\u8282\u70b9\u91cd\u542f\u540e\u53ef\u4ee5\u81ea\u52a8\u6062\u590d\uff0c\u5426\u5219\u8fb9\u7f18\u8de8\u8282\u70b9\u901a\u4fe1\u5c06\u65e0\u6cd5\u6301\u7eed\uff1b\\n- \u95ee\u9898 2: \u4e1a\u52a1\u5bb9\u5668 IP \u4fdd\u6301\u4e0d\u53d8\uff0c\u56e0\u4e3a\u548c\u4e91\u7aef\u7f51\u7edc\u65ad\u8fde\u72b6\u6001\u4e0b\u5bb9\u5668 IP \u53d8\u5316\u5c06\u65e0\u6cd5\u901a\u77e5\u5230\u5176\u4ed6\u8282\u70b9\uff1b\\n- \u95ee\u9898 3: vtep(vxlan tunnel endpoint) \u7684 mac \u5730\u5740\u4fdd\u6301\u4e0d\u53d8\uff0c\u539f\u56e0\u548c\u5bb9\u5668 IP \u4fdd\u6301\u4e0d\u53d8\u7c7b\u4f3c\u3002\\n\\n\\n\u4ece\u95ee\u9898 1 \u53ef\u4ee5\u770b\u51fa\uff0c\u5fc5\u987b\u89e3\u51b3 kube-proxy / flannel / coredns \u7b49\u7ec4\u4ef6\u7684\u81ea\u6cbb\uff0c\u624d\u80fd\u5b9e\u73b0\u7f51\u7edc\u914d\u7f6e\u7684\u81ea\u6cbb\u3002\u5982\u679c\u4e4b\u524d\u8fb9\u7f18\u81ea\u6cbb\u662f\u91c7\u7528\u91cd\u6784 kubelet \u6765\u5b9e\u73b0\u7684\u8bdd\uff0c\u8981\u5b9e\u73b0\u8fb9\u7f18\u7f51\u7edc\u81ea\u6cbb\u5c31\u4f1a\u78b0\u5230\u5f88\u5927\u7684\u9ebb\u70e6\uff0c\u5982\u679c\u5f3a\u884c\u628a\u91cd\u6784\u7684 kubelet \u81ea\u6cbb\u80fd\u529b\u79fb\u690d\u5230\u5404\u4e2a\u7f51\u7edc\u7ec4\u4ef6 (kube-proxy / flannel / coredns)\uff0c\u4e5f\u5bf9\u6574\u4e2a\u67b6\u6784\u5c06\u662f\u5669\u68a6\u3002\\n\\n\u5728 OpenYurt \u4e2d\u56e0\u4e3a YurtHub \u7684\u72ec\u7acb\u6027\uff0ckube-proxy / flannel / coredns \u7b49\u7f51\u7edc\u7ec4\u4ef6\u8f7b\u677e\u4f7f\u7528 YurtHub \u6765\u5b9e\u73b0\u7f51\u7edc\u914d\u7f6e\u7684\u81ea\u6cbb\u80fd\u529b\u3002\u56e0\u4e3a YurtHub \u7f13\u5b58\u4e86 service \u7b49\u7f51\u7edc\u914d\u7f6e\u8d44\u6e90\u5728 local storage\uff0c\u5373\u4f7f\u65ad\u7f51\u5e76\u4e14\u8282\u70b9\u91cd\u542f\uff0c\u7f51\u7edc\u7ec4\u4ef6\u4ecd\u7136\u53ef\u4ee5\u83b7\u5f97\u65ad\u7f51\u524d\u7684 object \u72b6\u6001\u4ee5\u53ca\u76f8\u5e94\u7684\u914d\u7f6e\u4fe1\u606f\u3002\u5982\u4e0b\u56fe\u6240\u793a:\\n\\n![image](../static/img/blog/local_storage.png)\\n\\n\\n\u95ee\u9898 2\uff0c3 \u548c Kubernetes core \u65e0\u5173\uff0c\u4e3b\u8981\u6d89\u53ca\u5230 cni \u63d2\u4ef6\u548c flanneld \u7684\u589e\u5f3a\uff0c\u540e\u7eed\u6587\u7ae0\u4e2d\u518d\u8be6\u7ec6\u4ecb\u7ecd\u3002\\n### 2\uff09\u591a\u4e91\u7aef\u5730\u5740\u652f\u6301\\n\u516c\u6709\u4e91\u4e0a\u7684 Kubernetes \u9ad8\u53ef\u7528\u90e8\u7f72\u65f6\uff0c\u591a\u5b9e\u4f8b kube-apiserver \u524d\u9762\u4e00\u822c\u90fd\u6302\u4e86\u4e00\u4e2a SLB\uff0c\u4f46\u662f\u5728\u4e13\u6709\u4e91\u573a\u666f\u4e0b\u6216\u8005\u8fb9\u7f18\u8ba1\u7b97\u573a\u666f\u4e0b\uff0c\u8282\u70b9\u9700\u8981\u901a\u8fc7\u591a\u4e2a\u4e91\u7aef\u5730\u5740\u6765\u8bbf\u95ee\u3002\u6bd4\u5982:\\n\\n\\n\\n- \u4e13\u6709\u4e91\u573a\u666f\uff1a\u56e0\u4e3a\u6ca1\u6709 SLB \u670d\u52a1\uff0c\u7528\u6237\u9700\u8981\u5728\u4e91\u7aef\u901a\u8fc7 VIP \u65b9\u5f0f\u6765\u81ea\u884c\u5b9e\u73b0 kube-apiserver \u7684\u8d1f\u8f7d\u5747\u8861\uff0c\u6216\u8005\u50cf kubespray \u90a3\u6837\u5728\u6bcf\u4e2a\u8282\u70b9\u4e0a\u90e8\u7f72\u4e00\u4e2a nginx \u6765\u5b9e\u73b0\u591a\u4e91\u7aef\u5730\u5740\u7684\u8bbf\u95ee\uff1b\\n- \u8fb9\u7f18\u8ba1\u7b97\u573a\u666f: \u8003\u8651\u5230\u8fb9\u7f18\u548c\u4e91\u7aef\u4e4b\u95f4\u7f51\u7edc\u7684\u7a33\u5b9a\u6027\u548c\u5b89\u5168\u6027\u8981\u6c42\uff0c\u67d0\u4e9b\u573a\u666f\u4e0b\u7528\u6237\u4e5f\u901a\u8fc7\u4e13\u7ebf\u548c\u516c\u7f51\u4e24\u79cd\u65b9\u5f0f\u548c\u4e91\u7aef\u901a\u4fe1\uff0c\u6bd4\u5982\u4f18\u5148\u91c7\u7528\u4e13\u7ebf\uff0c\u5f53\u4e13\u7ebf\u6545\u969c\u65f6\u80fd\u81ea\u52a8\u5207\u6362\u5230\u516c\u7f51\u901a\u4fe1\u3002\\n\\n\\n\\nYurtHub\u6b63\u5f0f\u8003\u8651\u5230\u4e86\u4e0a\u8ff0\u7684\u9700\u6c42\uff0c\u652f\u6301\u591a\u4e91\u7aef\u5730\u5740\u8bbf\u95ee\u3002\u4e91\u7aef\u5730\u5740\u7684\u8d1f\u8f7d\u5747\u8861\u6a21\u5f0f\u53ef\u4ee5\u9009\u62e9\uff1a\\n- rr(round-robin)\uff1a\u8f6e\u8f6c\u6a21\u5f0f\uff0c\u9ed8\u8ba4\u9009\u62e9\u8be5\u6a21\u5f0f\uff1b\\n\\n- priority: \u4f18\u5148\u7ea7\u6a21\u5f0f\uff0c\u9ad8\u4f18\u5148\u7ea7\u5730\u5740\u6545\u969c\u540e\u624d\u4f7f\u7528\u4f4e\u4f18\u5148\u7ea7\u5730\u5740\u3002\\n\\n\u5177\u4f53\u53ef\u4ee5\u53c2\u7167 YurtHub \u7684 LB \u6a21\u5757\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a\\n\\n![image](../static/img/blog/local_storage.png)\\n\\n\\n### 3\uff09\u8282\u70b9\u7ef4\u5ea6\u7684\u4e91\u7aef\u6d41\u63a7\\n\u5bf9\u4e8e\u4e00\u4e2a\u5206\u5e03\u5f0f\u7cfb\u7edf\u6765\u8bf4\uff0c\u6d41\u63a7\u90fd\u662f\u4e00\u4e2a\u65e0\u6cd5\u56de\u907f\u7684\u95ee\u9898\u3002\u539f\u751f Kubernetes \u4ece\u96c6\u7fa4\u89c6\u89d2\u5728 kube-apiserver \u4e2d\u4ee5\u53ca\u4ece\u8bbf\u95ee\u8005\u89c6\u89d2\u5728 client-go \u5e93\u4e2d\u5c01\u88c5\u4e86\u6d41\u91cf\u7ba1\u63a7\uff0c\u5728\u8fb9\u7f18\u8ba1\u7b97\u573a\u666f\u4e0b\uff0cclient-go \u7684\u6d41\u91cf\u7ba1\u63a7\u65e2\u5206\u6563\u53c8\u5bf9\u4e1a\u52a1\u6709\u4e00\u5b9a\u4fb5\u5165\uff0c\u663e\u7136\u4e0d\u80fd\u5f88\u597d\u7684\u89e3\u51b3\u6d41\u63a7\u95ee\u9898\u3002\\n\\n\\nYurtHub \u5728\u8fb9\u7f18\u53ef\u4ee5\u63a5\u7ba1\u4e0d\u8bba\u662f\u7cfb\u7edf\u7ec4\u4ef6\u8fd8\u662f\u4e1a\u52a1\u5bb9\u5668\u5bf9\u4e91\u7aef\u8bbf\u95ee\u7684\u6d41\u91cf\uff0c\u53ef\u4ee5\u5f88\u597d\u7684\u89e3\u51b3\u8282\u70b9\u7ef4\u5ea6\u7684\u4e91\u7aef\u6d41\u63a7\u95ee\u9898\u3002\u76ee\u524d YurtHub \u7684\u6d41\u63a7\u914d\u7f6e\u662f\uff1a\u5355\u8282\u70b9\u4e0a\u5bf9\u4e91\u7aef\u7684\u5e76\u53d1\u8bf7\u6c42\u6570\u8d85\u8fc7 250 \u4e2a\u65f6\uff0c\u5c06\u62d2\u7edd\u65b0\u7684\u8bf7\u6c42\u3002\\n\\n\\n### 4\uff09\u8282\u70b9\u8bc1\u4e66\u8f6e\u8f6c\u7ba1\u7406\\nKubernetes \u5df2\u7ecf\u652f\u6301\u8282\u70b9\u8bc1\u4e66\u81ea\u52a8\u8f6e\u6362\uff0c\u5373\u5f53\u8282\u70b9\u8bc1\u4e66\u5feb\u8fc7\u671f\u524d\uff0ckubelet \u4f1a\u81ea\u52a8\u5411\u4e91\u7aef\u7533\u8bf7\u65b0\u7684\u8282\u70b9\u8bc1\u4e66\u3002\u4f46\u662f\u5728\u8fb9\u7f18\u8ba1\u7b97\u573a\u666f\u4e0b\uff0c\u5f88\u6709\u53ef\u80fd\u56e0\u4e3a\u8fb9\u7f18\u548c\u4e91\u7aef\u7f51\u7edc\u7684\u65ad\u8fde\uff0c\u9020\u6210 kubelet \u5c06\u65e0\u6cd5\u5b8c\u6210\u8bc1\u4e66\u7684\u8f6e\u6362\u3002\u8bc1\u4e66\u8fc7\u671f\u540e\u5373\u4f7f\u548c\u4e91\u7aef\u7f51\u7edc\u8fde\u63a5\u6062\u590d\uff0c\u8282\u70b9\u8bc1\u4e66\u4e5f\u53ef\u80fd\u65e0\u6cd5\u81ea\u52a8\u8f6e\u6362\uff0c\u5e76\u9020\u6210 kubelet \u7684\u9891\u7e41\u91cd\u542f\u3002\\n\\n\\n\\nYurtHub \u5728\u63a5\u7ba1\u8282\u70b9\u548c\u4e91\u7aef\u901a\u4fe1\u6d41\u91cf\u65f6\uff0c\u540c\u65f6\u4e5f\u53ef\u4ee5\u63a5\u7ba1\u8282\u70b9\u7684\u8bc1\u4e66\u7ba1\u7406\u3002\u8fd9\u6837\u65e2\u89e3\u51b3\u4e86\u5404\u7c7b\u5b89\u88c5\u5de5\u5177\u5bf9\u8282\u70b9\u8bc1\u4e66\u7684\u7ba1\u7406\u7684\u4e0d\u4e00\u81f4\uff0c\u4e5f\u89e3\u51b3\u4e86\u8bc1\u4e66\u8fc7\u671f\u540e\u7f51\u7edc\u518d\u6062\u590d\u65f6\u7684\u8bc1\u4e66\u8f6e\u6362\u95ee\u9898\u3002\u53e6\u5916\u76ee\u524d YurtHub \u8fd8\u662f kubelet \u5171\u4eab\u8282\u70b9\u8bc1\u4e66\uff0cYurtHub \u7684\u72ec\u7acb\u8282\u70b9\u8bc1\u4e66\u7ba1\u7406\u529f\u80fd\u5c06\u5728\u8fd1\u671f\u5f00\u6e90\u3002\\n\\n\\n\\n### 5\uff09\u5176\u4ed6\\nYurtHub \u9664\u4e86\u524d\u9762\u4ecb\u7ecd\u7684\u6269\u5c55\u80fd\u529b\uff0c\u8fd8\u6709\u5f88\u591a\u6709\u4ef7\u503c\u7684\u80fd\u529b\uff0c\u5728\u6b64\u4e5f\u7b80\u5355\u4ecb\u7ecd\uff1a\\n- \u8282\u70b9\u591a\u79df\u9694\u79bb\u7ba1\u7406\uff1a\u5728\u5177\u5907\u591a\u79df\u9694\u79bb\u80fd\u529b\u7684 Kubernetes \u96c6\u7fa4\u4e2d\uff0c\u5047\u5b9a\u8282\u70b9\u5f52\u5c5e\u4e8e\u67d0\u4e2a\u79df\u6237\uff0c\u90a3\u4e48 YurtHub \u5c06\u53ef\u4ee5\u786e\u4fdd\u8282\u70b9\u4e0a\u6240\u6709\u4e91\u7aef\u8bf7\u6c42\u90fd\u53ea\u8fd4\u56de\u8282\u70b9\u6240\u5c5e\u79df\u6237\u7684\u8d44\u6e90\u3002\u6bd4\u5982\u8bf4 list service \u5c06\u53ea\u8fd4\u56de\u8be5\u79df\u6237\u7684 service\u3002\u800c\u8fd9\u79cd\u591a\u79df\u9694\u79bb\u80fd\u529b\u4e0d\u9700\u8981\u5176\u4ed6\u7ec4\u4ef6\u505a\u4efb\u4f55\u4fee\u6539\u3002\u5f53\u7136\u5982\u679c\u8981\u5b9e\u73b0\u96c6\u7fa4\u5185\u7684\u591a\u79df\u9694\u79bb\uff0c\u9700\u8981\u914d\u5408\u76f8\u5e94\u7684\u591a\u7ec4 CRD \u7b49\uff0c\u8be6\u7ec6\u53ef\u4ee5\u53c2\u7167[\u9879\u76eekubernetes-sigs/multi-tenancy](https://github.com/kubernetes-sigs/multi-tenancy)\\n- \u96c6\u7fa4\u95f4\u8282\u70b9\u8fc1\u79fb\uff1a\u67d0\u4e9b\u573a\u666f\u4e0b\uff0c\u8fb9\u7f18\u8282\u70b9\u9700\u8981\u4ece\u96c6\u7fa4 A \u8fc1\u79fb\u5230\u96c6\u7fa4 B\uff0c\u5e38\u89c4\u64cd\u4f5c\u662f\u5148\u4ece\u96c6\u7fa4 A \u4e0b\u7ebf\uff0c\u7136\u540e\u518d\u6b21\u63a5\u5165\u96c6\u7fa4 B\uff0c\u6700\u540e\u5728\u96c6\u7fa4 B \u90e8\u7f72\u8282\u70b9\u4e0a\u7684\u5e94\u7528\u3002\u56e0\u4e3a YurtHub \u5bf9\u8282\u70b9\u6d41\u91cf\u4ee5\u53ca\u8282\u70b9\u8bc1\u4e66\u7684\u63a5\u7ba1\uff0c\u53ef\u4ee5\u76f4\u63a5\u5bf9 YurtHub \u6ce8\u5165\u96c6\u7fa4B\u7684\u4fe1\u606f\uff0c\u8ba9\u8282\u70b9\u65e0\u635f\u8fc1\u79fb\u5230\u96c6\u7fa4 B\uff1b\\n- \u901a\u8fc7\u57df\u540d\u8bbf\u95ee\u4e91\u7aefkube-apiserver\u7b49\u7b49\u4e00\u4e9b\u5176\u4ed6\u529f\u80fd\u3002\\n\\n\\n\\n\\n## \u603b\u7ed3\\n\u901a\u8fc7\u4e0a\u8ff0\u7684\u6269\u5c55\u80fd\u529b\u53ef\u4ee5\u770b\u51fa\uff1a\\n\\n\\n\\n- YurtHub \u4e0d\u4ec5\u4ec5\u662f\u8fb9\u7f18\u8282\u70b9\u4e0a\u7684\u5e26\u6709\u6570\u636e\u7f13\u5b58\u80fd\u529b\u7684\u53cd\u5411\u4ee3\u7406\uff0c\u800c\u4e14\u5bf9 Kubernetes \u8282\u70b9\u5e94\u7528\u751f\u547d\u5468\u671f\u7ba1\u7406\u52a0\u4e86\u4e00\u5c42\u65b0\u7684\u5c01\u88c5\uff0c\u63d0\u4f9b\u8fb9\u7f18\u8ba1\u7b97\u6240\u9700\u8981\u7684\u6838\u5fc3\u7ba1\u63a7\u80fd\u529b\uff1b\\n\\n \\n\\n- YurtHub \u4e0d\u4ec5\u4ec5\u9002\u7528\u4e8e\u8fb9\u7f18\u8ba1\u7b97\u573a\u666f\uff0c\u5176\u5b9e\u8fd8\u53ef\u4ee5\u4f5c\u4e3a\u8282\u70b9\u4fa7\u7684\u4e00\u4e2a\u5e38\u5907\u7ec4\u4ef6\uff0c\u9002\u7528\u4e8e\u4f7f\u7528 Kubernetes \u7684\u4efb\u610f\u573a\u666f\u3002\u76f8\u4fe1\u8fd9\u4e5f\u4f1a\u9a71\u52a8 YurtHub \u5411\u66f4\u9ad8\u6027\u80fd\uff0c\u66f4\u9ad8\u7a33\u5b9a\u6027\u53d1\u5c55\u3002\\n\\n[\u539f\u6587\u94fe\u63a5](https://mp.weixin.qq.com/s/gYxK3GLhDRNkHibYgTchOg)"},{"id":"YurtHub-design-detail","metadata":{"permalink":"/blog/YurtHub-design-detail","editUrl":"https://github.com/openyurtio/openyurt.io/tree/master/blog/blog/2020-06-18-YurtHub-design-detail.md","source":"@site/blog/2020-06-18-YurtHub-design-detail.md","title":"YurtHub Design Detail:edge autonomy of OpenYurt","description":"image","date":"2020-06-18T00:00:00.000Z","formattedDate":"June 18, 2020","tags":[{"label":"yurthub","permalink":"/blog/tags/yurthub"}],"readingTime":6.02,"truncated":true,"authors":[{"name":"rambohe","title":"Maintainer of OpenYurt","url":"https://github.com/rambohe-ch","imageURL":"https://github.com/rambohe-ch.png","key":"rambohe-ch"}],"frontMatter":{"slug":"YurtHub-design-detail","title":"YurtHub Design Detail:edge autonomy of OpenYurt","authors":["rambohe-ch"],"tags":["yurthub"]},"prevItem":{"title":"Viewing Expansion Ability of YurtHub from Edge Autonomy","permalink":"/blog/Expansion-capability-of-Yurthub"},"nextItem":{"title":"Yurtctl:make the native k8s cluster achieve edge computing capabilities","permalink":"/blog/Use-of-yurtctl"}},"content":"![image](../static/img/blog/OpenYurt.png)\\n\\n\u5bfc\u8bfb\uff1aOpenYurt \u5f00\u6e90\u4e24\u5468\u4ee5\u6765\uff0c\u4ee5\u975e\u4fb5\u5165\u5f0f\u7684\u67b6\u6784\u8bbe\u8ba1\u878d\u5408\u4e91\u539f\u751f\u548c\u8fb9\u7f18\u8ba1\u7b97\u4e24\u5927\u9886\u57df\uff0c\u5f15\u8d77\u4e86\u4e0d\u5c11\u884c\u4e1a\u5185\u540c\u5b66\u7684\u5173\u6ce8\u3002\u963f\u91cc\u4e91\u63a8\u51fa\u5f00\u6e90\u9879\u76ee OpenYurt\uff0c\u4e00\u65b9\u9762\u662f\u628a\u963f\u91cc\u4e91\u5728\u4e91\u539f\u751f\u8fb9\u7f18\u8ba1\u7b97\u9886\u57df\u7684\u7ecf\u9a8c\u56de\u9988\u7ed9\u5f00\u6e90\u793e\u533a\uff0c\u53e6\u4e00\u65b9\u9762\u4e5f\u5e0c\u671b\u52a0\u901f\u4e91\u8ba1\u7b97\u5411\u8fb9\u7f18\u5ef6\u4f38\u7684\u8fdb\u7a0b\uff0c\u5e76\u548c\u793e\u533a\u5171\u540c\u63a2\u8ba8\u672a\u6765\u4e91\u539f\u751f\u8fb9\u7f18\u8ba1\u7b97\u67b6\u6784\u7684\u7edf\u4e00\u6807\u51c6\u3002\\n\u672c\u6587\u5c06\u8be6\u7ec6\u4ecb\u7ecdOpenYurt\u7684\u8fb9\u7f18\u81ea\u6cbb\u80fd\u529b\u7684\u8bbe\u8ba1\u7ec6\u8282\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u8fb9\u7f18\u81ea\u6cbb\u7279\u6027\\n\\n### 1\uff09\u7279\u6027\u4ecb\u7ecd\\n\\n\u5c06 Kubernetes \u7cfb\u7edf\u5ef6\u5c55\u5230\u8fb9\u7f18\u8ba1\u7b97\u573a\u666f\uff0c\u8fb9\u7f18\u8282\u70b9\u5c06\u901a\u8fc7\u516c\u7f51\u548c\u4e91\u7aef\u8fde\u63a5\uff0c\u4ece\u516c\u7f51\u7684\u4e0d\u7a33\u5b9a\u6027\u4ee5\u53ca\u6210\u672c\u7b49\u56e0\u7d20\u8003\u8651\uff0c\u8fb9\u7f18\u8981\u6c42\u65ad\u7f51\u72b6\u6001\u6216\u8005\u5f31\u7f51\u72b6\u6001\u4e0b\u8fb9\u7f18\u4e1a\u52a1\u53ef\u4ee5\u6301\u7eed\u8fd0\u884c\u3002\u6211\u4eec\u4ece Gartner \u7684\u8fb9\u7f18\u8ba1\u7b97\u62a5\u544a\u4e2d\u63d0\u5230\u7684\u8fb9\u7f18\u8ba1\u7b97\u8bc9\u6c42\u4e2d\uff0c\u8fb9\u7f18\u81ea\u6cbb\u4e5f\u662f\u4e3b\u8981\u8bc9\u6c42\u4e4b\u4e00\uff1a\\n![image](../static/img/blog/Gartner.png)\\n\\n\u4ece Kubernetes \u7cfb\u7edf\u67b6\u6784\u6765\u770b\uff0c\u4e3b\u8981\u56e0\u4e3a Slave Agent(Kubelet) \u4e2d\u7684\u5bb9\u5668\u4fe1\u606f\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u65ad\u7f51\u72b6\u6001\u4e0b\u56e0\u4e3a\u65e0\u6cd5\u4ece\u4e91\u7aef\u83b7\u53d6\u4e1a\u52a1\u6570\u636e\uff0c\u5982\u679c\u8282\u70b9\u6216\u8005 Kubelet \u91cd\u542f\uff0c\u5c06\u65e0\u6cd5\u8fdb\u884c\u4e1a\u52a1\u5bb9\u5668\u6062\u590d\u3002\\n![image](../static/img/blog/slave_agent.png)\\n\\n### 2\uff09\u8fb9\u7f18\u81ea\u6cbb\u9700\u8981\u89e3\u51b3\u7684\u95ee\u9898\\n\u56e0\u6b64\u8fb9\u7f18\u81ea\u6cbb\u5728Kubernetes\u7cfb\u7edf\u91cc\uff0c\u9700\u8981\u89e3\u51b3\u4e0b\u9762\u7684\u95ee\u9898\uff1a\\n- \u95ee\u9898 1\uff1a\u8282\u70b9\u5f02\u5e38\u6216\u91cd\u542f\u65f6\uff0c\u5185\u5b58\u6570\u636e\u4e22\u5931\uff0c\u7f51\u7edc\u65ad\u8fde\u65f6\u4e1a\u52a1\u5bb9\u5668\u65e0\u6cd5\u6062\u590d\uff1b\\n\\n- \u95ee\u9898 2\uff1a\u7f51\u7edc\u957f\u65f6\u95f4\u65ad\u8fde\uff0c\u4e91\u7aef\u63a7\u5236\u5668\u5bf9\u4e1a\u52a1\u5bb9\u5668\u8fdb\u884c\u9a71\u9010\uff1b\\n\\n- \u95ee\u9898 3\uff1a\u957f\u65f6\u95f4\u65ad\u8fde\u540e\u7f51\u7edc\u6062\u590d\u65f6\uff0c\u8fb9\u7f18\u548c\u4e91\u7aef\u6570\u636e\u7684\u4e00\u81f4\u6027\u4fdd\u969c\u3002\\n\\n\\n#### \u95ee\u98981\u7684\u89e3\u51b3\u65b9\u68481\\n\\n\u91cd\u6784 kubelet \u7ec4\u4ef6\uff0c\u590d\u7528\u6216\u8005\u53c2\u8003 kubelet \u7684 checkpoint \u529f\u80fd\uff0c\u6301\u4e45\u5316\u5bb9\u5668\u4e1a\u52a1\u6570\u636e\u5230\u672c\u5730\u78c1\u76d8\uff0c\u7f51\u7edc\u65ad\u8fde\u72b6\u6001\u4e0b\u5229\u7528\u672c\u5730\u7f13\u5b58\u6570\u636e\u5b9e\u73b0\u4e1a\u52a1\u6062\u590d\u3002\\n![image](../static/img/blog/checkpoint.png)\\n\u8be5\u65b9\u6848\u7ecf\u8fc7\u91cd\u6784 kubelet\uff0c\u6210\u529f\u89e3\u51b3\u8fb9\u7f18\u81ea\u6cbb\u7684\u9700\u6c42\uff0c\u5177\u5907\u5982\u4e0b\u4f18\u70b9\uff1a\\n\\n\\n\\n- \u901a\u8fc7\u91cd\u6784 kubelet\uff0c\u65b9\u4fbf\u5728 kubelet \u4e2d\u96c6\u6210\u5bf9\u7aef\u8bbe\u5907\u7684\u7ba1\u7406\u80fd\u529b\uff1b\\n\\n- \u901a\u8fc7\u91cd\u6784 kubelet\uff0c\u53ef\u4ee5\u5bf9 kubelet \u8fdb\u884c\u8f7b\u91cf\u5316\u6539\u9020\u3002\u6b64\u4f18\u70b9\u4f46\u662f\u4e5f\u610f\u5473\u7740\u539f\u751f kubelet \u529f\u80fd\u7f3a\u5931\u7684\u95ee\u9898\u3002\\n\\n\\n\\n\u4f46\u662f\u4e5f\u6709\u5982\u4e0b\u4e0d\u8db3\uff1a\\n\\n\\n\\n- \u53ef\u7ef4\u62a4\u6027\u5dee: \u4fb5\u5165\u5f0f\u4fee\u6539 kubelet core\uff0c\u8ddf\u968f\u793e\u533a\u7248\u672c\u5347\u7ea7\u975e\u5e38\u56f0\u96be\uff0c\u719f\u6089kubelet\u7684\u540c\u5b66\u90fd\u4f1a\u6709\u540c\u611f\uff0ckubelet \u7ec4\u4ef6\u7531\u4e8e\u76f4\u63a5\u8d1f\u8d23\u8ba1\u7b97\uff0c\u5b58\u50a8\uff0c\u7f51\u7edc\u4ea4\u4e92\uff0c\u6240\u4ee5\u5176\u4ee3\u7801\u7ed3\u6784\u548c\u903b\u8f91\u5f02\u5e38\u590d\u6742\u3002\u56e0\u6b64\u6301\u7eed\u7ef4\u62a4\u4e00\u4e2a\u6df1\u5ea6\u4fee\u6539\u8fc7\u7684 kubelet \u7684\u5de5\u4f5c\u91cf\u53ef\u60f3\u800c\u77e5\uff1b\\n\\n- \u53ef\u6269\u5c55\u6027\u5dee: \u56e0\u4e3a\u81ea\u6cbb\u80fd\u529b\u76f4\u63a5\u505a\u5230\u91cd\u6784\u7684 kubelet \u7ec4\u4ef6\u4e2d\uff0c\u8fd9\u6837\u8fb9\u7f18\u8282\u70b9\u5982\u679c\u5176\u4ed6\u7ec4\u4ef6(\u5982\u7f51\u7edc\u7ec4\u4ef6)\u60f3\u590d\u7528\u8fb9\u7f18\u81ea\u6cbb\u80fd\u529b\u5c06\u9762\u4e34\u91cd\u590d\u9020\u8f6e\u5b50\u7684\u5883\u5730\uff1b\\n\\n- \u573a\u666f\u8026\u5408\u66f4\u6df1: \u4f8b\u5982\u5728 kubelet \u91cd\u6784\u4e2d\u589e\u52a0\u4e86 IOT \u8bbe\u5907\u7ba1\u7406\uff0c\u5c06\u53ef\u80fd\u4f7f kubelet \u548c IOT \u573a\u666f\u6df1\u5ea6\u8026\u5408\u3002\\n\\n\\n\\n#### \u95ee\u98981\u7684\u89e3\u51b3\u65b9\u68482\uff08OpenYurt\u4f7f\u7528\u65b9\u6848\uff09\\n\\n\u5728\u8fb9\u7f18\u8282\u70b9\u4e0a\u589e\u52a0 web \u7f13\u5b58\u53ca\u8bf7\u6c42\u4ee3\u7406 hub(\u53d6\u540d\u4e3a YurtHub\uff0c\u5546\u4e1a\u4ea7\u54c1\u4e2d\u540d\u4e3a edge-hub)\uff0c\u8fb9\u7f18\u4fa7\u7ec4\u4ef6(kubelet)\u548c\u4e91\u7aef\u901a\u4fe1\u5c06\u7ecf\u7531\u8be5\u7ec4\u4ef6\u3002YurtHub \u76f8\u5f53\u4e8e\u5e26\u6709\u6570\u636e\u7f13\u5b58\u529f\u80fd\u7684\u201d\u900f\u660e\u7f51\u5173\u201c\uff0c\u548c\u4e91\u7aef\u7f51\u7edc\u65ad\u8fde\u72b6\u6001\u4e0b\uff0c\u5982\u679c\u8282\u70b9\u6216\u8005 kubelet \u91cd\u542f\uff0c\u5c06\u4ece YurtHub \u4e2d\u83b7\u53d6\u5230\u4e1a\u52a1\u5bb9\u5668\u76f8\u5173\u6570\u636e\uff0c\u6709\u6548\u89e3\u51b3\u8fb9\u7f18\u81ea\u6cbb\u7684\u95ee\u9898\\n\\n![image](../static/img/blog/edge_hub.png)\\n\\n\\n\\n\u76f8\u6bd4\u89e3\u51b3\u65b9\u68481\uff0c\u6709\u5982\u4e0b\u4f18\u52bf\uff1a\\n- kubelet \u96f6\u4fee\u6539\uff0c\u610f\u5473\u539f\u751f kubelet \u80fd\u529b\u5929\u7136\u5177\u5907\uff0c\u540c\u65f6\u8ddf\u968f Kubernetes \u7248\u672c\u5347\u7ea7\u96f6\u8d1f\u62c5\uff1b\\n\\n- \u53ef\u6269\u5c55\u6027\u5f3a\uff0c\u8282\u70b9\u5176\u4ed6\u7ec4\u4ef6\u8f7b\u677e\u590d\u7528 YurtHub\uff1b\\n\\n- \u4e0e Kubernetes \u8bbe\u8ba1\u7406\u5ff5\u5951\u5408\uff0cYurtHub \u975e\u5e38\u5bb9\u6613\u6269\u5c55\u51fa\u66f4\u591a\u7684\u80fd\u529b\u3002\\n\\n\\n\u5f53\u7136 OpenYurt \u7684\u89e3\u51b3\u65b9\u6848\uff0c\u4e5f\u4f1a\u9762\u4e34\u5982\u4e0b\u7684\u95ee\u9898\uff1a\u539f\u751f kubelet \u6bd4\u8f83 high-weight\uff0c\u5728\u8d44\u6e90\u7d27\u5f20\u573a\u666f\u4e0b\u5e94\u7528\u4f1a\u6bd4\u8f83\u6311\u6218\u3002\u76ee\u524d\u5546\u4e1a\u4ea7\u54c1\u4e2d\u8282\u70b9\u89c4\u683c\u63a8\u8350 2U4G \u8d77\u6b65\u3002\\n\\n#### \u95ee\u98982\u7684\u89e3\u51b3\u65b9\u6848\\n\u8be5\u95ee\u9898\u6b63\u662f\u901a\u8fc7\u5f00\u6e90\u7ec4\u4ef6 yurt-controller-manager \u4e2d\u7684 Node Controller \u6765\u89e3\u51b3\u7684\u3002\u5982 github \u4e3b\u9875\u4ecb\u7ecd\u6240\u793a\uff1a\\n![image](../static/img/blog/OpenYurt_arch.png)\\n\\n\\n#### \u95ee\u98983\u7684\u89e3\u51b3\u65b9\u6848\\nKubernetes \u7cfb\u7edf\u4e2d\uff0c\u7528\u6237\u662f\u901a\u8fc7\u4e91\u7aef\u5bf9\u8fb9\u7f18\u8fdb\u884c\u7ba1\u63a7\u7684(\u5982\u5e94\u7528\u90e8\u7f72\uff0c\u5347\u7ea7\uff0c\u6269\u7f29\u5bb9\u7b49)\uff0c\u56e0\u6b64\u5f53\u8fb9\u7f18\u548c\u4e91\u7aef\u7f51\u7edc\u65ad\u8054\u65f6\uff0c\u8fb9\u7f18\u8282\u70b9\u5c06\u4e0d\u4f1a\u4ece\u4e91\u7aef\u540c\u6b65\u7528\u6237\u5bf9\u8282\u70b9\u7684\u7ba1\u63a7\u64cd\u4f5c\uff0c\u56e0\u6b64\u65ad\u7f51\u671f\u95f4\uff0c\u53ea\u8981 YurtHub \u4fdd\u6301\u672c\u5730\u7f13\u5b58\u6570\u636e\u548c\u65ad\u7f51\u65f6\u523b\u4e00\u81f4(\u5373\u65ad\u7f51\u671f\u95f4\u8fb9\u7f18\u7f13\u5b58\u6570\u636e\u4e0d\u66f4\u65b0)\uff0c\u800c\u7f51\u7edc\u6062\u590d\u65f6\uff0c\u518d\u4ece\u4e91\u7aef\u540c\u6b65\u6700\u65b0\u6570\u636e\u5373\u53ef\u3002\\n\\n[\u539f\u6587\u94fe\u63a5](https://mp.weixin.qq.com/s/4BLfvMJJA623ZwRSgUE69A)"},{"id":"Use-of-yurtctl","metadata":{"permalink":"/blog/Use-of-yurtctl","editUrl":"https://github.com/openyurtio/openyurt.io/tree/master/blog/blog/2020-06-08-Use-of-yurtctl.md","source":"@site/blog/2020-06-08-Use-of-yurtctl.md","title":"Yurtctl:make the native k8s cluster achieve edge computing capabilities","description":"image","date":"2020-06-08T00:00:00.000Z","formattedDate":"June 8, 2020","tags":[{"label":"yurtctl","permalink":"/blog/tags/yurtctl"}],"readingTime":8.83,"truncated":true,"authors":[{"name":"Chao Zheng","title":"Maintainer of OpenYurt","url":"https://github.com/charleszheng44","imageURL":"https://github.com/charleszheng44.png","key":"charleszheng44"}],"frontMatter":{"slug":"Use-of-yurtctl","title":"Yurtctl:make the native k8s cluster achieve edge computing capabilities","authors":["charleszheng44"],"tags":["yurtctl"]},"prevItem":{"title":"YurtHub Design Detail:edge autonomy of OpenYurt","permalink":"/blog/YurtHub-design-detail"},"nextItem":{"title":"OpenYurt:edge computing cloud native project","permalink":"/blog/Introduce-of-OpenYurt"}},"content":"![image](../static/img/blog/OpenYurt.png)\\n\\n\u968f\u7740\u7269\u8054\u7f51\u6280\u672f\u4ee5\u53ca 5G \u6280\u672f\u7684\u9ad8\u901f\u53d1\u5c55\uff0c\u5c06\u4e91\u8ba1\u7b97\u7684\u80fd\u529b\u5ef6\u4f38\u81f3\u8fb9\u7f18\u8bbe\u5907\u7aef\uff0c\u5e76\u901a\u8fc7\u4e2d\u5fc3\u8fdb\u884c\u7edf\u4e00\u4ea4\u4ed8\u3001\u7ba1\u63a7\uff0c\u5df2\u6210\u4e3a\u4e91\u8ba1\u7b97\u7684\u91cd\u8981\u53d1\u5c55\u8d8b\u52bf\u3002\u4e3a\u670d\u52a1\u66f4\u591a\u5f00\u53d1\u8005\u628a\u63e1\u8fd9\u4e00\u8d8b\u52bf\uff0c5\u670829\u65e5\uff0c\u963f\u91cc\u5df4\u5df4\u6b63\u5f0f\u5bf9\u5916\u5f00\u6e90\u4e86\u57fa\u4e8e ACK@Edge\uff08\u8fb9\u7f18\u96c6\u7fa4\u6258\u7ba1\u670d\u52a1\uff09\u7684\u4e91\u539f\u751f\u8fb9\u7f18\u8ba1\u7b97\u6846\u67b6 \u2014\u2014\\n[OpenYurt](https://github.com/openyurtio/openyurt)\\n\\n\u81ea OpenYurt \u5f00\u6e90\u4ee5\u6765\u53d7\u5230\u4e86\u5f00\u53d1\u8005\u7684\u5173\u6ce8\uff0c\u4eca\u5929\u8fd9\u7bc7\u6587\u7ae0\u5c06\u5e26\u5927\u5bb6\u5feb\u901f\u4e0a\u624b OpenYurt \uff0c\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528 OpenYurt \u63d0\u4f9b\u7684\u547d\u4ee4\u884c\u7ba1\u7406\u5de5\u5177 Yurtctl\uff0c \u9ad8\u6548\u5feb\u901f\u5730\u90e8\u7f72 OpenYurt \u96c6\u7fa4\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## OpenYurt\u4ecb\u7ecd\\nOpenYurt \u4e3b\u6253\u201c\u4e91\u8fb9\u4e00\u4f53\u5316\u201d\u6982\u5ff5\uff0c\u4f9d\u6258 Kubernetes \u5f3a\u5927\u7684\u5bb9\u5668\u5e94\u7528\u7f16\u6392\u80fd\u529b\uff0c\u6ee1\u8db3\u4e86\u4e91\u8fb9\u4e00\u4f53\u5316\u7684\u5e94\u7528\u5206\u53d1\u3001\u4ea4\u4ed8\u3001\u548c\u7ba1\u63a7\u7684\u8bc9\u6c42\u3002\u76f8\u8f83\u4e8e\u5176\u4ed6\u57fa\u4e8e Kubernetes \u7684\u8fb9\u7f18\u8ba1\u7b97\u6846\u67b6\uff0cOpenYurt \u79c9\u6301\u7740\u201c\u6700\u5c0f\u4fee\u6539\u201d\u539f\u5219\uff0c\u901a\u8fc7\u5728\u8fb9\u7f18\u8282\u70b9\u5b89\u88c5 Yurthub \u7ec4\u4ef6\uff0c\u548c\u5728\u4e91\u7aef\u90e8\u7f72 Yurt-controller-manager\uff0c\u4fdd\u8bc1\u4e86\u5728\u5bf9 Kubernetes \u96f6\u4fb5\u5165\u7684\u60c5\u51b5\u4e0b\uff0c\u63d0\u4f9b\u7ba1\u7406\u8fb9\u7f18\u8ba1\u7b97\u5e94\u7528\u6240\u9700\u7684\u76f8\u5173\u80fd\u529b\u3002\\n\\n\\nOpenYurt \u80fd\u5e2e\u7528\u6237\u89e3\u51b3\u5728\u6d77\u91cf\u8fb9\u3001\u7aef\u8d44\u6e90\u4e0a\u5b8c\u6210\u5927\u89c4\u6a21\u5e94\u7528\u4ea4\u4ed8\u3001\u8fd0\u7ef4\u3001\u7ba1\u63a7\u7684\u95ee\u9898\uff0c\u5e76\u63d0\u4f9b\u4e2d\u5fc3\u670d\u52a1\u4e0b\u6c89\u901a\u9053\uff0c\u5b9e\u73b0\u548c\u8fb9\u7f18\u8ba1\u7b97\u5e94\u7528\u7684\u65e0\u7f1d\u5bf9\u63a5\u3002\u5728\u8bbe\u8ba1 OpenYurt \u4e4b\u521d\uff0c\u6211\u4eec\u5c31\u975e\u5e38\u5f3a\u8c03\u4fdd\u6301\u7528\u6237\u4f53\u9a8c\u7684\u4e00\u81f4\u6027\uff0c\u4e0d\u589e\u52a0\u7528\u6237\u8fd0\u7ef4\u8d1f\u62c5\uff0c\u8ba9\u7528\u6237\u771f\u6b63\u65b9\u4fbf\u5730 \u201cExtending your native kubernetes to edge\u201d\u3002\\n\\n\\n## Yurtctl\uff1a\u4e00\u952e\u8ba9\u539f\u751fk8s\u96c6\u7fa4\u5177\u5907\u8fb9\u7f18\u8ba1\u7b97\u80fd\u529b\\n\\n\u4e3a\u4e86\u8ba9\u539f\u751f K8s \u96c6\u7fa4\u5177\u5907\u8fb9\u7f18\u8ba1\u7b97\u80fd\u529b\uff0cOpenYurt \u4ee5 addon \u4e3a\u8f7d\u4f53\uff0c\u975e\u4fb5\u5165\u5f0f\u7ed9\u539f\u751f K8s \u589e\u5f3a\u4e86\u5982\u4e0b\u80fd\u529b\uff1a\\n- \u8fb9\u7f18\u81ea\u6cbb\u80fd\u529b\uff08YurtHub\uff1a\u5df2\u5f00\u6e90\uff09\uff0c\u4fdd\u8bc1\u5728\u5f31\u7f51\u6216\u8005\u91cd\u542f\u8282\u70b9\u7684\u60c5\u51b5\u4e0b\uff0c\u90e8\u7f72\u5728\u8fb9\u7f18\u8282\u70b9\u4e0a\u7684\u5e94\u7528\u4e5f\u80fd\u6b63\u5e38\u8fd0\u884c\uff1b\\n- \u4e91\u8fb9\u534f\u540c\u80fd\u529b\uff08\u5f85\u5f00\u6e90\uff09\uff0c\u901a\u8fc7\u4e91\u8fb9\u8fd0\u7ef4\u901a\u9053\u89e3\u51b3\u8fb9\u7f18\u7684\u8fd0\u7ef4\u9700\u6c42\uff0c\u540c\u65f6\u63d0\u4f9b\u4e91\u8fb9\u534f\u540c\u80fd\u529b\uff1b\\n- \u5355\u5143\u5316\u7ba1\u7406\u80fd\u529b\uff08\u5f85\u5f00\u6e90\uff09\uff0c\u4e3a\u5206\u6563\u7684\u8fb9\u7f18\u8282\u70b9\uff0c\u8fb9\u7f18\u5e94\u7528\uff0c\u5e94\u7528\u95f4\u6d41\u91cf\u63d0\u4f9b\u5355\u5143\u5316\u95ed\u73af\u7ba1\u7406\u80fd\u529b\uff1b\\n\\n\u57fa\u4e8e\u8fc7\u5f80ACK@Edge\u7684\u7ebf\u4e0a\u8fd0\u7ef4\u7ecf\u9a8c\uff0c\u6211\u4eec\u5f00\u6e90\u4e86Yurtctl\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u5e2e\u52a9\u5b9e\u73b0\u4e86\u539f\u751fKubernetes\u548cOpenYurt\u4e4b\u95f4\u7684\u65e0\u7f1d\u8f6c\u6362\u4ee5\u53ca\u5bf9OpenYurt\u76f8\u5173\u7ec4\u4ef6\u7684\u9ad8\u6548\u8fd0\u7ef4\u3002\\n\\n\\n### Yurtctl\u7684\u5de5\u4f5c\u539f\u7406\\n\\n![image](../static/img/blog/Yurtctl_convert.png)\\n\\nYurtctl\u662f\u4e00\u4e2a\u4e2d\u5fc3\u5316\u7684\u7ba1\u63a7\u5de5\u5177\u3002\u5728 OpenYurt\u4e91\u8fb9\u4e00\u4f53\u7684\u67b6\u6784\u91cc\uff0cYurtctl \u5c06\u76f4\u63a5\u4e0e APIServer \u8fdb\u884c\u4ea4\u4e92\u3002\u5b83\u501f\u52a9\u539f\u751f Kubernetes\u7684Job workload\u5bf9\u6bcf\u4e2anode\u8fdb\u884c\u8fd0\u7ef4\u64cd\u4f5c\u3002\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u5728\u6267\u884c\u8f6c\u6362\uff08convert\uff09\u64cd\u4f5c\u65f6\uff0cYurtctl \u4f1a\u901a\u8fc7 Job \u5c06\u4e00\u4e2a servant Pod \u90e8\u7f72\u5230\u7528\u6237\u6307\u5b9a\u7684\u8fb9\u7f18\u8282\u70b9\u4e0a\u3002\\n\\nservant Pod \u91cc\u7684\u5bb9\u5668\u6267\u884c\u7684\u5177\u4f53\u64cd\u4f5c\u8bf7\u53c2\u8003\uff1a\uff08OpenYurt:release-v0.1-beta.1\uff5ev0.3\uff09\\nhttps://github.com/openyurtio/openyurt/blob/release-v0.1-beta.1/config/yurtctl-servant/setup_edgenode\\n\\n\\n\\n\u7531\u4e8e servant Pod \u9700\u8981\u76f4\u63a5\u64cd\u4f5c\u8282\u70b9 root \u7528\u6237\u7684\u6587\u4ef6\u7cfb\u7edf\uff08\u4f8b\u5982\u5c06 yurthub \u914d\u7f6e\u6587\u4ef6\u653e\u7f6e\u4e8e /etc/kubernetes/manifests \u76ee\u5f55\u4e0b\uff09\uff0c\u5e76\u4e14\u9700\u8981\u91cd\u7f6e\u7cfb\u7edf\u7ba1\u7406\u7a0b\u5e8f\uff08kubelet.service\uff09\uff0cservant Pod \u4e2d\u7684 container \u5c06\u88ab\u8d4b\u4e88 privileged \u6743\u9650\uff0c\u5141\u8bb8\u5176\u4e0e\u8282\u70b9\u5171\u4eab pid namespace\uff0c\u5e76\u5c06\u501f\u7531 nsenter \u547d\u4ee4\u8fdb\u5165\u8282\u70b9\u4e3b\u547d\u540d\u7a7a\u95f4\u5b8c\u6210\u76f8\u5173\u64cd\u4f5c\u3002\u5f53 servant Job \u6210\u529f\u6267\u884c\u540e\uff0cJob \u4f1a\u81ea\u52a8\u5220\u9664\u3002\u5982\u679c\u5931\u8d25\uff0cJob \u5219\u4f1a\u88ab\u4fdd\u7559\uff0c\u65b9\u4fbf\u8fd0\u7ef4\u4eba\u5458\u6392\u67e5\u9519\u8bef\u539f\u56e0\u3002\u501f\u7531\u8be5\u673a\u5236\uff0cYurtctl \u8fd8\u53ef\u5bf9 Yurthub \u8fdb\u884c\u66f4\u65b0\u6216\u8005\u5220\u9664\u3002\\n\\n\\n## \u6848\u4f8b\uff1a\u4e00\u952e\u8f6c\u6362OpenYurt\u96c6\u7fa4\\n###1\uff09\u83b7\u53d6yurtctl\\nOpenYurt github \u4ed3\u5e93\u5305\u62ec\u4e86 yurtctl \u7684\u6e90\u7801\uff0c\u4e0b\u8f7d OpenYurt \u4ed3\u5e93\u4e4b\u540e\uff0c\u5373\u53ef\u901a\u8fc7\u7f16\u8bd1\u83b7\u5f97 yurtctl\uff0c\u5177\u4f53\u547d\u4ee4\u5982\u4e0b\uff1a\\n\\n```\\n$ make build WHAT=cmd/yurtctl\\nhack/make-rules/build.sh cmd/yurtctl\\nBuilding cmd/yurtctl\\n```\\n\u7f16\u8bd1\u6210\u529f\u4e4b\u540e\uff0cyurtctl \u53ef\u6267\u884c\u6587\u4ef6\u5c31\u53ef\u4ee5\u5728 _output/bin/ \u76ee\u5f55\u4e0b\u627e\u5230\u3002 \\n\\n###2\uff09\u5c06Kubernetes\u8f6c\u6362\u4e3aOpenYurt\\n\u5982\u679c\u6211\u4eec\u60f3\u5c06\u4e00\u4e2a\u53cc\u8282\u70b9\uff08node1 \u548c node2\uff09\u7684 Kubernetes \u96c6\u7fa4\u8f6c\u6362\u6210 OpenYurt \u96c6\u7fa4\uff0c\u5e76\u4e14\u53ea\u60f3\u8ba9 node2 \u6210\u4e3a\u81ea\u6cbb\u8fb9\u7f18\u8282\u70b9\uff0c\u90a3\u4e48\u53ef\u4ee5\u901a\u8fc7\u6267\u884c yurtctl convert \u6765\u5b9e\u73b0\uff0c\u5177\u4f53\u547d\u4ee4\u5982\u4e0b\uff1a\\n```\\n$ yurtctl convert --cloud-nodes node1 --provider ack\\nI0603 14:34:33.714304   40825 convert.go:164] mark node1 as the cloud-node\\nI0603 14:34:33.719816   40825 convert.go:172] mark node2 as the edge-node\\nI0603 14:34:33.736609   40825 convert.go:198] deploy the yurt controller manager\\nI0603 14:34:33.742272   40825 convert.go:210] deploying the yurt-hub and resetting the kubelet service...\\nI0603 14:34:53.810165   40825 util.go:168] servant job(yurtctl-servant-convert-node2) has succeeded\\n```\\n\u6210\u529f\u914d\u7f6e\u8282\u70b9\u4e4b\u540e\uff0c\u6211\u4eec\u9700\u8981\u5c06\u8fb9\u7f18\u8282\u70b9\u6807\u8bb0\u4e3a\u81ea\u6cbb\u72b6\u6001\uff0c\u5177\u4f53\u547d\u4ee4\u5982\u4e0b\uff1a\\n``` \\n$ yurtctl markautonomous # \u5982\u679c\u7528\u6237\u53ea\u60f3\u6807\u8bb0\u90e8\u5206\u8fb9\u7f18\u8282\u70b9\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 --autonomous-nodes \u9009\u9879\u6307\u5b9a\\nI0602 11:22:05.610222   89160 markautonomous.go:149] mark node2 as autonomous\\n```\\n\\n\u63a5\u7740\u6211\u4eec\u5c31\u53ef\u4ee5\u6d4b\u8bd5 node2 \u5728\u65ad\u7f51\u73af\u5883\u4e0b\u662f\u5426\u80fd\u5b9e\u73b0\u8282\u70b9\u81ea\u6cbb\u3002\u9996\u5148\uff0c\u5728 node2 \u4e0a\u90e8\u7f72\u4e00\u4e2a\u6d4b\u8bd5 pod\uff1a\\n```\\n$ kubectl apply -f-<<EOF\\napiVersion: v1\\nkind: Pod\\nmetadata:\\n  name: bbox\\nspec:\\n  nodeName: node2\\n  containers:\\n  - image: busybox\\n    command:\\n    - top\\n    name: bbox\\nEOF\\npod/bbox created\\n```\\n\u767b\u9646\u5230 node2 \u4e0a\uff0c\u5c06 Yurthub \u7684 --server-addr \u53c2\u6570\u8bbe\u7f6e\u4e3a\u4e00\u4e2a\u4e0d\u53ef\u8bbf\u95ee\u7684\u5730\u5740\uff1a\\n``` \\nsudo sed -i \'s|--server-addr=.*|--server-addr=https://1.1.1.1:1111|\' /etc/kubernetes/manifests/yurt-hub.yaml\\n```\\n\u8010\u5fc3\u7b49\u5f85 40 \u79d2\uff0c\u6211\u4eec\u5c06\u89c2\u5bdf\u5230\uff0c\u5373\u4f7f node2 \u5df2\u7ecf\u5904\u4e8e NotReady \u72b6\u6001\uff0cpod1 \u4ecd\u7136\u5904\u4e8e Running \u72b6\u6001\u3002\u8fd9\u8bf4\u660e\u5f53\u8fb9\u7f18\u8282\u70b9\u5904\u4e8e\u81ea\u6cbb\u72b6\u6001\u65f6\uff0c\u5373\u4f7f node \u4e0d\u5728\u7ebf\uff0cPod \u4e5f\u4e0d\u4f1a\u88ab\u4e91\u7aef node controller \u9a71\u9010\u3002\\n\\n``` \\n$ kubectl get node \\nNAME           STATUS     ROLES    AGE   VERSION\\nnode1          Ready      master   14m   v1.14.8\\nnode2          NotReady   <none>   12m   v1.14.8\\n$ kubectl get pod\\nNAME   READY   STATUS    RESTARTS   AGE\\nbbox   1/1     Running   0          5m12s\\n```\\n\u8fd9\u65f6\u5982\u679c\u5c06 node2 \u91cd\u542f\uff0c\u6211\u4eec\u53ef\u4ee5\u7528 docker ps \uff08\u5047\u8bbe\u8282\u70b9\u4f7f\u7528 docker \u4f5c\u4e3a container runtime\uff09\u547d\u4ee4\u6765\u9a8c\u8bc1 bbox Pod \u4f1a\u88ab\u91cd\u65b0\u62c9\u8d77\u3002\\n``` \\n$ docker ps --format \'table {{.ID}}\\\\t{{.Image}}\\\\t{{.RunningFor}}\' | grep busybox\\nd0c8134fddc1        busybox          About a minutes ago\\n```\\n\u8fd9\u662f\u56e0\u4e3a Kubelet \u4f1a\u4ece Yurthub \u8bfb\u53d6\u7f13\u5b58\u7684\u6570\u636e\uff0c\u6062\u590d\u91cd\u542f\u524d\u7684Pod\u72b6\u6001\u3002\u8fd9\u90e8\u5206\u6280\u672f\u7ec6\u8282\u6211\u4eec\u4f1a\u5728\u540e\u7eed\u7684\u6587\u7ae0\u91cc\u8be6\u7ec6\u4ecb\u7ecd\u3002\\n\\n\\n###3\uff09\u5c06OpenYurt\u8f6c\u6362\u56deKubernetes\\n\u76f8\u5bf9\u7684\uff0c\u901a\u8fc7\u8fd0\u884c yurtctl revert \u547d\u4ee4\uff0c\u7528\u6237\u53ef\u4ee5\u5c06\u4e00\u4e2a OpenYurt \u96c6\u7fa4\u8f6c\u6362\u56de Kubernetes \u96c6\u7fa4\u3002\u5047\u8bbe\u6211\u4eec\u60f3\u5c06\u4e0a\u8ff0\u53cc\u8282\u70b9 Kubernetes \u96c6\u7fa4\u8f6c\u6362\u56de Kubernetes \u6a21\u5f0f\uff0c\u90a3\u4e48\u53ea\u9700\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u5373\u53ef\uff08\u8fd0\u884c\u8be5\u547d\u4ee4\u524d\uff0c\u8bf7\u5148\u5c06 node2 \u4e0a\u7684 yurthub \u91cd\u65b0\u8fde\u4e0a apiserver\uff09\uff1a\\n``` \\n$ yurtctl revert\\nI0603 14:38:55.522376   41016 revert.go:106] label alibabacloud.com/is-edge-worker is removed\\nI0603 14:38:55.527998   41016 revert.go:116] yurt controller manager is removed\\nI0603 14:38:55.548354   41016 revert.go:130] ServiceAccount node-controller is created\\nI0603 14:39:05.572686   41016 util.go:168] servant job(yurtctl-servant-revert-node2) has succeeded\\nI0603 14:39:05.572718   41016 revert.go:142] yurt-hub is removed, kubelet service is reset\\n```\\n\\n\u5982\u679c\u8fd8\u60f3\u4e86\u89e3\u66f4\u591a yurtctl \u7684\u4f7f\u7528\u65b9\u6cd5\uff0c\u8bf7\u53c2\u8003 OpenYurt github \u4ed3\u5e93\u4e0b\u7684yurtctl\u7684\u6559\u7a0b\uff1ahttps://github.com/alibaba/openyurt/tree/master/docs/tutorial\u3002\\n\\n## what\'s Next\\nYurtctl \u76ee\u6807\u662f\u6210\u4e3a\u8fd0\u7ef4\u4eba\u5458\u7ba1\u7406 OpenYurt \u96c6\u7fa4\u7684\u6709\u529b\u5de5\u5177\u3002\u56e0\u6b64\u6211\u4eec\u4f1a\u6301\u7eed\u6f14\u8fdb Yurtctl \u4ee5\u652f\u6301 OpenYurt \u7684\u65b0\u529f\u80fd\u548c\u65b0\u589e\u7684\u8fd0\u7ef4\u6d41\u7a0b\u6216\u573a\u666f\u3002\u4f8b\u5982\uff0c\u4e0d\u4e45\u4e4b\u540e OpenYurt \u8fd8\u5c06\u5f00\u6e90 Yurttunnel\uff0cYurtunit \u7b49\u7ec4\u4ef6\uff0cYurtctl \u4e5f\u5c06\u5bf9\u8fd9\u4e9b\u7ec4\u4ef6\u63d0\u4f9b\u652f\u6301\u3002\u6211\u4eec\u540c\u65f6\u6b22\u8fce\u5927\u5bb6\u63d0\u51fa\u5bf9 Yurtctl \u7684\u9700\u6c42\uff0c\u4e00\u8d77\u52aa\u529b\u4f7f\u5176\u66f4\u52a0\u5b8c\u5584\u3002\\n\\n## \u793e\u533a\u5efa\u8bbe\\nOpenYurt \u793e\u533a\u6b22\u8fce\u65b0\u7528\u6237\u52a0\u5165\u548c\u53c2\u4e0e\u5171\u5efa\u3002\u7528\u6237\u53ef\u4ee5\u901a\u8fc7 Github issue \u83b7\u53d6\u6280\u672f\u652f\u6301\u3001\u62a5\u544a bug\u3001\u63d0\u51fa\u9700\u6c42\u610f\u89c1\u7b49\uff0c\u6216\u8005\u901a\u8fc7 OpenYurt \u7528\u6237\u9489\u9489\u7fa4\u76f4\u63a5\u548c core \u5f00\u53d1\u4eba\u5458\u53d6\u5f97\u8054\u7cfb\u3002\\n[\u539f\u6587\u94fe\u63a5](https://mp.weixin.qq.com/s/tQIIfwClRRmEYO9dE3znhw)"},{"id":"Introduce-of-OpenYurt","metadata":{"permalink":"/blog/Introduce-of-OpenYurt","editUrl":"https://github.com/openyurtio/openyurt.io/tree/master/blog/blog/2020-05-29-Introduce-of-OpenYurt.md","source":"@site/blog/2020-05-29-Introduce-of-OpenYurt.md","title":"OpenYurt:edge computing cloud native project","description":"image","date":"2020-05-29T00:00:00.000Z","formattedDate":"May 29, 2020","tags":[{"label":"openyurt","permalink":"/blog/tags/openyurt"}],"readingTime":8.325,"truncated":true,"authors":[{"name":"Fei Guo","title":"Maintainer of OpenYurt","url":"https://github.com/Fei-Guo","imageURL":"https://github.com/Fei-Guo.png","key":"Fei-Guo"},{"name":"frank-huangyuqi","title":"Maintainer of OpenYurt","url":"https://github.com/huangyuqi","imageURL":"https://github.com/huangyuqi.png","key":"huangyuqi"},{"name":"rambohe","title":"Maintainer of OpenYurt","url":"https://github.com/rambohe-ch","imageURL":"https://github.com/rambohe-ch.png","key":"rambohe-ch"}],"frontMatter":{"slug":"Introduce-of-OpenYurt","title":"OpenYurt:edge computing cloud native project","authors":["Fei-Guo","huangyuqi","rambohe-ch"],"tags":["openyurt"]},"prevItem":{"title":"Yurtctl:make the native k8s cluster achieve edge computing capabilities","permalink":"/blog/Use-of-yurtctl"}},"content":"![image](../static/img/blog/OpenYurt.png)\\n\\n\u5bfc\u8bfb\uff1a\u5317\u4eac\u65f6\u95f4 5 \u6708 29 \u65e5\uff0c\u5728\u963f\u91cc\u4e91\u5bb9\u5668\u670d\u52a1 ACK@Edge\uff08\u8fb9\u7f18\u96c6\u7fa4\u6258\u7ba1\u670d\u52a1\uff09 \u4e0a\u7ebf\u4e00\u5468\u5e74\u4e4b\u9645\uff0c\u963f\u91cc\u5df4\u5df4\u6b63\u5f0f\u5ba3\u5e03\u5c06\u5176\u6838\u5fc3\u80fd\u529b\u5f00\u6e90\uff0c\u5e76\u5411\u793e\u533a\u8d21\u732e\u5b8c\u6574\u7684\u8fb9\u7f18\u8ba1\u7b97\u4e91\u539f\u751f\u9879\u76ee -- OpenYurt\u3002\\n\\n\\n\u8fb9\u7f18\u4e91\u8ba1\u7b97\u662f\u57fa\u4e8e\u4e91\u8ba1\u7b97\u6280\u672f\u7684\u6838\u5fc3\u548c\u8fb9\u7f18\u8ba1\u7b97\u7684\u80fd\u529b\uff0c\u6784\u7b51\u5728\u8fb9\u7f18\u57fa\u7840\u8bbe\u65bd\u4e4b\u4e0a\u7684\u65b0\u578b\u8ba1\u7b97\u5e73\u53f0\uff0c\u5e76\u6b63\u5728\u6210\u4e3a\u884c\u4e1a\u7684\u65b0\u7126\u70b9\u3002OpenYurt \u4f5c\u4e3a\u963f\u91cc\u5df4\u5df4\u9996\u4e2a\u8fb9\u7f18\u8ba1\u7b97\u4e91\u539f\u751f\u5f00\u6e90\u9879\u76ee\uff0c\u6c47\u805a\u4e86\u963f\u91cc\u5df4\u5df4\u4f17\u591a\u8fb9\u7f18\u8ba1\u7b97\u4e1a\u52a1\u56e2\u961f\u7684\u6df1\u539a\u6280\u672f\u79ef\u7d2f\uff0c\u6df1\u5ea6\u6316\u6398\u4e86\u8fb9\u7f18\u8ba1\u7b97 + \u4e91\u539f\u751f\u843d\u5730\u5b9e\u65bd\u8bc9\u6c42\u3002\\n\\n\\n\\n\u4e24\u5e74\u524d\uff0cOpenYurt \u4f5c\u4e3a\u516c\u5171\u4e91\u670d\u52a1 ACK@Edge \u7684\u6838\u5fc3\u6846\u67b6\uff0c\u5c31\u5df2\u7ecf\u5e94\u7528\u4e8e CDN\u3001\u97f3\u89c6\u9891\u76f4\u64ad\u3001\u7269\u8054\u7f51\u3001\u7269\u6d41\u3001\u5de5\u4e1a\u5927\u8111\u3001\u57ce\u5e02\u5927\u8111\u7b49\u5b9e\u9645\u5e94\u7528\u573a\u666f\u4e2d\uff0c\u5e76\u670d\u52a1\u4e8e\u963f\u91cc\u4e91 LinkEdge\u3001\u76d2\u9a6c\u3001\u4f18\u9177\u3001\u89c6\u9891\u4e91\uff08\u89c6\u9891\u70b9\u64ad\u3001\u89c6\u9891\u76f4\u64ad\u3001\u5b9e\u65f6\u901a\u4fe1\u3001\u89c6\u9891\u76d1\u63a7\u3001\u667a\u80fd\u89c6\u89c9\uff09\u7b49\u591a\u4e2a\u4e1a\u52a1\u6216\u9879\u76ee\u4e2d\u3002\\n\\n\\n\\n\u963f\u91cc\u5df4\u5df4\u4e91\u539f\u751f\u5f00\u6e90\u8d1f\u8d23\u4eba\u3001\u4e91\u539f\u751f\u5e94\u7528\u5e73\u53f0\u8d44\u6df1\u6280\u672f\u4e13\u5bb6\u674e\u54cd\u8868\u793a\uff1a\u201c\u968f\u7740\u8fb9\u7f18\u8ba1\u7b97\u7684\u573a\u666f\u548c\u9700\u6c42\u4e0d\u65ad\u589e\u52a0\uff0c\u2018\u4e91\u8fb9\u534f\u540c\u2019\u3001\u2018\u8fb9\u7f18\u4e91\u539f\u751f\u2019\u6b63\u5728\u9010\u6e10\u6210\u4e3a\u65b0\u7684\u6280\u672f\u7126\u70b9\u3002OpenYurt \u5f00\u6e90\u9879\u76ee\u5b9e\u8df5\u2018\u4e91\u8fb9\u4e00\u4f53\u5316\u2019\u6982\u5ff5\uff0c\u4f9d\u6258\u539f\u751f Kubernetes \u5f3a\u5927\u7684\u5bb9\u5668\u7f16\u6392\u3001\u8c03\u5ea6\u80fd\u529b\uff0c\u5b9e\u73b0\u5b8c\u5168\u8fb9\u7f18\u8ba1\u7b97\u4e91\u539f\u751f\u57fa\u7840\u8bbe\u65bd\u67b6\u6784\uff0c\u5e2e\u52a9\u5f00\u53d1\u8005\u8f7b\u677e\u5b8c\u6210\u5728\u6d77\u91cf\u8fb9\u3001\u7aef\u8d44\u6e90\u4e0a\u7684\u5927\u89c4\u6a21\u5e94\u7528\u7684\u4ea4\u4ed8\u3001\u8fd0\u7ef4\u3001\u7ba1\u63a7\u3002\u6211\u4eec\u5e0c\u671b OpenYurt \u5f00\u6e90\u80fd\u63a8\u52a8\u793e\u533a\u5728\u4e91\u539f\u751f\u548c\u8fb9\u7f18\u8ba1\u7b97\u4ea4\u53c9\u9886\u57df\u7684\u534f\u540c\u53d1\u5c55\u3002\u201d\\n\\n\x3c!--truncate--\x3e\\n\\n##  \u4ec0\u4e48\u662fOpenYurt\\n![image](../static/img/blog/OpenYurt-01.png)\\n\\n\u4f7f\u7528 OpenYurt\uff08Yurt\uff0c/j\u025c\u02d0rt/\uff0c\u8499\u53e4\u5305\uff09\u4f5c\u4e3a\u672c\u6b21\u5f00\u6e90\u9879\u76ee\u540d\u79f0\uff0c\u671f\u671b\u4ee5\u5176\u201c\u5f62\u201d\u6765\u8868\u793a\u8fb9\u7f18\u8ba1\u7b97\u4fa7\u91cd\u4e8e\u521b\u5efa\u4e00\u4e2a\u96c6\u4e2d\u7ba1\u7406\u4f46\u7269\u7406\u5206\u5e03\u7684\u57fa\u7840\u8bbe\u65bd\uff0c\u5e76\u652f\u6301\u81ea\u52a8/\u81ea\u6cbb\u8fd0\u884c\u64cd\u4f5c\u7684\u542b\u4e49\u3002\\n\\nOpenYurt \u4e3b\u6253\u201c\u4e91\u8fb9\u4e00\u4f53\u5316\u201d\u6982\u5ff5\uff0c\u4f9d\u6258\u539f\u751f Kubernetes \u5f3a\u5927\u7684\u5bb9\u5668\u7f16\u6392\u3001\u8c03\u5ea6\u80fd\u529b\uff0c\u901a\u8fc7\u4f17\u591a\u8fb9\u7f18\u8ba1\u7b97\u5e94\u7528\u573a\u666f\u9524\u70bc\uff0c\u5b9e\u73b0\u4e86\u4e00\u6574\u5957\u5bf9\u539f\u751f Kubernetes\u201c\u96f6\u201d\u4fb5\u5165\u7684\u8fb9\u7f18\u4e91\u539f\u751f\u65b9\u6848\uff0c\u63d0\u4f9b\u8bf8\u5982\u8fb9\u7f18\u81ea\u6cbb\u3001\u9ad8\u6548\u8fd0\u7ef4\u901a\u9053\u3001\u8fb9\u7f18\u5355\u5143\u5316\u7ba1\u7406\u3001\u8fb9\u7f18\u6d41\u91cf\u62d3\u6251\u7ba1\u7406\uff0c\u5b89\u5168\u5bb9\u5668\u3001\u8fb9\u7f18 Serverless/FaaS\u3001\u5f02\u6784\u8d44\u6e90\u652f\u6301\u7b49\u80fd\u529b\u3002OpenYurt \u80fd\u5e2e\u7528\u6237\u89e3\u51b3\u5728\u6d77\u91cf\u8fb9\u3001\u7aef\u8d44\u6e90\u4e0a\u5b8c\u6210\u5927\u89c4\u6a21\u5e94\u7528\u4ea4\u4ed8\u3001\u8fd0\u7ef4\u3001\u7ba1\u63a7\u7684\u95ee\u9898\uff0c\u5e76\u63d0\u4f9b\u4e2d\u5fc3\u670d\u52a1\u4e0b\u6c89\u901a\u9053\uff0c\u5b9e\u73b0\u548c\u8fb9\u7f18\u8ba1\u7b97\u5e94\u7528\u7684\u65e0\u7f1d\u5bf9\u63a5\u3002\\n\\n### 1\uff09OpenYurt\u8bde\u751f\u80cc\u666f\\n![image](../static/img/blog/OpenYurt-02.png)\\n\u4ece 2017 \u5e74\u5e95\u5f00\u59cb\uff0c\u963f\u91cc\u4e91\u7269\u8054\u7f51\uff08IoT\uff09\u548c CDN (\u5185\u5bb9\u5206\u53d1\u7f51\u7edc)\u670d\u52a1\u4f5c\u4e3a\u5178\u578b\u7684\u8fb9\u7f18\u8ba1\u7b97\u4e1a\u52a1\u6b63\u9762\u4e34\u7740\u4ea7\u54c1\u89c4\u6a21\u7684\u7206\u53d1\u5f0f\u589e\u957f\u3001\u8fd0\u7ef4\u590d\u6742\u5ea6\u6025\u5267\u6500\u5347\u3001\u8fd0\u7ef4\u6548\u7387\u4e0d\u9ad8\u7684\u201c\u4e09\u96be\u201d\u5883\u5730\uff0c\u56e0\u6b64\u5f15\u5165\u4e91\u539f\u751f\u7406\u5ff5\u3001\u5168\u9762\u8f6c\u578b\u8fb9\u7f18\u5e94\u7528\u7684\u8fd0\u7ef4\u7ba1\u7406\u6a21\u5f0f\u6210\u4e3a\u4e9f\u9700\u89e3\u51b3\u7684\u95ee\u9898\u3002\\n\\n\u6b63\u662f\u5728\u8fd9\u6837\u7684\u80cc\u666f\u4e0b\uff0cOpenYurt \u8bde\u751f\u4e8e\u963f\u91cc\u4e91\u5bb9\u5668\u670d\u52a1\u56e2\u961f\uff0c\u5e76\u5728\u63a5\u4e0b\u6765\u7684\u4e24\u5e74\u591a\u65f6\u95f4\u5185\uff0c\u4f5c\u4e3a\u516c\u5171\u4e91\u670d\u52a1 ACK@Edge \u7684\u6838\u5fc3\u6846\u67b6\u88ab\u5e7f\u6cdb\u5e94\u7528\u4e8e CDN\u3001\u97f3\u89c6\u9891\u76f4\u64ad\u3001\u7269\u8054\u7f51\u3001\u7269\u6d41\u3001\u5de5\u4e1a\u5927\u8111\u3001\u57ce\u5e02\u5927\u8111\u7b49\u5b9e\u9645\u5e94\u7528\u573a\u666f\u4e2d\uff0c\u5e76\u6b63\u5728\u670d\u52a1\u4e8e\u963f\u91cc\u4e91 LinkEdge\u3001\u76d2\u9a6c\u3001\u4f18\u9177\u3001\u89c6\u9891\u4e91\uff08\u89c6\u9891\u70b9\u64ad\uff0c\u89c6\u9891\u76f4\u64ad\uff0c\u5b9e\u65f6\u901a\u4fe1\uff0c\u89c6\u9891\u76d1\u63a7\uff0c\u667a\u80fd\u89c6\u89c9\uff09\u7b49\u591a\u4e2a\u4e1a\u52a1\u6216\u9879\u76ee\u4e2d\u3002\\n\\n\\n### 2\uff09OpenYurt\u6280\u672f\u7279\u70b9\\n\\nOpenYurt\u6cbf\u7528\u4e86\u76ee\u524d\u4e1a\u754c\u6d41\u884c\u7684\u201c\u4e2d\u5fc3\u7ba1\u63a7\u3001\u8fb9\u7f18\u81ea\u6cbb\u201d\u7684\u8fb9\u7f18\u5e94\u7528\u7ba1\u7406\u67b6\u6784\uff0c\u5c06\u201c\u4e91\u8fb9\u7aef\u4e00\u4f53\u5316\u534f\u540c\u201d\u4f5c\u4e3a\u76ee\u6807\uff0c\u8d4b\u80fd\u4e91\u539f\u751f\u80fd\u529b\u5411\u8fb9\u7f18\u7aef\u62d3\u5c55\u3002\u5728\u6280\u672f\u5b9e\u73b0\u4e0a\uff0cOpenYurt\u8d2f\u5f7b\u4e86\u201cExtending your native Kubernetes to Edge\u201d\u7684\u6838\u5fc3\u8bbe\u8ba1\u7406\u5ff5\uff0c\u5176\u6280\u672f\u65b9\u6848\u6709\u5982\u4e0b\u7279\u70b9\uff1a\\n- \u5bf9\u539f\u751fKubernetes\u201c\u96f6\u201d\u4fb5\u5165\uff0c\u4fdd\u8bc1\u5bf9\u539f\u751fk8s API\u7684\u5b8c\u5168\u517c\u5bb9\u3002\\n\\nOpenYurt\u901a\u8fc7proxy node network traffic\uff0c\u5bf9 Kubernetes \u8282\u70b9\u5e94\u7528\u751f\u547d\u5468\u671f\u7ba1\u7406\u52a0\u4e86\u4e00\u5c42\u65b0\u7684\u5c01\u88c5\uff0c\u63d0\u4f9b\u8fb9\u7f18\u8ba1\u7b97\u6240\u9700\u8981\u7684\u6838\u5fc3\u7ba1\u63a7\u80fd\u529b\uff1b\\n\\n- \u65e0\u7f1d\u8f6c\u6362\uff0cOpenYurt\u63d0\u4f9b\u4e86\u5de5\u5177\u5c06\u539f\u751fKubernetes\u201c\u4e00\u952e\u5f0f\u201d\u8f6c\u6362\u6210\u652f\u6301\u8fb9\u7f18\u8ba1\u7b97\u80fd\u529b\u7684 Kubernetes \u96c6\u7fa4\uff1b\\n\\n- \u4f4eOverhead\uff0cOpenYurt\u53c2\u8003\u4e86\u5927\u91cf\u8fb9\u7f18\u8ba1\u7b97\u573a\u666f\u7684\u5b9e\u9645\u9700\u6c42\uff0c\u5728\u4fdd\u8bc1\u529f\u80fd\u548c\u53ef\u9760\u6027\u7684\u57fa\u7840\u4e0a\uff0c\u672c\u7740\u6700\u5c0f\u5316\uff0c\u6700\u7b80\u5316\u7684\u8bbe\u8ba1\u7406\u5ff5\uff0c\u4e25\u683c\u9650\u5236\u65b0\u589e\u7ec4\u4ef6\u7684\u8d44\u6e90\u8bc9\u6c42\u3002  \\n\\n\\n### 3\uff09OpenYurt\u6838\u5fc3\u80fd\u529b\\n![image](../static/img/blog/OpenYurt_arch.png)\\n\\n- \u8fb9\u7f18\u81ea\u6cbb\u80fd\u529b\uff1a \\n\\nYurtHub\u4f5c\u4e3a\u8282\u70b9\u4e0a\u7684\u4e34\u65f6\u914d\u7f6e\u4e2d\u5fc3\uff0c\u5728\u7f51\u7edc\u8fde\u63a5\u4e2d\u65ad\u7684\u60c5\u51b5\u4e0b\uff0c\u6301\u7eed\u4e3a\u8282\u70b9\u4e0a\u6240\u6709\u8bbe\u5907\u548c\u5ba2\u6237\u4e1a\u52a1\u63d0\u4f9b\u6570\u636e\u914d\u7f6e\u670d\u52a1\u3002YurtHub \u63d0\u4f9b\u4e86\u5bf9\u5927\u91cf\u539f\u751f Kubernetes API\u7684\u652f\u6301\uff0c\u53ef\u4ee5\u5728\u8282\u70b9\u548c\u8fb9\u7f18\u5355\u5143\u7ef4\u5ea6\u63d0\u4f9b\u201cShadowApiserver\u201d\u7684\u80fd\u529b\uff0c\u5728\u8fb9\u7f18\u8ba1\u7b97\u5f31\u7f51\u7edc\u94fe\u63a5\u573a\u666f\u7684\u4ef7\u503c\u5c24\u4e3a\u7a81\u51fa\uff1b\\n\\n\\n- \u8fb9\u7f18\u8fd0\u7ef4\u901a\u9053\\n\\n\u5728\u8fb9\u7f18\u573a\u666f\uff0c\u7531\u4e8e\u5927\u591a\u6570\u8fb9\u7f18\u8282\u70b9\u6ca1\u6709\u66b4\u9732\u5728\u516c\u7f51\u4e4b\u4e0a\uff0c\u4e2d\u5fc3\u7ba1\u63a7\u65e0\u7f1d\u548c\u8fb9\u7f18\u8282\u70b9\u4e3b\u52a8\u5efa\u7acb\u7f51\u7edc\u94fe\u63a5\uff0c\u6240\u6709\u7684Kubernetes\u539f\u751f\u5e94\u7528\u8fd0\u7ef4APIs\uff08logs/exec/metrics\uff09\u4f1a\u5931\u53bb\u6548\u529b\uff1b\\nYurtTunnel \u901a\u8fc7\u5728\u7ba1\u63a7\u4e0e\u8fb9\u7f18\u8282\u70b9\u4e4b\u95f4\u5efa\u7acb\u53cd\u5411\u901a\u9053\uff0c\u5e76\u548c\u8282\u70b9\u7684\u751f\u547d\u5468\u671f\u5b8c\u6574\u8054\u52a8\uff0c\u627f\u8f7d\u539f\u751f\u8fd0\u7ef4 APIs \u7684\u6d41\u91cf\uff1b\\n\\n- \u96c6\u7fa4\u8f6c\u6362\u80fd\u529b\\nYurtctl\u4f5c\u4e3aOpenYurt\u5b98\u65b9\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u63d0\u4f9b\u539f\u751fKubernetes\u96c6\u7fa4\u652f\u6301\u8fb9\u7f18\u8ba1\u7b97infrastructure\u7684\u4e00\u952e\u5f0f\u5207\u6362\u3002\\n\\n\u5176\u4ed6\u66f4\u9ad8\u7ea7\u7684\u529f\u80fd\u6bd4\u5982\u8fb9\u7f18\u6d41\u91cf\u7ba1\u7406\u3001\u5355\u5143\u5316\u7ba1\u7406\uff0c\u90e8\u7f72\u3001\u533a\u57df\u81ea\u6cbb\u7b49\u5c06\u4f1a\u9010\u6b65\u5f00\u6e90\u3002\\n\\n### 4\uff09OpenYurt Roadmap\\n\u4f5c\u4e3a\u963f\u91cc\u4e91\u5bb9\u5668\u670d\u52a1 ACK@Edge \u7684\u5f00\u6e90\u7248\u672c\uff0cOpenYurt \u5c06\u91c7\u7528\u5168\u5f00\u6e90\u793e\u533a\u5f00\u53d1\u6a21\u5f0f\uff0c\u6bcf\u5b63\u5ea6\u53d1\u5e03\u65b0\u7248\u672c\u66f4\u65b0\uff0c\u5305\u542b\u793e\u533a\u4e0a\u6e38\u5b89\u5168/\u5173\u952e bug \u4fee\u590d\u548c\u65b0\u7279\u6027\u3001\u65b0\u80fd\u529b\uff0c\u5e76\u9010\u6b65\u5c06\u4ea7\u54c1\u5b8c\u6574\u80fd\u529b\u5f00\u6e90\u3002\\n\\n\u4e3b\u5bfc\u8fd9\u6b21\u5f00\u6e90\u7684\u963f\u91cc\u5df4\u5df4\u4e91\u539f\u751f\u5e94\u7528\u5e73\u53f0\u56e2\u961f\uff0c\u76ee\u524d\u5df2\u7ecf\u5f00\u6e90 OAM\u3001OpenKruise\u3001Dragonfly\u3001Apache RocketMQ\u3001Apache Dubbo \u7b49\u4f17\u591a\u660e\u661f\u9879\u76ee\uff0c\u662f\u56fd\u5185\u6700\u8d44\u6df1\u7684\u4e91\u539f\u751f\u5f00\u6e90\u8d21\u732e\u56e2\u961f\u3002OpenYurt \u9879\u76ee\u7684\u5f00\u6e90\uff0c\u672c\u7740\u201cExtending your native Kubernetes to Edge\u201d\u7684\u8bbe\u8ba1\u7406\u5ff5\uff0c\u8ba9\u4e91\u539f\u751f\u6280\u672f\u5728\u8fb9\u7f18\u8ba1\u7b97\u9886\u57df\u7684\u751f\u6001\u5efa\u8bbe\u4e0e\u666e\u53ca\u524d\u8fdb\u4e86\u4e00\u5927\u6b65\uff0c\u4e5f\u4e3a\u5168\u7403\u5f00\u53d1\u8005\u62d3\u5c55\u4e91\u539f\u751f\u8fb9\u754c\u8d21\u732e\u4e86\u4e00\u4efd\u529b\u91cf\u3002\\n\\n[\u539f\u6587\u94fe\u63a5](https://mp.weixin.qq.com/s/0LwCE4CpVdttmvx4FAMArg)"}]}')}}]);